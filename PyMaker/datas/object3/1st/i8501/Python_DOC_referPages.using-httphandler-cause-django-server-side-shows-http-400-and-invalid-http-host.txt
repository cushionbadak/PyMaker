Natural Text
I am using HTTPHandler to send logging messages to a Django Web server with The following code, but The server side shows http 400 and Invalid HTTP_HOST header message like this Invalid HTTP_HOST header: '192.168.8.100:8000,192.168.8.100'. The  domain name pr ovided is not valid according to RFC 1034/1035.  [05/Apr/2017 10:43:14] "GET  /VideoParser/lYYDownloaderClientLog/?relativeCreated  =117.00654029846191&thread=5468&levelname=ERROR&exc_info=None&exc_text=None&proc  ess=8920&filename=a.py&msecs=39.52503204345703&stack_info=None&levelno=40&proces  sName=MainProcess&msg=testing+remote+logging&module=a&threadName=MainThread&line  no=26&created=1491360192.039525&funcName=%3Cmodule%3E&args=%28%29&name=main&  pathname=C%3A%5CUsers%5Ci%5CDocuments%5CTencent+Files%5C2281570025%5CFileRecv%5C  a.py HTTP/1.1" 400 68137while request from browser with url http://192.168.8.100:8000/VideoParser/lYYDownloaderClientLog/?filename=log55.p%20y&levelno=40&relativeCreated=88.00482749938965&funcName=%3Cmodule%3E&thread=7144%20&stack_info=None&module=log55&args=%28%29&exc_text=None&pathname=D%3A%5CBaiduYun%20Download%5C%E7%BC%96%E7%A8%8B%5CPython%5Clog55.py&levelname=ERROR&msecs=668.0548%20191070557&threadName=MainThread&process=6664&name=root&lineno=34&msg=yahoo+Serve%20r+Exception&exc_info=None&processName=MainProcess&created=1491225161.6680548could actually send a good request to The server , The server shows The following in this caseso what's wrong with my code using HTTPHandler to send logging messages to a Django Web server  ?As I have tested: If I pass the IP address of my web server to the host parameter of HTTPHandler, the server side would show http 400 and Invalid HTTP_HOST header message, there are also exceptions , pasted here https://bpaste.net/show/f2d2e64e7a7e , while if I pass the domain name instead, then the view function works as expected . so would it be a bug within HTTPHandler? related code For debug django-test\LYYDownloaderServer\VideoParser\urls.pydjango-test\LYYDownloaderServer\VideoParser\views.py
I meet the same problem when I use Django receive log, finally I dont solve it, but i known the problem is. according to the output, I check the source code of logging.handlers.HTTPHandler, and in this class, function emit will instance http.client.HTTPSConnection or http.client.HTTPConnection then execute putrequest and putheader, but in the putrequest will execute putheader to, because the port != 80, the host is host:portso I guess if you use Nginx and 80 port, maybe you can resolve the problemupdate:Finally I resolve it. I make a new class LogHTTPHandler, inherit the HTTPHandler, then rewrite the function emit and comment out h.putheader("Host", host)


Answer URL
https://docs.python.org/3/library/logging.handlers.html#httphandler
https://docs.python.org/3/library/logging.handlers.html#httphandler
