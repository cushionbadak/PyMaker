Natural Text
Inside a python script, I use the difflib.unified_diff() function to receive the differences of two files. Then, following this example, I call the writelines() function to write the result on the screen:Then, I also want to write the differences in a file, but I receive an empty file. Here comes the strange part: if I exchange the order of the two writelines() calls, I get a correct file but empty screen output. The same problem can also be reproduced by just calling the last command twice, like this:This will print the diff only once.I suppose that the second time the function continues from the same (i.e. last) "line" of diff and doesn't have anything to write. So, there must be some kind of iterator I have to reset, but I couldn't find what and how...
difflib.unified_diff() returns a generator. It only produces the output once when iterated.If you need to write it out twice, capture the lines in a list first:From the difflib.unified_diff() documentation:Compare a and b (lists of strings); return a delta (a generator generating the delta lines) in unified diff format.Bold emphasis mine.
You have consumed the generator after the first write that unified_diff returns.difflib.unified_diff(a, b[, fromfile][, tofile][, fromfiledate][, tofiledate][, n][, lineterm])Compare a and b (lists of strings); return a delta (a generator generating the delta lines) in unified diff format.You need to store the output in  a list if you want to use it twice.Once you iterate over a generator once, it has been consumed so there is nothing to iterate over the second time:Calling list on  the gen means you store all the lines in a list so you can iterate and use the lines as many times as you need:


Answer URL
https://docs.python.org/3/library/io.html
