Natural Text
I was writing a C extension function, which was supposed to accept a str object as argument. The code is shown below:But as I test the module in python3 console, I find str objects can't pass the PyUnicode_Check:As far as I know, Python 3’s str() type is called PyUnicode in C and the C code above was written in refer to "python cookbook3" Char15.13. I just can't work out the problem. Can anybody tell me what's wrong with my code.Here is what "python cookbook3" said:If for some reason, you are working directly with a PyObject * and can’t use PyArg_ParseTuple(), the following code samples show how you can check and extract a suitable char * reference, from both a bytes and string object:And the whole code:
If the goal is to accept exactly one argument, the function should be declared as METH_O, not METH_VARARGS; the former passes along the single argument without wrapping, the latter wraps in a tuple which would need to be unpacked or parsed to get the PyUnicode* inside.


Answer URL
https://docs.python.org/3/c-api/structures.html#METH_O
