Natural Text
Given a frame object, I need to get the corresponding module object.  In other words, implement callers_module so this works:(That would be equivalent because I can generate a stack trace in the function for this test case.  The imports are there simply to make that example complete and testable, and prevent callers_module from taking the shortcut of using __name__, since it's in a different module.)I've attempted this:Which gets a frame object, on which f_code will give me a code object, but I can't find out how to get the corresponding module or its name (to use with sys.modules).  If I could get function objects, those have a __module__ attribute (and also have code objects), but that's not present in the frame.  Indeed, not all code objects belong to function objects, such as the code for my test case (with assert, above).  The same can be said of frame/code objects not having a moduleâ€”but many of them do, and in my case they will, so that doesn't need to be handled; however, a simple None or exception is fine in that case, too.It feels like I'm missing something simple.  What needs to be done for this to work?

While inspect.getmodule works great, and I was indeed looking in the wrong place to find it, I found a slightly better solution for me:It still uses inspect.currentframe (which I prefer over the exactly identical sys._getframe), but doesn't invoke inspect's module-filename mapping (in inspect.getmodule).Additionally, this question inspired an interesting way to manage __all__:


Answer URL
https://docs.python.org/3/library/__main__.html
