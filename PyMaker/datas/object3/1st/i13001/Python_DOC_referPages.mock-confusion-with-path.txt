Natural Text
I have a test below using mock on Python 2.6.Inside the module I want to test, I haveTwo questions:When inspecting re = RE.query.filter(RE.e_id == e).one(), I see <MagicMock name='query.filter().one()' id='62856528'>.Why isn't this returning None?Another question is when I change @path('testme.check.RE.query') to @path('testme.check.RE.query') and change query.filter.one to query.one, I notice that nothing is mocked out. Why is this the case?
When you are calling RE.query.filter(RE.e_id == e) in your function-under-test, it is returning a new unconfigured MagicMock, and then you are calling its one function, which is generating that default return_value.You probably want to set the return_value of filter to be a new Mock whose one function returns None.
Short answer is what you want to do isDefault mock's return_value attribute is a MagickMock object (AFAIK allocated as lazy property). IMHO try to avoid this kind of mock configurations, take your class/function more clear and narrow to avoid object browsing. These kind of test make source and tests tangled and create a solid fence to do refactoring. For your second question I can just point you to Where to Patch must read document. From what you say is impossible to find the root cause by I can bet the answer is always in this documentation's chapter.


Answer URL
https://docs.python.org/3/library/unittest.mock.html#where-to-patch
