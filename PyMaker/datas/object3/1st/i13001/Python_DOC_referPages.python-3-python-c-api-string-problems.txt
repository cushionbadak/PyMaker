Natural Text
I am trying to use the Python/C API to run a Python function which returns a string. I want to store that returned string to a C++ variable, but I can't get it to work. I am using Python 3 and it seems like the PyString_FromString() method doesn't work anymore. Here is my code:The python file is called ocr.py, and the function I am trying to call is called get_text(value). I am trying to pass in "ocr_noise.png" as an argument. Any ideas what I should do?EDIT 2: I don't need to use std::string as in the code. What else can I use to store the string returned from the function?
It's essential to check the return values of all Python functions. Python returns a nullptr if there was an error. So PyUnicode_FromString() works fine in your code. It just segfaults because pValue is a nullptr you got from PyObject_CallObject(). Putting PyErr_Print() just after this call prints:You need to pass a tuple of objects as argument, not a single str. Instead you might want to use PyObject_CallFunction(pFunc, "O", pValue) or PyObject_CallFunction(pFunc, "s", "ocr_noise.png").Additionally have a look into PyImport_ImportModule(). Furthermoreshould not even compile since it returns a PyObject * not a string.


Answer URL
https://docs.python.org/3/c-api/unicode.html#c.PyUnicode_AsUTF8
https://docs.python.org/3/c-api/unicode.html#c.PyUnicode_FromObject
