Natural Text
I want to use pytest to check if the argparse.ArgumentTypeError exception is raised for an incorrect argument:However, running pytest says During handling of the above exception, another exception occurred: and consequently the test fails. What am I doing wrong?
The problem is that if argument's type converter raises exception ArgumentTypeError agrparse exits with error code 2, and exiting means raising builtin exception SystemExit. So you have to catch that exception and verify that the original exception is of a proper type:
Here's the ArgumentTypeError test in the test_argparse.py file (found in the development repository)ErrorRaisingAgumentParser is a subclass defined at the start of the file, which redefines the parser.error method, so it doesn't exit, and puts the error message on stderr.  That part's a bit complicated.Because of the redirection I described the comment, it can't directly test for ArgumentTypeError.  Instead it has to test for its message.


Answer URL
https://docs.python.org/3/library/argparse.html#invalid-arguments
