Natural Text
I have a loop that looks like this:What I would like to do is change response of requests.post in the second iteration of the loop. From within my test, I know I can do something like:But that only seems to work for one status_code. I looked at side_effect, and it looks like I can iterate through the loop like so:However, it looks like it doesn't actually get the "right" status code. What's the best way of changing the behavior in side_effect or return_value to properly get the behavior I want? I think side_effect is what I want, but I'm not sure what the best way is to mock the responses.
The simpler and cleaner way to do it ispatch create mock_post object by MagicMock(side_effect=mock_responses) and replace mymodule.requests.post reference. You can also use mock_post to check post() calls by something like:You can do the same work by build and configure mock_post before and then pass it as new parameter (the second patch argument) but by this way you have 2 downsideMore code to write  Lose the ability to use autospec=True options in patchAutospeccing is a very powerful feature of mock framework that prevent a lot of silly bug both in test and code.
Actually turns out it was as simple as:


Answer URL
https://docs.python.org/3/library/unittest.mock.html#patch
https://docs.python.org/3/library/unittest.mock.html#autospeccing
