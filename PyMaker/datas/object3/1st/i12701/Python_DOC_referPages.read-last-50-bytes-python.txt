Natural Text
I am trying to find a string near the end of a text file. The problem is that the text file can vary greatly in size. From 3MB to 4GB. But everytime I try to run a script to find this string in a text file that is around 3GB, my computer runs out of memory. SO I was wondering if there was anyway for python to find the size of the file and then read the last megabyte of it.The code I am currently using is as follows, but like I said earlier, I do not seem to have a big enough memory to read such large files.
Use file.seek():You must specify binary mode when you open the file or you will get 'undefined behavior.'  Under python2, it might work anyway (it did for me), but under python3 seek() will raise an io.UnsupportedOperation exception if the file was opened in the default text mode. The python 3 docs are here.  Though it isn't clear from those docs, the SEEK_* constants are still in the os module.Update: Using with statement for safer resource management, as suggested by Chris Betti.
You can use the tail recipe with a deque to get the last n lines of a large file:Now test this.First create a big file:Then test:This will return the last n lines rather than the last X bytes of a file. The size of the data is the same as the size of lines -- not the size of the file. The file object fin is used as an iterator over lines of the file, so the entire file is not resident in memory all at once. 
The proposed answer using seek is a correct answer to your question, but I think it's not what you really want to do. Your solution loads the whole file into memory, just to get the last 20 lines. That's the main cause of your problem. The following would solve your memory issue:This will iterate over all lines in the file, but releasing the lines after they have been processed. I would guess, that this solution is already much faster than yours so no further optimization is needed. But if you really want to have just the last 20 lines, but the lines in a deque with a max length of 20.


Answer URL
https://docs.python.org/3/library/io.html#io.IOBase.seek
