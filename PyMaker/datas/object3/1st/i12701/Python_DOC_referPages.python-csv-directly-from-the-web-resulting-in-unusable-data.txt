Natural Text
I'm using Python 3.5 on Windows.I have this little piece of code that downloads close to one hundred CSV files from different URLs stored in Links.txt:The problem is that the CSV files generated always starts with b ' and after the last line of the data follows another ' and a couple of empty rows to wrap things up. I do not see these characters when I look at the files from the browser (before I download them).This creates problems when I want to import and use the data in a database. Do you have any idea on why this happens and how I can get the code to write the CSV files correctly?Tips that can make the code faster/better, or adjustments for other flaws in the code are obviously very welcome.
What's happening is that urllib treats its stream as bytes - any string that looks like b'...' means it's a byte-string.Your immediate problem could be solved by encoding the stream by calling decode('utf-8') (as Chedy2149 shows), which will convert the data's bytes.However, you can complete elide this problem by downloading the file directly to disk. You go through the work of downloading it, splitting it, and writing it to disk, but all that seems unnecessary because your code just ultimately writes the file's contents to disk without additional work against them.You can use urllib.request.urlretrieve and download to a file directly.Here's an example, modified from your code.
In the download_data function you need to convert the byte string csv response to a plain string.Try replacing csv_str = str(csv) by csv_str = csv.decode('utf-8').This should properly decode the byte string returned by response.read().
The problem is that your function returns a bytes object; str() doesn't convert it to a string the way you expect. Use csv_str = csv.decode() instead.


Answer URL
https://docs.python.org/3/library/urllib.request.html#urllib.request.urlretrieve
