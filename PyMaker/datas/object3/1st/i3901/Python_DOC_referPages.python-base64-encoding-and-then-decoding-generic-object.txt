Natural Text
i am trying to convert a numpy.ndarray to base64 and then convert it back.Is base64 library the way to go?the very simple code below does not even works as expected.What am I missing?is there a way to obtain back the original variable?The general question is:can i convert "any" object to a binary string and then convert back to the original type?I maybe can use pickle BUT I would need a compressed format (not in a file):something like
I am not sure what you are trying to accomplish, but you can base-64 encode any object that has a bytes representation.  In the example you gave, you are encoding a numpy array to base64.  This works because a numpy array has a bytes form.  You can reach it by either wrapping bytes() around the array or by use the .tobytes() method.Since we have a bytes representation of the array, you can pass it to the base64 encoder.  Note that if the object is not a byte-like object, it will base64 will try to convert it before encoding, as in the following example:The byte array is nothing special.  It is just a sequence of numbers!  That's it.  You reason you did not recover the numpy array is because encoding-decoding process still just leaves you with the result from x.tobytes() not x itself.  To get back the original object, you need to an interface that can read a sequence of bytes and return an object of some sort.  Luckily, numpy can do just that via the frombuffer function.  However, you will need to tell numpy what TYPE of array it is reading as bytes.  In other words, you could have a int32 array and an int16 array that have identical byte representations, but to recover the correct one, you need to tell numpy which TYPE is correct.  So you need some sort of knowledge of the object. If you want to save an object and then recover it later, that process is called serialization.  There are two very good packages that handles serialization, the first is in the standard library, call pickle, the second is called dill and can handle more complicated objects.
base64 encoding is probably not a great choice here.  It may be a good choice if you need to store or transfer data in environments that, perhaps for legacy reasons, are restricted to ASCII.For numpy arrays, there are simpler methods tostring and frombuffer with the caveat that you need to know the dtype and shape.  If you're using fixed sizes and types you may use it directly:Otherwise, just use numpy's serializer and deserializer, np.save and np.load, which will take care of those details for you:Note: You can always add b64 encode/decode pass over those serialized bytes (i.e. the f.getvalue() string) if you need to - but for all practical purposes you can probably just transport numpy's bytes directly without converting to/from b64.The general question is: can I convert "any" object to a binary string and then convert back to the original type?In theory, yes, because the objects are just bytes on your computer anyway.For general serialization of Python objects, the standard library provides pickle.  Compression could be added with zlib, to give just one example.


Answer URL
https://docs.python.org/3/library/pickle.html
https://docs.python.org/3/library/zlib.html
