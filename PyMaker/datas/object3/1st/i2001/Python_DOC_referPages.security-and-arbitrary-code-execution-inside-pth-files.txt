Natural Text
Reading deeply through the Python site.py documentation, I found this regarding .pth files:Blank lines and lines beginning with # are skipped. Lines starting with import (followed by space or tab) are executed.These two sentences are easy to miss. They're at the end of a long-ish paragraph, meaning that scanning eyes will easily overlook them. I missed them even when I was actively looking for them.An example of code execution comes from python3.6/site-packages/virtualenvwrapper-4.8.2-py2.7-nspkg.pth:What is the purpose of allowing arbitrary code execution inside .pth files?What are the best practices regarding inspecting or securing .pth files given that arbitrary code execution can have wide-ranging negative effects?
What is the purpose of allowing arbitrary code execution inside .pth files?It allows packages to configure sys.path by using code. This might be used for   conditional branching, e.g. platform-specific customizations.What are the best practices regarding inspecting or securing .pth files given that arbitrary code execution can have wide-ranging negative effects?The same as always - know what you're installing.  Using pip install somepackage is already allowing arbitrary code execution, setup.py is executed as code. So there is not really any additional vulnerability or possibility to hide code inside a .pth file.There has been discussion recently about the possibility to deprecate and remove .pth hacks going forward (Python 3.8+), see issue33944 for further detail.


Answer URL
https://docs.python.org/3/library/site.html
