Natural Text
I am struggling to find an explanation on why python decodes carriage return as line feed.I have here for the example a text file of one line containing a Carriage Return character (\r).If I open it as a text file specifying the encoding, I do not find the same string that if open the file in binary mode and the decode it with this same encoding.Indeed when I open the file in text mode, the CR character is replaced with a Line Feed one (\n).Why ?
This has nothing to do with encoding.When you open the file in "r" (text) mode, then universal newline support applies unless you specify something else. That works as follows:When reading input from the stream, if newline is None, universal  newlines mode is enabled. Lines in the input can end in '\n', '\r', or  '\r\n', and these are translated into '\n' before being returned to  the caller.At https://docs.python.org/3/library/io.html under class io.TextIOWrapper.When you open the file in "rb" (binary) mode, then you get exactly what is in the file. It looks like your file has \r in it and when you read it in text mode, you are getting it normalized to \n. But in binary mode it is (of course) not normalized, so you get the inconsistent EOLs that are actually in the file.
This is because the open function's universal newline mode, enabled by default, automatically normalizes '\r' and '\r\n' into '\n'. You can use the newline='' argument if you prefer that the original line endings be preserved instead:Excerpt from the documentation:newline controls how universal newlines works (it only applies to text  mode). It can be None, '', '\n', '\r', and '\r\n'. It works as  follows:On input, if newline is None, universal newlines mode is enabled. Lines in the input can end in '\n', '\r', or '\r\n', and these are  translated into '\n' before being returned to the caller. If it is '',  universal newline mode is enabled, but line endings are returned to  the caller untranslated. If it has any of the other legal values,  input lines are only terminated by the given string, and the line  ending is returned to the caller untranslated.On output, if newline is None, any '\n' characters written are translated to the system default line separator, os.linesep. If  newline is '', no translation takes place. If newline is any of the  other legal values, any '\n' characters written are translated to the  given string.
The full list of default parameter of open are:The newline=None parameter is behind the behavior that you noticed. This parameter when not specified (a.k.a newline=None) results on activating "Universal newline mode". As stated in the documentation, here, this means that \r\n will be translated to \n automatically:On input, if newline is None, universal newlines mode is enabled.  Lines in the input can end in '\n', '\r', or '\r\n', and these are  translated into '\n' before being returned to the caller.When you open the file with mode=rb, the data is loaded as bytes and won't be decoded, thus the automtic translation of \r to \n won't be done.Files opened in binary mode (including 'b' in the mode argument)  return contents as bytes objects without any decodingMore on universal newline support in PEP 278 -- Universal Newline Support. 


Answer URL
https://docs.python.org/3/library/io.html
