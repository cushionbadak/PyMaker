Natural Text
I'm trying to test a very simple function (as a result of multiple failed attempts at testing a more complicated function which uses the argument parser as a parameter).# from ./runfile.py# from ./tests/test_args.pyWhen I run the script runfile.py all works as expected, however when I call pytest tests/test_args.py I get the unrecognised arguments error message below.I've tried setting up a conftest.py file and using addoption but I just seem to be encountering more errors far beyond my experience to fix. Can anyone point me in the right direction of how to run the test using the default arguments from the core script but not have tests/test_args.py being called as an argument for the actual test itself?
The problem comes from the parser.parse_args call which accepts an optional args argument. If this argument is not provided, args are taken from sys.argv.When you execute pytest tests/test_args.py, sys.argv contains ['pytest', 'tests/test_args.py']. The first element of the list is the called program and the second is the first argument.Thus, parser.parse_args called without its args argument considers tests/test_args.py as the value for the first declared argument of the parser. Fortunately, it is unable to parse it and an error occurs with the explicit message unrecognized arguments: tests/test_args.py.To check it, you can add a breakpoint in your test before calling parser.parse_args and inspect sys.argvInvoking pytest without specifying the file to run (just pytest) should pass with no problem.Anyway, your test should pass whatever the manner it is ran. All you have to do for this is specifying explicit args for your parser.parse_args call in your test.For example, passing an empty list will work:But you will probably want to test it with values for the priv_raw_name option:


Answer URL
https://docs.python.org/3/library/argparse.html#the-parse-args-method
https://docs.python.org/3/library/sys.html#sys.argv
