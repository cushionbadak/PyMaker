Natural Text
I'm building a website which has a form which captures user data and runs some cgi on the user data.  One of the first steps of the cgi is that it needs to copy files from the linux webserver to windows machines.  The server would be using an active directory role acount for the copy credential.  I had hoped to simply use something like this:
I used the SMBConnection class found in pysmb (https://pythonhosted.org/pysmb/api/smb_SMBConnection.html). Very simple and no need for mounting.Make sure that the user has logon rights to the fileshare.
This approach has two drawbacks: the first one is that you mount windows share from your webserver. You don;t need to mount it dynamically and in no account you should not mount it for every request. Separate your implementation and infrastructure. Mount required directory in /etc/fstab and let your webserver to rely on existence of the directory.But then there is another problem: what for you are copying the files to another machine? Do you want to process them there? How you want to notify windows machine that it needs to process data? Why not to run another web server on it and send it requests when you need to process something. And at this point you can drop all that network file systems and send the files within the requests. So you will have linux based frontend server which performs some actions by sending HTTP requests to windows backend server. This will also allow you to notify frontend when the processing is ready.
First, drop the exception block as it hides error details, anyway Popen and other subprocess methods only throw exceptions when they cannot start commands (because of command not found), which means that mount is actually called.Second, you really don't need Popen, but call (and as a bonus you get the return code directly)In your case, the problem is the general exception block.This method:returns an integer, so if you remove the exception block you get error because you're adding a string with an integer (TypeError: Can't convert 'int' object to str implicitly). It's a simple mistake that you could have seen if it hadn't for the stupid exception catch which mislead you.But with the generic try/except block without any argument, you just get mount failed useless message. never protect your statements with try:/except:, that's counter-productive.If you really want to do that,do this:Now to sum it up, here's a fixed version of your code (with some slight improvements as a bonus):
The solution was not to mount the share but rather to copy on the fly using smbclient.  The command I'm using refers to an authfile which contains an account with the relevant permissions in the form:The permissions on this file are set to 500.The smbclient command is then used to create a directory on the remote machine and copy files to that directory.Thank you all for the advice, most helpful!


Answer URL
https://docs.python.org/3/library/tempfile.html
