Natural Text
I want choice to return the same value 1000 every time in my unittest. The following code doesn't work.The error message is as follows:How should I modify it to make it work? I'm using python2.7
The problem here is that a() is using an unpatched version of random.choice.Compare functions a and b:It prints e.g.:Why?This line is the problem:It imported random and than stored random.choice into a new variable named choice.Later, mock.patch patched the original random.choice, but not the local choice.Can I patch the local one? Yes:Now it prints e.g.(I used '__main__' because I put this code into the top-level file - it may be something else in your case)So what to do?Either patch everything, or take a different approach. For example, patch a() instead of choice().Alternative SolutionIn this case, where you want to test behaviour of random functions, it may be better to use a seedYou can't know beforehand what random values will be generated for a certain seed, but you can be sure that they will always be the same. Which is exactly what you need in tests.In the last example above, I tested a() after random.seed(0) once and it returned 1000, so I can be sure it will do so every time:
I don't know what is mockobj from tests but what you can do is.


Answer URL
https://docs.python.org/3/library/__main__.html
