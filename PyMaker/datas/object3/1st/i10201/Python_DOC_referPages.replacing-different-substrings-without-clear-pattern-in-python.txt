Natural Text
I need to replace part of some queries (strings) which don't always have the same substring to replace. I want to replace the part regarding date after group by. This part could be any of the following strings:My idea is to search for "(utimestamp)," and get the part from the left (YEAR, DAY, WEEK or MONTH) searching for the first blank space in the left. After having those removed I want to insert another substring, but how can I insert this substring now that I have blank spaces where the new substring should go.I thought of getting the index everytime I removed a string and once there's no more to remove insert the substring there but I think I'm complicating things.Is there an easier, neat way of doing this? Am I missing something?EXAMPLE:Input string that needs replacement:query = """ SELECT DATE(utimestamp) as utimestamp, sum(value) as value     from table     where utimestamp BETWEEN '2000-06-28 00:00:00' AND '2000-07-05 00:00:00'     group by YEAR(utimestamp), MONTH(utimestamp), id """or oretc.Desired result:If should work for all those cases (and more, the ones stated before)Following @Efferalgan answer I came up with this:
From what you asked, I would go forIt concatenates the part before the group by, then MY_COOL_STRING and then first thing before the first (utimestamp).
If I'm not mistaken, you don't want to get rid of the (utimestamp) part, only the YEAR, MONTH, etc. Or maybe I got it wrong but this solution is trivial to adapt in that case: just adapt the rep dict to cover your needs.In any case, I would use regular expressions for that. This should take care of what you want (I think) in a single pass and in a (fairly) simple way.That's just the basic example. Here's a more complete one with comments explaining what the code does, including a test at the end for all the possible patterns you mentioned:You can read more about how re.sub() works.
You may use re.sub() of regex to achieve it:where replace_with is the content you need to update with the pattern '\w+\(utimestamp\)' and query is the string you mentioned in the code.Here, \w+ means alphabets with occurence of one or more, whereas \(utimestamp\) along with that denotes, words followed by the string (utimestamp).EDIT:As is mentioned in the comment, to replace all instances of the timestamp in the query, regex expression should be like:


Answer URL
https://docs.python.org/3/library/re.html#re.sub
