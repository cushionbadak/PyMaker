Natural Text
Consider the following C functions:Now consider the following code in Python:Now the following works:However the following gives AttributeError: 'bytes' object has no attribute 'value' :In the first case the debugger shows c_str as c_char_p(ADDRESS_HERE). In the second case the debugger shows c_str as b'Test2'.So is this a bug in Python/ctypes or am I doing something wrong?
ctypes automatically converts c_char_p return values to bytes objects.Fundamental data types, when returned as foreign function call results, or, for example, by retrieving structure field members or array items, are transparently converted to native Python types. In other words, if a foreign function has a restype of c_char_p, you will always receive a Python bytes object, not a c_char_p instance.If you want the actual pointer value, use ctypes.POINTER(ctypes.c_char) as the restype.
Finally here is a workaround for this problem:To avoid automatic conversions of c_char_p to bytes, set C function's restype as c_void_p:Then cast to c_char_p before passing to a function that expects c_char_p as the common case:


Answer URL
https://docs.python.org/3/library/ctypes.html#ctypes-fundamental-data-types-2
