Natural Text
I have a program that load .so file from linux which works fine with no problem. Now, I'm trying to make the program cross-platform. After struggling for a while, I have managed to compile a dll file to support Windows but when I tried to load from ctypes, I get this error:"WindowsError: exception: access violation writing 0x0000000000000000" It seems it can't even properly pass the arguments to my c-function. I'm thinking I might have made some mistake while converting my c-code for Windows dll or the my python code probably need some more work for properly loading dll and utilize it in Windows. I'm familiar with python but am an novice to both ctypes and C. I tried to search what I'm missing but couldn't figure out what to do. :(I've tried few more things and found where the error occurs but still don't know how to solve. So my problem occurs when the dll function tries to call another dll function inside. I've updated my code to include that part. I've checked that another dll("mylib.dll") call inside my c-code works fine by calling the initfunc inside a main function(In another c-code with the same calling convention.) So my "mylib.dll" doesn't have a problem. I'm guessing I might have to do something more if I want to call a dll function from inside a dll function?Below is my c-code for linux and Windows and How I call them in python. I have edited my code so it would be Minimal, Complete, and Verifiable example, as Antti suggested. I'm quite new to Stack Overflow and didn't understand what it means to make "Minimal, Complete, and Verifiable example" at first. Thanks for the advice and sorry for my ignorance. Now I can reproduce the same problem with my code below. And below is my python code to access the function.I'm not sure if this is an enough information to debug... but with the combination of above python code and Linux c-code compiled ".so" file. I don't have any problem.. but I get the error for the dll case. Any idea will be appreciated. 
After fixing 2 errors in your (Python) code, I was able to successfully run it. Instead of guessing what your error might be (I still think it's a matter of .dll not being found, maybe due to wrong naming), I went the other way around and refactored your code. One thing that I want to point out is ctypes page: [Python 3]: ctypes - A foreign function library for Python.header.h:dll0.c:dll1.c:code.py:Notes:Did some refactoringRenames: files, variables, ... (names that start with "My", scratch my brain)Tried to avoid code duplication (this can be improved more) - extracted it in common areas (like files, variables, ...)Other non critical stuffAdded a freeStruct function that will deallocate the pointer returned by initFunc, otherwise there will be memory leaksC:Didn't test on Lnx (didn't start the VM), but it should workIf something goes wrong (GetProcAddress returns NULL), exit initFunc instead of just printing message and going further. This was a good candidate for the Access ViolationUnload the (inner) .dll before exiting initFuncReversed the Lnx / Win conditionals logic (__linux__ / _WIN32 macro checking) since the dlfcn functions are generic for all Nixes (and if you for example try to build your code on OSX or Solaris (where __linux__ is not defined), it will fall on the Win branch, and obviously fail)Python:Removed np. The code didn't compile with it, and it's absolutely not necessaryChanged param_dict keys from str to bytes to match ctypes.c_char_p (as I'm using Python 3


Answer URL
https://docs.python.org/3/library/ctypes.html#module-ctypes
