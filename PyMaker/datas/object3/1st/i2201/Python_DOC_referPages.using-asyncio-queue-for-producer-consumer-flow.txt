Natural Text
I'm confused about how to use asyncio.Queue for a particular producer-consumer pattern in which both the producer and consumer operate concurrently and independently.First, consider this example, which closely follows that from the docs for asyncio.Queue:There is one finer detail about this script: the items are put into the queue synchronously, with queue.put_nowait(sleep_for) over a conventional for-loop.My goal is to create a script that uses async def worker() (or consumer()) and async def producer().  Both should be scheduled to run concurrently.  No one consumer coroutine is explicitly tied to or chained from a producer.How can I modify the program above so that the producer(s) is its own coroutine that can be scheduled concurrently with the consumers/workers?There is a second example from PYMOTW.  It requires the producer to know the number of consumers ahead of time, and uses None as a signal to the consumer that production is done.
How can I modify the program above so that the producer(s) is its own coroutine that can be scheduled concurrently with the consumers/workers?The example can be generalized without changing its essential logic:Move the insertion loop to a separate producer coroutine.Start the consumers in the background, letting them process the produced items.Wait for the producer(s) to finish by awaiting them, as with await producer() or await gather(*producers), etc.Once all producers are done, wait for the remaining produced items to be processed with await queue.join()Cancel the consumers, all of which are now idly waiting for the next queued item which will never arrive.Here is an example implementing the above:


Answer URL
https://docs.python.org/3/library/asyncio-queue.html#examples
https://docs.python.org/3/library/asyncio-eventloop.html#asyncio.loop.run_in_executor
