Natural Text
I have a method in Python that looks like this (in comicfile.py):I'm trying to write a unit test for this (I've already tested prune_dirs), and so for this is what I have (test_comicfile.py):When I run this test, I get the following:OK, so self.comic_file.page_count() is returning 0. I tried placing the following line after members = zip.namelist() in page_count.During the test, I get this:I'm quite new to unit testing and am quite nebulous on using unittest.mock, but my understanding is that mock_zip-file.return_value.namelist = list(file_tuple) should have made it so that the namelist method of the ZipFile class would return each of the file_tuple contents in turn. What it is doing I have no idea.I think what I'm trying to do here is clear, but I can't seem to figure out how to override the namelist method so that my unit test is only testing this one function instead of having to deal with ZipFile as well.
ZipFile is instantiated as a context manager.  to mock it you have to refer to its __enter__ method.mock_zip_file.return_value.__enter__.return_value.namelist.return_value = list(file_tuple)What you're trying to do is very clear, but the context manager adds complexity to the mocking. One trick is that when a mock registers all calls made to it, in this example it is saying it has a call at:members -> <MagicMock name='ZipFile().__enter__().namelist()' id='4483358280'>This can guide you in registering your mocked object, replace all () with return_value


Answer URL
https://docs.python.org/3/library/unittest.mock.html#calling
