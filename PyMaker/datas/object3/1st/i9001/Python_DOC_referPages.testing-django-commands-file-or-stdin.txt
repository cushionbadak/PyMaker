Natural Text
I am writing a django command that takes a bunch of input and processes it.It seems natural that because of the volume of the data, the input should either come in as a file or as stdin.I would like to easily test it, and by easily, I mean, without having to create a bunch of files in my test environment.Now, I remember somewhere (can't find it properly documented, but I did find the "PR"), that the "-" is supposed to read from stdin, but I can't get it to work.It seems the command should do something like this:But then when I run the command on the command line, it doesn't like the - parameter (says it isn't a file).The command docs recommend writing to self.stdout for better testing. I tried something similar for self.stdin but couldn't get that to work either.Assuredly this is a common pattern, but I couldn't find any good helps on how to do this best. It seems like "There should be one-- and preferably only one --obvious way to do it.", but I can't find it. Is there something I'm missing?
Having a look at the docs for the type= argument to add_argument, it says "the argparse module provides the factory FileType". So I did the following and ./manage.py test_stdin - then worked as you'd expect.
Django command argument parser is a wrapping of argparse module. According to this post: Optional stdin in Python with argparse, you can define an argument to accept stdin or a actual file as an input.Sample command for your reference:management/commands/stdintest.pyYou can call the command without specifying the input file, and the command will grab input from stdinor specify the foo argument with an actual fileI am not sure is that what you need. If I have misunderstood, please leave a comment. Hope it would help.


Answer URL
https://docs.python.org/3/library/argparse.html#type
