Natural Text
I found some code in the shutil module in the standard library that I do not understand._use_fd_functions ends up holding a truthy/falsy value, and it's initialized like this:{os.open, os.stat, os.unlink, os.rmdir} are all functions, and the right argument to <= looks like a boolean, but according to the source, they're functions and sets of functions.I was not able to recreate this behavior in the Python 3.5.2 repl: (tracebacks removed)Of course, since an experienced developer was not able to decipher the code in a few seconds, the code is being too smart. But how does it work, and what does it do?
Your answer is found in the os module:os.supports_dir_fd is a set of functions.In Python and have lower precedence than <= so your set comparison is evaluated first. For set this operator checks if the first set is a subset of the second set.os.supports_dir_fd lists the kind of file operations you can do. This can differ between operating systems, so the os module takes different code paths depending on the current environment. For each function, _add will check if it is allowed on the current OS. So the intent of the code snippet you are asking about is to see if the operations open, stat, unlink and rmdir are supported, and then it does some more checks for specific behaviours that shutil wants to use. In the end, _use_fd_functions will tell if shutil should use file descriptor functions ("fd") at all, depending on what you can do in the current environment.


Answer URL
https://docs.python.org/3/reference/expressions.html#operator-precedence
https://docs.python.org/3/library/stdtypes.html#set.issubset
