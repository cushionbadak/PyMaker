Natural Text
I'm analyzing a cvs file data line by line. For each line, I will generate a string storing the analyzed results.Since the file is huge, I must do multiprocessing. But because I have to access the results by their index,I have to store them in order (to a local file). One way I tried and worked is using lock, but it's still very slow. If i didn't lock it, it runs fast, but the data will be messed.What I want to do is to store those results in order to a global list. And I can write to a local file when all of the subprocesses are done.Any hints how to do it without a lock and how to speed it up?The following are my multiprocessing part code:Thanks!!
ThreadPoolExecuter is great for running the same method in parallel with different sets of data, and for re-assembling the results from each thread.As the results come back from each thread put them in a list something like [(index1, result1), (index2, result2),...] as/when they return, sort the list by index when all threads have completed, then write the sorted list to a file.The catch here is that this keeps all of your results in memory, but you should be able to do this as you're already keeping them all in memory in each of your processes.
I'd suggest using a multiprocessing.Pool and using its imap method to do the work. Have the workers return values instead of writing them directly, with the main process performing all the I/O. imap guarantees you get the results in the order the tasks were dispatched, and with only the main process performing I/O, conflicts are impossible.It's also an improvement because you can split up your work into fixed chunks instead of carefully dividing the work to match the number of processes you wish to launch. multiprocessing.Pool, by default, spawns a number of workers equal to your CPU cores (so no need to manually specify the number of workers and risk too few, wasting cores, or too many, wasting time on context switches). And map/imap and company will seamlessly split X work items among N workers, without needing to ensure the number of work items equals the number of work items.


Answer URL
https://docs.python.org/3/library/concurrent.futures.html#threadpoolexecutor-example
