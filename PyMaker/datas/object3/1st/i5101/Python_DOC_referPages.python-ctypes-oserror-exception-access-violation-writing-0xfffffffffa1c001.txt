Natural Text
Here is a code for writing values to memory using memory mapping. When I try to run the code, I get the error    "File "MMF.py", line 26, in     memcpy(pBuf, szMsg, len(szMsg))     OSError: exception: access violation writing 0xFFFFFFFFFA1C001B"
Before anything, here's (almost) everything that you need: [Python 3]: ctypes - A foreign function library for Python. ctypes.wintypes is not explained, but you can see its exports by running dir(ctypes.wintypes) in the Python console. Note that all these types are simple ctypes types, I use them just for convention / consistency / readability's sake.Your updated code (code.py):Notes:Added the argtypes and restype for the functions. Details can be seen in the "Specifying the required argument types (function prototypes)" and "Return types" sections, and of course MSDN for function declarationsmemcpy's 2nd argument is a Python string, which is not the same its char * address (not to mention that in Python 3, strings are wchar_t based) that memcpy expects, this will probably yield Undefined BehaviorFILE_MAP_ALL_ACCESS's value is 0x000F001F (printed out the value from VStudio 2015), 0x04 corresponds to FILE_MAP_READError converting INVALID_HANDLE_VALUE's old value to HANDLE, changed it to -1 (as in handleapi.h)You're calling CreateFileMappingA with a c_wchar_p. That will set a name consisting of only the 1st character from the supplied string for the mapping object because each wcha_t consists of 2 bytes: 0x00 plus the corresponding char value - 'A' will be represented as 0x00 0x41 (generally this is not true - especially the 0x00 part, but in our case, it is) - so the 2nd char in the lpName argument (due to little-endianness) will be 0x00 (NULL)No need to import msvcrt module, just for _getch which is also exposed by vcruntime140.dll (ucrtbase.dll)According to the page above:Accessing the standard C library through cdll.msvcrt will use an outdated version of the library that may be incompatible with the one being used by Python.So, I also added [Docs.MS]: RtlCopyMemory function to replace memcpy (you can comment out its line, I left it there just to show that it works), as in the example ([MS.Docs]: Creating Named Shared Memory) that you took the code from, and tried to convert it ([minwinbase.h: 36]: #define CopyMemory RtlCopyMemory)Changed naming convention to be Python compliant ([Python]: PEP 8 -- Style Guide for Python Code)Other (non critical) changes (output formatting, moving lines of code around for a better structure, and so on ...)Output:


Answer URL
https://docs.python.org/3/library/ctypes.html#module-ctypes
