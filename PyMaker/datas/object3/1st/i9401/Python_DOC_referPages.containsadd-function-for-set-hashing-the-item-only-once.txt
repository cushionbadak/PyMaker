Natural Text
This question already has an answer here:Python: how to check if an item was added to a set, without 2x (hash, lookup)                    1 answer                I'm looking for a way to add a value to a set but I also need to know if the value was in the set before I added it. With the additional restriction that the hash of the value is only calculated once (if it wasn't contained before I added it).It would be quite easy without the restriction:But unfortunatly the hash method of the value is quite expensive and I can't (easily) change that class.
One way would be to create a temporary set containing the value and then using set.isdisjoint and set.update - both don't require to recalculate the hash:To verify that this only calculates the hash once:However this approach is definetly slower than the function presented in the question if the hash function isn't expensive!Another way (not really recommended because it uses private functions) is to use the Python-C-API (3.5+) of dict (if one assumes that a dict would be an acceptable alternative to a set). Here simulated with Cython:On the plus side dict_contains_add is really fast (faster than the function presented in the question) but as it (mis-)uses private functions only avaiable for python 3.5 and later it may not be a good alternative.


Answer URL
https://docs.python.org/3/library/stdtypes.html#set.isdisjoint
https://docs.python.org/3/library/stdtypes.html#set.update
