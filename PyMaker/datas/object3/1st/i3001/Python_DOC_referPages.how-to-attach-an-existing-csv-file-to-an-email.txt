Natural Text
I'm trying to follow the example at Attach generated CSV file to email and send with Django to generate a CSV file and send it by email. In my case, however, I would also like to save the actual file, and not only send it my email as in the example. (Also, I'm using Python 3, whereas the example seems to pertain to Python 2).Here is the Django script I'm trying to run:However, I'm getting the following error message when I run python manage.py runscript nps (where scripts/nps.py is the location of the script):What I essentially need to do, as I understand from https://docs.python.org/3/library/io.html#text-i-o, is construct an in-memory io.StringIO from the output file at scripts/nps.csv. How can I go about this?UpdateFollowing the answers, I've replaced csvfile.getvalue() by csvfile.read(). After some refactoring, this is now my send_results_by_email() function:The problem is that it is not sending an email. However, if I replace csvfile.read() with the string 'foobar', I do get an email:with the expected content:Why does it work with the simple string, 'foobar', and not with csvfile.read()? I've printed the contents in the debugger and it does seem to have content, which I've uploaded to https://file.io/kZkNPq (it's scrambled data).Update 2The sending of emails was actually working, the only difference was that GMail was identifying the emails with larger attachments as Phishing and sending them to my Junk folder:
getvalue method is available only on io.StringIO. For an io.TextIOWrapper instance, use the read method.Change csvfile.getvalue() to csvfile.read() and it should work.
Since the csvfile is a _io.TextIOWrapper object, you have to use .read() method instead of getvalue() as,


Answer URL
https://docs.python.org/3/library/io.html#text-i-o
