Natural Text
The script I am writing should exit back to the shell prompt with a helpful message if the data to be processed is not exactly right.  The user should fix the problems flagged until the script is happy and no longer exits with error messages.  I am developing the script with TTD, so I write a pytest test before I write the function.The most heavily up-voted answer here suggests that scripts be edited by calling sys.exit or raising SystemExit.The function:passes this test (where _non-text.png is a PNG file, i.e., not encoded in UTF-8):However, the script continues to run, and statements placed after the try/except block execute.I want the script to completely exit every time so that the user can debug the data until it is correct, and the script will do what it is supposed to do (which is to process a directory full of UTF-8 text files, not PNG, JPG, PPTX... files).Also tried:The following also passes the test above by raising an exception that is a sub-class of SystemExit, but it also does not exit the script:
You can use raise Exception from exception syntax:I this case you doesn't change original error message and add your own message.
The try...except block is for catching an error and handling it internally. What you want to do is to re-raise the error. This will print your message, then automatically re-raise the error you've caught.Instead of just re-raising the old error, you might want to change the error type as well. For this case, you specify raise further, e.g.:
You problem is not how to exit a program (sys.exit() works fine). You problem is that your test scenario is not raising a UnicodeDecodeError.Here's a simplified version of your example. It works as expected:Add some diagnostic printing to your code to learn more. For example:
In the end, what worked is similar to what @ADR proposed, with one difference: I was not able to get the formatted string syntax shown above to work correctly (f'File {file_to_test} must...'), nor could I find documentation of the f prefix for strings.My slightly less elegant solution, then, for the (renamed) function:passes the pytest:


Answer URL
https://docs.python.org/3/whatsnew/3.6.html
