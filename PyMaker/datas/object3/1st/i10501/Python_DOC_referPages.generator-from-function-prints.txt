Natural Text
At the moment I have a little flask project that calls another python file. I'm fully aware that this way is kinda awful, and so, I want to swap it for a function call while maintaining the prints getting yelded to the website. I've tryed to replace the file call with the function directly but it just prints it to the console.I really appreciate any help you can provide.
Assuming that all the printing you want to grab is done within the same module, You can monkey-patch the print function of the other module. In the example below, I use a context manager to revert the original print function after the grabbing is done.This is mod1, the module with the misbehaving function.This is mod2, the module using mod1.bogus_function()The grab_stdout() context manager redirects print calls of module to the file-like object fd. In the function line_generator(), grab_stdout() is used to store the print output of bogus_function in the StringIO object fd. The rest should be self-explanatory.If you don't know exactly whether print is called in other modules in the call tree of the function in question, you can modify grab_stdout as follows:
A simple way would be to temporarily change sys.stdout to a file-like object, call the function, then restore sys.stdout. The output will be available in the file-like object.Here is a working Flask app that demonstrates the method:Here a io.StringIO object is used to collect the standard output produced by the function, and then the lines are yielded from that object. The finally ensures that the original sys.stdout is restored afterwards. There is some additional complexity around the yield statement because yield returns control to the calling code for which stdout must be restored in case the caller also wants to print to stdout.It's assumed that the function in somefile.py is the "main" function, and that invocation of it is guarded by a if __name__ == '__main__': test, something like this:


Answer URL
https://docs.python.org/3/library/io.html?highlight=pipe#io.StringIO
