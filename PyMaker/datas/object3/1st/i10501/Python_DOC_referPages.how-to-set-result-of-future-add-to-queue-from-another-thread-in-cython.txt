Natural Text
I have C++ dll which works with multiple threads.So I wrapped this library with Cython and created special receiver callback-function, which must adds some results to asyncio.Queue.I marked it as nogil, this callback calls from another thread.In this callback I just use:And got deadlock here. How to resolve it?C++ callback declaration (header):cpp:Cython code:Full code:.h http://pastebin.com/ZTCjc6NA.cpp http://pastebin.com/MeygA8im.pyx http://pastebin.com/k4X9c54P.py http://pastebin.com/1YV7tMiF
This is a bit of a guess but you probably have a Cython/C/C++ loop running that's holding the GIL and never releasing it. The callback is then forced for wait forever for it.In normal Python code the GIL is released every few instructions if another thread is waiting for it. In Cython that doesn't happen automatically. One way to ensure that it does happen every so often is to to your loop:This ensures the GIL is released once per loop.Unfortunately it's not obvious to me where you have your main loop. I wonder if it's inside connect in your PyTeamSpeak3 class, and perhaps changing the definition of connect to:might help?


Answer URL
https://docs.python.org/3/c-api/init.html#non-python-created-threads
