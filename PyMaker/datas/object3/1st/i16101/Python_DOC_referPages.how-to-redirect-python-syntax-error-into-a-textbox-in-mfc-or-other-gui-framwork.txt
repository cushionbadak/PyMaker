Natural Text
I embed Python into my GUI application, when the script throws syntax errors, I want to redirect the error message into a textbox, so I can know where the error is.My codes is very simple:If the file contains syntax error, it may looks like:The above messages can be seen in a console window, but now I want to cache these messages in a GUI window.A GUI window don't have a console. I want to output such messages into a text box.Please note that I embed Python into C++, I want to cache Python's Syntax Error in C++.
As the documentation for PyRun_SimpleString clearly says:Returns 0 on success or -1 if an exception was raised. If there was an error, there is no way to get the exception information.So, if you want to get the exception information, you have to use slightly lower-level functions.Meanwhile, once you're using the right function, and it returns NULL or -1 to tell you an exception occurred, how do you get the exception information (and distinguish SyntaxError from other exceptions, for whatever reason you want to do that)?There's a whole chapter in the C-API docs on Exception Handling. But briefly: You call PyErr_Occurred to get the type of the exception. Then you call PyErr_ExceptionMatches to check whether it's the type you want. If so, use PyErr_Fetch to get the value and traceback so you can format them yourself, or PyErr_Format to get a simple formatted string, or whatever else you want. Then you just extract the Unicode or ASCII bytes from the string and put them in your GUI window.
Use a try/catch block and the traceback module (docs).This will only give you the SyntaxError: x part, if you also want the traceback, use traceback.format_exception.


Answer URL
https://docs.python.org/3/c-api/veryhigh.html#c.PyRun_SimpleStringFlags
https://docs.python.org/3/c-api/exceptions.html
