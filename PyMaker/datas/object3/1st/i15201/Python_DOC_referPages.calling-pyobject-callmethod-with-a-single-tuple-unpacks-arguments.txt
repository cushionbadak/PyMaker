Natural Text
Consider the following:I expect it to act like this python code:However my output is simply:I can imagine it is actually calling the function like:What I'm looking for:Why?What is the minimal change can I get to have my expected output?
The issue appears to be with the way Py_BuildValue works (which seems to be used by PyObject_CallMethod). From the docs (emphasis mine):Py_BuildValue() does not always build a tuple. It builds a tuple only  if its format string contains two or more format units. If the format  string is empty, it returns None; if it contains exactly one format  unit, it returns whatever object is described by that format unit. To  force it to return a tuple of size 0 or one, parenthesize the format  string.This means that instead of building the format string "O" with tup into args=(tup,) and calling fmt.format(*args) (expanding to fmt.format(("hello", "world")), it builds args=tup, and so fmt.format(*args) expands to fmt.format("hello", "world"), as you thought. The solution is also in the docs:To force it to return a tuple of size 0 or one, parenthesize the format  string.So, just change:To:And you get the desired output of ('hello', 'world'). Full code snippet (compiled with gcc thissnippet.c -I /usr/include/python3.4m/ -l python3.4m):


Answer URL
https://docs.python.org/3/c-api/object.html#c.PyObject_CallMethod
https://docs.python.org/3/c-api/arg.html#c.Py_BuildValue
https://docs.python.org/3/c-api/arg.html#c.Py_BuildValue
