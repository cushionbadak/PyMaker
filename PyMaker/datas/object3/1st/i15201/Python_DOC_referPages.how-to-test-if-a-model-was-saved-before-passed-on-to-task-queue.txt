Natural Text
In the following method the correct behaviour would to to save the news model before passing its id to the asynchronous Task queue for further processing.Otherwise the task queue has the older version.As you can see I have made a mistake and am saving the model after sending its id to the task queue.  How do I possibly test for that?My test below passes as long as the model was saved. But thats wrong, the order matters, and this test doesn't capture it !!!  Is there a way to achieve this with mock?
I'm doing these kind of tests by using patch from unittest.mock framework.When I need to do test like this the first thing I do is looking for a point where I can put a hook. Then I patch the hook and use side_effect callback to do the test.In your case the hook will be BBCSpider.taskqueue.Task and its side_effect something like this:So your test become:Note autospec=True is not mandatory but I like to use it every time I do a patch to avoid silly errors.I'm apologize if the code contains some mistake (I cannot test it without considerable effort) but I hope the idea is clear.


Answer URL
https://docs.python.org/3/library/unittest.mock.html
