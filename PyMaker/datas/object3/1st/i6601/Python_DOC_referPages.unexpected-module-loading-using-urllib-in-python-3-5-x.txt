Natural Text
There appears to be some unexpected behavior when it comes to phantom module loading with urllib on certain systems. The behavior is as follows:The unexpected behavior is that the additional names are loaded after only trying to access a bad attribute and getting a AttributeError. On another system with the same python interpreter (Ubuntu 16.04 apt python3) this does not happen:We have tested on several OSes and interpreters and the only other one that exhibits the unexpected behavior is an Ubuntu 14.04 Python 3.4.0 obtained from apt. On this system, we also verified that it seems to occur when a completely unrelated exceptions is raised as well...What's going on here?
You have Apport installed, a software package used by Ubuntu to capture software crashes.The package includes a Python package that installs a sys.excepthook function; this hook is called whenever an unhandled exception is raised in a Python program. The implementation for that hook indirectly loads urllib.* modules.By triggering an exception in the interactive interpreter, you triggered the hook, causing the extra Python code to run which adds imports.See the apport_python_hook.py source code; when the hook is called, various apport modules are loaded, including apport.report which imports urllib modules.You can disable the hook by setting enabled = 0 in /etc/default/apport.In future, if you want to see imports take place, you can run Python with the -v command-line switch or setting the PYTHONVERBOSE environment variable; that'd have told you that the apport_python_hook module was loaded when you opened Python, and that more modules were loaded when the exception was raised.


Answer URL
https://docs.python.org/3/library/sys.html#sys.excepthook
https://docs.python.org/3/using/cmdline.html#id4
https://docs.python.org/3/using/cmdline.html#envvar-PYTHONVERBOSE
