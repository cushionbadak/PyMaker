Natural Text
I have a script stored in /etc/init.d that works ok when executed at boot time. Since I do not export USER, it should execute everything as root (if I'm not wrong).Then, it executes python3 script.pyIn this script, everything works fine until it reachesEDIT: changed for this code, but the created file is empty/EDITAt which point it stops. I can tell that since it writes a debug file before and after this step, and the 2nd one is never written.The thing though is that if I execute in a terminalThen the "python3 script.py" is executed entirely ok, including the Popen part.Why is that happening?Thx(init.d script)
Popen() returns as soon as the child process is started. It does not wait for it to finish. It is very unlikely that your scripts blocks for long on Popen().A possible explanation is that your script raises an exception and terminates while trying to start espeak or aplay processes -- that is why you don't see the 2nd record in the log file. Catch and log all errors e.g., set sys.excepthook.You don't see the error when running manually because the environment is different: disks are mounted, audio service is running, X is started, etc -- I don't know what espeak, aplay require to run.As an alternative save all output to a file:I can see what's the problem, and it was to pass an argument with accentuated words (strange that it wasn't the case when I executed the script from the shell). I've eliminated the accents and now it works ok. Try to specify a utf-8 locale. The default is C locale that uses ascii encoding that can't represent accentuated words directly:If there is no C.UTF-8 locale in the output of locale -a command then choose any other utf-8 locale from the list.


Answer URL
https://docs.python.org/3/library/sys.html#sys.excepthook
