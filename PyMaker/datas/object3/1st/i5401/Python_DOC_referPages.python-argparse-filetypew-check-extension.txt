Natural Text
The argparse package does a great job when dealing with command line arguments. I'm wondering however if there is any way to ask argparse to check for file extension (e.g ".txt"). The idea would be to derived one the class related to argparse.FileType. I would be interested in any suggestion. Keep in mind that I have more than 50 subcommands in my program all having there own CLI. Thus, I would be interest in deriving a class that could be imported in each of them more than adding some uggly tests in all my commands. Thanks a lot.
You could subclass the argparse.FileType() class, and override the __call__ method to do filename validation:You could also support a regex if you really want to, but using str.endswith() is a more common and simpler test.This takes either a single string, or a tuple of strings specifying valid extensions:You need to handle this in the __call__ method because the FileType() instance is essentially treated like any other type= argument; as a callable, and you can indicate that the specific argument isn't suitable by raising the ArgumentTypeError exception.
My solution is to create an closure that does the extension checking:Notesext_check basically is a wrapper for argparse.FileTypeIt takes an expected extension to check and an opennerFor simplicity, the expected extension is in lower case, the filename will be converted to lower case prior to validationopenner in this case is an argparse.FileType('w') callable (most likely a function, but I don't care, as long as it is a callable).ext_check returns a callable, which is a function called extension. I name it this way, so that the error will come out as followed (note the word extension bellow, which is the name of the function):Within the extension function, we check the file extension, if passed, we pass the file name to the openner.What I like about this solutionConciseRequire almost no knowledge of how argparse.FileType works since it just act as a wrapper around itWhat I don't like about itCaller has to know about closure to understand how it worksI have no control over the error message. That is why I have to name my inner function extension to get a somewhat meaningful error message as seen above.Other possible solutionsCreate a custom action, see the documentation for argparseSubclass argparse.FileType as Martijn Pieters has doneEach of these solutions has its own strong points and weaknesses


Answer URL
https://docs.python.org/3/library/argparse.html#argparse.FileType
