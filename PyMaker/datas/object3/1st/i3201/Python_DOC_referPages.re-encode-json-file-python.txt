Natural Text
I have a tough task, it is to download a json file from a format and re encode in other format to upload in a MongoDB. My json file is from Alpha Vantage (https://www.alphavantage.co/query?function=TIME_SERIES_INTRADAY&symbol=MSFT&interval=1min&apikey=demo) and has the following format.I need to re encode the file according the following schema using Day, hour and minute as keys.I've done a lot of research but I didn't figure it out how to construct a Dictionary with multiple keys using a loop, at the same time I read the json file I'd like to re enconde in the Dict.
I agree it can be a little confusing if you aren't used to working with nested data structures, but it's not that hard if you're careful. The trick is to create the inner dictionaries if they don't already exist. We can do that with the dict.setdefault method.We also need to convert the inner data from strings to numbers. But we want the numbers to be integers if they don't contain a decimal point, otherwise we want floats. The usual way to do that is shown in my str_to_num function. First we try to convert to integer, and if that fails we convert to float. And if that fails due to bad data, the program will raise a ValueError exception and terminate. You may want to handle that differently, eg to ignore bad data.I'll assume that you know how to extract the desired data from the outermost level using the "Time Series (1min)" key. The code below uses the standard json module simply to convert the data in the new format back to JSON so we can print it nicely.outputYou will notice that my output isn't exactly the same as your desired output. That's because keys in Python dictionaries are unique: you can't have two items in the same dict with a key of "2018-07-13". So my code creates a dict in out_data with the key of "2018-07-13" and inside that dict it creates a dict for each hour, as necessary. 


Answer URL
https://docs.python.org/3/library/stdtypes.html#dict.setdefault
