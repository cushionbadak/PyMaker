Natural Text
I recently switched from Python 2.7 to Python 3.3, and it seems that while in Python 2 the ordering of dictionary keys was arbitrary but consistent, in Python 3 the ordering of the keys of a dictionary obtained with e.g. vars() appears non-deterministic.If I run:in both Python 2.7 and Python 3.3, then:Python 2.7 consistently gives meWith Python 3.3, I can get any random order – for example:Where does this non-determinism come from? And why is something like… consistent between runs, always giving… ?
Update: In Python 3.6, dict has a new implementation which preserves insertion order. From Python 3.7, this order-preserving behaviour is guaranteed:the insertion-order preservation nature of dict objects has been declared to be an official part of the Python language spec.This is the result of a security fix from 2012, which was enabled by default in Python 3.3 (scroll down to "Security improvements").From the announcement:Hash randomization causes the iteration order of dicts and sets to be  unpredictable and differ across Python runs. Python has never guaranteed  iteration order of keys in a dict or set, and applications are advised to never  rely on it. Historically, dict iteration order has not changed very often across  releases and has always remained consistent between successive executions of  Python. Thus, some existing applications may be relying on dict or set ordering.  Because of this and the fact that many Python applications which don't accept  untrusted input are not vulnerable to this attack, in all stable Python releases  mentioned here, HASH RANDOMIZATION IS DISABLED BY DEFAULT.As noted above, the last, capitalized bit is no longer true in Python 3.3.See also: object.__hash__() documentation ("Note" sidebar).If absolutely necessary, you can disable hash randomization in versions of Python affected by this behaviour by setting the PYTHONHASHSEED environment variable to 0.Your counterexample:… does not in fact always give the same result in Python 3.3, although the number of different orderings is limited due to the way hash collisions are handled:As noted at the beginning of this answer, that's no longer the case in Python 3.6:
Note that Python 3.7 still has non-deterministic sets however. dicts preserve insertion order but sets do not. Sets can exhibit the same random behavior. python3 -c "print({str(i) for i in range(9)})"still gives different results from one run to the next.


Answer URL
https://docs.python.org/3/library/functions.html#vars
https://docs.python.org/3/whatsnew/3.6.html#whatsnew36-compactdict
https://docs.python.org/3/whatsnew/3.7.html
https://docs.python.org/3/library/stdtypes.html#typesmapping
https://docs.python.org/3/using/cmdline.html#envvar-PYTHONHASHSEED
https://docs.python.org/3/using/cmdline.html#envvar-PYTHONHASHSEED
