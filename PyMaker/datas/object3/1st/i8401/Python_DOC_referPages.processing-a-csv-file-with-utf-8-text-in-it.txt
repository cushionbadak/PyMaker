Natural Text
I have a csv file (see [1] below) that has non ascii text in it (for instance a name like Antonio Melé. The file has a list of books with URLs, excerpts and comments.In Python 3.5 I open and process the file like so:Now printing the rows of the csv (see print(book_utf8) above) will give me results like:[b'Django By Example', b'Antonio Mel\xc3\xa9', b'Using class-based views', b'2017-03-08', b'https://www.safaribooksonline.com/library/view/django-by-example/9781784391911/', b'https://www.safaribooksonline.com/library/view/django-by-example/9781784391911/ch01s09.html', b'https://www.safaribooksonline.com/a/django-by-example/5869158/', b'Using class-based views', b'']First off, I have a byte prefix. Why? (Python 3.x treats strings as unicode by default, Python 2.7 treats it as byte by default.)And then I have this: b'Antonio Mel\xc3\xa9' instead of Antonio Melé.I know that I have not fully grasped the concept of encoding in Python. Read many posts here on SO, but still I don't really get it.So if my csv file has special characters, I need to open it as utf-8? I did that.Then, if I iterate over the csv reader, get all the rows and append them to a list (without encoding the columns), then try to print it, I get an error (see [2] below). Why can't I print that list?[1] csv file with utf-8 text[2] Trying to print a list of rows of the csv file without encoding the colums of the row will give me an error:(snip)['Learning jQuery Deferreds', 'Terry Jones...', '2. The jQuery Deferred API', '2017-04-06', 'https://www.safaribooksonline.com/library/view/learning-jquery-deferreds/9781449369385/', 'https://www.safaribooksonline.com/library/view/learning-jquery-deferreds/9781449369385/ch02.html', 'https://www.safaribooksonline.com/a/learning-jquery-deferreds/6635517/', 'More Terminology: Resolve, Reject and Progress', '']*** UnicodeEncodeError: 'ascii' codec can't encode character '\u2019' in position 368: ordinal not in range(128)
Typically, all encoding/decoding is done when communicating with the outer world. In your example, there are two communication steps:you read from a file opened with codecs.open(),you write out the result using the print() built-in.Between this, you should always work with decoded strings, ie. type str (Python 2's unicode).Reading from an on-disk fileThe first point goes well, initially: You open the file with the correct encoding and let csv do the format parsing.This makes sure that the bytes found on the disk are correctly decoded into strings, without you having to use a decode method.(As a side note, you can omit codecs here and just use the built-in open(filename, 'r', encoding='utf-8'), but it effectively does the same thing.)But then, you re-encode the strings with the following line:You shouldn't do this. Now you have to process bytes instead of strings.Note:The bytes type has common features with strings, but they are incompatible.That's why you have to decode each element in the select_book_matching_keyword function (which is not used in your code snippet, btw.), so that the membership test is done between strings and strings, not strings and bytes.One of the differences between the two types is that print() uses the repr form to display bytes, thus the output will include quotes and the b prefix:Compare to printing strings:Writing text or data to STDOUTThis brings us to the next problem: Writing data to STDOUT using print().If you try the above line, you probably get an exception:The problem is that, apparently, 'ascii' encoding is used.Now, how do you specify the encoding?It's clear when using open to write to a file on disk:But you can't tell print what encoding to use.The reason for that is that it uses a file handle that is already open, ie. sys.stdout. In my case, this is:but you probably see encoding='ascii' or something like 'ANSI_X3.4-1968'.You have two possibilities:You write the output to a disk file, and don't use print at all.You change the encoding of sys.stdout.(More precisely, you replace it with a new TextIOWrapper around the underlying bytes-based STDOUT stream.)The first possibility is obvious, I hope.For the second one, you need one additional line of code (provided that sys is imported):Now print will encode strings with UTF-8.However, you might still have trouble:It's quite likely that your terminal isn't configured to accept and properly display UTF-8 text, or that it doesn't even support Unicode.If that is the case, you either get garbled characters on screen, or maybe another exception.But that problem is outside Python, you'll have to fix it through the terminal config, or by switching to a different one.


Answer URL
https://docs.python.org/3/library/codecs.html#encodings-and-unicode
