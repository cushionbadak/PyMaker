Natural Text
For a personal project I'm trying to upgrade the paterns package to Python 3. Actually I'm running the test:db.py,  but I'm stuck with the following error in the '__init__.py' file, on a csv class:This is the code snippet od the save() function:there, we dfine s as a BytesIO() stream, so the function is asked to stream bytes to a self csv file.The error comes from the line: it's supposed that csv_header_encode to deliver bytes, and I checked this and it does, but somehow, in its conversion to list it changes to 'str'.And if I change the s encoding to StringsIO then the complaining comes fromAny help will be appreciated.
You may be trying to write to a BytesIO object, but csv.writer() deals in strings only. From the csv writer objects documentation:A row must be an iterable of strings or numbersEmphasis mine. csv.writer() also requires a text file to write to; the object produces strings:[...] converting the userâ€™s data into delimited strings on the given file-like object.Either use an io.StringIO object instead, or wrap the BytesIO object in an io.TextIOWrapper object to handle encoding for you. Either way, you'll need to pass in Unicode text to csv.writer().Because you are later on treating the s.getvalue() data as strings again (using regular expressions defined as strings, and using encoding to Latin-1), you probably want to write to text file (so StringIO).That f.write(BOM_UTF8) fails is a separate issue. f was opened in text mode ('wt') so expects strings, not bytes. If you want to write  text to a file encoded as UTF-8 with an UTF-8 BOM at the start you can use the utf-8-sig encoding when opening the file:Generally, you appear to be mixing bytes and strings in all the wrong ways. Leave text as text for as long as possible, and only encode at the last possible moment. Here that moment would be when writing to the file at location path, and you can leave the encoding entirely to the file object.


Answer URL
https://docs.python.org/3/library/csv.html#writer-objects
https://docs.python.org/3/library/csv.html#csv.writer
https://docs.python.org/3/library/io.html#io.StringIO
https://docs.python.org/3/library/io.html#io.TextIOWrapper
