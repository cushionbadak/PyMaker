Natural Text
Assuming that I am in a python console and want to launch another python program in the same process. The python program looks like this:and I'm not allowed to modify it.What is the proper way of doing this? Can I call it's 'main function' with a different list of arguments like C++ or Java?I'm not against method are are considered hacking. Python is a highly extendable interpreted language and I'll do whatever necessary to bypass this restriction
You can't "call its main function", because it doesn't have one.In fact, the usual way to handle this is to move all those code into a function, then make the __main__ guard code just call that:Then you can call its main function, passing it any args you want.But if you can't fix the file, that won't work.So, what can you do? It all depends on how exactly you need to follow the usual python another.py semantics.The quick&dirty way is to do what blhsing's answer suggests: read the file, and exec it with the globals from your own script:Notice that this is going to leave sys.argv untouched. You can, of course, manually set it to something else first:If you're doing this from another module, rather than from your top-level script, that won't work, but with a slight modification, it will:But you may be better off creating a clean global namespace. The script may not expect to have your globals sitting aroundâ€”and it may change things you don't want it to change. This is just as easy:(Note that this will still automatically inherit the current builtins, which you usually want. If you don't want that for some reason, see the exec docs.)If you want to guarantee that you're executing it exactly the same way as running a script normally, use the runpy module.When you run python -m another, what it ultimately does is:So, you can do the same thing manually:Whether you want to add alter_sys=True depends on what you're after. Without it, if the script tries to access sys.argv (as your script does) or sys.modules['__main__'], it will see your values, instead of its own.If you want to emulate python another.py, you'd want to use importlib to create a full __spec__ and related objects, then calls runpy.run_path.
You can read the file and use exec to execute the code with the current globals so that __name__ == '__main__' would be true.


Answer URL
https://docs.python.org/3/library/functions.html#exec
https://docs.python.org/3/library/functions.html#globals
https://docs.python.org/3/library/builtins.html#module-builtins
https://docs.python.org/3/library/runpy.html
https://docs.python.org/3/library/runpy.html
