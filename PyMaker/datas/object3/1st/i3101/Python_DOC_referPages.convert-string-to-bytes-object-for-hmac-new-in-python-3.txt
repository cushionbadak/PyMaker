Natural Text
code example from https://www.mimecast.com/developer/documentation/downloading-siem-logs/ shows a script that can be used to download logs from a service in python 2.7.I am working on updating the script to be compatible with python 3 but cannot figure out how to get a string to pass into the hmac.new section for the hash generation here:trying to run this as-is results in "LookupError, 'base64' is not a text encoding; use codecs.decode() to handle arbitrary codecs"I was trying to convert the variable to bytes prior to or inside this function by using the base64.b64decodeor bytes(secret_key)functions but that results in "TypeError, Unicode-objects must be encoded before hashing" and I'm just not finding a lot of information on how to get a string variable to pass into hmac.new().I am pretty sure this is related to the change between python 2 and 3 where strings are stored as unicode in 3 where it was raw data in 2, but I'm not familiar enough with these encodings to understand how to properly translate them when passing them around
Just think what's bytes and what's str:EDIT: according to the docs for hmac.new and the hashlib module, data_to_sign must also be bytes.secret_key is a str -> convert it to bytesdata_to_sign is possibly a str as well -> convert it to bytesbase64.b64decode accepts and outputs bytes -> do nothinghmac.new accepts bytes too -> we're already readydigest returns bytes -> we want to b64encode it, and b64encode accepts bytes, so we're goodYou want to output a str (although bytes may be just fine) -> decode the result of b64encodeYou may also supply an encoding argument to your function, if you want to work with an encoding different from the default (utf-8).Code:
The error message is telling you what you need to do:To encode a Unicode object (that is, a str), you just call its encode method.You have to decide what encoding you want. Usually, this is UTF-8. If you're on a modern Python 3, UTF-8 is guaranteed to be the default, so you can just write this:If you want a different encoding (or if you want UTF-8 but you're on an older Python), specify it explicitly:


Answer URL
https://docs.python.org/3/library/stdtypes.html?highlight=str%20encode#str.encode
https://docs.python.org/3/library/stdtypes.html#str.encode
https://docs.python.org/3/library/hmac.html
