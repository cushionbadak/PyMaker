Natural Text
@patch does not seem to produce the same behavior under 2.7 and 3.6.Here is my project structure:foo.py:bar.py (imports Foo):lol.py (imports Bar):Since bar.py imports Foo using from project.foo import Foo, I am patching bar.Foo (according to where to patch docs):test_bar.py:This setup runs correctly in Python 3.6 but fails in 2.7 (Foo does not get patched).However, if I switch my setup to:test_bar.py:It works in 2.7 but fails in 3.6.What is a recommended way to use @patch to make it produce results consistent between python versions?Note: This problem only appears when I test lol.py. If I call bar.py from the unit test, I get consistent results using second setup @patch('cookie_test.bar.Foo') and it works in both 2.7 and 3.6.
I cannot replicate the difference using 2.7 vs 3.6 upon adding __init__.py files to your project directory, and changing the import of Bar in lol.py:In either case, you should not need to import bar in your test - mock is taking care of finding bar by parsing the string passed to the mock decorator.  I suspect the error you're seeing is due to the fact that Python 3 uses absolute imports (https://www.python.org/dev/peps/pep-0328/)


Answer URL
https://docs.python.org/3/library/unittest.mock.html#where-to-patch
