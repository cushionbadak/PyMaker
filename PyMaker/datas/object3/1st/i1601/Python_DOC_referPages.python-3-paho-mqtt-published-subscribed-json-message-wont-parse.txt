Natural Text
Rookie here.  I have a simple python code that's supposed to subscribe to a topic and publish JSON payload to the same topic using MQTT protocol. But for some reason, I am unable to load the payload as JSON!What am I doing wrong here?
There are a couple of problems here.1. Exception handlingYou're not handling exceptions (and Paho effectively ignores them within handlers, to keep the client alive I guess). This means when the exception is thrown in json.loads(data_to_pub), you're never seeing this but the function is exited as there is no local except block.Improved versionHang on, what exception?Running this improved version we can now see:Couldn't parse raw data: b'{\n    "this_json": "info",\n    "data": {\n        "multi_keyval": {\n            "1": "1",\n            "5": "5",\n            "15": "15"\n        },\n        "single_keyval": {\n            "single_key": "200"\n        }\n    }\n}' Expecting value: line 1 column 1 (char 0)Hmmm, what's that b' doing there?...2. The encoding problemEssentially your problem comes down to one line By calling str on the payload of that MqttMessage, which is a bytes object in Python 3, you'll get the stringified version of those bytes, e.g. b'foobar'.This b, of course, makes it invalid JSON now, hence Expecting value: line 1 column 1 (char 0)...Fixed versionDon't call str! Json.loads can handle bytes too. So:Or, assuming utf-8 encoding, we can do this more explicitly (I prefer working in strings):Hope that helps!


Answer URL
https://docs.python.org/3/library/json.html#json.loads
