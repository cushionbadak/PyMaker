Natural Text
I have a python 2.7x Tornado application that when run serves up a handful of RESTful api endpoints.My project folder includes numerous test cases that rely on the python mock module such as shown below.The RESTful endpoint http://localhost/my_service/my_endpoint has two internal calls to my_method respectively: my_method(my_arg=1) and my_method(my_arg=2).I want to mock out my_method in this test-case such that it returns 0 if it is called with my_arg==2, but otherwise it should return what it would always normally return. How can I do it?I know that I should do something like this:But I don't know how to properly specify that something so that its behavior is conditional on the arguments that my_method is called with. Can someone show me or point me to an example??
I want to mock out my_method in this test-case such that it returns 0 if it is called with my_arg==2, but otherwise it should return what it would always normally return. How can I do it?Write your own method mock calling the original one on condition:For patching: if you don't need to assert how often the mocked method was called and with what args etc, it is sufficient to pass the mock via new argument:If you want to invoke the whole mock assertion machinery, use side_effect as suggested in the other answer. Example:
you could use side_effect to change return value dynamically:update: as you want to run original my_method code under some condition, you may need a method proxy, Mock can't get back the real function object being patched.will outputs:


Answer URL
https://docs.python.org/3/library/unittest.mock.html#unittest.mock.Mock.side_effect
https://docs.python.org/3/library/unittest.mock.html#unittest.mock.Mock.assert_called
