Natural Text
I have some code that adds work to an one queue, where it is processed by multiple workers, and then the results are put into another queue where they are processed by a final worker. When I have multiple producers adding material to this results queue, how can I reliably signal the collector process that there is nothing more to process?
There's a few ways.  One is to look for n poison pills, where n is the number of producers you have.  You already are familiar with this approach since you're using it to shut down your producers.  This works okay, but is a bit clunky - you need extra logic in your consumer to keep track of how many poison pills you've seen.My personal favorite is to use a Semaphore to do the counting for me.  If we know how many producers are alive, that is sufficient information to figure out when to shut down the consumer - we shut it down when (no producers are alive) and (the queue is empty).Rough code, entirely untested, but should get the point across.


Answer URL
