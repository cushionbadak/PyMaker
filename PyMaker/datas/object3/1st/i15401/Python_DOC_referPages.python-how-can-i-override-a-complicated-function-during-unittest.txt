Natural Text
I am using Python's unittest module to test a script I am writing.The script contains a loop like this:I have no problems using unittest to test complicated_function. But I would like to test my_loopy_function by overriding complicated_function.I tried modifying my script so that my_loopy_function takes complicated_function as an optional parameter so that I can pass in a simple version from the test:It has not worked as I had hoped, are there any suggestions on how I should be doing this?
In the end I used Python's mock, which allows me to override complicated_function without having to adjust the original code in any way.Here is the original script, and note that complicated_function is not passed in to my_loopy_function as an 'action_function' parameter (which was what I tried in my earlier solutions):and here is the script I am using to test it:This works just as I had wanted:I am able to substitute functions with a simpler version of themselves that I can more easily test,I do not need to alter my original code in any way (such as I was trying -- which was effectively by passing in function pointers), the mock module gives me post-coding access to the innards.Thanks to austin for his suggestion to use mock.BTW I am using Python 2.7 and therefore used the pip-installable mock from PyPI.
Don't try to override complicated_function with action_function, just use complicated_function as the default action_function:
In your code, you shouldn't be able to overwrite complicated_function like that. If I try it, I get UnboundLocalError: local variable 'complicated_function' referenced before assignment.But perhaps is the problem that in your actual code, you're referring to complicated_function in some other way (e.g. as a member of a module)? Then by overwriting it in your test, you're overwriting the actual complicated_function, so you won't be able to use it from other tests.The correct way to do this is to overwrite the local variable with the global one, like so:


Answer URL
https://docs.python.org/3/library/unittest.mock.html
