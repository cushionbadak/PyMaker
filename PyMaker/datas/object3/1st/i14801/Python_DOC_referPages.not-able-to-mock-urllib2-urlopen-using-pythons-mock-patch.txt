Natural Text
Below is a code snippet of my api.py moduleI am trying to mock urllib2.urlopen in unittest of above module. I have written After I run the unittest, I get an exceptionWhat am I missing? Please help me out.
You are patching the wrong things: take a look to Where to patch.In api.py byyou create a local reference to urlopen and Request in your file. By mock.patch('urllib2.urlopen') you are patching the original reference and leave the api.py's one untouched.So, replace your patches byshould fix your issue.... but is not enough.In your test case api.Request are not used but urllib2.urlopen() create a Request by use the patched version: that is why Request().get_type() is a MagicMock.For a complete fix you should change your test at all. First the code:Now the clarification... In your test you don't call Request() because you pass just the first parameter, so I've removed useless patch. Moreover you are patching urlopen function and not urlopen object, that means the read() method you want mocked is a method of the object return by urlopen() call.Finally I add a check on urlopen call and autospec=True that is always a good practice.


Answer URL
https://docs.python.org/3/library/unittest.mock.html#where-to-patch
https://docs.python.org/3/library/unittest.mock.html#autospeccing
