Natural Text
In a view, I create a Django HttpResponse object composed entirely of a csv using a simply csv writer:In a unit test, I want to test some aspects of this csv, so I need to read it. I'm trying to do so like so: But the test fails with the following on the headers = next(reader) line:I see in the HttpResponse source that response.content is spitting the string back out as a byte-string, but I'm not sure the correct way to deal with that to let csv.reader read the file correctly. I thought I would be able to just replace response.content with response (since you write to the object itself, not it's content), but that just resulted in a slight variation in the error:Which seems closer but obviously still wrong. Reading the csv docs, I assume I am failing to open the file correctly. How do I "open" this file-like object so that csv.reader can parse it?
response.content provides bytes. You need to decode this to a string:Then pass this string to the csv reader using io.StringIO:
You can use io.TextIOWrapper to convert the provided bytestring to a text stream:This will convert the bytes to strings as they're being read by the reader. 


Answer URL
https://docs.python.org/3/library/io.html#io.TextIOWrapper
