Natural Text
What is the best method for testing a method that looks like thisThis is pretty standard code for a consumer, do work while the is_running flag is set.But this is difficult to test because it's going to enter the loop and never come out unless I create a second thread to change is_running to false. Are there any good strategies for testing this without spinning up a separate thread to run the code?I haven't seen anything but I am thinking maybe the mock library would provide functionality that can return a [True, True, False] each time is_running is read but would that require me to change is_running from a member variable to a property or a method?
As I mentioned in the comments, I think testing this method using threads is a perfectly viable approach, and probably the best solution. However, if you really want to avoid threads, you could convert is_running to a property and then use mock.PropertyMock to mock the property:Output:I would say that changing your production implementation this much just to enable a specific method of testing is not worth it, though. Just have your test function create a thread to set is_running after some period of time.


Answer URL
https://docs.python.org/3/library/asyncio-task.html
