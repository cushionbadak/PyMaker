Natural Text
I have the following function written to find the most recent date in my dataset prior to the year I am calculating for. I am having trouble understanding why it will not work in a for loop, but it will outside of one. If I write it with a hardcoded value as the year, it will run just fine. However, when I try to put it in a loop, it will give the following error:'ValueError: max() arg is an empty sequence'Thank you for any insight on why this is error is thrown, and what I can do to fix it.
You are comparing apples and orangesmax_date_prior_to_year(df['Date'], 2014) feeds 2014 as the yr argument. But your for loop starts with 2011. If df['Date'] has no dates  before 1st January 2011, dates[dates<pd.to_datetime(str(yr)+'-01-01')] will return an empty series, so you are effectively calculating:As per the docs:If the iterable is empty and default is not provided, a ValueError  is raised.Use pd.Series.max instead of built-in maxOne way you can avoid ValueError and increase efficiency is to use pd.Series.max instead of Python's built-in max.1 This is will return NaN if the series is empty after Boolean indexing. So change your function to:1 In fact, as a rule you should prefer Pandas numeric methods to applying built-in functions on pandas series.


Answer URL
https://docs.python.org/3/library/functions.html#max
https://docs.python.org/3/library/functions.html#max
