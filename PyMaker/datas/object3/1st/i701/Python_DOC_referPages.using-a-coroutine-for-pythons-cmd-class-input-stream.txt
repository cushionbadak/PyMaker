Natural Text
The problem I am facing is that:I have an asynchronous methodCalling plain-old python code I cannot changeWhich calls back a plain-old python methodWhich needs to call async code using awaitI have a custom command interpreter built on top of Python's Cmd class. I provide it with custom stdin and stdout. For the purpose of this question, it looks like this:When Cmd needs to read from the user, it will do this:I want to provide an SSH interface to my custom interperter using the AsyncSSH library based on asyncio. My SSH code is much like the Simple Server sample, which reads a stdin like interface like this (notice the await keyword):I tried a number of things but I can't duck type the SSH code to Cmd's expectation of stdin. What must I do to have my CustomStream object use asyncio/coroutines on the inside while providing an old-school, single thread interface to MyShell?
The solution was to patch the cmdloop method to make it asyncio aware.This code is a copy of Python's 3.7.2 Cmd class cmdloop function you get if you setraw_input set to Trueput await in front of readlineResults in this code (aoicmd.py available as a gist): Where you need to use your Cmd derived class, like MyShell, create a new class called MyAsyncShell at runtime:Implement write and flush as you see fit, but your readline should look like this:


Answer URL
https://docs.python.org/3/library/cmd.html
