Natural Text
result is :Question: why result is not :
That's because you're using a weakref.WeakValueDictionary() for stock. From the docs:A weak reference to an object is not enough to keep the object alive: when the only remaining references to a referent are weak references, garbage collection is free to destroy the referent and reuse its memory for something else.So destroying catalog allows the garbage collector to destroy stock contents.Only remaining element is the last one because it's referenced by the last loop item as cheeseIf you perform a del cheese, then the second printout is completely empty.
A WeakValueDictionary will dispose the items if the values are not referenced anywhere else anymore.In your case all values are referenced in catalog, and one item additionally as cheese (left over from the last iteration). When catalog is deleted only one element has an other reference, the others get disposed.


Answer URL
https://docs.python.org/3/library/weakref.html
