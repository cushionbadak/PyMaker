Natural Text
Find list of 5 top number from a text file having billions of numbers stored. Numbers are either coma separated or in new lines.I cannot store the content of list in a variable because of memory issue.I have used generator and giving the batch size as 5. So that each time when I call next(result_generator) I get 5 elements from the text file.First time when the next(result_generator) is called, I will get 5 elements and sort them.I will consider them as the top 5.Next time when I will call next(result_generator), I will get another 5.I will combine it with previous 5. I will sort it and then get top 5 out of those 10.Similarly, taking next 5 and combining with previous 5 to get top fifty until it next(result_generator) return None.The problem I am facing is generator is not working properly, it is not taking the next 5 elements.It is going to Exception when making 2nd call of next(result_generator).I tried to do the same thing with database , it is working fine there.I suspect file operation has some issue.I am using random function to generate numbers and writing it in text file for sample input.Code to generate random numbers in text file:Code to find top 5 elements from text file:e.g.131,205,65,55,222,278,672,902,69,26.......billionsExpected result : [902,672,278,222,205]Actual  result : [222,205,131,65,55]
Why not use heapqWith some file like file.txtYou iterate your file normally and can doYou will be using O(N) memory and O(MlogN) time where M is in billions for your problem and N is however many top numbers you want to get


Answer URL
https://docs.python.org/3/library/heapq.html
