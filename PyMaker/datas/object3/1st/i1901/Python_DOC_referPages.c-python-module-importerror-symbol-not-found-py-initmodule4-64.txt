Natural Text
I am beginning the process of writing Python 3 module in C.  The C I have written already compiles fine (code I compiled at bottom of post).  I compile with:The built .so file is placed in the current directory.  After launching python3, when I import my module I get this error (tripple dot used to truncate paths):How do I got about getting symbol _Py_InitModule4_64 implemented?I am running macOS High Sierra if that means anythingRunning nm for helloWorld.cpython-36m-darwin.so shows _Py_InitModule4_64 is undefined, so does that prove there is an issue in the compilation process?Codetest.c:setup.py:
You wrote your module against the Python 2 C API (the various Py_InitModule functions are purely for Python 2), but you're trying to compile it and run it with Python 3. The C layer for CPython changed a lot between Python 2 and 3, and there is no 2to3 tool for the C code to my knowledge.You need to write Python 3 API compatible code to work on Python 3; the simplest (and only approach supported on 3.0-3.4) translation is to single-phase initialization (with PyModule_Create), but multi-phase initialization gets behavior more like modules defined in Python (e.g. it's possible to completely unload them in a way that isn't possible with single-phase modules). The structure of the entry point name changed as well, from initMODULENAME to PyInit_MODULENAME, so you'll need to update that as well.I'd strongly recommend reading the Python 3 extension module tutorial.


Answer URL
https://docs.python.org/3/c-api/module.html#single-phase-initialization
https://docs.python.org/3/c-api/module.html#multi-phase-initialization
https://docs.python.org/3/extending/index.html
