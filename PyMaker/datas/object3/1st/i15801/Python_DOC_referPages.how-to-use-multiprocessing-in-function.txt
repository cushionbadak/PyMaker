Natural Text
I want to define a function in "a.py" which uses multiprocessing for parallelization, then import it in "b.py" as a library function. For example, in "a.py":Then in "b.py":However, it won't work, I will always get error:_pickle.PicklingError: Can't pickle : attribute lookup lock on _thread failed. So, is it possible to use multiprocessing of python this way or am I missing anything?The entire traceback, slightly edited (Python 3.x, Windows):
The problem is that you're using queue.Queue, which only works between threads in the same process, instead of multiprocessing.Queue, which works between processes.Depending on your platform, and the way you use it, this will fail in different ways. In your case, because you're trying to pass the queue as an argument to the Process constructor, and you're on Windows, you get the nicest error: you try to pickle the queue itself, and that fails.* On Unix, you may actually successfully pass the queue to the child processes, but it will probably either lose most of your values (OS X) or deadlock (most other systems) when you use it.As the docs explain, multiprocessing.Queue "is a near clone of queue.Queue", except that it's "thread and process safe" instead of just thread safe.If you thought you were using multiprocessing.Queue, your mistake is in this line:This doesn't import multiprocessing as both mp and queue, it imports multiprocessing as mp, and imports queue as itself. See the reference on import for details.The fact that this is ambiguous to a human (even though it's not ambiguous to the parser) is one of the reasons multi-import statements are discouraged in Python. For example, PEP 8 says "Imports should usually be on separate lines".* It might be nicer if the queue itself raised an exception when you pickled it, instead of relying on the fact that it uses some unpicklable threading synchronization objects, because it's not entirely obvious that pickling a _thread.lock was caused by pickling a queue.Queue.


Answer URL
https://docs.python.org/3/library/queue.html
https://docs.python.org/3/library/multiprocessing.html#multiprocessing.Queue
https://docs.python.org/3/library/multiprocessing.html#exchanging-objects-between-processes
https://docs.python.org/3/reference/simple_stmts.html#import
