Natural Text
I'm using a python script to manage ssh fingerprint problems after a workstation(s) is reimaged.I attempt to connect, and if I get a "REMOTE HOST IDENTIFICATION HAS CHANGED!" error, then script removes the old fingerprint, scans for the new one and adds it.This all works great, until I get a message like this:The script waits for user input before continuing and removing the offending key.How can I get the script to push through, or enter "no" so the script can continue with its fingerprint repair job?Here's the relevant method:
run (or legacy call) doesn't allow your controlling of the input/output of the process interactively. When you get the output, the process has already ended. So you're too late for the party.Some would direct you to pexpect, or paramiko (which doesn't require calling ssh command).Here's a workaround with Popen. I dropped your return logic. If you want to keep that, remember that at this point the process is still running, so you have to kill it (or wait for it to complete):if you're sure that the only answer will be "no", and a given number of times, an alternative to the loop would benote the "b" prefix when scanning strings/writing data, as standard input/output/error are binary. Doesn't matter in python 2, but in python 3, omitting the b compares strings with bytes, and you'll never get a match.Aside, I've done that with plink on Windows, but after a while, I got tired and rebuilt a version of plink with all security messages disabled/defaulting to the "optimistic" value. If the network is a company network behind firewalls and you're going to answer anything to get pass those prompts, better create a non-interactive tool from the start.


Answer URL
https://docs.python.org/3/library/subprocess.html#subprocess.Popen.communicate
