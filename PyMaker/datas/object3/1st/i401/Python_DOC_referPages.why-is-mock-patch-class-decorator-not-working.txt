Natural Text
I want to mock something for an entire class but the following minimal example is not working:I get this unexpected output: (why did time.sleep not raise?)However if I move the @mock.patch(...) down 1 line so it is decorating the method bar instead of the class Foo then it works as expected:Why does @mock.patch not work at the class level?
It turns out the class decorator only patches methods beginning with patch.TEST_PREFIX which defaults to test.So renaming the method to test_bar or even testbar makes the patch start working.Docs:Patch can be used as a TestCase class decorator. It works by decorating each test method in the class. This reduces the boilerplate code when your test methods share a common patchings set. patch() finds tests by looking for method names that start with patch.TEST_PREFIX. By default this is 'test', which matches the way unittest finds tests. You can specify an alternative prefix by setting patch.TEST_PREFIX.Evidently this behaviour applies to any class whether inheriting from unittest.TestCase or not.


Answer URL
https://docs.python.org/3/library/unittest.mock.html#patch
