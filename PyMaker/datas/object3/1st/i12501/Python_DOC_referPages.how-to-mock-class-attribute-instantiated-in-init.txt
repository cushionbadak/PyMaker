Natural Text
I'm trying to mock the "self.api.friends.get" method in VKAuth class:from the test module test_views.py:having created instance of VKAuth class during the post call to 'auth-social' above in SNView class-based view:And I get an error:What should I write istead of the current patch.object to reach api.friends.get and mock it? UPD:To be more precise, I want some equivalent of:but mock it the moment before we make request to the django-rest-framework api via self.client.post().Thank you!
You are patching the wrong thing. In VKAuth:add api attribute to VKAuth self object. When you callyou are patching the api static attribute of VKAuth class and not the object attribute.You should patch vk.API instead. Notes :Use patch.object only if you really know why you need it instead simple patch.autospec=True is not mandatory but I strongly encourage to use it.In the patch context self.api will be equal to mock_api.return_value because call vk.API(self.session) is like call mock_api(); in other words mock_api is the mock object used to replace the vk.API reference.Take a look to where to patch, you can find it very useful.Now if you want fill your mock_api.return_value by some behavior you can configure it in with context:


Answer URL
https://docs.python.org/3/library/unittest.mock.html#patch-object
https://docs.python.org/3/library/unittest.mock.html#autospeccing
https://docs.python.org/3/library/unittest.mock.html#where-to-patch
