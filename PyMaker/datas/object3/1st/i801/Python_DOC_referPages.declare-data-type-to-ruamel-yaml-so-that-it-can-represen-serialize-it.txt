Natural Text
I am using a function from a python library which returns an object with a specific data type. I would like to serialize that object to a yaml file and I would like to use ruamel.yaml. The problem is that ruamel.yaml does not know how to serialize the specific data type that the function returns and throws an exception:The question is how to "declare" the data type to ruamel.yaml so that it knows how to handle it. Note: I can't / I don't want to make changes to the library or anything of that sort. I am only the consumer of an API.To make this more concrete, let's use the following example that uses socket.AF_INET which happens to be an IntEnum but the specific data type should not be important.which gives this error:
In order for ruamel.yaml to be able to dump a specific class, whether you define it, you get it from the standard library or get if from somewhere else, you need to register that class against the representer.(This is not necessary when using YAML(typ='unsafe'), but I assume you don't want to resort to that).This registration can be done in different ways. Assuming you havedone yaml = ruamel.yaml.YAML() or yaml = ruamel.yaml.YAML(typ='safe'), and want to represent SomeClass, you can:use yaml.register_class(SomeClass). This might work on other classes dependingon how they are defined.use one of the decorators @yaml_object(yaml) or @yaml.register_class, just before the class SomeClass:definition. This is primarily of use when defining your own classesadd a representer directly using:    yaml.representer.add_representer(SomeClass, some_class_to_yaml)The first two ways are just syntactic sugar wrapped around the thirdway, and they will try to use a method to_yaml and a class attributeyaml_tag if available, and try to do something sensible if either isnot available.You can try yaml.register(socket.AF_INET), but you'll notice that it fails because:AttributeError: 'AddressFamily' object has no attribute 'name'So you'll have to resort to the third way usingadd_representer(). The argument some_class_to_yaml is a functionthat will becalled when a SomeClass instance is encountered, and that function is calledwith the yaml.representer instance as first argument and with the actual data(the instance of SomeClass) as second argument.If SomeClass is some container type that could recursively reference itself (indirectly), you need to take special care dealing with that possibility, but for socket.AF_INET this is not necessary.The specific data type is in so far important, that you need to decidehow to represent the type in YAML. Quiet often you'll see that thatattributes of SomeClass are used as keys in a mapping (and then itis the mapping that gets the tag), but sometimes the type can bedirectly represented in a non-collection type available in YAML suchas a string, int, etc., for other classes it makes more sense to berepresented as a (tagged) sequence.When you print type(socket.AF_INET), you'll notice that "SomeClass" is actually AddressFamily.And after inspecting socket.AF_INET using dir(), you'll notice that there is a name attribute andthat nicely gives you a string 'AF_INET', which can be used to tell the representer how to represent this data as a string, without resorting to some lookup:which gives:Make sure the tag is defined as unicode (necessary in case you are using Python 2.7).If you also want to load this, you can extend the constructor in an similar way. Butthis time you'll get a Node that you need to convert to AddressFamily instance.which runs without throwing an exception, and shows that the otherconstants in socket are handled as well.


Answer URL
https://docs.python.org/3/library/socket.html#constants
