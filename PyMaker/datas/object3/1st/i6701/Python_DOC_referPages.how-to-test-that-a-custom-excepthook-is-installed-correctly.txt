Natural Text
My app logs unhandled exceptions.  These tests pass OK:But I couldn't get a test of unhandled exceptions logging working:What's wrong here?  How can we actually trigger the app.excepthook from within a test?
Python won't call sys.excepthook until an exception actually propagates all the way through the whole stack and no more code has an opportunity to catch it. It's one of the very last things that happen before Python shuts down in response to the exception.As long as your test code is still on the stack, sys.excepthook won't fire. What little code actually can run after sys.excepthook probably isn't going to play well with your testing framework. For example, atexit handlers can still run, but the test is over by then. Also, your test framework is probably going to catch the exception itself if you don't, so sys.excepthook won't fire anyway.If you don't want to call sys.excepthook yourself, your best bet may be to launch an entire subprocess with your excepthook installed and verify the subprocess's behavior.
pytest can check the exception message. You can do something like this:You can actually test the whole thing in one test. No need for multiple test functions.


Answer URL
https://docs.python.org/3/library/atexit.html
