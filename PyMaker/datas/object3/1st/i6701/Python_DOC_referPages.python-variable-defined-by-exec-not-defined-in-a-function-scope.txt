Natural Text
The following executes without an error in Python 3:But if I try to capture the local variable dict as well, it fails with a NameError:Why is this happening, and how can I execute this code while capturing both global and local variables?
From the exec() documentation:Remember that at module level, globals and locals are the same dictionary. If exec gets two separate objects as globals and locals, the code will be executed as if it were embedded in a class definition.You passed in two separate dictionaries, but tried to execute code that requires module-scope globals to be available. import math in a class would produce a local scope attribute, and the function you create won't be able to access that as class scope names are not considered for function closures.See Naming and binding in the Python execution model reference:Class definition blocks and arguments to exec() and eval() are special in the context of name resolution. A class definition is an executable statement that may use and define names. These references follow the normal rules for name resolution with an exception that unbound local variables are looked up in the global namespace. The namespace of the class definition becomes the attribute dictionary of the class. The scope of names defined in a class block is limited to the class block; it does not extend to the code blocks of methods[.]You can reproduce the error by trying to execute the code in a class definition:Just pass in one dictionary.


Answer URL
https://docs.python.org/3/library/functions.html#exec
https://docs.python.org/3/reference/executionmodel.html#naming-and-binding
https://docs.python.org/3/reference/executionmodel.html#resolution-of-names
