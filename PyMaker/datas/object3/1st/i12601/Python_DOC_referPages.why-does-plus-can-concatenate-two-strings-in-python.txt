Natural Text
I'm learning Learn Python the hard way.Explain why adding the two strings w and e with + makes a longer string.Even I know it can work, but I don't understand why and how? Please help me.
Python uses + to concatenate strings because that's how core developers of Python defined that operator.While it's true that __add__ special method is normally used to implement the + operator, + (BINARY_ADD bytecode instruction) does not call str.__add__ because + treats strings specially in both Python 2 and Python 3. Python invokes the string concatenation function directly if both operands of + are strings, thus eliminating the need to call special methods.Python 3 calls unicode_concatenate (source code):Python 2 calls string_concatenate (source code):This optimization has been in Python ever since 2004. From the issue980695:... in the attached patch ceval.c special-cases addition of two strings (in the same way as it special-cases addition of two integers already)But note that the main goal was greater than elimination of special attribute lookup.For what it's worth, str.__add__ still works as expected:and Python will call __add__ methods of subclasses of str, because PyUnicode_CheckExact(left) && PyUnicode_CheckExact(right) (or PyString_CheckExact(v) && PyString_CheckExact(w), in Python 2) from the code snippets above will be false:
The __add__ method of the class str is called when you add (concatenate) two strings in this manner. The __add__ method works as such, but the following is not verbatim from the source code:Example:
+, -, *, and other operators will work on anything that implements the right methods. Since strings implement the __add__(self, other) method, you can add two strings with +.Try this: define your own string subclass and override its __add__ method:The same technique, operator overloading, lets you create classes that can use the built-in operators like + or * usefully, like vectors that can be added together.


Answer URL
https://docs.python.org/3/reference/datamodel.html#object.__add__
https://docs.python.org/3/library/dis.html#opcode-BINARY_ADD
