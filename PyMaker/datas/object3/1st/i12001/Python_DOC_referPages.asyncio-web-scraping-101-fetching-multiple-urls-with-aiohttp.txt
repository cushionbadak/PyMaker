Natural Text
In earlier question, one of authors of aiohttp kindly suggested way to fetch multiple urls with aiohttp using the new async with syntax from Python 3.5:However when one of the session.get(url) requests breaks (as above because of http://SDFKHSKHGKLHSKLJHGSDFKSJH.com) the error is not handled and the whole thing breaks.I looked for ways to insert tests about the result of session.get(url), for instance looking for places for a try ... except ..., or for a if response.status != 200: but I am just not understanding how to work with async with, await and the various objects.Since async with is still very new there are not many examples. It would be very helpful to many people if an asyncio wizard could show how to do this. After all one of the first things most people will want to test with asyncio is getting multiple resources concurrently.GoalThe goal is that we can inspect the_results and quickly see either: this url failed (and why: status code, maybe exception name),  orthis url worked, and here is a useful response object
I would use gather instead of wait, which can return exceptions as objects, without raising them. Then you can check each result, if it is instance of some exception.Tests:
I am far from an asyncio expert but you want to catch the  error you need to catch a socket error:Running the code and printing the_results:You can see we get catch the error  and the further calls are still successful returning the  html.We should probably really be catching an OSError as socket.error is   A deprecated alias of OSError since python 3.3:If you want to also check the response is 200, put your if in the try too and you can use the reason attribute to get more info:


Answer URL
https://docs.python.org/3/library/asyncio-task.html#asyncio.gather
