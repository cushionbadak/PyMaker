Natural Text
Python3 test cases (doctests) are failing with my sample code. But the same is working fine in Python2.test.pytst.pyRun test cases: python3 -m doctest -v tst.pyError:Can anyone please help in how to overcome this error.Thanks.
This is arguably a bug in doctest. What's happening is that doctest is searching for functions/methods/callables with a docstring, and while doing so it's unwrapping any decorators it finds. Why it does this, I have no idea. But anyway, doctest ends up calling inspect.unwrap(t) (where t is a Test instance), which is essentially equivalent to doing this:Because t is a Test instance, accessing t.__wrapped__ calls __getattr__ and returns a new Test instance. This would go on forever, but inspect.unwrap is smart enough to notice that it's not getting anywhere, and throws an exception instead of entering an infinite loop.As a workaround, you can rewrite your __getattr__ method to throw an AttributeError when __wrapped__ is accessed. Even better, throw an AttributeError when any dunder-attribute is accessed:
For unittest.mock try importing items asinstead of This worked around the bug for me.


Answer URL
https://docs.python.org/3/library/inspect.html#inspect.unwrap
