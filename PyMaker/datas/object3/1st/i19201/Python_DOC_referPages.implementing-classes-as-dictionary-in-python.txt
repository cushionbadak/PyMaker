Natural Text
I found below code at http://pydanny.com/python-dictionary-as-a-class.html. The code works fine and I kind of understand why it does but a similar code, below it gives error.My trial code:Error Message:When I use 'nonlocal x' in the closed function it works but how come the initial code works without 'nonlocal'.My understanding is that it's a closure and the inside function will keep reference of the outside (free) variable and whenever the inner function is called it will be able to act upon that closed variable but certainly I haven't understood some part of it properly.Please help me clear the concept I am missing.Thank you all the folks who answer. SO has been too helpful.
When I use 'nonlocal x' in the closed function it works but how come the initial code works without 'nonlocal'.In the first snippet, you're mutating the existing kwargs value. You're not assigning a new value to it, or to any other name.But in the second snippet, you're assigning a new value to x. That forces x to be local (unless you've said otherwise). Therefore, your x+1 is a reference to a local variable that hasn't been assigned yet. Hence the error.For a more rigorous explanation, read Naming and binding in the documentation. The relevant bits are:Each occurrence of a name in the program text refers to the binding of that name established in the innermost function block containing the use…When a name is used in a code block, it is resolved using the nearest enclosing scope…If a name is bound in a block, it is a local variable of that block, unless declared as nonlocal…To learn how this works under the covers, you'll also need to read about functions and code objects in The standard type hierarchy. You probably don't need to know that part for understanding, but for debugging, you may want to inspect the __closure__ and other attributes.


Answer URL
