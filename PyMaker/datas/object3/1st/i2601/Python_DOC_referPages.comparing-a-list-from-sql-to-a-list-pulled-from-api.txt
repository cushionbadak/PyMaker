Natural Text
I work for a Security MSSP and I am currently creating an script that pulls threat data from one of our vendors online console and stores the details in an SQLLite3 database for later use.I have been able to query all of the threats from the console and upload them to the database but as we are dealing with over 3000 threats on our testing console, the script takes a very long time to run.The basic outline of the script is as follows:Query the console API to get the total pages of threats. (They can only be queried in blocks of 200)Loop through the pages and get all of the threat hashes on each page and store these in a list.Loop through this list and use the API to query each hash to obtain the full details of the threat and store them into the SQL database.I am now facing a problem as I am attempting to optimize the script so that it runs quicker on successive runs.I have attempted to implement a function, which queries the SQL database and pulls all of the currently stored hashes and adds them to a list, I then want to compare this list with the API list. If the hash appears in the SQL list, skip querying the API for this hash.The problem I am having is when I attempt to compare the lists, every hash appears as if its not found in the SQL list, thus adding it to the final hash list, which is used to upload to the DB.Function that queries the DB:Function that get the threats and compares the lists:Can anybody see any problems with these functions?Apologies for the wall of text but I wanted to provide as much information as possible.Any help would be very much appreciated.Thanks,Craig
Use sets and set-difference instead of creating lists and manually append them if/if not:Output:Doku set() && set() class. There is also the immutable frozenset() which could be used if you can fill it in one go (you page through, so probably not).


Answer URL
https://docs.python.org/3/tutorial/datastructures.html#sets
https://docs.python.org/3/library/stdtypes.html#set
