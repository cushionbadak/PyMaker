Natural Text
I have a Flask view which uses SQLAlchemy to query and display some blog posts.  I am running my app using mod_wsgi.  This view works the first time I go to the page, but returns a 500 error next time.  The traceback shows the error ProgrammingError: SQLite objects created in a thread can only be used in that same thread.  Why am I getting this error and how do I fix it?views.pymodels.py:
SQLAlchemy (and in this case SQLite also) doesn't work if you share a session across threads.  You may not be using threads explicitly, but mod_wsgi is, and you've defined a global session object.  Either use scoped_session to handle creating a unique session for each thread.Preferably, use Flask-SQLAlchemy which handles this and other things for you.  The SQLAlchemy docs recommend you use the integration library rather than doing this yourself.Also note that you should only be defining the engine, session, etc. once and importing it elsewhere, rather than redefining it in each file like your current code does.
Taking a hint from this SO answer I searched SA docs and found out you can do this:scoped_session wasn't really suitable in my case since Flask-SQLAlchemy only takes a connection string argument:According to sqlite3.connect:By default, check_same_thread is True and only the creating thread may  use the connection. If set False, the returned connection may be  shared across multiple threads. When using multiple threads with the  same connection writing operations should be serialized by the user to  avoid data corruption.


Answer URL
https://docs.python.org/3/library/sqlite3.html#sqlite3.connect
