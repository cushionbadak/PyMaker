Natural Text
this gives me an error ExecutionError: sed: -e expression #1, char 0: no previous regular expressionI am not sure what the issue is.The above is being used in a Python script.
Change it to:The variable assignment needs to be a separate statement from sed. When you put a variable assignment at the beginning of a statement, it only sets an environment variable that gets inherited by the child process. But you need the variable to be expanded by the original shell, so you need to set the variable before executing the sed command.
Your problem is that:is relying on the shell to expand the variables, not sed. But setting variables via command prefix only affects the environment of the command, not bash, so old_val is never defined for the purposes of string interpolation. Per the bash reference manual (emphasis added):The environment for any simple command or function may be augmented temporarily by prefixing it with parameter assignments, as described in Shell Parameters. These assignment statements affect only the environment seen by that command.So if sed tried to read old_val from its own environment it would see the correct value. But what sed is receiving is the post-interpolation string passed, which is s//9/g, because bash interpolation doesn't see old_val (that exists only for sed).To fix, set the variable in bash by performing the assignment as a separate command, not a sed prefix:Or more correctly, you should really avoid relying on shell=True (it's dangerous/easy to misuse). Even if you must use sed, all the stuff you were using the shell for can be done at the Python layer:This has the same behavior (operates in /etc/squid, and passes the unqualified file names so you won't have new command line length issues if there are a lot of files in a deeply nested directory).Of course, you could go even further, and just use the fileinput module to do the work of sed in Python too; it features editing files in place just like sed (though it will likely be slightly slower if the files are of meaningful size).
Actually i found something that worked, putting each of the variables in single quotes and escaping the single quotes.


Answer URL
https://docs.python.org/3/library/fileinput.html
