Natural Text
I am trying to port this Python extension to work with Python 3. Python 3 made many changes to the Python C/C++ API that necessitate modifications to legacy modules' initialization and argument passing functions. So far, I have taken the old Python 2 code:And I have made this, following this example:In theory, this should follow the new Python 3 rules for module initialization, argument passing, and string size variables. It successfully compiles and installs (I am using the same setup.py distributed with the project), but when I try to import it:I get a segmentation fault: I have tried to attach gdb to examine the C code, but gdb is not working on my computer with Python C modules. I have also tried commenting out the OpenSSL code to see if that was the source of the problem, to no avail. My Python3 installation runs other programs that don't use this library. Could someone take a look at this and suggest where I should look or what I should try next?Thanks!
The segfault is most likely caused by you defining the module struct as a PyMethodDef instead of a PyModuleDef:In addition to that. I'm not sure why you've called Py_Initialize in the initialization function. Calling it is a no-op (since you're already running in an initialized interpreter when you call it).As an aside, there's no need for the gist, Python already has information on how to port from 2 to 3.


Answer URL
https://docs.python.org/3/howto/cporting.html
