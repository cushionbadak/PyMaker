Natural Text
Problem:Males and Females can use a unisex bathroom.The bathroom has infinite capacity but Males and Females cannot use the bathroom at the same time.I'm having trouble enforcing the sex-segregation provision. I'm trying to use the LightSwitch design pattern from "Little Book of Semaphores" and I can't figure out why the pattern isn't excluding the opposite sex when a male or female is in the bathroom.This isn't a homework problem. It's a problem I bombed on in an interview.Users.py:LightSwitch.py:Bathroom.pyMain.py:Output:
First off, I don't have the "Little Book of Sempahores" sitting around and 30 seconds of searching did not yield anything CS-related about "Lightswitch Design Pattern" (but plenty of stuff about home improvement). Anyhow, I believe you're code was a bit too complicated. Here's what I came up with:Some general comments about the multi-threaded portion:The whole thing is based around a single threading.Condition which the bathroom keeps track of.Anyone can enter the bathroom when it's already assigned to their sex or if it's empty.When a bathroom empties out, the bathroom fires off a notify_all to let all of the people waiting that the bathroom is available for use.Beyond the output making sense, I also added a bunch of asserts to make sure that things were working as expected.Output:Notice how everyone from a single sex mobs the bathroom at first (because it's available to them). After everyone leaves, everyone from the other sex mobs the bathroom. This creates two "waves" of people (where each wave takes slightly more than a second to finish because that's how long the sleep is for.I also simplified some of your code to make the threading portion clearer and improve separation of concerns in general. Notably, I completely removed the line_full event because I didn't think that was necessary for the rest of the code to work as intended.


Answer URL
https://docs.python.org/3/library/threading.html#condition-objects
https://docs.python.org/3/library/threading.html#threading.Condition.notify_all
