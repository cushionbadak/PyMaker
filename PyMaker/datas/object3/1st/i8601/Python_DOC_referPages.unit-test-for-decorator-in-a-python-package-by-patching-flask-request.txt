Natural Text
I have a python module security.py which defines a decorator authorized(). I want to test the decorator. The decorator will receive a flask request header.The decorator is sth like this:I want to mock the flask request header using a @patch decorator.The test I wrote is sth like this:but I always get the following error:How should I do it right?
Mock the whole request object to avoid triggering the context lookup:and build up the mock from there:Since a missing token results in an Abort exception being raised, you should explicitly test for that. Note that the request.headers attribute is not called anywhere, so side_effect or return_value attributes don't apply here.I ignored MockHeaders altogether; your decorator is not using json_data and your implementation is lacking a __contains__ method, so in tests wouldn't work on that. A plain dictionary suffices for the current code-under-test.Side note: authorized is a decorator factory, but it doesn't take any parameters. It'd be clearer if you didn't use a factory there at all. You should also use functools.wraps() to ensure that any metadata other decorators add are properly propagated:then use the decorator directly (so no call):


Answer URL
https://docs.python.org/3/library/functools.html#functools.wraps
