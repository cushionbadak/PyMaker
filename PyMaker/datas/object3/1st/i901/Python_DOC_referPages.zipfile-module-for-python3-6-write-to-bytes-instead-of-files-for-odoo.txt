Natural Text
I've been trying to use the zipfile module for Python 3.6 to create a .zip file which contains multiple objects.My problem is, I have to manage files from an Odoo database that only allows me to use bytes objects instead of files.This is my current code:Which returns this error:How am I supposed to do it? I followed the ZipFile.writestr() docs, but that got me nowhere...EDIT: using file_data = file[1].decode('utf-8') as second parameter is not useful either, I get the same error.
As mentioned in my comment, the issue is with this line:You're trying to pass a byte object into the ZipFile() method, but like open() it is expecting a path-like object.In your case, you might want to utilize the tempfile module (in this particular example we'll use SpooledTemporaryFile from this relevant question:Note the use of context managers to ensure all your file objects are closed properly after being loaded.This gives you zipped_bytes which is the bytes you want to pass back to Odoo.  You can also test the zipped_bytes by writing it to a physical file to see what it looks like first:If you are handling file size that are considerably large, make sure to pay attention and make use of max_size argument in the documentation.
If you want to handle all of this in memory without a temporary file then use io.BytesIO as the file object for ZipFile:You may also want to set the compression algorithm as shown because otherwise the default (no compression!) is used.


Answer URL
https://docs.python.org/3/library/tempfile.html#tempfile.SpooledTemporaryFile
https://docs.python.org/3/library/tempfile.html#tempfile.SpooledTemporaryFile
