Natural Text
I'm using Python 2.7 with Mock. I have a method that takes a url and downloads it into a temporary file, then renames file according to business logic rules. I want to test this renaming logic, but first I must mock the file download part. And here is where I'm stuck. I'm using urllib2.urlopen and its read(chunkSize) method in infinite cycle, checking if read(chunkSize) returns some value. While this approach works in real life, and the response is eventually read up to the end where read(chunkSize) does not return anything, I get an infinite cycle when mocking. read(chunkSize) seems to always have a result. How do I get the cycle to stop once the contents of the response has been read? Here's my code:
Assign a list of values to return to the side_effect attribute:The mock will iterate over the values for each read() call, so the last call returning an empty bytes object terminates your loop.


Answer URL
https://docs.python.org/3/library/unittest.mock.html#unittest.mock.Mock.side_effect
