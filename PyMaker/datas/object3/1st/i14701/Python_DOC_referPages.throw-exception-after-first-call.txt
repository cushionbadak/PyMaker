Natural Text
I have a loop where I handle adding records to a zip file. I have mocked my zipfile object and I want to raise a exception to verify that my logic for handling large zipfiles will work correctly.is there a way with MagicMocks or plain mocks to accept the first call, but raise an exception on the second?
with a generator and Mock side_effectyou can get:I'm sure you can make it slightly cleaner with some effort, but it should solve your basic problem 
The simplest way is to use side_effect that accept either iterable, callable or Exception (class or instance)Alternatively side_effect can be an exception class or instance. In this case the exception will be raised when the mock is called.As showed in Quick Guide you can use side_effect to raise an exception simply by Moreover you can use list and Exception together in side_effect assignment. So the simplest way to do what you need is something like this:An other way to do it can be use a callable to write the logic of how your mock should react. In this case you are free to chose if it based on arguments or your test's state.


Answer URL
https://docs.python.org/3/library/unittest.mock.html#unittest.mock.Mock
https://docs.python.org/3/library/unittest.mock.html#quick-guide
