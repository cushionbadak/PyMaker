Natural Text
I've been digging around the source code to figure-out at which point the result is printed. For example:The above two statements are compiled to:and The first statement doesn't print anything because None is the returned value. The second returns the result of the addition.CPython's interactive loop calls PyRun_InteractiveOneObjectEx() for each input. This gets the AST and invokes run_mod() to compile that AST to byte code and then evaluate the result in the virtual machine. The returned Python object that PyRun_InteractiveOneObjectEx() gets is simply the top of the VM's stack.So far all of this is what I would expect. But then the returned value seems to be thrown away! When is this printed by the REPL?As an aside, I can see that interactive mode does change the tokenizer; it invokes PyOS_Readline with the sys.ps1 prompt (">>> " by default). I checked for a similar change in pythonrun.c, but no luck.
You are showing disassemblies of the bytecode as generated by having the code in a function.  That isn't how interactive code is compiled: it uses a special 'single' mode (3rd parameter to compile(), if you were doing the equivalent in Python code).  In this mode, the POP_TOP opcode that discards the value of each expression gets turned into a PRINT_EXPR instead.  The reason why x = 1 prints nothing is that statements leave nothing on the stack that needs to be popped, so this transformation doesn't apply.
Correct answer from @jasonharper! For posterity, here's a deeper look of what's going on.The above disassembly shows the results of eval mode:The opcodes can be viewed with:The two numbers following the opcode represent a 16-bit operand, though only the first byte is what we need here. So this corresponds to:Those operands are indices to the compiled code object's variable names and constant pool, respectively.So far, this is what we have in the question. But in reality, executing Python code results in:I.e., the result is discarded and a None is introduced as the return value.In interactive mode, we have:The result is printed (via sys.displayhook) and a None becomes the actual return value.So the printing is introduced by the code generation phase, not by the VM.


Answer URL
https://docs.python.org/3/library/sys.html#sys.displayhook
