Natural Text
I have spent a considerable time trying to get the Linux diff and patch tools to work in python with strings. To achieve this I try to use named pipes since they seem the most robust way to go. The problem is that this doesn't work for big files.Example:This hangs at the first write. If figured out that if I use a[:6500] it hangs on the second write. So I would assume it has something to do with the buffer. I tried manually flushing after each write, closing, using the lowlevel os.open(f, 'r', 0) with 0 buffer but still the same issue.I thought of looping through the write in chunks but that feels wrong in a high level language like Python. Any ideas what I am doing wrong?
A named pipe is still a pipe. It has a finite buffer on Linux. You can't write an unlimited output unless someone reads from the other end of the pipe at the same time.If f1.write(a) blocks then it means diff doesn't read all the input files at once (it seems logical: the purpose of the diff program is to compare files line by line--reading from the first file won't be too far ahead of the reading from the second file).To write different data to different places concurrently, you could use threads/async.io:where named_pipes(n) context manager is defined here.Note: unless you call .communicate(); the diff process may hang as soon as any of its stdout/stderr OS pipe buffers fill up.You could consider whether difflib.context_diff(a, b) would work in your case.


Answer URL
https://docs.python.org/3/library/difflib.html
