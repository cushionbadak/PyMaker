Natural Text
I have basically the following code:The script takes a newline-separated list of file names as its input. However, some of the file names contain invalid utf8, which causes fileinput.input() to implode. I've read about the surrogateescape error handler, which I think is what I want, but I don't know how to set the error handler for fileinput.In short: how do I get fileinput to deal with invalid Unicode?
filenames on POSIX may be arbitrary sequences of bytes (except b'\0' and b'/') i.e., no character encoding can decode them in the general case (that is why os.fsdecode() exists that uses surrogateescape error handler).You could use a binary mode to read the filenames then either skip undecodable filenames if the input shouldn't contain them or pass them as is (or os.fsdecode()) to functions that expect filenames:Beware, there were several known Python bugs related to using a binary mode and fileinput e.g.:fileinput should use stdin.buffer for "rb" modefileinput.FileInput.readline() always returns str object at the end even if in 'rb' mode
Following documentation please use opening hook:


Answer URL
https://docs.python.org/3/library/os.html#os.fsdecode
https://docs.python.org/3/library/os.html#os.fsdecode
