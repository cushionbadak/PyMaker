Natural Text
I am accessing an API and can't get the data returned. The two float pointers will point to an array of data. I must assume the API is working properly. A different function call provides a the length of the data I am retrieving. This values is length down below when attempted.C Header for Functionctypes setupFailed Attempt 1:Program crashes OR Access violation writing.Failed Attempt 2:Null Pointer ErrorFailed Attempt 3:Null Pointer ErrorFailed Attempt 4:Program crashesFailed Attempt 5:Null Pointer Error OR ArgumentError: expected LP_c_float instance instead of LP_c_float_Array_[length]Failed Attempt 6:Program crashesWhat am I missing and why?I believe the argtypes are correct. I am attempting to meet them properly, but there continues to be an issues. Do I need to "malloc" the memory somehow? (I'm sure I need to free after I get the data).This is on Windows 7 with Python 2.7 32-bit.I have looked through other similar issues and am not finding a solution. I am wondering if, at this point, I can blame the API for this issue.
Dealing with pointers and arrays is explained in [Python 3]: Type conversions.I prepared a dummy example for you.main.c:code.py:Notes:The C part tries to mimic what your .dll does (or at least what I understood):size - gets the arrays sizesfunction - populates the arrays (till their size - assuming that they were properly allocated by the caller)Python part is straightforward:Load the .dllDefine argtypes and restype (in your code it's restype's) for the 2 functions (for size_func not necessary)Get the lengthsInitialize the arraysPass them to function_func using ctypes.castOutput (on Lnx, as building the C code is much simpler, but works on Win as well):
It really depends on what you are doing with these float pointers.If you are trying to traverse it, i.e. then for sure this is problematic as no array was allocated. You simply passed a pointer pointing to a float. That is all.You need to first allocate that memory. To this end Attempt 4 looks like the more promising, but I suspect you have a problem inside your C function leading to the crash.Difficult to say without seeing the implementation of that function.


Answer URL
https://docs.python.org/3/library/ctypes.html#type-conversions
