Natural Text
I have been read pickle source code recently.The following code in copy_reg make me confused:So what does __flags__ using for?I found it is defined in type object:I was tried to search it in the official doc, but nothing was found.But interesting thing is that __class__.__flags__ & _HEAPTYPE is always 0 when the __class__ is python internal type. And the result will be 1 when __class__ is a subclass of python internal type.Can anyone help me to solve this puzzle?
__flags__ is a wrapper, to access CPython type object structure member tp_flags, constants used to compose this flag defined in object.h, following is quoted from the source:Type flags (tp_flags)  These flags are used to extend the type structure in a backwards-compatible  fashion. Extensions can use the flags to indicate (and test) when a given  type structure contains a new feature. The Python core will use these when  introducing new functionality between major revisions (to avoid mid-version  changes in the PYTHON_API_VERSION).See more detail on python document on tp_flags.But interesting thing is that class.flags & _HEAPTYPE is always 0 when the class is a python internal type. And the result will be 1 when class is a subclass of python internal type.Subclass of python built-in type, like other user defined type, allocated on heap with PyType_GenericAlloc().to break down type.__flags__:yields:
__flags__ is to be viewed as binary, if you want to see the flags.These type flags are defined here in Python's source code.


Answer URL
https://docs.python.org/3/c-api/typeobj.html#c.PyTypeObject.tp_flags
