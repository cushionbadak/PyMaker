Natural Text
I am having trouble getting my test to run as expected. I am trying to mock the return value for two properties and a method for one test but instead of getting the desired return value I get a MagicMock object.I can not figure out how to do this. The thing that irritates me the most is that mocking the method works as expected but for the two properties it does not.Is this a problem I am having because I am using properties or because of the foreignkey relationships or am I doing something basic wrong?I am using Django 1.8, Python2.7, model-mommy, unittests, mockHere are some snippets of my code, I hope they are sufficient to understand the situation:App1 called producersApp2 called customersApp3 called purchasesA test for the clean method of the Purchase modelactually returned values for producer.is_valid: <MagicMockname='is_valid' id='4465040784'> actually returned values forcustomer.is_valid: <MagicMock name='is_valid' id='4465109520'> for customer.is_allowed_to_purchase_from_producer(producer): FalseWhen asserting if the properties have been called I get False but for the method I get True. Where is the differnce? What am I not seeing?
Thanks to Daniel Roseman's comment and link to PropertyMock I managed to figure out how to get the tests running.A mock intended to be used as a property, or other descriptor, on a  class. PropertyMock provides get() and set() methods so you  can specify a return value when it is fetched.So for the example above, the simple solution is to use PropertyMock as follows for all properties:The rest stays the same as in the above example.I hope this helps if someone is having a similar problem.


Answer URL
https://docs.python.org/3/library/unittest.mock.html#unittest.mock.PropertyMock
https://docs.python.org/3/library/unittest.mock.html#unittest.mock.PropertyMock
