Natural Text
I'm making a couple of functions via exec, that could possibly error. However when Python errors out it doesn't display the line that the error occurred on.For example using:Gives us the output:If we however, don't use eval. Then we get the line that the program errored on:I've looked into using the __traceback__, however I couldn't find a way to add to the traceback under the 'File' line. And so the best I could get was this:The biggest problem with this is if the eval calls other code, it becomes confusing where the - raise Exception() comes from.Is there a way to make the eval code provide the line that it errored on?
That happens when the interpreter is unable to find the source code forthat line for whatever reason. This is the case for built-in modules,compiled files, exec strings, etc. More specifically, in the tracebackyou can see that the filename for the fn's code object is set to <string>Because <string> is not a valid filename, the reference to thesource code is lost.One option is to create a temporary file, write fn_str in there,compile fn_str to set the filename, execute the compiled code, andfinally call the function. Note that you'll need to keep the file aliveat least until the source lines are cached by the traceback-printingfacilityprintsSince we already create a "real" file, we can delegate thecompilation and execution of code to runpy.run_path:


Answer URL
https://docs.python.org/3/library/runpy.html#runpy.run_path
