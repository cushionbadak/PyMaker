Natural Text
I'm automating some repository operations and I'm using GitPython for this job. Let's simplify things and assume I'd like to assert whether my function called pull method on the repository. Code below:However, I noticed that Git class is somewhat special and doesn't implement pull. Instead, it "delegates" all the traffic to __getattr__ which uses another method that does the job.My question is how to approach testing this? I'm using pytest with pytest-mock that provides a mocker fixture and here are my attempts:They both work, but I feel like there is a better way and maybe my approach to testing this is wrong.
Thanks to jonrsharpe who instructed me to use create argument I managed to achieve what I wanted with the following code:Excerpt from the documentation explaining what create=True does:By default patch() will fail to replace attributes that don’t exist. If you pass in create=True, and the attribute doesn’t exist, patch will create the attribute for you when the patched function is called, and delete it again afterwards.


Answer URL
https://docs.python.org/3/library/unittest.mock.html#unittest.mock.patch
