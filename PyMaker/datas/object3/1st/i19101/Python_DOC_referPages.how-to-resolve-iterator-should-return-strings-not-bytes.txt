Natural Text
I am trying to import a CSV file, using a form to upload the file from the client system. After I have the file, I'll take parts of it and populate a model in my app. However, I'm getting an "iterator should return strings, not bytes" error when I go to iterate over the lines in the uploaded file.  I've spent hours trying different things and reading everything I could find on this but can't seem resolve it (note, I'm relatively new to Django- running 1.5- and python - running 3.3).  I stripped out things to get to just the error and ran it like this to make sure it is still there. The error is displayed when executing the line "for clubs in club_list" in tools_clubs_import():The following is the corrected views.py that works, based on answer marked below:The following is the original version of what I submitted (the html that generates the form is included at the bottom of this code list:Exception Value:    iterator should return strings, not bytes (did you open the file in text mode?)Exception Location:     /usr/lib/python3.3/csv.py in fieldnames, line 96
request.FILES gives you binary files, but the csv module wants to have text-mode files instead.You need to wrap the file in a io.TextIOWrapper() instance, and you need to figure out the encoding:It'd probably be better if you took the charset parameter from the Content-Type header if provided; that is what the client tells you the character set is.You cannot work around needing to know the correct encoding for the file data; you can force interpretation as ASCII, for example, by providing a errors keyword as well (setting it to 'replace' or 'ignore'), but that does lead to data loss:Using TextIOWrapper will only work when using Django 1.11 and later (as this changeset added the required support). In earlier versions, you can monkey-patch the support in after the fact:
In python 3, I used:xls_file being the file got from the POST form. I hope it helps.
Fuse your two methods, this never fails in Python 3.5.2 and Django 1.9


Answer URL
