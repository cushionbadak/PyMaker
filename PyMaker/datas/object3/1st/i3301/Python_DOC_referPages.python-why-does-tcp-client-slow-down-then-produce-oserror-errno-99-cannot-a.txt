Natural Text
I am writing a server for an event-based simulator and am using asyncio TCP server for this purpose.I want a client to send encoded json events to this server quickly.ProblemThe client program has varying performance and error generation, despite having no other user programs open.Often, but not always, the first run of client.py runs at about 3,000 tasks per second. Occasionally, the first run goes slower (~500-600 tasks per second).Once the performance drops to 500-600 tasks per second, further runs never recover back to 3,000 tasks per second.Eventually, running client.py raises the following exception:QuestionHow should I rewrite client.py (or server.py) to avoid this?Having read https://docs.python.org/3/howto/sockets.html, perhaps a few notes:The messages will be variable length.I am fine with with either delimiting or sending message length with the messages as opposed to shutting down the connection, which seems to be the underlying source of the problem here.I'd rather not add an application-layer protocol like HTTP here as I know messages will always be UTF8-encoded JSON.
I think using a message delimiter (I've chosen b'\x1e') allows me to have 1 connection for the entire set of messages instead of establishing a new connection for each message. The StreamReader.readuntil method works fine in this case.And client...


Answer URL
https://docs.python.org/3/howto/sockets.html
