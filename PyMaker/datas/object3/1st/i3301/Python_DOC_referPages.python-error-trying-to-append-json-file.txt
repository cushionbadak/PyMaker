Natural Text
I'm relatively new to Python so my issue may be a simple one to fix but after days of trying and searching the internet I cant find anything. So I built a script to stream data from Twitter and store the collecting data into a json file so that I can later access it and do whatever. This script pulls the user credentials like consumer key, token, and access info from a separate file to authenticate (I'm sure there is a better and more secure way to do that, this is just a proof of concept at the moment) using this code:The issue I am having is that if I want to append another user and their credentials to this file I keep receiving this error:THINGS I HAVE ALREADY TRIED:Modifying the mode using 'r', 'r+', 'w', 'w+'Changing load() and dump() to loads() and dumps()Changing the encodingUsing 'r+' and 'w+' did not give me an error, but it did duplicate the original user so that they appeared multiple times. I want to eliminate that so that when it appends it does not duplicate. Any insight would be greatly appreciated. Thanks in advance.
A JSON file is a file containing a single JSON document. If you append another JSON string to it, it's no longer a JSON file.As the docs say:Note Unlike pickle and marshal, JSON is not a framed protocol, so trying to serialize multiple objects with repeated calls to dump() using the same fp will result in an invalid JSON file.If you aren't actually trying to store multiple documents in one file, the fix is easy: what you want to do is open the file, load it, modify the data, then open the file again and overwrite it. Like this:Notice that I'm using w mode, not a, because we want to overwrite the old file with the new one, not tack stuff onto the end of it.If you are trying to store multiple documents, then you can't do that with JSON. Fortunately, there are very simple framed protocols based on JSON—JSONlines, NDJ, etc.—that are commonly used. There are three or four different such formats with minor differences, but the key to all of them is that each JSON document goes on a line by itself, with newlines between the documents.But using ensure_ascii=False means you're not escaping newlines in strings, and indent=2 means you're adding more newlines between fields within the document, and then you aren't doing anything to write a newline after each document. So, your output isn't valid JSONlines any more than it's valid JSON.Also, even if you fix all that, you're doing a single json.load, which would read only the first document out of a JSONlines file, and then doing json.dump to the same file, which would write a second document after that one, overwriting whatever's there. You could easily end up overwriting, say, half of the previous second document, leaving the other half behind as garbage to read later. So, you need to rethink your logic. At minimum, you want to do the same thing as above, opening the file twice:This time I'm using a mode, because this time we do want to tack a new line onto the end of an existing file.


Answer URL
https://docs.python.org/3/library/json.html#json.dumps
