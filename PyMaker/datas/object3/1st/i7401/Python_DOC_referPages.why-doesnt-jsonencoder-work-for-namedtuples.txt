Natural Text
I am unable to to dump collections.namedtuple as correct JSON.First, consider the official example for using custom JSON serializer:Second, now consider the following example which tells Python how to JSONize a Friend object:Finally when we try to implement the same thing using namedtuples, json.dumps(t, cls=FriendEncoder) doesn't give any errors but gives the wrong output. Take a look:The output I get is not a dict-like but rather just a list of values i.e. [21, 'Steve', 'Rogerson']Why?Is the default behavior such that information is lost?Does json.dumps ignore the explicitly passed encoder?Edit: by correctly jsonized namedtuple I mean that json.dumps should return data like exactly dict(nt._asdict()), where nt is a pre defined namedtuple
As I said in a comment, the json.JSONEncoder only calls default when it encounters an object type it doesn't already know how to serialize itself. There's a table of them in the json documentation. Here's a screenshot of it for easy reference:Note that tuple is on the list, and since namedtuple is a subclasses of tuple, it applies to them, as well. (i.e isinstance(friend_instance, tuple) ⇒ True).This is why your code for handling instances of the Friend class never gets called.Below is one way around the issue—namely by creating a Wrapper class whose instances which won't be a type it thinks it already knows how to handle, and then using a custom JSONEncoder to watch for them and does what you want. Here's what I mean:Output:For some additional information and insights, also check out my answer to the question Making object JSON serializable with regular encoder.


Answer URL
https://docs.python.org/3/library/json.html#encoders-and-decoders
