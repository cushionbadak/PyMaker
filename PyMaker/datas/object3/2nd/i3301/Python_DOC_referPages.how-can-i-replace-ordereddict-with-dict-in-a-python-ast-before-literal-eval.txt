Natural Text
I have a string with Python code in it that I could evaluate as Python with  if it only had instances of  replaced with .I am trying to use  and  to do the replacement, but when I catch the node with , I can't find the list that is the argument in the node object so that I can replace it with a  node.Is this even the right approach?Some code:
The idea is to replace all  nodes, represented as  having specific attributes (which can be seen from  below), with  nodes whose  /  arguments are extracted from the  arguments.NotesBecause we want to replace the innermost node first, we place a call to  at the beginning of the function.Whenever an  node is encountered, the following things are used: is a list containing the arguments to the  call.This call has a single argument, namely a list containing key-value pairs as tuples, which is accessible by  () and  are the tuples wrapped in a .So  are the different s () whose elements are accessible again via the  attribute.Finally  are the keys and  are the values which are used in the  call.The latter keys and values are then used to create a fresh  instance which is then used to replace the current node (which was ).
You could use the  class to observe the  tree in order to build the  tree manually from the encountered nodes, using the parsed nodes from an empty dict as a basis.Note that this only works for the simple structure of your example which uses  as keys and  as values. However extensions to more complex structures should be possible in a similar fashion.
Instead of using  for parsing and transforming the expression you could also use a regular expression for doing that. For example:The above expression is based on the example string of the OP and considers single quoted strings as keys and positive integers as values, but of course it can be extended to more complex cases.


Answer URL
https://docs.python.org/3/library/ast.html#ast.NodeVisitor
