Natural Text
This is the observed behavior:The expected output of  is What's going on here?I observed this on , but others have seen this with  and .The observed behavior on  and pypy:
 documentation tells that[...]The operation of  is similar to the uniq filter in Unix. It generates a break or new group every time the value of the key function changes (which is why it is usually necessary to have sorted the data using the same key function). That behavior differs from SQLâ€™s GROUP BY which aggregates common elements regardless of their input order.The returned group is itself an iterator that shares the underlying iterable with . Because the source is shared, when the `groupby() object is advanced, the previous group is no longer visible. So, if that data is needed later, it should be stored as a list [--]So the assumption from the last paragraph is that that the generated list would be the empty list , since the iterator advanced already, and met ; but instead in CPython the result is surprising .This is because the  iterator lags one item behind the original iterator, which is because  needs to peek one item ahead to see if it belongs to the current or the next group, yet it must be able to later yield this item as the first item of the new group.However the  and  attributes of the  are not reset when the original iterator is exhausted, so  still points to the last item from the iterator.The CPython documentation actually contains this equivalent code, that also has the exact same behaviour as the C version code:Notably the  finds the first item of the next group, and stores it its key into  and its value to . But the key is the lineWhen  throws  the  still contains the last key of the previous group. Now, when  is made into a , it first yields the value of , and only then runs  on the underlying iterator (and meets  again).Even though there is Python equivalent in the documentation, that behaves exactly like the authoritative C code implementation in CPython, IronPython, Jython and PyPy give different results.
The problem is that you group all of them into one group so after the first  call everything is already grouped:but the  are a generator, so you need to pass it immediatly into some structure taking an iterable to "print" or "save" it, i.e. a :and then your  is empty and the groupy-generator is finished:


Answer URL
https://docs.python.org/3/library/itertools.html#itertools.groupby
