Natural Text
I got the following function to test:my_package.db_engine.db_functions.py: This function takes the name of a database, then builds a command string from it and executes this command as  with the  method. I want to test this function without actually executing the . I only want to check if the command is built correctly and correctly passed to . Therefore I need to mock the  method which is imported from module .My folder structure is the following:So for my test I tried the following in :The execution of the actual command yields  for . So to verify if the mock return value is used, I set it to .But the mock for the function is not used, as the execution of the test case still yields  because it is executing the actual function that should have been patched with the mock.Any idea what I got wrong here?
You are patching the wrong location. From the Where to patch section: works by (temporarily) changing the object that a name points to with another one. There can be many names pointing to any individual object, so for patching to work you must ensure that you patch the name used by the system under test.The basic principle is that you patch where an object is looked up, which is not necessarily the same place as where it is defined. Your code-under-test finds  as a global in their own module, but you didn't patch that reference:The  reference is patched, but that  reference in  will still point to the original, unpatched function.Patch the imported global instead:Now the  lookup inside  will use the patched mock object rather than the original global bound by the  statement.


Answer URL
https://docs.python.org/3/library/unittest.mock.html#where-to-patch
