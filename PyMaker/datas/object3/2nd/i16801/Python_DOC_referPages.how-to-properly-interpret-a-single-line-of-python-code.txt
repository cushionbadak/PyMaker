Natural Text
I need to execute a line of python code that is entered by the user.If it is a statement I want to execute it, but if it is an expression, I want the result to be returned and do some fancy stuff with it.The problem is that python has two different functions for that, namely  and .Currently I just try to evaluate the string that the user entered.If that raises a SyntaxError, this may indicate that the string is an statement instead, so I try to execute it.This feels rather hacky. Is there a neater, more pythonic way to do this?
While I think your existing code is probably reasonably Pythonic (under the doctrine that it's "easier to ask forgiveness than permission"), I suspect the best alternative approach is to use the  module to inspect the code in your string:Note that some common statements are really "expression statements". So, an input string like  will use the  branch of the code above, rather than the  branch. I don't think this will have any adverse consequences, but you never know.It is also possible to compile the  that has been parsed and then pass the result into the  or  calls later. I found it rather fiddly to get right though (you need to wrap the 's  attribute in an  in the top branch) and so I went with the simpler (to read and understand) alternative of just passing in the string and letting Python parse it again.
You can refactor the try-except a bit. There's no real context in your example, but assuming you want to be able to execute  and then evaluate  afterwards and get , then you could do something like...This should work for more than one line of code too.Without knowing a bit more about your objective it's difficult to say how to do it best, but what you have is fine in principle, it just needs tidying up. This similar answer includes a minimal version of the same try-except logic again, with a focus on mimicking the interpreter more faithfully.
you missed one, actually there are three functions related to executing code, and the one you missed is . takes three required arguments, the code to be compiled, the name of the module being compiled, which will appear in tracebacks originating from that code, and a "mode".  The mode argument should be one of "exec", for compiling whole modules, "eval" for compiling simple expressions, and "single", which should be a single line of interactive input!In all three cases, you pass the returned  object to , with the desired context:


Answer URL
https://docs.python.org/3/library/ast.html
