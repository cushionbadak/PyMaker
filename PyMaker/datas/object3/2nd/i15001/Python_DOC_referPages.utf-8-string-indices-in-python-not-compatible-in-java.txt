Natural Text
I have a text file with the following content:I have a python code running in the server to find the indices which I want to pass with the text for the highlighting purposes on the client. Following is the code for that:The output is:Now on the client side, I have the java code (on android). HOwever these indices dont work at all.And the output is:I am sure I am making some mistake in the encoding of the strings. Can someone help me with that.
The Python side works with UTF-8 encoded data (which vary in size), the Java code with UTF-16 codeunits*. Indices into one do not map into the other.You can see the issue when applying the index to your sample string, both as Unicode string and encoded to UTF-8, in a Python 2.7 UCS-2 build (which uses UTF-16 surrogate pairs like Java does):UTF-8 encodes Unicode codepoints to 1 and 4 codeunits per codepoint; how many codeunits are used then depends on the text:while decoding Unicode to an internal UTF-16 representation (like Java does, and Python 2.7 with the default narrow UCS-2 build), most characters use just the one codeunit, while characters outside of the BMP (like emoticons) use 2:Either run your regex on a Unicode value in Python (e.g. decode from UTF-8) or alter the Java code to operate on UTF-8 bytes rather than UTF-16 codeunits.If you are using Unicode in Python, do take into account that you can also build the Python binary using UCS-4 for Unicode codepoints; you'd never see surrogates and the length of the string in Python will differ from that of the Java representation. Python 3.3 and up use a flexible storage where the internal representation will never use surrogates but instead scales to meet the requirements for each individual string.In that case you may need to use JSR-204 methods to access codepoints on the Java side; I suspect that  would be helpful here but I am not a Java developer.You may want to brush up on Unicode and codecs; I recommend you read:The Absolute Minimum Every Software Developer Absolutely, Positively Must Know About Unicode and Character Sets (No Excuses!) by Joel SpolskyPragmatic Unicode by Ned BatchelderThe Python Unicode HOWTO* Java's String type uses UTF-16 words, which are 2 bytes per codeunit. For characters outside the BMP, that means two codeunits are used per character using surrogate pairs.


Answer URL
https://docs.python.org/3/whatsnew/3.3.html#pep-393
