Natural Text
The situation is pretty strange and I expect that there is something that I don't know about the pickle module.I have two tuples  and . If I compare them it returns .If I pickle them and compare results, it returns Let's look on these byte strings. They are really different:If I unpickle them back and compare results they are identical:So the questions are what is caused this issue and how to avoid it? Are there some metadata pickled?Hmm, I found one related question Python pickle not one-to-one: different pickles give same object. So pickle can return different results for the identical objects? And thus it is inappropriate for hash calculation? Since I planned to calculate md5 hashes based on pickled representation.UPDATE: text representation of  and :
The problem is that  preserves identity relationships between subobjects (this is for efficiency and to handle recursive objects):Here,  and  are equal but are different objects (they have a different ; see When does python choose to intern a string);  and  are again equal but in  the third element is the same object as the first element, while in  the third element is the same object as the second element.We can see this by disassembling the pickles:A quick (if inefficient) workaround could be to break the object identities by using  to recreate the tuples from their :
I've tried with marshal module (https://docs.python.org/2/library/marshal.html#module-marshal), and works. Look the example


Answer URL
https://docs.python.org/3/library/pickle.html#comparison-with-marshal
