Natural Text
I'm trying to round money numbers in Decimal to the nearest 0.05. Right now, I'm doing this:Is there any way I can do this more elegantly without dealing with floats using python Decimals (using quantize perhaps)?
With floats, simply use . This doesn't give control over the rounding direction, though.Using  you also get complete control over the type and direction of rounding (Python 3.5.1):
First note this problem (unexpected rounding down) only sometimes occurs when the digit immediately inferior (to the left of) the digit you're rounding to has a .i.e.But there's an easy solution, I've found that seems to always work, and which doesn't rely upon the  of additional libraries. The solution is to add a  where  is the length of the number string you're trying to use  on plus .Aha! So based on this we can make a handy wrapper function, which is standalone and does not need additional  calls...Basically this adds a value guaranteed to be smaller than the least given digit of the string you're trying to use  on. By adding that small quantity it preserve's 's behavior in most cases, while now ensuring if the digit inferior to the one being rounded to is  it rounds up, and if it is  it rounds down.The approach of using  was deliberate, as it the largest small number you can add to force the shift, while also ensuring that the value you add never changes the rounding even if the decimal  is missing.  I could use just  with a condiditional  to subtract  more... but it's simpler to just always subtract the  as that won't change much the applicable range of decimal numbers this workaround can properly handle.  This approach will fail if your values reaches the limits of the type, this will fail, but for nearly the entire range of valid decimal values it should work.You can also use the decimal library to accomplish this, but the wrapper I propose is simpler and may be preferred in some cases.Edit: Thanks Blckknght for pointing out that the  fringe case occurs only for certain values here.


Answer URL
https://docs.python.org/3/library/decimal.html
