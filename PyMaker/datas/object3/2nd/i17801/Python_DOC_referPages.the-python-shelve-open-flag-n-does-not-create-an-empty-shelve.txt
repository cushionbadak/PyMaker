Natural Text
I am using the Python shelve module and the following python version:. The flag parameter of the shelve.open method is described here:The optional flag parameter has the same interpretation as the flag parameter of dbm.open().and the dbm flag parameter is described here:'n' Always create a new, empty database, open for reading and writing  But the following program did not work as I expected:The output wasFor the second line I expectedbecause the shelve was opened with the  flag and therefore the database should be empty after opening.Do I miss something?Additional tests:OnI also getOnI get the expectedAlso onI getSo this is a new feature or a bug in 3
I found http://bugs.python.org/issue18039. Title: dbm.open(..., flag="n") does not work and does not give a warningwhich gives an explanation.The documentation says that shelve uses one of the available database interfaces.http://docs.python.org/3/library/shelve.html12.3. shelve — Python object persistence  ...  shelve.open (filename, flag='c', protocol=None, writeback=False)  Open a persistent dictionary.  ...  The optional flag parameter has the same interpretation as the flag parameter of dbm.open().  ...12.3.1. Restrictions  The choice of which database package will be used (such as dbm.ndbm or dbm.gnu) depends on which interface is available. Therefore it is not safe to open the database directly using dbm. and that the 'n' flag works like in  http://docs.python.org/3/library/dbm.html12.5. dbm — Interfaces to Unix “databases”  dbm is a generic interface to variants of the DBM database — dbm.gnu or dbm.ndbm. If none of these modules is installed, the slow-but-simple implementation in module dbm.dumb will be used  ...'n'     :     Always create a new, empty database, open for reading and writingBut this definition of the n-flag contradicts to the definition of the n-flag if it falls back to dbms.dumbhttp://docs.python.org/3/library/dbm.html#module-dbm.gnu12.5.1. dbm.gnu — GNU’s reinterpretation of dbmPlatforms: Unix http://docs.python.org/3/library/dbm.html#module-dbm.dumb says12.5.3. dbm.dumb — Portable DBM implementation  ...  dbm.dumb.open(filename[, flag[, mode]])  ...  The optional flag argument is currently ignored; the database is always opened for update, and will be created if it does not exist.So this maybe not an issue on Unix implementations where gnu.dbm libraries are installed (I don't have access to a python 3 on Unix to test this)From this I conclude that there some conflicting statements in the python documentation:On unix systems where dbm libraries are installed python shelve will use this dbm installation an here the 'n' flag works as described in the documentation.If no dbm installation can be found (e.g. on windows systems) the dbm.dumb module will be used where the 'n' works like the 'c' flag.


Answer URL
