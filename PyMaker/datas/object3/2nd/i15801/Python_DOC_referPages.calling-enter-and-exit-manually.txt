Natural Text
I've googled  but with no luck. So let's imagine I have MySQL connector class that uses  and  functions (originally used with  statement) to connect/disconnect from a database.And let's have a class that uses 2 of these connections (for example for data sync). Note: this is not my real-life scenario, but it seems to be the simplest example. Easiest way to make it all work together is class like this:Q: Is it okay (is there anything wrong) to call / manually like this? Pylint 1.1.0 didn't issue any warnings on this, nor have I found any article about it (google link in the beggining).And what about calling:Is this a good/bad practice? Why?
No, there's nothing wrong with that. There are even places in the standard library that do it. Like the  module:Or the  module:The standard library examples aren't calling / for two objects, but if you've got an object that's responsible for creating/destroying the context for multiple objects instead of just one, calling / for all of them is fine.The only potential gotcha is properly handling the return values of the   calls for the objects you're managing. With , you need to make sure you're returning whatever  is required for the user of your wrapper object to get back from the  call. With , you need to decide if you want to propagate any exception that occurred inside the context (by returning ), or suppress it (by returning ). Your managed objects could try to do it either way, you need to decide what makes sense for the wrapper object.
Your first example is not a good idea:What happens if  throws an exception: acquires its resource fails propogates the exception does not run is never cleaned up!Potential for Bad ThingsWhat happens if  throws an exception? finished early is never cleaned up!Potential for Bad Things can help here:Asking the same questions:What happens if  throws an exception:The with block is exited, and  cleans up Everything is ok!What happens if  throws an exception?Doesn't matter,  gets cleaned up before this is calledEverything is ok!Ok, what happens if  throws an exception? makes sure to call  whatever happens to the slave connectionEverything is ok!There's nothing wrong with calling  directly, but if you need to call it on more than one object, make sure you clean up properly!


Answer URL
https://docs.python.org/3/library/contextlib.html#contextlib.ExitStack
https://docs.python.org/3/library/contextlib.html#contextlib.ExitStack
