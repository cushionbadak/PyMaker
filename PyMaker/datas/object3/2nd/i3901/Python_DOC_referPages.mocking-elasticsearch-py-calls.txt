Natural Text
I'm writing a CLI to interact with elasticsearch using the elasticsearch-py library. I'm trying to mock elasticsearch-py functions in order to test my functions without calling my real cluster.I read this question and this one but I still don't understand.main.py inherits from cliff's  classsettings.pysettings_test.pyI want to have  to return what I want (a  object) in order to not make the real HTTP call, but it keeps doing it.What I know:In order to mock an instance method I have to do something likeI cannot patch  because Python tries to import  as module, which cannot work. So I'm patching the whole lib.I desperately tried to put some  everywhere but I cannot understand why I can't mock that thing properly.
You should be mocking with respect to where you are testing. Based on the example provided, this means that the  class you are using in the  module needs to be mocked with respect to . So, more practically, your  call would look like this inside  instead: With this, you are now mocking what you want in the right place based on how your tests are running. Furthermore, to add more robustness to your testing, you might want to consider speccing for the  instance you are creating in order to validate that you are in fact calling valid methods that correlate to . With that in mind, you can do something like this, instead: To read a bit more about what exactly is meant by , check the patch section in the documentation. As a final note, if you are interested in exploring the great world of pytest, there is a pytest-elasticsearch plugin created to assist with this. 


Answer URL
https://docs.python.org/3/library/unittest.mock.html#patch
