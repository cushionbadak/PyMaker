Natural Text
I have a set of super simple XML files to parse... but... they use custom defined entities.  I don't need to map these to characters, but I do wish to parse and act on each one.  For example:There is a tantalizing hint at http://effbot.org/elementtree/elementtree-xmlparser.htm that XMLParser has limited entity support, but I can't find the methods mentioned, everything gives errors:Which depending on how you adjust the comments gives:ororFor those curious the XML is from the OpenStreetMap's mapnik project.
I'm not sure if this is a bug in ElementTree or what, but you need to call UseForeignDTD(True) on the expat parser to behave the way it did in the past.It's a bit hacky, but you can do this by creating your own instance of ElementTree.Parser, calling the method on it's instance of xml.parsers.expat, and then passing it to ElementTree.parse():This outputs "MOOOOO"Or using a mapping interface:This outputs "moo_1"A more complex fix would be to subclass ElementTree.XMLParser and fix it there.
As @cnelson already pointed out in a comment, the chosen solution here won't work in Python 3.I finally got it working. Quoted from this Q&A.Inspired by this post, we can just prepend some XML definition to the incoming raw HTML content, and then ElementTree would work out of box.This works for both Python 2.6, 2.7, 3.3, 3.4.


Answer URL
