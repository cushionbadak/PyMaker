Natural Text
I have a situation where the subprocess communicate hangs when i have to run the subprocess inside an asyncio event loop, and the whole thing is inside a separate thread. I learned that in order to run subprocess in separate thread, i need to have After having the above conditions i got my subprocess work. But the subprocess.communicate is hanging now. The same code is working if call it from the main thread.After digging further i observed that communicate is hanging because the process is not finishing on its own.  is actually hanging.I have seen communicate hang when the command i am trying to issue in subprocess itself hangs, but that is not the case here.
I think this fixes it.  Use loop run_in_executor for the Threads.
It looks like the subprocess SIGCHLD isn't being received by the worker thread but by the parent.  These means process.wait() won't be signaled by the operating system.  There is another discussion about this here.It looks like the child watcher is supposed to detect the SIGCHLD and propagate it to other threads (or pids) and their event loops, which also seems to be it's primary design purpose.  (Documentation is lacking so reading the source is required.)Note: I think the t.join() is blocking the main thread which runs the child watcher, so that needs to be fixed.  I just put a while loop there and end the main event loop when t.is_alive() returns False.


Answer URL
https://docs.python.org/3/library/asyncio-eventloop.html#asyncio.loop.run_in_executor
