Natural Text
In CPython the following returns . This confuses me a bit, since  is a builtin class defined in CTypes and the collections module explicitly relies on the existence of  to accomplish some of its functionality. Something other than straightforward inheritance checks must be going on and I can't figure out why this works. Below I provide some of my reasoning that leads to my confusion.If we look at the inheritance structure of  we see it inherits from . 's signature shows that it inherits from , ,  all of which inherit only from the metaclass .But  is a builtin, which I thought meant that it was being defined directly as a CType which I thought meant it wouldn't be inheriting from anything.So, why is it that  â†’ ?For more context about why this came up see this nbformat issue, in which in attempting to recreate the signature & functionality of 's  we need to know how  will behave. 
That's because metaclasses can customize what  and  return. In case of  this is done via , which allows to register "virtual subclasses".For example:It even works for subclasses of registered subclasses:The same happens for . So even though it's not a real subclass of  it's still a virtual subclass. Like the second example shows that means that all "real" subclasses of  also will be "virtual" subclasses of .Note that even simpler ABCs implement subclass checks based on the presence of methods. For example  checks if the class has a :So even without explicit  this  will be recognized as valid subclass of .
Because this:It's explicitly ed with , and  defines  checks so that registered classes are considered subclasses for the purpose of  and  checks, using the  and  hooks.


Answer URL
https://docs.python.org/3/reference/datamodel.html#class.__instancecheck__
https://docs.python.org/3/reference/datamodel.html#class.__subclasscheck__
