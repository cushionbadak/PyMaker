Natural Text
Long story short, I'm perfectly able to mock class method, when it's just that method that's replaced by mock object, but I'm unable to mock that method when I'm trying to replace the whole class by the mock objectThe  successfully mocks the  method but  fails to do so. I've followed the example at https://docs.python.org/3/library/unittest.mock.html#unittest.mock.patchbut apparently I'm doing something wrong. I'm mocking the lexicon module in the same namespace in both cases (it's imported by  in the ) but the  check failsOutput :EDIT :To clarify, the  is defined as follows 
What is real relevant here is how  's method use . But first of all we should remove the noise:Is what can lead us to the wrong direction: try to replace it byand you will understand that you are printing  because  is not  but just .Now I cannot tell you why the first test doesn't work because the answer is in  method or more probably in  module where I can guess you can have something like In both case take a look to Where to Patch documentation that can enlighten you on what can be the cause and what you really need to patch in your case.The second version works just because you are patching the object and not the reference (that should be different).Finally the more concise and general version can be:One more thing: remove  at least you're not using python 2.4 and you are interested on backported unittest features.[EDIT]Now I can stop to guess and point to you why the first version doesn't work and will never work: attribute is evaluated at the load time. That means when you import  a  is created and the reference associated to . When you patch  you leave this reference untouched and your parser object still use the original reference created when is imported.What you can do is to patch the reference in  class byYou can use  if you want give to your mock the same 's signature.


Answer URL
https://docs.python.org/3/library/unittest.mock.html#unittest.mock.patch
https://docs.python.org/3/library/unittest.mock.html#where-to-patch
https://docs.python.org/3/library/unittest.mock.html#create-autospec
