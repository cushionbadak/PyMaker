Natural Text
Having somewhat a strange issue with python, not unsure if this is something to do with psycopg2 or some rookie error im making with python.Essentially i have a function that copy's data from a csv and attempts to insert it into a pgsql database using psycopg2. If there is an a data type error i want the code to try and rectify it and then re-attempt to insert the data into the data base. here is the code:What happens is that the first try executes as expected and throws the error, then the alter table statement runs correctly, on the second attempt the copy_expert function does nothing but doesnt error and the code completes without inserting the csv data into the database. This is the output showing it tries for the second time. 
So, after having spent ~30 minutes enthusiastically walking down a blind alley, I think I found the cause of the issue. It has neither to do with , nor would I necessarily call it a rookie mistake. I was actually quite convinced that it was about isolation levels ... it wasn't.It's the file handle. The file is read completely by  so the internal pointer is at its end when the  raises. There's simply nothing left to read from that handle the second time around. If you put  in your  block, the pointer will be reset to the beginning of the file.I have created a little test class using your  method and implemented the methods  and  the way I assumed you did. I was able to reproduce the behavior you describe in your post and resetting the pointer in the  block led to the data in the file being visible in the database after the second attempt, following the modification of the column length.


Answer URL
https://docs.python.org/3/library/io.html#io.TextIOBase.seek
