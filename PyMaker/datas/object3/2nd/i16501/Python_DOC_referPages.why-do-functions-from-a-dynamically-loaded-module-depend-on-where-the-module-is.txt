Natural Text
Following this answer, I am using  and  to dynamically load a module and extract functions from it. However, when I store the module in a local variable, functions from it get broken. Here is an example:Executing this with Python 2.7.3 yields : codepad. After uncommenting  line, making  global, the function works as expected and prints 42: codepad. What am I missing? Why does the behaviour change when module is stored in a local variable?
The  module is a local, and not referenced anywhere else. Like all other objects in Python, that means it is cleaned up when  exits. By making it a global instead, a reference to the module object is kept.When a module is cleaned up, all the globals are set to  (this is done to break reference cycles early, setting to  is an optimisation to prevent excessive rehashing due to dictionary resizing). The  object still has a reference to the module globals dictionary, and thus sees  bound to  now.The normal procedure of importing a module adds a reference to the module object in , keeping the module alive until interpreter shutdown.(In Python 3.4, globals are no longer rebound to  (in most cases), as per Safe Object Finalization; see PEP 442).


Answer URL
https://docs.python.org/3/whatsnew/3.4.html#whatsnew-pep-442
