Natural Text
I am trying to backtest moving average crossover strategy with pandas.First, I defined a class (Book) where number of stocks, amount of cash, and total amount of asset.In the class there are 3 functions that calculates book status as buy or sell signals is generated.Here is my code, but when I tested, I could find miscalculation of stocks and total asset.What's the problem?result
I have updated your code as below and now it seems to be somewhat better and improved, I have added additional info in  for debugging purpose, which you can remove as per your requirement:And the output dataframe is now as below:I had noticed couple of things, first is that during some of the calculations  is going negative this is because of floating point calculation limitations in Python, refer Floating Point Arithmetic: Issues and Limitations for more details. The negative  can be resolved in your code if you choose to have only  as integer that can be done using floor division i.e with operator . If you with to have  as integer the update my above code and replace  function with the below:Second thing is that in  function when we buy  then  needs to reduced only for the new  not for the whole available.Additionally rounding can be done to two decimal places for all the floating numbers where multiplication and division using round(number[, ndigits]).I hope this helps you to some extent.


Answer URL
https://docs.python.org/3/tutorial/floatingpoint.html#tut-fp-issues
https://docs.python.org/3/library/functions.html#round
