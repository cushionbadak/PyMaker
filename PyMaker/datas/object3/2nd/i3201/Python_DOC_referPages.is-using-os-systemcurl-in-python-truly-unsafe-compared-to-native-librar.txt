Natural Text
I'm writing a project with Angular on the frontend, and a backend written in Python.For certain API calls, instead of using Python's built-in libraries (and since I am more of a C/C++/bash programmer) and did not know how to do a similar normal system call in python,  I just did a .When people were reviewing my code they said that it would be better practice to use Python's built in libraries instead of doing a  call since it looks better and could be less dangerous.Is this a legitimate criticism? How could it be more dangerous if the python library is probably doing the same thing anyway?I am not asking for opinions on style but legitimate problems with this method. 
The objection is entirely legitimate.Let's say that your command looks like:Now, what happens if you're told to report a result that contains ? The shell invoked by  runs , and then it runs a second command of .Several naive attempts at fixes don't work.Consider, for example:Even if you avoid direct shell injection vulnerabilities, using a shell exposes you to other kinds of bugs.At startup time, a shell does a number of operations based on filesystem contents and environment variables. If an untrusted user can manipulate your program into setting environment variables of their choice before calling , they can cause a file named in  to have its commands executed; can shadow commands with exported functions, or can cause other mischief. See ShellShock for a well-publicized historical example.And that's before considering other things that can happen to your data. If you're passing a filename to a shell, but unknown to you it contains whitespace and glob characters, that filename can be split into / replaced with other names.The official Python documentation warns against shell use.Quoting a warning from the Python  module documentation, which is also relevant here:Warning: Executing shell commands that incorporate unsanitized input from an untrusted source makes a program vulnerable to shell injection, a serious security flaw which can result in arbitrary command execution. For this reason, the use of  is strongly discouraged in cases where the command string is constructed from external input: disables all shell based features, but does not suffer from this vulnerability; see the Note in the  constructor documentation for helpful hints in getting  to work.When using ,  can be used to properly escape whitespace and shell metacharacters in strings that are going to be used to construct shell commands. has all the same faults as  -- even more faults, since  provides a way to pass data out-of-band from code, and so can be used safely.Native Python libraries don't call shells for work that the Python runtime can do.Python has a  library in its standard library interface, which directly invokes operating system and libc calls to create network connections and interact with them. There is no shell involved in these syscalls; arguments are C structs, C strings, etc; so they aren't prone to shell injection vulnerabilities in the same way that  is.Some Python libraries, like , may be slightly less native insofar as they use their own C libraries rather than only calling out to the operating system through functions included in the Python runtime itself; even then, though, these OS-level syscalls are at a much lower level than any shell.
This answer is entirely correct.But I'd also like to point out to other cases in which you might think that security doesn't matter. E.g. the command you are running is hard-coded or you have 100% control or trust over what is supplied to it.Even it that case using  is wrong.In fact:You have to rely on external tools that might not be present or, even worse, you might have a command with that name, but it doesn't do what you expect it to do. Maybe because it has a different version or maybe because it's a different implementation of that command (e.g. GNUtar != BSDtar). Manging python dependencies will be much more easy and reliable.It is more difficult to handle errors. You only have a return code which is not always enough to understand what is going on. And I hope that your solution to this problem isn't to parse the command output.Environment variables can modify the way a program works unexpectedly. Many programs use environment variables as an alternative to command line or configuration options. If your python script relies on specific behavior from the command, an unexpected variable in the user's environment can break it.If at some point in the future you will need to let the user customize a bit your script behavior you will need to rewrite it from scratch without  or you might have security problems.


Answer URL
https://docs.python.org/3/library/subprocess.html#subprocess.Popen
