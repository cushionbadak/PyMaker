Natural Text
I am attempting to read from keyboard input without waiting for input. The purpose is to be used in an "infinite" loop ala while True:.Thus far I've been trying to manipulate the readchar library https://pypi.python.org/pypi/readchar/0.6 , but with no luck. While it doesn't wait for Enter, it still waits for some input. I don't want it to wait for input, but simply to check and return "" or some placeholder if there is no input.Here is what I've been working with:
The POSIX I/O functions that ultimately underlie Python's file objects have two different modes, blocking and non-blocking, controlled by a flag named . In particular, the  function says:When attempting to read a file … that … has no data currently available … If  is set, read() shall return -1 and set errno to .In Python, this flag is available in the  module. is already open, so you can't just pass  to the  function, so… what do you do? Well, you actually might want to open  instead; it kind of depends on what you're actually doing. In that case, the answer is obvious. But let's assume that you don't. So, you want to change the flags of the already-open file. That's exactly what  is for. You use the  operation to read the current flags, or in the bit for , and  the result. You can remember the current flags for later if you want to restore things, of course.In Python, the  function, and the operation constants, are available in the  module.One last problem:  isn't a raw file object, it's a  that does Unicode decoding on top of a , which itself adds buffering on top of a . So,  isn't directly calling the POSIX  function. In order to do that, you need to use . And you may also need to do lots of careful flushing if you want to go back and forth between raw and normal input. (Note that this means you're giving up Unicode and instead getting a single-byte  object, which could be, say, half of a UTF-8 character or a quarter of a terminal escape character. Hopefully you're expecting that.)Now, what does  return when nothing is available? Well, it's an implementation of , and  says:If 0 bytes are returned, and size was not 0, this indicates end of file. If the object is in non-blocking mode and no bytes are available,  is returned.In other words, you're going to get  if nothing is available,  for EOF, or a single-byte  for anything else.So, putting it all together:One last thing: Is there a way to tell if input is ready without reading it? Yes, but not portably. Depending on your platform, , , , and/or  may be available and may work on regular files.  may be guaranteed to return  instead of . And so on. You can read your local man pages. But a simpler solution is the same thing C's stdio does: add a 1-byte-max buffer, and use it to implement your own  and  or  and  wrappers.


Answer URL
https://docs.python.org/3/library/os.html#os.O_NONBLOCK
https://docs.python.org/3/library/fcntl.html#fcntl.fcntl
https://docs.python.org/3/library/io.html#io.TextIOWrapper
https://docs.python.org/3/library/io.html#io.BufferedReader
https://docs.python.org/3/library/io.html#io.FileIO
https://docs.python.org/3/library/io.html#io.RawIOBase.read
https://docs.python.org/3/library/curses.html
