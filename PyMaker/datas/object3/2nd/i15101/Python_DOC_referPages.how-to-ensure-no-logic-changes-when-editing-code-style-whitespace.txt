Natural Text
When making superficial changes to a Python script (changing code-style/formatting/whitespace, for example), it's useful to be able to check if any logical changes were (accidentally) made to the code.For C/C++ I generate assembler and diff it (not 100% fool proof with platform specific , but still useful). While I could binary diff a  file, this isn't so helpful in seeing what exactly changed.Is there a convenient way to get some human-readable text output of the AST that can be checked for changes? This may of course raise some false positives (replacing  with , for example), but I am still interested to know if some convenient ways exist.Background infoSince it was suggested to just run tests.Here is some background on why I ask this question.This code has no tests and it's unlikely to ever have 100% test coverage since it happens to be build-system utility scripts. In theory, we could spend time to add a test suite and find ways to enable tests to run on different platforms (monkey patch  or run continuous integration on all supported platforms in a VM...) but we simply can't justify spending this kind of effort at the moment.Also, it's possible that you might want to clean up test code itself!
Parsing the AST to check for logical diff is a great idea. Python makes working with its AST incredibly easy.If you would like to see a diff then Python has another built in diff library.
As @erik-e noted, you can simply use , however this puts everything in a single line, heres a modified version of , in a script that reads from the stdin and prints out the ast.eg:Other than newlines and indentation, output is the same as .You can download the script from:https://gitlab.com/ideasman42/dotfiles/blob/master/bin/py_to_ast.pyExample output of this script run through its self
You could possibly make your own tree rather easily, I'd recommend reading if the equality operator on it has been overloaded for comparison, it it hasn't you'd have to manually compare them. Read about it here
Our SmartDifferencer parses source code into an AST, and computes a difference over the ASTs.  This ignores whitespace formatting, comments, number radix, escape sequences in strings.  SmartDifference works with Python as well as other languages.If the only change are whitespace differences, the AST difference is empty.  In this case the program is semantically identical.Any actual differences are reported in the form of plausible edits to the code structures, such as:  delete, insert, move, copy, replace identifier.


Answer URL
https://docs.python.org/3/library/ast.html
https://docs.python.org/3/library/difflib.html
