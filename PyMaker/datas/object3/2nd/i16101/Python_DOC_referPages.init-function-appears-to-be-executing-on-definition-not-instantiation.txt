Natural Text
I have something akin to the following code:This fails on import, not runtime, defining the , saying 'the database has no connection'. This doesn't make sense to me, since the  function hasn't even been run yet!
I found this: http://docs.python-guide.org/en/latest/writing/gotchas/#mutable-default-argumentsTurns out, values for optional arguments are evaluated at their definition, not when executed. Here's an extreme example:Before this discovery, I'd say this code would do nothing; no functions are run, just some definitions. Now I know (and have tested) that this code alone will print out .This means two things for the code in the above question:In order to not crash, the  would have to be run before the  definition happens.The  would  only get run once, and said db query would never get re-run (stale credentials!)So to make this actually do what it's intended to do (query the database for credentials when none are provided), you have to do something akin to this:This way  is run at runtime, not at definition. This both allows the  to be done elsewhere (so long as it's before an instance of  is instantiated), and fixes the stale credentials issue.


Answer URL
https://docs.python.org/3/tutorial/controlflow.html#default-argument-values
