Natural Text
In the context of a python  CLI application, I would like to run a subcommand inside of a context manager that would be setup in a higher level command. How is it possible to do that with ? My pseudo-code looks something like:And this would be called like:Edit: note that the above example is forged to better illustrate the missing functionality of , not that I want to solve this problem in particular. I know I could repeat the same code in all commands and achieve the same effect, which I already do in my real use case. My question is precisely on what could I do only in the main function, that would run all transparently subcommands in a context manager.
Decorating commandsDefine a context manager decorator using Use  decorator on , so you can explore click contextCreate an instance  of the context managerIterate on commands defined for group  using For each command, replace the original callback (function called by the command) with the same callback decorated with the context manager This way you will programmatically modify each command to behave just like:But without requiring to change your code beyond your function .See the code below for a working example:It does what you describe in your question, hope it will work as expected in real code.Using This code below will give you an idea of how to do it using .Another solution to avoid explicit  statement could be passing the context manager as a decorator using , but it would likely be more complex to setup with .


Answer URL
https://docs.python.org/3/library/contextlib.html#contextlib.ContextDecorator
https://docs.python.org/3/library/contextlib.html#contextlib.ContextDecorator
https://docs.python.org/3/reference/compound_stmts.html#the-with-statement
