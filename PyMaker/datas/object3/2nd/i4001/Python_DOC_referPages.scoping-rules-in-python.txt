Natural Text
Consider the following python snippet (I am running Python 3)This produces the output  as expectedHowever,generates an .Why does the first snippet work, whereas the second doesn't? 
The error is actually caused (indirectly) by the following line, i.e. . Try commenting out that line and you'll see that the function works.The fact that there is an assignment to a variable named  makes  local to the function at compile time, however, at execution time the first reference to  fails because, at the time that the  statement is executed, it does not exist yet in the current scope.Correct it by using  in :The reason that the first function () works is because it's OK to read variables in an outer scope, however, you can not assign to them unless you specify that the variable exists in an outer scope (with  or ).You can assign to a variable of the same name, however, that would create a new local variable, not the variable in the outer scope. So this also works:Here  is assigned to before being referenced. This creates a new variable named  in the scope of function  which shadows the  defined in .
In a given scope, you can only reference a variable's name from one given scope. Your variable cannot be global at some point and local later on or vice versa.For that reason, if  is ever to be declared in a scope, Python will assume that you are refering to the local variable everywhere in that scope, unless you explicitly state otherwise.This is why you first function, , works. The variable  is unambiguously coming from the closure. Although, in  the variable  is used in the scope and thus you cannot reference the  from the closure unless explicitly stating otherwise with .The following errors might enlighten us on this.A variable cannot become global after useThis raises a . This means that the closure's  cannot be used and then the global one.A global variable cannot become localHere is another case using  at the top of .This code was exectued without error, but notice that the assignment to  updated the global variable, it did not make  become local again.


Answer URL
https://docs.python.org/3/reference/simple_stmts.html#the-nonlocal-statement
https://docs.python.org/3/reference/simple_stmts.html#the-nonlocal-statement
