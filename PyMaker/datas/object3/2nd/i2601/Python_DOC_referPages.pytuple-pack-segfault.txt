Natural Text
I have a function  in a Python Extension Module that should return a tuple of ints to Python. This can be easily done using :Instead of , I want to use , which ensures that the return value is indeed a tuple.The Python C API documentation says that  is equivalent to . Both functions return a new reference of type .Hence, given the code above,should do the trick, which is does not. Instead I get a segfault.What am I missing here?
The difference is: expects  and  to be simple C-int values. expects  and   to be already s (and not C-ints).The documentation says: The tuple values are initialized to the subsequent n C arguments pointing to Python objects.  is equivalent to .In order to use  you need to convert the int-values to Python-Integers first. It is simpler to use . If you parenthesize your format string in , the result will be a tuple: does not always build a tuple. It builds a tuple only if its format string contains two or more format units. If the format string is empty, it returns None; if it contains exactly one format unit, it returns whatever object is described by that format unit. To force it to return a tuple of size 0 or one, parenthesize the format string.That means: there is nothing to worry about if you construct a tuple from at least two elements:It is different if there is only one element:or no elements at all:So just make sure there are parenthesizes in the format string and the returned value will be a tuple.


Answer URL
https://docs.python.org/3/c-api/arg.html#c.Py_BuildValue
