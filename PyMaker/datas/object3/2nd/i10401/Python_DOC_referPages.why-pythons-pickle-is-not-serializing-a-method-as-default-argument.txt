Natural Text
I am trying to use pickle to transfer python objects over the wire between 2 servers. I created a simple class, that subclasses  and I am trying to use pickle for the marshalling:I first tried to use  for the marshalling, but when I un-marshalled I received an error related to the  expression.Then I tried to do the marshalling with  but it seemed the  was not called.Then I tried again with , but I passed the  function as the  parameter - again the  does not seemed to be invoked and the un-marshalling failed on the  ( is ).Why is that? what am I missing here?If I try to run the following code:it fails with This is a different question than: Python, cPickle, pickling lambda functionsas I tried using  with  and it failed to work, and I also tried passing a function and it also failed.
 is loading your dictionary data before it has restored the attributes on your instance. As such the  attribute is not yet set when  is called for the dictionary key-value pairs.Note that  will never call ; instead it'll create an entirely blank instance and restore the  attribute namespace on that directly.You have two options:default to  and ignore the condition if it is still set to :The  there is needed because a blank instance has no  attribute at all (it is not set to , the attribute is entirely missing). You could add  to the class:and then just test for .Define a custom  method to control how the initial object is created when restored: is expected to return a tuple with:A callable that can be pickled directly (here the class does fine)A tuple of positional arguments for that callable; on unpickling the first element is called passing in the second as arguments, so by setting this to  we ensure that the new instance is created with  passed in as an argument and now  will be called.The next 2 positions are for a  method (ignored here) and for list-like types, so we set these to .The last element is an iterator for the key-value pairs that pickle then will restore for us.Note that I replaced the default value for  with a function here too so you don't have to rely on  for the pickling.


Answer URL
https://docs.python.org/3/library/pickle.html#object.__reduce__
