Natural Text
I'm currently struggling to find a good way of mocking multiple layers / nested  return values. In other words, I want to return a magic mock that in turn returns a magic mock with it's own set return values. I'm finding this relatively cumbersome and am looking for a more elegant and maintainable solution.I'm trying to test the following code efficiently. the URL returns a json string that needs further processing:This is how I've mocked this so far, which is extremely inelegant and makes maintenance complicated:In the end, all i'm trying to mock is the returned data from the decode function, that originates from the url open function.This should be possible in one line or in a simpler way, using perhaps the enter methods.Ideally the mock would look something like this in the test_load_json function:Unfortunately, I can't seem to find anything useful in the mock documentation. Any help appreciated.
Turns out this is easily possible and documented. However, the naming is not straightforward and needed to know what one is looking for. The referred to mocking is chained calls, which are in fact documented in the mock library.In this example, the mock_urlopen should look like this:This works beautifully. For more details check out the python doc: https://docs.python.org/3/library/unittest.mock-examples.html#mocking-chained-calls
I have made this for you as a helper class:


Answer URL
https://docs.python.org/3/library/unittest.mock-examples.html#mocking-chained-calls
