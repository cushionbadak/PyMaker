Natural Text
I am sending an email with an attachment, and that attachment has a long filename. Why does it get corrupted with newlines, and what part of the system is supposed to know these newlines should be removed?Gives me:
Handling of long header fields is defined in section 2.2.3 of RFC 2822 "Internet Message Format". That section survives unchanged in an obsoleting RFC 5322.2.2.3. Long Header FieldsEach header field is logically a single line of characters comprising  the field name, the colon, and the field body.  For convenience  however, and to deal with the 998/78 character limitations per line,  the field body portion of a header field can be split into a multiple  line representation; this is called "folding".  The general rule is  that wherever this standard allows for folding white space (not simply  WSP characters), a CRLF may be inserted before any WSP.  For example,  the header field:can be represented as:Note: Though structured field bodies are defined in such a way that  folding can take place between many of the lexical tokens (and even  within some of the lexical tokens), folding SHOULD be limited to  placing the CRLF at higher-level syntactic breaks.  For instance, if a  field body is defined as comma-separated values, it is recommended  that folding occur after the comma separating the structured items in  preference to other places where the field could be folded, even if it  is allowed elsewhere.The process of moving from this folded multiple-line representation of  a header field to its single line representation is called  "unfolding". Unfolding is accomplished by simply removing any CRLF  that is immediately followed by WSP.  Each header field should be  treated in its unfolded form for further syntactic and semantic  evaluation.
As Leon's answer explains, Python is implementing the folding algorithm defined in the RFCs.In Python 2, you can use an  instance to give you control over the maximum header length; from the docs:For more flexibility, instantiate a Generator instance and use its flatten() method directly. For example:(setting maxheaderlen to zero will prevent folding of long header lines in almost all cases).In Python 3.5, the maxheaderlen argument is exposed in 's signature, so is possible.  is zero by default, so header lines are not wrapeed unless a value is provided.In Python 3.6,  is exposed in 's signature (note this is a different class).   now defaults to : header lines wrap at 78 characters unless a value is specified.


Answer URL
https://docs.python.org/3/library/email.message.html#email.message.EmailMessage.as_string
