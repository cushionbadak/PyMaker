Natural Text
I have written a spider that takes urls from a list, loads the according pages using  in separate threads using  and when a page is loaded some info is extracted from it, put into an  (a dictionary) and that  is put into a  called .After running a spider method that creates jobs for  in separate threads (simplified):I am waiting for the items collected by worker threads:However sometimes the  loop breaks before all the items have been collected. is a  of worker threads which in  loop take work items from  and run associated callables.Condition  is not reliable, because the work item queue in executor maybe empty as well as the collected items queue, but at the time of checking this condition an executor worker thread could have taken the last work item from  and right now is doing some work that will add a collected item to  queue (which at the moment is empty too). Or the work item queue has not received yet the first work item.I don't see a way to reliably determine whether I have still to wait for new items to appear in  or move on.UPDATE:I would solve this if after finishing a work item the worker thread would call . Unfortunately it's not the case.I've added a comment to a related bug: http://bugs.python.org/issue14119#msg207512
Write your worker code like this:And use  as the condition.


Answer URL
