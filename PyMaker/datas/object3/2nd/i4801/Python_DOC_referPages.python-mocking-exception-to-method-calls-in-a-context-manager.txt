Natural Text
I'm working on unittesting some python3 code that calls sendmail on an  class via a context manager and attempts to catch exceptions to log them.  I can successfully mock the  class and do some checking on it in other tests (e.g. verifying that  was actually called), but I can't seem to get the method call to  on the class to raise an exception to log the error.Code to be tested (from siteidentity_proxy_monitoring.py):Unittest method:Output from the test result:I feel like I'm missing something related to the calls to  and , but I can't quite seem to tease out why my patching doesn't seem to trigger the side effect where I expect it to.  Unfortunately, most of the examples and documentation I've come across don't quite go that in depth with mocking method calls within contexts (as far as I've understood them, anyway).
Got stuck on similar issue just now, this is how get around it:Put a  before line Run your test.When you get dropped into the PDB session, type  and you'll see something like .In your test case, replace all s with . In your case: .


Answer URL
https://docs.python.org/3/library/unittest.mock.html#mocking-magic-methods
