Natural Text
I'd like to create a custom sequence of elements. When iterating over it, the length of the sequence is ignored. Here is a minimal code example:I'd expect to have only  to  printed out. In reality, the loop behaves as with an infinitely long sequence and goes on and on and on.  returns  as expected.What am I missing?
Python expects  to raise an  when indexes outside of the possible range are requested, as noted in the docs:Note  loops expect that an  will be raised for illegal indexes to allow proper detection of the end of the sequence.The advantage to this is that you don't have to implement  which means your index-based iterable can be lazy, meaning unknown lengths or infinite lengths are possible.This mirrors the way iterator objects and for loops work in Python - they continue to ask for values until an exception is reached ( for iterators), which makes the implementation easier -  just wraps with a loop incrementing the index until it hits the exception.
You have to check yourself, if the key is out of bounds.  is only used for two purposes. To be able to call len(obj) and it will be used, if no  method exists to determine, if the object evaluates to true in conditions.


Answer URL
https://docs.python.org/3/reference/datamodel.html#object.__getitem__
https://docs.python.org/3/glossary.html#term-iterator
