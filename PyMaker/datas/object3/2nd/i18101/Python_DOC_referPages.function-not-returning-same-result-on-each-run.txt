Natural Text
I am trying to replace special characters with HTML entities, But the results are random with the same input and I don't understand why.Here is the code :Here are the console outputs:The problem is with the  character which is sometimes returned as  and sometimes as .I think it is coming from the last item in the dictionary,  but I don't understand why it is not interpreted the same on each run.
As you speculated in your answer, the problem is that iteration over a dictionary does not have a defined order.From the Python 3 documentation:Performing list(d.keys()) on a dictionary returns a list of all the  keys used in the dictionary, in arbitrary order (if you want it  sorted, just use sorted(d.keys()) instead).It's not explicitly stated, but the same applies to items().I'm a little surprised to see the order changes between iterations in this case, but arbitrary in this case means undefined -- any order is technically valid.  If you want consistent results, I recommend redesigning your algorithm to not be sensitive to the ordering of the items at all; failing that, sorting the output first or using an OrderedDict would at least solve the consistency problem.
I have modified the function as follow and it is working :but I don't understand why the old function is not working... A for x in ... is not always the same order ?
Sometimes, your code replaces  with  first, and then  with . Sometimes it does it the other way round.Example (using "\'" as input):If we do  ->  first, and then  ->  we get  after the first attempted replacement (where nothing happens because there isn't a ), and then  after the second.But if we do it the other way round, we get  after the first, and then it replaces the  with  for the second, so we end up with !This happens because  is a dictionary, so it isn't ordered, and iterating through it (the  loop) doesn't necessarily happen in the same way each time.The way you have gone about solving it is fine, but for future reference there is an  in the  module.


Answer URL
