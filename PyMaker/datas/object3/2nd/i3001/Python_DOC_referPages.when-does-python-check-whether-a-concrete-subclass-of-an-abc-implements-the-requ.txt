Natural Text
While trying to write unittests that check whether a concrete subclass of an Abstract base class really does raise a TypeError upon instantiation if one of the required methods is not implemented, I stumbled upon something which made me wonder when the check if the required methods is defined by the concrete subclass is actually performed.Until now I would have said: upon instantiation of the object, since this is the time when the Exception is actually raised when running the program.But look at this snippet:As expected, trying to instantiate MyConcreteSubclass raises a TypeError:But what happens if I declare a valid subclass at first and then afterwards delete this method surprises me:This is certainly not what I expected. When inspecting MyConcreteSubclass.foo after deletion, we see that through the method Resolution order the Abstract method of the base class is retrieved, which is the same behaviour as if we haven't implemented foo in the concrete subclass in the first place.But after instantiation the TypeError is not raised.So I wonder, are the checks whether the required methods are implemented already performed when the body of the concrete subclass is evaluated by the Interpreter?If so, why are the TypeErrors only raised when someone tries to instantiate the subclass?The Tests shown above were performed using Python 3.6.5.
It happens at class creation time. In Python 3.7, it's in C, in  in , which is called as part of .Incidentally, the docs do mention thatDynamically adding abstract methods to a class, or attempting to modify the abstraction status of a method or class once it is created, are not supported.
user2357112's answer covers the main question here, but there's a secondary question:why are the TypeErrors only raised when someone tries to instantiate the subclass?If a  were raised earlier, at class creation time, it would be impossible to create hierarchies of ABCs:You don't want that to raise a  because  doesn't define , unless someone tries to instantiate .What if it were legal only for classes that added new abstract methods? Then it would be possible to create ABC hierarchies, but it would be impossible to create intermediate helper classes:(For a more realistic example, see the classes in  that allow you to implement the full  interface by defining only 7 of the 18 methods.)You wouldn't want a rule that made such definitions illegal.


Answer URL
https://docs.python.org/3/library/abc.html#abc.abstractmethod
https://docs.python.org/3/library/collections.abc.html
