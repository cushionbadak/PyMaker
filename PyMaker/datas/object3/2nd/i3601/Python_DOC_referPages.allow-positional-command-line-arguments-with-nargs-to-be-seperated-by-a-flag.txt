Natural Text
I have a program using argparse. It takes 1 required positional argument, 1 optional positional argument, and 1 flag argument. Something like:So, I tried using this:Which works fine for  and .But when I do , it throws an error:So, how can I get it to accept the optional positional argument to be accepted even if there is a flag in between?Note that this works if I remove the , but then it's not optional. The problem also happens with , but this doesn't happen for  (e.g. , ) and doesn't happen for .  makes it parse the flags as part of  (, )
This is a known issue, both here on SO and Python bug/issues, and doesn't have an easy fix.   https://bugs.python.org/issue15112It's the result of the basic parsing algorithm.  This trys to parse positionals up to the next optional's flag.  Then parse the flagged option (and however many arguments it needs).  Then parse the next batch of positions, etc.When the parser handles , it can also handle , even if there is just one string.   requires nothing.  That means  gets 'used up' the first time it processes positionals.With  used up (even though it just gets the default), there's nothing to consume the last string.  It is an 'extra'.parse_intermixed_argsPython 3.7 has added a parsing method that solves this issue, .  https://docs.python.org/3/library/argparse.html#intermixed-parsingIt was added as a way of allowing a flagged Action in the middle of a '*' positional. But ends up working in this case with '?' Actions.  Note the caution in the docs; it may not handle all  features.In effect it deactivates the , does a  to get all , and then parses the  with just the .  See the code of  for details.


Answer URL
https://docs.python.org/3/library/argparse.html#intermixed-parsing
