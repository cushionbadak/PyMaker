Natural Text
An answer here (Size of raw response in bytes) says : Just take the  of the content of the response:However doing that does not get the accurate content length. For example check out this python code:If we try and manually calculate the content length and compare it to what is in the header, we get an answer that is much larger? Why does  not return the correct content length? And how can we manually calculate it accurately if the header is missing? 
The  header reflects the body of the response. That's not the same thing as the length of the  or  attributes, because the response could be compressed.  decompresses the response for you.You'd have to bypass a lot of internal plumbing to get the original, compressed, raw content, and then you have to access some more internals if you want the  object to still work correctly. The 'easiest' method is to enable streaming, then reading from the raw socket:Demo:This reads the full response into memory, so don't use this if you expect large responses! In that case, you could instead use  to copy the data from the  file to a spooled temporary file (which will switch to an on-disk file once a certain size is reached), get the file size of that file, then stuff that file onto .A function that adds a  header to any request that is missing that header would look like this:This accepts an existing session, and lets you specify the request method too. Adjust  as needed for your memory constraints. Demo on , which lacks a  header:Note that if there is no  header present or the value for that header is set to , and the  is available, then just you can rely on  being the full size of the response. That's because then there is obviously no compression applied.As a side note: you should not use  if what your are after is the length of a  or  object (the number of bytes or characters in that object).  gives you the internal memory footprint of a Python object, which covers more than just the number of bytes or characters in that object. See What is the difference between len() and sys.getsizeof() methods in python?


Answer URL
https://docs.python.org/3/library/tempfile.html#tempfile.SpooledTemporaryFile
