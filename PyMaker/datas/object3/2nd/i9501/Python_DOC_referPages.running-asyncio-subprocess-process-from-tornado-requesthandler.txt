Natural Text
I'm trying to write a Tornado web app which runs a local command asynchronously, as a coroutine. This is the stripped down example code:When  is called directly it executes as expected. Also, when I have  implemented as a regular, synchronous method (see ), it executes correctly. However, when running the above app and calling , the log shows:However,  shows that the process hanged:I have a feeling that I'm not implementing the right loop, or I'm doing it wrong, but all the examples I've seen show how to use , and I couldn't find much about combining asyncio and Tornado. All suggestions welcome!
Subprocesses are tricky because of the singleton  handler. In asyncio, this means that they only work with the "main" event loop. If you change  to , then the example works. A few other cleanups were also necessary; here's the full code:Also note that tornado has its own subprocess interface in , so if that's the only thing you need asyncio for, consider using the Tornado version instead. Be aware that combining Tornado and asyncio's subprocesses interfaces in the same process may produce conflicts with the  handler, so you should pick one or the other, or use the libraries in such a way that the SIGCHLD handler is unnecessary (for example by relying solely on stdout/stderr instead of the process's exit status).


Answer URL
https://docs.python.org/3/library/asyncio-subprocess.html#subprocess-using-streams
