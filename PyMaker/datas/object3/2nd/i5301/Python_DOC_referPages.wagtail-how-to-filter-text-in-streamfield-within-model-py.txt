Natural Text
I would like to write a filter which replaces some $variables$ in my streamfield text. What is the best way to do this in my "Page" model? I tried the following but it is sometimes not working if I save my model as draft and publish it afterwards. Does anyone know a better way doing this?And this is just the class which replaces $variables$ with values from my database.
Here is a way to simply make the templated (converted) html output from streamfield from within your CityPage model.Overview:Use Python's built in basic Template system (or Python 3 docs), it is easy and will save you the hassle of dealing directly with the substitution.Python's built in Template system uses  not  but works well and can be configured if really needed.Avoid trying to build up the blocks within your streamfield manually, best to just to something like  which will force it to render into nice HTML.Remember you can customise the html for any streamblock using  see docs.Once we have our HTML output from the streamfield, we can use the  class to create our output text by providing a dict of the template names and what to replace them with. Template variable names should not have the  symbol in them ( not ), the library takes care of that for you, it also takes care of basic string conversion.For the sake of simplicity, I used a helpful  util from Django to make the  into a dict to pass directly to the template (think of this as your context for Django templates).Note: This means that your  would not work, it would need to match the fieldname eg.  - or just change the fieldnames. It makes it easier for reading the code later if all the variables/fieldnames match anyway.Before we can use this output in our final  template, we will need to mark it as safe for Django to render directly. Important: please be really careful about this as it means someone could save javascript code to the CityObject an it would run in the frontend, you may want another layer after  to clear any potential js code.Example: myapp/models.pyExample: myapp/template/city_page.html


Answer URL
https://docs.python.org/3/library/string.html#template-strings
