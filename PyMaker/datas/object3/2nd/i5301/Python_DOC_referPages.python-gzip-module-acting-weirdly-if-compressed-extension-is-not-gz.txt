Natural Text
I need to compress a file using the  module, but the output file extension may not be .Look at this simple code:It works fine. But if I replace  with  for example, then I am not able to open the compressed file correctly:I tried with 7-Zip and WinRar, the result is the same, and the bug persists even if I rename the file.Does anyone know where the problem comes from, please?I tried with compression  and , they seem to work properly no matter what the extension is.
You actually have two versions of file created this way:First,  file:Second,  file:Both create a GZIP with your  in it. The only difference is that in the second case,  is renamed to .The problem is that the argument to  actually has two purposes: the filename of the gzip archive and the filename of the file inside (bad design, imho).So, if you do  and write to it, it will create gzip archive named  with a file named  inside.But then, there comes magic: if the filename endswith , then it behaves differently, e.g.  creates a gzip archive named  with a file named  inside.So, with  you activated the (undocumented, as far as I can see!) magic, whereas with  you did not.
The filename inside the archive can be controlled by utilising  constructor instead of the  method. The  needs then a separate  call before it.Note also the added  - according to my experience without this line the  may in some cases randomly not flush the data before the file is closed, resulting in corrupt archive.Or as a complete example:


Answer URL
https://docs.python.org/3/library/gzip.html
https://docs.python.org/3/library/lzma.html
https://docs.python.org/3/library/gzip.html#gzip.GzipFile
