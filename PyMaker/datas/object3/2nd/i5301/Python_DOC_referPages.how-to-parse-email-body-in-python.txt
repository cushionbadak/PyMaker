Natural Text
I want to retrieve body (only text) of emails using python imap and email package.As per this SO thread, I'm using the following code:Though it's working fine for some instances, but sometime I get similar to following response
You are assuming that messages have a uniform structure, with one well-defined "main part". That is not the case; there can be messages with a single part which is not a text part (just an "attachment" of a binary file, and nothing else) or it can be a multipart with multiple textual parts (or, again, none at all) and even if there is only one, it need not be the first part. Furthermore, there are nested multiparts (one or more parts is another MIME message, recursively).In so many words, you must inspect the MIME structure, then decide which part(s) are relevant for your application. If you only receive messages from a fairly static, small set of clients, you may be able to cut some corners (at least until the next upgrade of Microsoft Plague hits) but in general, there simply isn't a hierarchy of any kind, just a collection of (not necessarily always directly related) equally important parts.
The main problem in my case is that replied or forwarded message shown as message instance in the bodytext.Solved my problem using the following code:
Maybe this post (of mine) can be of help. I receive a Newsletter with prices of different kind of oil in the US. I fetch email in gmail with a given pattern for the title, then I extract the prices in the mail body using regex. So i have to access the mail body for the last n emails which title observe given pattern.I am using  also:  so maybe it gives you concrete example of how to use methods in this python lib.
Basically you have to iterate over the different text/plain (or text/html) parts of the message to get to the body - there is absolutely no guarantee on which position is the body part! (though there is the convention for it to be one of the first... in most cases... probably... :)As I don't want to duplicate content, please see  my answer to quite similar question here, and adjust according to your needs.


Answer URL
https://docs.python.org/3/library/email.message.html#email.message.EmailMessage.get_body
