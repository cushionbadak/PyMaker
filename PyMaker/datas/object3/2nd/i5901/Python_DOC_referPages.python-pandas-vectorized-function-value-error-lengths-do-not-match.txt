Natural Text
I have a pandas dataframe:And I have written the following to apply date range columns:However this is very slow, so I have been trying to vectorize it:However this produces a value error: "Lengths must match to compare".  I am new to trying to write vectorized functions from scratch, so I would appreciate any insight into where I am going awry.EDIT:Here is the full error message:EDIT:I ended up finding an edge condition with the original solution when there are collisions on the first/last days of a 30 day window.  I have made some changes to get closer to a robust solution now:However, this is still not working correctly because it only sets 'window_start_dt' to the lowest/first value in the date range: '2004-01-01'.  Good news is it should be faster yet again.EDIT:I added an answer with the solution to the date collision issue below based on jezrael's answerEDITTurns out there was still one more edge case.  Please see jezrael's answer here for the final solution:Numpy: conditional np.where replace
I believe you can use :
I actually found a particularly clever fix for the date collision issue which is just a small change from @jezrael's fantastic answer:It occurred to me that start_date_range and end_date_range have the exact same number of elements and that, in this specific case, you can just reuse the index created from end_date_range and apply it via np.take to start_date_range to get the correct intervals every time:   It is also even faster now!
I'll sidestep the error you are getting for mismatching lengths.This still uses  so it may not be what you want, but maybe simplifying it will help:Make a column of pandas.Period's with a month frequency.Each Period has a  and  attribute which is easy to useIf you really need a start and end column;


Answer URL
https://docs.python.org/3/tutorial/errors.html#handling-exceptions
