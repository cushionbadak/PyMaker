Natural Text
I have the following script that sends a keyboard key every xx seconds (F15 by default), inspired by some code found onlineI want to remove the types and union related to Mouse events but cannot make it to work. In particular, I don't know how to remove the class  and the union of types  (removing them will stop sending the keyboard key).Any suggestion on how to trim the script to a minimum (i.e. only keep code related to Keyboard)?The following code will send the key "C" to be able to debug.
The "Bible" for tasks like this: [Python 3]: ctypes - A foreign function library for Python. I modified your code (found a bunch of problems, out of which some were critical).code.py:Notes:Initially, I defined the INPUT structure having only its 1st 2 members, but took a look at [MS.Docs]: INPUT structure and noted that the union consists of:MOUSEINPUTKEYBDINPUTHARDWAREINPUTDid some tests and noted that MOUSEINPUT has the largest size out of the 3 structs, and it's 8 bytes greater than KEYBDINPUT (for both 32 bit and 64 bit), so I added the (dummy) (padding) member. Normally, I wouldn't expect that SendInput to go beyond KEYBDINPUT size when receiving an INPUT structure with type set to INPUT_KEYBOARD, but the INPUT size is required by [MS.Docs]: SendInput function's cbSize arg - in Python, * before an argument does something totally different than in C. Check [SO]: Expanding tuples into arguments (I didn't find the official doc). I modified the function so that it only sends one such structureAlways define argtypes (and restype) for a function being invoked via ctypes. Otherwise they will default to  (and that could lead to some nasty errors, especially on 64 bit: [SO]: Python ctypes cdll.LoadLibrary, instantiate an object, execute its method, private variable address truncated (@CristiFati's answer))Use  for Win specific types, don't reinvent the wheel. Not to mention that sometimes mismatches might occur (most recent one that I saw, was  vs. )I renamed your functions to be [Python]: PEP 8 -- Style Guide for Python Code compliant. I also removed some of them, that were no longer neededOther small changes that don't worth being mentioned individuallyAs for testing, I used a Notepad window (or any other, "sensitive" to user input):Launch the scriptAlt + Tab to the test window (I added the 1st instruction () from main just to give user time to switch windows), and notice the cs "magically" appearing... Or just launch the script from console, press Ctrl, and notice that it got cancelled.


Answer URL
https://docs.python.org/3/library/ctypes.html#module-ctypes
