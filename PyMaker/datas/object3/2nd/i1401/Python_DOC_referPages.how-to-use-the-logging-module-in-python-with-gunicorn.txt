Natural Text
I have a flask-based app. When I run it locally, I run it from the command line, but when I deploy it, I start it with gunicorn with multiple workers.I want to use the  module to log to a file. The docs I've found for this are https://docs.python.org/3/library/logging.html and https://docs.python.org/3/howto/logging-cookbook.html .I am confused over the correct way to use logging when my app may be launched with gunicorn. The docs address threading but assume I have control of the master process. Points of confusion:Will  return the same logger object in different gunicorn worker threads?If I am attaching a logging  to my logger in order to log to a file, how can I avoid doing this multiple times in the different workers?My understanding - which may be wrong - is that if I just call , this will send messages via the root logger which may have a higher default logging level and may ignore debug messages, and so I also need to call  in order for my debug messages to get through. But the docs say not to call  from a thread. How can I  correctly set the root logging level when using gunicorn? Or do I not need to?
This is my typical Flask/Gunicorn setup. Note gunicorn is ran via supervisor.wsgi_web.py. Note  to get a client's real IP address from Nginx.Flask application factory  Gunicorn command (4th line) within supervisor conf, note the  parameter has been set to  in this instance. Note  passed to access 
Each worker is an isolated process with its own memory so you can't really share the same logger across different workers.Your code runs inside these workers because the master process only cares about managing the workers.The master process is a simple loop that listens for various process  signals and reacts accordingly. It manages the list of running workers  by listening for signals like TTIN, TTOU, and CHLD. TTIN and TTOU tell  the master to increase or decrease the number of running workers.In Gunicorn itself, there are two main run modesSyncAsyncSo this is different from threading, this is multiprocessing.However since Gunicorn 19, a threads option can be used to process requests in  multiple threads. Using threads assumes use of the gthread worker.With this in mind, the logging code will be written once and will be invoked multiple times each time a new worker is created. You can use Singelton pattern to ensure the same logger instance is being used inside the same worker. For configuring the logger itself, you just need to follow the normal process of setting the root logger levels and the different loggers levels.basicConfig() won't affect the root handler if it's already setup:This function does nothing if the root logger already has handlers configured for it.To set the level on root explicitly do Then the level can be set on the handler or logger level.You can check this similar answer for logging related detailsSet logging levelsMore Resources : http://docs.gunicorn.org/en/stable/design.html


Answer URL
https://docs.python.org/3/library/logging.html
https://docs.python.org/3/howto/logging-cookbook.html
