<div class="post-text" itemprop="text">
<p>I'm using the following code to write xml string literals to an xml file.</p>
<pre><code>from lxml import etree
parser = etree.XMLParser(remove_blank_text=True)
tree = etree.parse("test.xml", parser)
root = tree.getroot()
phrase = '''
    &lt;d:entry xmlns:d="http://www.apple.com/DTDs/DictionaryService-1.0.rng" id="test" d:title="test"&gt;
    &lt;d:index d:value="test" d:title="test"/&gt;&lt;d:index d:value="test2" d:title="test2"/&gt;
    &lt;div class="ODECN"&gt;&lt;div class="extras"&gt;&lt;div class="phrase"&gt;&lt;span class="word_title"&gt;&lt;i&gt;test&lt;/i&gt;&lt;/span&gt;: &lt;p&gt;test &lt;a&gt;&lt;/a&gt;test&lt;/p&gt; &lt;/div&gt;&lt;p class="ref"&gt;See main entry:&lt;a href="x-dictionary:d:test"&gt;test&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;
    &lt;/d:entry&gt;'''
b = etree.fromstring(phrase)
root.insert(0, b)
tree.write("newtest.xml", xml_declaration=True, encoding='utf-8', pretty_print=False)
</code></pre>
<p>I'd like the xml string literals to be output to the file as is, i.e. in 4 lines, as follows:</p>
<pre><code>&lt;d:entry xmlns:d="http://www.apple.com/DTDs/DictionaryService-1.0.rng" id="{}" d:title="{}"&gt;
    &lt;d:index d:value="{}" d:title="{}"/&gt;&lt;d:index d:value="{}" d:title="{}"/&gt;
    &lt;div class="ODECN"&gt;&lt;div class="extras"&gt;&lt;div class="phrase"&gt;&lt;span class="word_title"&gt;&lt;i&gt;{}&lt;/i&gt;&lt;/span&gt;: {}{}&lt;/div&gt;&lt;p class="ref"&gt;See main entry:&lt;a href="x-dictionary:d:{}"&gt;{}&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/d:entry&gt;
</code></pre>
<p>But the resulting xml file shows somehow the parser formats the string literal to be more of a hierarchy, or structure, which is not needed, and it's much more lines than I expected as you can see in the picture below.</p>
<p><a href="https://i.stack.imgur.com/kQr68.png" rel="nofollow noreferrer"><img alt="enter image description here" src="https://i.stack.imgur.com/kQr68.png"/></a></p>
<p>The <code>&lt;d:entry</code> is in the wrong position too, it should start as a line start.</p>
<p>I have tried adding this parser to <code>etree</code>:</p>
<pre><code>etree.XMLParser(remove_blank_text=True)
</code></pre>
<p>But this does not help at all. I don't know if there's another setting that I don't know to make it work. Anyone familiar with this?</p>
<p>Any input is much appreciated.</p>
<p>Here's the content of the test.xml file:</p>
<pre><code>&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;d:dictionary xmlns:d="http://www.apple.com/DTDs/DictionaryService-1.0.rng"&gt;
&lt;d:entry id="test0" d:title="test0"&gt;
&lt;d:index d:value="test0" d:title="test0"/&gt;&lt;d:index d:value="test00" d:title="test00"/&gt;
&lt;div class="ODECN"&gt;&lt;div class="extras"&gt;&lt;div class="phrase"&gt;&lt;span class="word_title"&gt;&lt;i&gt;test&lt;/i&gt;&lt;/span&gt;: &lt;p&gt;test &lt;a&gt;&lt;/a&gt;test&lt;/p&gt; &lt;/div&gt;&lt;p class="ref"&gt;See main entry:&lt;a href="x-dictionary:d:test"&gt;test&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/d:entry&gt;
&lt;/d:dictionary&gt;
</code></pre>
<p>I'm using Python 3.7 and lxml.</p>
</div>
<div class="post-text" itemprop="text">
<p>The value of <code>phrase</code> is a single, multi-line, triple-quoted <a href="https://docs.python.org/3/tutorial/introduction.html#strings" rel="nofollow noreferrer">string</a>.  As it is a single string, the whitespace at the beginning of each line and the newlines at the end of each line are part of the string, and this is what is causing the formatting issues that you see.</p>
<p>The simplest solution is to take advantage of the fact that Python will concatenate successive strings automatically.  Wrap the value of <code>phrase</code> in brackets and triple-quote each line.</p>
<pre><code>phrase = ("""&lt;d:entry xmlns:d="http://www.apple.com/DTDs/DictionaryService-1.0.rng" id="test" d:title="test"&gt;
          """&lt;d:index d:value="test" d:title="test"/&gt;&lt;d:index d:value="test2" d:title="test2"/&gt;"""
          """&lt;div class="ODECN"&gt;&lt;div class="extras"&gt;&lt;div class="phrase"&gt;&lt;span class="word_title"&gt;&lt;i&gt;test&lt;/i&gt;&lt;/span&gt;:
          """&lt;/d:entry&gt;""")
</code></pre>
<p>This will eliminate the leading whitespace and newlines from the generated xml file.</p>
</div>
<span class="comment-copy">please provide a standalone code snippet. This does not work.</span>
<span class="comment-copy">Can't reproduce your issue, the output is equal to <code>phrase</code>.</span>
<span class="comment-copy">sorry, my mistake. I have just updated the content of the test.xml file.</span>
<span class="comment-copy">This is great. I've just tried this method and after I add additionally a <code>\n</code> after each line, it worked perfect now. Thanks so much.</span>
