<div class="post-text" itemprop="text">
<p>How can I create a word (.docx) document if not found using python and write in it?</p>
<p>I certainly cannot do either of the following:</p>
<pre><code>file = open(file_name, 'r')
file = open(file_name, 'w')
</code></pre>
<p>or, to create or append if found: </p>
<pre><code>f = open(file_name, 'a+')
</code></pre>
<p>Also I cannot find any related info in python-docx documentation at:</p>
<p><a href="https://python-docx.readthedocs.io/en/latest/" rel="nofollow noreferrer">https://python-docx.readthedocs.io/en/latest/</a></p>
<p><strong>NOTE:</strong></p>
<p>I need to create an automated report via python with text and pie charts, graphs etc.</p>
</div>
<div class="post-text" itemprop="text">
<p>Probably the safest way to open (and truncate) a new file for writing is using <a href="https://docs.python.org/3/library/functions.html#open" rel="nofollow noreferrer"><code>'xb'</code></a> mode. <code>'x'</code> will raise a <a href="https://docs.python.org/3/library/exceptions.html#FileExistsError" rel="nofollow noreferrer"><code>FileExistsError</code></a> if the file is already there. <code>'b'</code> is necessary because a word document is fundamentally a binary file: it's a zip archive with XML and other files inside it. You can't compress and decompress a zip file if you convert bytes through character encoding.</p>
<p><a href="https://python-docx.readthedocs.io/en/latest/api/document.html#docx.document.Document.save" rel="nofollow noreferrer"><code>Document.save</code></a> accepts streams, so you can pass in a file object opened like that to save your document.</p>
<p>Your work-flow could be something like this:</p>
<pre><code>doc = docx.Document(...)
...
# Make your document
...
with open('outfile.docx', 'xb') as f:
    doc.save(f)
</code></pre>
<p>It's a good idea to use <code>with</code> blocks instead of raw <code>open</code> to ensure the file gets closed properly even in case of an error.</p>
<p>In the same way that you can't simply write to a Word file directly, you can't append to it either. The way to "append" is to open the file, load the <a href="https://python-docx.readthedocs.io/en/latest/api/document.html#docx.document.Document" rel="nofollow noreferrer"><code>Document</code></a> object, and then write it back, overwriting the original content. Since the word file is a zip archive, it's very likely that appended text won't even be at the end of the XML file it's in, much less the whole docx file:</p>
<pre><code>doc = docx.Document('file_to_append.docx')
...
# Modify the contents of doc
...
doc.save('file_to_append.docx')
</code></pre>
<p>Keep in mind that the python-docx library may not support loading some elements, which may end up being permanently discarded when you save the file this way.</p>
</div>
<div class="post-text" itemprop="text">
<p><strong>Looks like I found an answer:</strong></p>
<blockquote>
<p>The important point here was to create a new file, if not found, or
  otherwise edit the already present file.</p>
</blockquote>
<pre><code>import os
from docx import Document 

#checking if file already present and creating it if not present
if not os.path.isfile(r"file_path"):

    #Creating a  blank document
    document = Document()

    #saving the blank document
    document.save('file_name.docx')

#------------editing the file_name.docx now------------------------

#opening the existing document
document = Document('file_name.docx')

#editing it
document.add_heading("hello world" , 0)

#saving document in the end
document.save('file_name.docx')
</code></pre>
<p><strong>Further edits/suggestions are welcome.</strong></p>
</div>
<span class="comment-copy">You can open a file in <code>'x'</code> mode: <a href="https://stackoverflow.com/q/29295654/2988730">stackoverflow.com/q/29295654/2988730</a></span>
<span class="comment-copy">why can't you do <code>f = open(file_name, 'a+')</code> can  you please explain</span>
<span class="comment-copy">@YugandharChaudhari 'a+' is for simple files, .docx file is a binary file which has something like 'rb' intead of 'r' for normal files. I may be wrong, what do you say?</span>
<span class="comment-copy">@Yugandhar. Because a word docx file is a binary zip archive containing, among other things, a bunch of XML files inside it.</span>
<span class="comment-copy">@MadPhysicist 'x' cannot open/create a word file I guess.</span>
<span class="comment-copy">This is not immune from race conditions.</span>
<span class="comment-copy">@MadPhysicist can you suggest an edit, for exactly where does it goes wrong?</span>
<span class="comment-copy">The edit is I'm my answer. The race condition is between checking <code>isfile</code> and opening said file.</span>
