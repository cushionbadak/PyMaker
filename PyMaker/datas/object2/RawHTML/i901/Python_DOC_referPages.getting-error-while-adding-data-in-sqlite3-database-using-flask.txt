<div class="post-text" itemprop="text">
<p>I am trying to add data in the existing database but getting error output, There is a minor mistake please help me.Thanks </p>
<p>Code ::</p>
<pre><code>@app.route('/')
def new_student():
    return render_template('student.html')

@app.route('/addrec', methods=['POST', 'GET'])

def addrec():
    if request.method == 'POST':
        try:
            nm = request.form['nm']
            addr = request.form['add']
            city = request.form['city']
            pin = request.form['pin']

            with sql.connect("database.db") as con:
                cur = con.cursor()
                cur.execute('''INSERT INTO students (name,addr,city,pin)
                    VALUES(?, ?, ?, ?)''',(nm,addr,city,pin))

                con.commit()
                msg = "Record successfully added"
        except:

            con.rollback()
            msg = "error in insert operation"

        finally:
            return render_template("result.html", msg=msg)
            con.close()

if __name__ == '__main__':
    app.run(debug=True)
</code></pre>
<p>My result.html file is :</p>
<pre><code>&lt;!doctype html&gt;
&lt;html&gt;
   &lt;body&gt;
      result of addition : {{ msg }}
      &lt;h2&gt;&lt;a href = "\"&gt;go back to home page&lt;/a&gt;&lt;/h2&gt;
   &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>The output should be:: "Record successfully added" but I am getting an "error in the insert operation".</p>
</div>
<div class="post-text" itemprop="text">
<p>My guess is that you have a typo in your code:</p>
<pre><code>addr = request.form['add']
</code></pre>
<p>should be</p>
<pre><code>addr = request.form['addr']
</code></pre>
<p>But your code needs some fixes regarding the connection: </p>
<p><code>con.commit()</code> is called on normal exit of the <code>with</code> block, and <code>con.rollback()</code> is called if the <code>with</code> block is exited because of an exception (see the <a href="https://docs.python.org/3/library/sqlite3.html#using-the-connection-as-a-context-manager" rel="nofollow noreferrer">docs</a>). You don't need those two explicit calls.</p>
<p>Furthermore, you placed the <code>con.close()</code> after the <code>return</code> statement, which means it will never be executed. Just swap the lines, or consider opening the connection at the start of the program.</p>
</div>
<div class="post-text" itemprop="text">
<p>After the <code>except:</code>, put a <code>raise</code> to re-raise the last exception and post here the traceback.</p>
<p>Possible problems are:</p>
<ul>
<li>You don't have permission on database.db file</li>
<li>You didn't send one of the form keys and accessing <code>request.form["some key"]</code> is raising KeyError exception.</li>
</ul>
</div>
<span class="comment-copy">Can you remove the try/except and show us the traceback you get when you try again?</span>
<span class="comment-copy">Thanks Buddy ,there was minor error i have corrected as you have suggested ,</span>
