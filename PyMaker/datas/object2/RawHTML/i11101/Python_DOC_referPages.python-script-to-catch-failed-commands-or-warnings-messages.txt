<div class="post-text" itemprop="text">
<p>I have a little script that telnets into a network switch and executes commands.  It works fine but I need it stop and show an error message if any of the commands fail or network give a waning or something.  </p>
<p>Here is the code:</p>
<pre><code>import sys
import telnetlib


HOST = "10.10.10.1"
user = "Test"
password = "TestPW"

tn = telnetlib.Telnet(HOST)

tn.read_until("username: ")
tn.write(user + "\n")
tn.read_until("password: ")
tn.write(password + "\n")

n, match, previous_text = tn.expect([r'Login incorrect', r'\$'], 1)
if n == 0:
    print "Invalid Credentials"
    tn.close()
else:
    tn.write("Term len 0\n")
    #Reads data from commands.txt file and executes it line by line
    with open("commands.txt") as commands:
        singlecommand = commands.read()
        tn.write(singlecommand)
        print singlecommand
    #Need exception/error checking to catch fail commands or warnings.
    tn.write("exit\n")
    tn.write("y\n")
    print tn.read_all()
    tn.close()
</code></pre>
<p>I want the script to stop executing more commands after a fail command or a warning from CLI that something maybe wrong.  It already has the print function so it should display the error message and command that failed.</p>
<p>Here is a example of a failed command:</p>
<blockquote>
<p>% Invalid input detected at '^' marker.</p>
</blockquote>
<p>Here is an example warning message:</p>
<blockquote>
<p>%Warning:</p>
</blockquote>
</div>
<div class="post-text" itemprop="text">
<p>You can use <a href="https://docs.python.org/3/tutorial/errors.html#handling-exceptions" rel="nofollow">Try/Except</a> statements.</p>
<p>They're related to the <a href="https://docs.python.org/3/tutorial/errors.html" rel="nofollow">Errors and Exceptions</a> part of the Python docs.</p>
<p><strong>Example:</strong></p>
<pre><code>try:
    wrong_sum = "a" + 2
except ValueError:
    print "You got a Value Error"
else:
    break
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>you can extract the message based on key word appeared in failed command, then raise the exception.<br/>
for example:</p>
<pre><code>try:
     if '%Warning' == message[:8]:
          raise Exception('Test')
except Exception:
     print message
</code></pre>
</div>
