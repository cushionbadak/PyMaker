<div class="post-text" itemprop="text">
<p>I'm following following the <a href="https://docs.python.org/2/library/xml.etree.elementtree.html" rel="nofollow noreferrer">official documentation</a> about how could i modify an existing xml file in order to add a subchild value inside the record child.</p>
<p><strong>Original xml file:</strong></p>
<pre><code>&lt;Values version="2.0"&gt;
  &lt;value name="system_type"&gt;osx&lt;/value&gt;
  &lt;record name="service"&gt;
    &lt;value name="threads"&gt;1&lt;/value&gt;
  &lt;/record&gt;
&lt;/Values&gt;
</code></pre>
<p><strong>Current code:</strong></p>
<pre><code>from xml.etree import ElementTree as ET

tree = ET.parse('data.xml')


values = tree.getroot()
list_languages = values.getchildren()

processing = ET.Element('value')
processing.attrib['name'] = 'cpu_use_limit'
processing.text = '20'

values.append(processing)

tree.write('output.xml')
</code></pre>
<p><strong>Current output:</strong></p>
<pre><code>&lt;Values version="2.0"&gt;
      &lt;value name="system_type"&gt;osx&lt;/value&gt;
      &lt;record  name="service"&gt;
        &lt;value name="threads"&gt;1&lt;/value&gt;
      &lt;/record&gt;
      &lt;value name="cpu_use_limit"&gt;20&lt;/value&gt;
&lt;/Values&gt;
</code></pre>
<p><strong>desired  xml file:</strong></p>
<pre><code>&lt;Values version="2.0"&gt;
      &lt;value name="system_type"&gt;osx&lt;/value&gt;
      &lt;record  name="service"&gt;
        &lt;value name="threads"&gt;1&lt;/value&gt;
        &lt;value name="cpu_use_limit"&gt;20&lt;/value&gt;
      &lt;/record&gt;  
&lt;/Values&gt;
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>I want to start with one remark: the input <em>XML</em> seems wrong (semantically), because you have a root node <em>Values</em>, which has children <em>value</em> <strong>and</strong> <em>record</em> (which doesn't seem to belong here).</p>
<p>But, considering that the <em>XML</em> is correct, then you don't want to add the newly created node directly under <em>Values</em> node, but under <em>record</em> (which is a child of <em>Values</em>). To find out that node, <a href="https://docs.python.org/3/library/xml.etree.elementtree.html#xml.etree.ElementTree.Element.findall" rel="nofollow noreferrer">[Python 3]: <strong>findall</strong>(<em>match, namespaces=None</em>)</a> is used.</p>
<p><em>code.py</em>:</p>
<pre><code>from xml.etree import ElementTree as ET


if __name__ == "__main__":
    tree = ET.parse("data.xml")

    values = tree.getroot()
    list_languages = values.getchildren()

    processing = ET.Element("value")
    processing.attrib["name"] = "cpu_use_limit"
    processing.text = "20"

    relevant_nodes = values.findall("record")
    for relevant_node in relevant_nodes:
        relevant_node.append(processing)

    tree.write("output.xml", encoding="utf-8", xml_declaration=True)
</code></pre>
<p>After running the code,</p>
<p><em>output.xml</em>:</p>
<pre><code>&lt;?xml version='1.0' encoding='utf-8'?&gt;
&lt;Values version="2.0"&gt;
  &lt;value name="system_type"&gt;osx&lt;/value&gt;
  &lt;record name="service"&gt;
    &lt;value name="threads"&gt;1&lt;/value&gt;
  &lt;value name="cpu_use_limit"&gt;20&lt;/value&gt;&lt;/record&gt;
&lt;/Values&gt;
</code></pre>
</div>
<span class="comment-copy">Nope, your last edit is wrong. There is no trace of "threads" in the input <i>xml</i> or the code, so there's no way that it's present in the output.</span>
<span class="comment-copy">I just edited, to correct this.</span>
<span class="comment-copy">QUick question, i forgot to mention that the original file contains &lt;?xml version="1.0" encoding="UTF-8"?&gt; , but on the output this line isn't present. How could i generate a new file with that information?</span>
<span class="comment-copy">Edited the answer (<code>tree.write</code> part).</span>
