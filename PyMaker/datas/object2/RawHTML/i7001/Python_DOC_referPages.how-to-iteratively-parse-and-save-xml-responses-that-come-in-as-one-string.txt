<div class="post-text" itemprop="text">
<p>I am making API calls, that is retrieving IDs, each call represents 10000 IDs and I can only retrieve 10000 at a time. <strong>My goal is to save each XML call into a list to count how many people are in the platform automatically.</strong> </p>
<p>The problem I running into is two fold. </p>
<ol>
<li><p>Each call comes as response object, the response object when I append to a list appends as a single string, so I can not count total number of IDs</p></li>
<li><p>To get the next 10000 list of IDs I have to use another API call to get information about each ID, and retrieve a piece of information called website ID and use that to call the next 10000 from the API in #1</p></li>
</ol>
<p>I also want to prevent any duplicate IDs in the list but I feel like this is the easiest task. </p>
<p>Here is my code:</p>
<h1>1</h1>
<ul>
<li>Call profile IDs (each call brings back 10000)</li>
<li><p>Append response object 'r' into list 'lst'</p>
<p>import requests
    import xml.etree.ElementTree as et
    import pandas as pd
    from lxml import etree
    import time</p>
<pre><code>lst = []



xml = '''
&lt;?xml version="1.0" encoding="utf-8" ?&gt;
&lt;YourMembership&gt;
    &lt;Version&gt;2.25&lt;/Version&gt;
    &lt;ApiKey&gt;*****&lt;/ApiKey&gt;
    &lt;CallID&gt;009&lt;/CallID&gt;
    &lt;SaPasscode&gt;*****&lt;/SaPasscode&gt;
    &lt;Call Method="Sa.People.All.GetIDs"&gt;
        &lt;Timestamp&gt;&lt;/Timestamp&gt;
        &lt;WebsiteID&gt;&lt;/WebsiteID&gt;
        &lt;Groups&gt;
            &lt;Code&gt;&lt;/Code&gt;
            &lt;Name&gt;&lt;/Name&gt;
        &lt;/Groups&gt;
    &lt;/Call&gt;
&lt;/YourMembership&gt;
'''
headers = {'Content-Type': 'application/x-www-form-urlencoded'}
r = requests.post('https://api.yourmembership.com', data=xml, headers=headers)
lst.append(r.text)
</code></pre></li>
</ul>
<p>API Call result</p>
<pre><code>&lt;YourMembership_Response&gt;
&lt;Sa.People.All.GetIDs&gt;
&lt;People&gt;
&lt;ID&gt;1234567&lt;/ID&gt;
&lt;/People&gt;
&lt;/Sa.People.All.GetIDs&gt;
&lt;/YourMembership_Response&gt;
</code></pre>
<h1>2</h1>
<ul>
<li><p>I take the last ID  from API call in #1 and manually input the value
into the API call below in the 'ID' tags.</p>
<pre><code>xml_2 = '''
&lt;?xml version="1.0" encoding="utf-8" ?&gt;

&lt;YourMembership&gt;
    &lt;Version&gt;2.25&lt;/Version&gt;
    &lt;ApiKey&gt;****&lt;/ApiKey&gt;
    &lt;CallID&gt;001&lt;/CallID&gt;
    &lt;SaPasscode&gt;****&lt;/SaPasscode&gt;
    &lt;Call Method="Sa.People.Profile.Get"&gt;
        &lt;ID&gt;1234567&lt;/ID&gt;
    &lt;/Call&gt;
&lt;/YourMembership&gt;
'''
headers = {'Content-Type': 'application/x-www-form-urlencoded'}
r_2 = requests.post('https://api.yourmembership.com', data=xml_2, headers=headers)
print (r_2.text)
</code></pre></li>
</ul>
<p>API call result:</p>
<pre><code>&lt;YourMembership_Response&gt;
&lt;ErrCode&gt;0&lt;/ErrCode&gt;
&lt;ExtendedErrorInfo&gt;&lt;/ExtendedErrorInfo&gt;
&lt;Sa.People.Profile.Get&gt;
&lt;ID&gt;1234567&lt;/ID&gt;
&lt;WebsiteID&gt;7654321&lt;/WebsiteID&gt;
&lt;/YourMembership_Response&gt;
</code></pre>
<p>I take the website ID and rerun this in API Call from #1 (example) with website ID tag filled, get the next 10000 until no more results come back:</p>
<pre><code>xml = '''
        &lt;?xml version="1.0" encoding="utf-8" ?&gt;
        &lt;YourMembership&gt;
            &lt;Version&gt;2.25&lt;/Version&gt;
            &lt;ApiKey&gt;*****&lt;/ApiKey&gt;
            &lt;CallID&gt;009&lt;/CallID&gt;
            &lt;SaPasscode&gt;*****&lt;/SaPasscode&gt;
            &lt;Call Method="Sa.People.All.GetIDs"&gt;
                &lt;Timestamp&gt;&lt;/Timestamp&gt;
                &lt;WebsiteID&gt;7654321&lt;/WebsiteID&gt;
                &lt;Groups&gt;
                    &lt;Code&gt;&lt;/Code&gt;
                    &lt;Name&gt;&lt;/Name&gt;
                &lt;/Groups&gt;
            &lt;/Call&gt;
        &lt;/YourMembership&gt;
        '''
        headers = {'Content-Type': 'application/x-www-form-urlencoded'}
        r = requests.post('https://api.yourmembership.com', data=xml, headers=headers)
        lst.append(r.text)
</code></pre>
<p>Hope my question makes sense, and thank you in advance. </p>
</div>
<div class="post-text" itemprop="text">
<p>I once started building something to crawl over an API which sounds similar to what you are aiming to achieve. One difference in my case though was the response came as json instead of xml but shouldn't be a big deal.</p>
<p>Can't see in your question evidence that you are really using the power of the xml parser. Have a look at the <a href="https://docs.python.org/3/library/xml.etree.elementtree.html" rel="nofollow noreferrer">docs</a>. For example you can easily get the id number out of those items you are appending to the list like this:</p>
<pre><code>xml_sample = """
&lt;YourMembership_Response&gt;
&lt;Sa.People.All.GetIDs&gt;
&lt;People&gt;
&lt;ID&gt;1234567&lt;/ID&gt;
&lt;/People&gt;
&lt;/Sa.People.All.GetIDs&gt;
&lt;/YourMembership_Response&gt;
"""

import xml.etree.ElementTree as ET
root = ET.fromstring(xml_sample)
print (root[0][0][0].text)
&gt;&gt;&gt; '1234567'
</code></pre>
<p>Experiment, apply it in a loop to each element in the list or maybe you will be lucky and the whole response object will parse without needing to look through things. </p>
<p>You should now be able to programmatically instead of manually enter that number in the next bit of code. </p>
<p>Your XML for the next section for the website ID seems to have an invalid line in it <code>&lt;Sa.People.Profile.Get&gt;</code> Once I take it out it can be parsed:</p>
<pre><code>xml_sample2 = """
&lt;YourMembership_Response&gt;
&lt;ErrCode&gt;0&lt;/ErrCode&gt;
&lt;ExtendedErrorInfo&gt;&lt;/ExtendedErrorInfo&gt;

&lt;ID&gt;1234567&lt;/ID&gt;
&lt;WebsiteID&gt;7654321&lt;/WebsiteID&gt;
&lt;/YourMembership_Response&gt;
"""
root2 = ET.fromstring(xml_sample2)
print (root2[3].text)
&gt;&gt;&gt; '7654321'
</code></pre>
<p>So not sure if there is always an invalid line there or if you forgot to paste something, maybe remove that line with regex or something before applying xtree. </p>
<p>Would recommend you try <a href="https://docs.python.org/3.6/library/sqlite3.html" rel="nofollow noreferrer">sqlite</a> to help you with the interactions between <strong>1</strong> and <strong>2</strong>. I think it's good up to half a million rows otherwise you would need to hook to a proper database. It saves a file in your directory and has a bit less setup time and fuss as with a proper database. Perhaps, test the concept with sqlite and if necessary migrate to postgresql.</p>
<p>You can store whichever useful elements from this parsed xml you like user ID, website ID into a table and pull it out again to use in a different section. Is also not hard to go back and forth from sqlite to pandas dataframes if you need it with <a href="http://pandas.pydata.org/pandas-docs/stable/generated/pandas.read_sql.html" rel="nofollow noreferrer">pandas.read_sql</a> and <a href="http://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.to_sql.html" rel="nofollow noreferrer">pandas.DataFrame.to_sql</a> Hope this helps.. </p>
</div>
<span class="comment-copy">Thank you very much for the response.   I got this part to work (root[0][0][0].text). I have been playing around with the 000 part, but having hard time understanding how they interact with xml tree?</span>
<span class="comment-copy">Look at <a href="https://docs.python.org/3/library/xml.etree.elementtree.html#parsing-xml" rel="nofollow noreferrer">this example</a> if you run <code>root = ET.fromstring()</code> on it then <code>root[0].attrib</code> gives you a dictionary <code>{'name': 'Liechtenstein'}</code>  , <code>root[1].attrib</code> , <code>{'name': 'Singapore'}</code> getting stuff out of dictionaries is fundamental Python.  <code>root[0][2].text</code> gives <code>'141100'</code> and <code>root[0][3].attrib</code>, <code>{'direction': 'E', 'name': 'Austria'}</code> shouldn't be too hard to practice it a bit till you get the hang of it.</span>
