<div class="post-text" itemprop="text">
<p>I'm obtaining inconsistent behaviour with the output of datetime.strftime().</p>
<p>I'm using macOS Sierra 10.12.6 and Python 3.6.2. I have a Python program, named <code>wut.py</code>, that is </p>
<pre><code>#!/usr/bin/python
from datetime import datetime
import locale
if __name__ == "__main__":
    print(locale.getlocale())
    print(datetime.today().strftime('%c'))
</code></pre>
<p>In a terminal, I write</p>
<pre><code>$ date
Gio 24 Ago 2017 18:54:01 CEST
</code></pre>
<p>which is the Italian way of writing dates. Then</p>
<pre><code>$ python3 ~/Desktop/wut.py 
('it_IT', 'UTF-8')
Thu Aug 24 18:54:03 2017
</code></pre>
<p>where the date and time are written in another locale. How is this happening? Is this a bug or is there any reason for this behaviour?</p>
<p>I'm puzzled because the Python docs mention that <code>%c</code> refers to "Localeâ€™s appropriate date and time representation.", so I thought that the system's locale is the "appropriate" one ;) (see <a href="https://docs.python.org/3/library/datetime.html" rel="nofollow noreferrer">https://docs.python.org/3/library/datetime.html</a>, sec 8.1.8)</p>
</div>
<div class="post-text" itemprop="text">
<p>Digging into the <code>locale</code> module a bit, I find this under the description of <code>getdefaultlocale()</code>:</p>
<blockquote>
<p>According to POSIX, a program which has not called
          setlocale(LC_ALL, "") runs using the portable 'C' locale.
          Calling setlocale(LC_ALL, "") lets it use the default locale as
          defined by the LANG variable. Since we don't want to interfere
          with the current locale setting we thus emulate the behavior
          in the way described above.</p>
</blockquote>
<p>From this, I gather it is good practice to call</p>
<pre><code>locale.setlocale(locale.LC_ALL, '')
</code></pre>
<p>to set your locale to the one you expect to inherit from the caller's evironment. Do that, and you should get the expected output from <code>strftime</code>.</p>
<hr/>
<p>That said, I noticed a difference in behavior between Python 2.7 and Python 3.6 on my macOS 10.12 installation. On startup, <code>locale.getdefaultlocale()</code> and <code>locale.getlocale()</code> both return <code>('en_US', 'UTF-8')</code> in Python 3. In Python 2, though, <code>getlocale()</code> returns <code>(None, None)</code> until I call <code>setlocale</code>. In either case, the call to <code>setlocale</code> is still required for <code>strftime</code> to actually use the set locale, rather than the default <code>C</code> locale. I do not know if this represents a bug, or if so, which one is the buggy instance.</p>
</div>
<div class="post-text" itemprop="text">
<p>There are a number of different locale categories that are all configured independently, and <code>locale.getlocale()</code> only gets you the settting of the <code>LC_CTYPE</code> category. Time formatting is controlled by the <code>LC_TIME</code> category, which you can check with <code>locale.getlocale(locale.LC_TIME)</code>.</p>
<p>You can use <code>locale.setlocale(locale.LC_ALL, '')</code> to set the settings for all locale categories to the user's default settings (typically specified in the <code>LANG</code> environment variable). <code>setlocale</code> isn't threadsafe, so this usually goes near the start of a program.</p>
</div>
<div class="post-text" itemprop="text">
<p>python result is correct, strftime('%c') return same result format.</p>
</div>
<span class="comment-copy">I know this doesn't answer the question but you say you are using python3 but your shebang calls out python 2... should be #!/usr/bin/python3</span>
<span class="comment-copy">Can you see what the <a href="http://man7.org/linux/man-pages/man3/strftime.3.html" rel="nofollow noreferrer">C <code>strftime</code></a> gives you? I think Python ultimately delegates to the C <code>strftime</code> to handle this.</span>
<span class="comment-copy">@AllenMoh thanks, you're right, I've fixed it. Anyway, it should change nothing in the above example</span>
<span class="comment-copy">If you "explicitly" set the locale to use your system locale with <code>locale.setlocale(locale.LC_ALL, '')</code>, you will get the expected Italian output. I don't know why this appears to be necessary.</span>
<span class="comment-copy">@user2357112 How can I see what the C function gives me? <code>man strftime</code>  just says that <code>%c    is replaced by national representation of time and date.</code> and that <code>the strftime() function uses the current locale</code></span>
<span class="comment-copy">thanks for the answer, I was puzzled by the behaviour of locale.getlocale() in python3, that returns a non-empty value even if you haven't set any locale yet.</span>
