<div class="post-text" itemprop="text">
<p>I have a script that uses some arguments and some <code>stdin</code> data.</p>
<p>For checking arguments I use argparse.ArgumentParser</p>
<p>Is it possible to check if any stdin data is given? Something like that:</p>
<pre><code>parser.add_argument('infile', nargs='?', type=argparse.FileType('r'), default=sys.stdin, required=True)
</code></pre>
<p>but this example gives this error:</p>
<blockquote>
<p>TypeError: 'required' is an invalid argument for positionals</p>
</blockquote>
</div>
<div class="post-text" itemprop="text">
<p>No. It wont't read from whatever file you pass it, be it given on the command line, or stdin. You will get an open file handle, with not even a single byte/char consumed.</p>
<p>Simply read the data yourself, for instance with <code>data = args.infile.read()</code> (assuming <code>args</code> is the result of parsing`).</p>
<p>You can then test if it is empty, with a simple <code>if not data:</code>...</p>
<p>But usually, if you expect data in a specific format, the best is to simply try to parse it, and raise an error if you fail. Either empty data is invalid (json for instance), or it is valid but then it should be an acceptable input.</p>
<p>(as for the error, <code>required</code> only tells whether some option must be given on the command line or not, for <code>--options</code> and <code>-o</code> options. Positionals are always required unless you change their numbers with <code>nargs</code>).</p>
</div>
<div class="post-text" itemprop="text">
<p>The error is just because of the <code>required=True</code> parameter; and the message tells you what is wrong.  It should be:</p>
<pre><code>parser.add_argument('infile', nargs='?', type=argparse.FileType('r'), default=sys.stdin)
</code></pre>
<p>By 'calling' this <code>infile</code>, as opposed to '--infile', you've created a positional argument.  <code>argparse</code> itself determines whether it is required or not. With <code>nargs='?'</code> it can't be required.  It's by definition optional (but not an <code>optionals</code> argument :) ).</p>
<p>The <code>FileType</code> type lets you name a file (or '-') in the commandline.  It will open it (stdin is already open) and assign it to the <code>args.infile</code> attribute.  It does nothing more.</p>
<p>So after parsing, using <code>args.infile</code> gives you access to this open file, which you can read as needed (and optionally close if not stdin).</p>
<p>So this is a convenient way of letting your users specify which file should be opened for use in your code.  It was intended for simple scripts that read one file, do something, and write to another.</p>
<p>But if all you are looking at is <code>stdin</code>, there isn't any point in using this type.  <code>sys.stdin</code> is always available for reading.  And there isn't any way of making the parser read <code>stdin</code>.  It parses <code>sys.argv</code> which comes from the commandline.</p>
<p>There is an <code>@</code> prefix file feature that tells the parser to read commandline strings from a file.  It parses the file and splices the values into <code>sys.argv</code>.  See the <code>argparse</code> docs.</p>
</div>
<div class="post-text" itemprop="text">
<p>From the docs <a href="https://docs.python.org/3/library/argparse.html#the-add-argument-method" rel="nofollow noreferrer">The add_argument() method</a></p>
<blockquote>
<p>required - Whether or not the command-line option may be omitted (optionals only).</p>
</blockquote>
<p>The <code>required</code> keyword is only used for options (e.g., <code>-f</code> or <code>--foo</code>) not for positional arguments. Just take it out.</p>
<pre><code>parser.add_argument('infile', nargs='?', type=argparse.FileType('r'),
    default=sys.stdin)
</code></pre>
<p>When parsed <code>infile</code> will either be a string or the <code>sys.stdin</code> file object. You would need to read that file to see if there is anything in it. Reading can be risky... you may block forever. But that just means that the user didn't follow instructions.</p>
</div>
