<div class="post-text" itemprop="text">
<p>I am porting some code from python 2 to python 3. In my code, I define a data type for strings as:</p>
<pre><code>MAX_WORD_LENGTH = 32
DT_WORD = np.dtype([('word', str('U') + str(MAX_WORD_LENGTH))])
</code></pre>
<p>Which shows up as:  </p>
<pre><code>&gt;&gt; DT_WORD.descr
[('word', '&lt;U32')]
</code></pre>
<p>Now, when I create a basic numpy array, I get no errors:</p>
<pre><code>&gt;&gt; import numpy as np
&gt;&gt; np.array(['a', 'b', 'c', 'd'])
array(['a', 'b', 'c', 'd'],
    dtype='&lt;U1')
</code></pre>
<p>But when I introduce my data type,</p>
<pre><code>&gt;&gt; np.array(['a','b','c','d'], dtype=DT_WORD)
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in &lt;module&gt;
TypeError: a bytes-like object is required, not 'str'
</code></pre>
<p>What does this error mean? All strings in python 3 are Unicode by default, so by explicitly stating the data type as Unicode I shouldn't get an error. How do I define my data type so it accepts unicode strings in both python 2 and 3?</p>
</div>
<div class="post-text" itemprop="text">
<p>I was able to eventually figure it out:</p>
<p>When using labelled <code>dtypes</code> the array is actually a <em>structured</em> array. Structured arrays arrays are created from a list of tuples (and not simply a list of values). So:</p>
<pre><code>np.array(['a','b','c','d'], dtype=DT_WORD)
</code></pre>
<p>Should be:</p>
<pre><code>np.array([('a',), ('b',), ('c',), ('d',)], dtype=DT_WORD)
</code></pre>
<p>More concisely, if <code>X</code> is a list of strings, you can use:</p>
<pre><code>np.array(list(zip(X)), dtype=DT_WORD)
</code></pre>
<p>Which is compatible with python 2 and 3.</p>
<p>Also, the same code will give a <code>TypeError</code> in python 2 as well:</p>
<pre><code>np.array(['a','b','c','d'], dtype=DT_WORD)
# Will give:
TypeError: expected a readable buffer 
</code></pre>
<p>So my question was partly incorrect in the first place. It had less to do with python version than with the distinction between arrays and structured arrays.</p>
</div>
<span class="comment-copy">Looks like <code>bytes like object</code> is the Py3 equivalent of a <code>readable buffer</code>.  I don't know why they don't give a better error message.  Trying to fill a structured array without the tuples must be a common enough error.</span>
<span class="comment-copy"><code>np.array([b'ab', b'b', b'c'],dtype=[('word','U3')])</code> works; but the b'ab' is rendered as a chinese character.  <a href="https://docs.python.org/3/glossary.html#term-bytes-like-object" rel="nofollow noreferrer">docs.python.org/3/glossary.html#term-bytes-like-object</a>.  But why does a tuple work?</span>
<span class="comment-copy"><a href="http://stackoverflow.com/questions/33532609/trying-to-create-a-labeled-numpy-array" title="trying to create a labeled numpy array">stackoverflow.com/questions/33532609/â€¦</a> - I gave a similar answer here; but didn't dig further.</span>
