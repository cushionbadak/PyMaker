<div class="post-text" itemprop="text">
<p>I´m trying to filter a queryset by the dates.</p>
<p>First I group the data by dates and have no problem.</p>
<pre><code>inventario_original = Inventario.objects.all()
inventario = inventario_original.values("fecha").annotate(
    valor_coste=Sum(F('existencias') * F('valor_coste')),
    valor_venta=Sum(F('existencias') * F('valor_venta')),
    existencias=Sum('existencias'))
</code></pre>
<p>Then i find the last date in the queryset.</p>
<pre><code>ultima_fecha_cargada = inventario_original.order_by('-fecha')
ultima_fecha_cargada = ultima_fecha_cargada.first().values('fecha')
</code></pre>
<p>If I print <code>ultima_fecha_cargada.fecha</code> I get <code>['15-03-2019']</code></p>
<p>Finaly I want to filter the queryset with items with that last date.</p>
<pre><code>inventario_producto = inventario_original.filter(fecha__date=ultima_fecha_cargada.fecha).values("codigo_kinemed").annotate(existencias=Sum('existencias'))
</code></pre>
<p>I get the full queryset with no filter applied. If I print the resulting dates I get <code>['15-03-2019']</code>so the date format matches.</p>
<p>Also tried </p>
<pre><code>filter(fecha=ultima_fecha_cargada.fecha)
filter(fecha=ultima_fecha_cargada)
filter(fecha=date(day=15, month=3, year=2019))
filter(fecha__contains=ultima_fecha_cargada.fecha)
filter(fecha__contains=date(day=15, month=3, year=2019)
</code></pre>
<p><strong>The full view code here</strong></p>
<pre><code>def InventarioView(request):
    inventario_original = Inventario.objects.all()
    ultima_fecha_cargada = inventario_original.order_by('-fecha')
    ultima_fecha_cargada = ultima_fecha_cargada.first().values('fecha')

    inventario = inventario_original.values("fecha").annotate(
        valor_coste=Sum(F('existencias') * F('valor_coste')),
        valor_venta=Sum(F('existencias') * F('valor_venta')),
        existencias=Sum('existencias'))

    inventario_producto = inventario_original.filter(fecha__date=ultima_fecha_cargada).values("codigo_kinemed").annotate(
        existencias=Sum('existencias'))

    return render(request, 'catalog/inventario.html', {
        'ultima_fecha_cargada': ultima_fecha_cargada,
        'inventario_producto': inventario_producto,
        'inventario': inventario,
    })
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>As @Endre Both remarked, my code was not right. This was the correct code (without the values).</p>
<pre><code>ultima_fecha_cargada = ultima_fecha_cargada.first() 
</code></pre>
<p>And then this to filter by date.</p>
<pre><code>inventario_producto = inventario_original.filter(fecha=ultima_fecha_cargada.fecha)
</code></pre>
<p>Now it works. The strange thing is that before I was able to see the results of using <code>ultima_fecha_cargada.first().values("fecha")</code>, got the expected value, printed it out correctly and had no error messages. </p>
<p>Now after a pc restart I started getting the error messages and the code seems to behave as Endre Both stated. </p>
</div>
<span class="comment-copy">The code you say you have run has several syntax errors; please post the code that you have actually run.</span>
<span class="comment-copy">@EndreBoth just added it to the question</span>
<span class="comment-copy">This code cannot run, it is syntactically wrong: <code>ultima_fecha_cargada = ultima_fecha_cargada.first().values('fecha')</code>. Didn't get a syntax error when running the view?</span>
<span class="comment-copy">@EndreBoth Not only I didn´t get an error, it works and I can print <code>ultima_fecha_cargada.fecha</code> in the template and get the correct date.</span>
<span class="comment-copy">1) <code>QuerySet.first()</code> returns a single object that doesn't have a <code>values('index')</code> method. 2) <code>Queryset.values()</code> returns a QuerySet of dictionaries whose entries you cannot access with the dot operator. So I'm afraid we cannot even begin to help when you seem to work in a different language :).</span>
