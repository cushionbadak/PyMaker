<div class="post-text" itemprop="text">
<p>Hi I have a tar file containing files named <code>0_data</code>, <code>0_index</code> etc. What I am trying to do is open the tar file and read through the contents of these files. What I could do till now is extract all the files. What I could not do is read the contents of the individual files. I know that they are not plain text files, but if I cannot see the contents of the files, how can I parse the files which are a bunch of webpages? </p>
<p>The error I get when I try to open a file is: </p>
<pre><code>return codecs.charmap_decode(input,self.errors,decoding_table)[0]
UnicodeDecodeError: 'charmap' codec can't decode byte 0x81 in position 87: character maps to &lt;undefined&gt;
</code></pre>
<p>Here's my code:</p>
<pre><code>import os
import tarfile

def is_tarfile(file):
return tarfile.is_tarfile(file)

def extract_tarfile(file):
    if is_tarfile(file):
        my_tarfile=tarfile.open(file)
        my_tarfile.extractall("c:/untar")
        read_files_nz2("c:/untar/nz2_merged");
        return 1
    return 0

def read_files_nz2(file):
    for subdir, dirs, files in os.walk(file):
        for i in files:
             path = os.path.join(subdir,i)
             print(path)
             content=open(path,'r')
             print (content.read())

extract_tarfile("c:/nz2.tar")
</code></pre>
<p><code>print(i)</code> will output the name of the file, but <code>print(content.read())</code> will give an error:</p>
<pre><code>return codecs.charmap_decode(input,self.errors,decoding_table)[0]
UnicodeDecodeError: 'charmap' codec can't decode byte 0x81 in position 87: character maps to &lt;undefined&gt;
</code></pre>
<p>I hope somebody can help me with reading data from the files</p>
</div>
<div class="post-text" itemprop="text">
<p>You need to do one of two things:</p>
<ul>
<li><p>specify an encoding when you open the file:</p>
<pre><code># This is probably not the right encoding.
content = open(path, 'r', encoding='utf-8')
</code></pre>
<p>For that, you need to know what the encoding of the file is.</p></li>
<li><p>open the file in <em>binary</em> mode:</p>
<pre><code>content = open(path, 'rb')
</code></pre>
<p>This will cause read to return a <a href="https://docs.python.org/3/library/stdtypes.html#typebytes" rel="nofollow">bytes</a> object instead of a string, but it will avoid any attempt to decode or validate the individual bytes.</p></li>
</ul>
</div>
<div class="post-text" itemprop="text">
<p>I'm not 100% sure this is your problem, but it is at least bad practice and a possible source of your problem.</p>
<p>You are not closing any files that you open. For example you have:</p>
<pre><code>my_tarfile=tarfile.open(file)
</code></pre>
<p>But somewhere after that and before you open another file you should have:</p>
<pre><code>my_tarfile.close()
</code></pre>
<p>Here's a quote from <a href="http://www.diveintopython.net/file_handling/file_objects.html" rel="nofollow">diveintopython</a>:</p>
<blockquote>
<p>Open files consume system resources, and depending on the file mode, other programs may not be able to access them. It's important to close files as soon as you're finished with them.</p>
</blockquote>
<p>My thinking is that because you never close my_tarfile the system can't properly read the files extracted from. Even if it isn't the problem, it is good practice to close you files as soon as you can.</p>
</div>
<div class="post-text" itemprop="text">
<p>You need a full file path to access it, not just a name.
Your second function should look like:</p>
<pre><code>def read_files_nz2(file):
for subdir, dirs, files in os.walk(file):
    for i in files:
        path = os.path.join(subdir, f) # Getting full path to the file
        content=open(path,'r')
        print (content.read())
</code></pre>
</div>
<span class="comment-copy">Maybe see the documentation [<a href="https://docs.python.org/2/library/codecs.html]" rel="nofollow noreferrer">docs.python.org/2/library/codecs.html]</a></span>
<span class="comment-copy">Thanks @Marichyasana I will go through the documentation but I am fairly new to python and this unicode stuff</span>
<span class="comment-copy">Thanks @rici I will try your solution</span>
<span class="comment-copy">finally read bytes</span>
<span class="comment-copy">I am now closing the file. In my case not closing the is not the problem. I updated the question and the error is   return codecs.charmap_decode(input,self.errors,decoding_table)[0] UnicodeDecodeError: 'charmap' codec can't decode byte 0x81 in position 87: character maps to &lt;undefined&gt;</span>
<span class="comment-copy">hi I updated the question. I added the path now the error is  return codecs.charmap_decode(input,self.errors,decoding_table)[0] UnicodeDecodeError: 'charmap' codec can't decode byte 0x81 in position 87: character maps to &lt;undefined&gt;</span>
