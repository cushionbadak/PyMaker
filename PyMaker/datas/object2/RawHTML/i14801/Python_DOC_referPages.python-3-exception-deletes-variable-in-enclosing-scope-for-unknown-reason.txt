<div class="post-text" itemprop="text">
<p>I have the following code:</p>
<pre><code>def foo():
    e = None
    try:
        raise Exception('I wish you would except me for who I am.')
    except Exception as e:
        print(e)
    print(e)

foo()
</code></pre>
<p>In Python 2.7, this runs as expected and prints:</p>
<pre><code>I wish you would except me for who I am.
I wish you would except me for who I am.
</code></pre>
<p>However in Python 3.x, the first line is printed, but the second line is not. It seems to delete the variable in the enclosing scope, giving me the following traceback from the last print statement:</p>
<pre><code>Traceback (most recent call last):
  File "python", line 9, in &lt;module&gt;
  File "python", line 7, in foo
UnboundLocalError: local variable 'e' referenced before assignment
</code></pre>
<p>It is almost as if a <code>del e</code> statement is inserted after the <code>except</code> block. Is there any reasoning for this sort of behavior? I could understand it if  the Python developers wanted except blocks to have their own local scope, and not leak into the surrounding scope, but why must it delete a variable in the outer scope that was previously assigned?</p>
</div>
<div class="post-text" itemprop="text">
<p>Quoting the <a href="https://docs.python.org/3/reference/compound_stmts.html#the-try-statement">documentation of <code>try</code></a>,</p>
<blockquote>
<p>When an exception has been assigned using <code>as target</code>, it is cleared at the end of the except clause. This is as if</p>
<pre><code>except E as N:
   foo
</code></pre>
<p>was translated to</p>
<pre><code>except E as N:
    try:
        foo
    finally:
        del N
</code></pre>
<p>This means the exception must be assigned to a different name to be able to refer to it after the except clause. <strong>Exceptions are cleared because with the traceback attached to them, they form a reference cycle with the stack frame, keeping all locals in that frame alive until the next garbage collection occurs</strong>.</p>
</blockquote>
<p>This is covered in these two PEPs.</p>
<ol>
<li><p><a href="https://www.python.org/dev/peps/pep-3110/">PEP 3110 - Catching Exceptions in Python 3000</a></p></li>
<li><p><a href="https://www.python.org/dev/peps/pep-0344/">PEP 344  - Exception Chaining and Embedded Tracebacks</a></p></li>
</ol>
</div>
<span class="comment-copy">Carrying the link from the deleted answer by @Barry: <a href="https://www.wefearchange.org/2013/04/python-3-language-gotcha-and-short.html" rel="nofollow noreferrer">wefearchange.org/2013/04/â€¦</a></span>
