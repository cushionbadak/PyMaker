<div class="post-text" itemprop="text">
<p>I'm trying to send an HTTP GET message to a server through a TCP connection, but it seems that I'm doing something wrong.</p>
<pre><code>s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((server, port))

message = 'GET /' + direction + ' HTTP/1.1'    

s.send(message.encode('utf-8'))

while True:
    webpage = s.recv(1024)

    print(webpage)

    if not webpage:
        break

    with open('step3.txt', 'wb') as file:
        file.write(webpage.decode('utf-8').content)
</code></pre>
<p>The important thing here is the composition of variable <code>message</code>, because the problem is that server does not recognize the HTTP request message apparently.</p>
<p>Thanks</p>
</div>
<div class="post-text" itemprop="text">
<p>It is possible that the server is refusing your HTTP request because your request body isn't valid. Take a look at this valid request:</p>
<pre><code>GET / HTTP/1.1
Host: www.test.com
User-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1)
(empty line)
</code></pre>
<p>First thing: <strong>your request must end with an empty line (<code>\r\n</code>)</strong>. In your context, that means <code>message = 'GET /' + direction + ' HTTP/1.1\n'</code>.</p>
<p>Then, there are some missing headers:</p>
<ul>
<li>The <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Host" rel="nofollow noreferrer"><code>Host</code> header</a> is <strong>required</strong> in valid HTTP requests.</li>
<li>The <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/User-Agent" rel="nofollow noreferrer"><code>User-Agent</code> header</a> is optional but most servers require it.</li>
</ul>
<p>Take a shot using something like this, replacing <code>www.test.com</code> by the actual hostname you want to communicate with:</p>
<pre><code>message = ''
message += 'GET /' + direction + ' HTTP/1.1\r\n'
message += 'Host: www.test.com\r\n'
message += 'User-Agent: my agent\r\n'
message += '\r\n'
</code></pre>
<p>Finally, unless you are required to write use <code>socket</code>, I recommend using either <a href="http://docs.python-requests.org/en/master/" rel="nofollow noreferrer"><code>requests</code></a> or <a href="https://docs.python.org/3/library/urllib.html" rel="nofollow noreferrer"><code>urllib</code></a>. These packages encapsulate the hard-work behind dealing with TCP/UDP sockets by hand.</p>
</div>
<span class="comment-copy">Can you not user higher level libraries such as <code>http.client</code> or <code>requests</code>?</span>
<span class="comment-copy">The thing is that this exercise is for not using those libraries haha</span>
<span class="comment-copy">Eh, why work harder and not smarter? Their underlying code uses <code>socket</code>.</span>
<span class="comment-copy">I know, but it is not my election :). Teachers' stuff...</span>
<span class="comment-copy">@t.m.adam You're right. I just updated my answer. Thanks!</span>
<span class="comment-copy">Thank you so much @matheus-portela. That was the correct option to make an HTTP request!!</span>
