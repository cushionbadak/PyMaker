<div class="post-text" itemprop="text">
<p>The <code>importlib.import_module</code> with relative module name can fail sometime.</p>
<p>For example, I have a package structure like this:</p>
<pre><code>├── test0
│   ├── __init__.py
│   ├── test1.py
│   └── test2.py
├── test_impl.py
</code></pre>
<p>Test code like this:</p>
<pre><code>import importlib
import sys
print(sys.version_info)
def test_imp_module(module_name, pkgname):
    try:
        _m = importlib.import_module(module_name, pkgname)
        print("import OK: module={}, pkg={}".format(module_name, pkgname))
    except Exception as e:
        print(e)

test_imp_module(".test1", "test0")
test_imp_module("test0.test1", "")
if __name__ == '__main__':
    test_imp_module(".test1", "test0")
    test_imp_module("test0.test1", "")
</code></pre>
<p>In Python3.5 it will fail the first test:</p>
<pre><code>$ python3 test_impl.py 
sys.version_info(major=3, minor=5, micro=2, releaselevel='final', serial=0)
Parent module 'test0' not loaded, cannot perform relative import
import OK: module=test0.test1, pkg=
import OK: module=.test1, pkg=test0
import OK: module=test0.test1, pkg=
</code></pre>
<p>In python3.6 it works:</p>
<pre><code>$ python3 test_impl.py 
sys.version_info(major=3, minor=6, micro=4, releaselevel='final', serial=0)
import OK: module=.test1, pkg=test0
import OK: module=test0.test1, pkg=
import OK: module=.test1, pkg=test0
import OK: module=test0.test1, pkg=
</code></pre>
<p>Is this expected or a bug?
Update:
    Python2.7.12 has the same behavior as 3.6.</p>
</div>
<div class="post-text" itemprop="text">
<p>The <a href="https://docs.python.org/3/library/importlib.html#importlib.import_module" rel="nofollow noreferrer">docs</a> say:</p>
<blockquote>
<p><code>importlib.import_module(name, package=None)</code></p>
<p>...</p>
<p><em>Changed in version 3.3:</em> Parent packages are automatically imported.</p>
</blockquote>
<p>Therefore, the 3.6.4 behaviour is correct and the 3.5.2 behaviour is buggy. 
 You seem to be hitting <a href="https://bugs.python.org/issue30876" rel="nofollow noreferrer">#30876</a>, and the issue says that was fixed in the version 5 micro i.e. v3.5.5.</p>
<p><sub>Credit to <em>vaultah</em> in room 6 for <a href="https://chat.stackoverflow.com/transcript/message/42082683#42082683">finding the ticket</a>.</sub></p>
</div>
<span class="comment-copy">why 3.5 is expected? I thought the 1st and 3rd test should both fail or success. But 3.5 only success with 3rd one, which is very strange actually. If they both fail, then the relative module name never work, which is still unexpected.</span>
<span class="comment-copy">Are you using <a href="https://docs.python.org/3/library/importlib.html#importlib.util.LazyLoader" rel="nofollow noreferrer">LazyLoader</a> at all?  Do <code>python3 -v test_impl.py |&amp; grep LazyLoader</code>.</span>
<span class="comment-copy">Hmm, now I'm not so sure, after seeing <a href="https://bugs.python.org/issue19963" rel="nofollow noreferrer">bugs.python.org/issue19963</a></span>
<span class="comment-copy">@wim I think when &lt;3.2, 1st and 3rd should always fail due to haven't load parent packages. But &gt;3.4 they no longer require this thus should be always success. In either case the py3.5 behaved strangely.</span>
