<div class="post-text" itemprop="text">
<p>I am attempting to perform a custom action when I see a very specific warning. The warning is a <code>UserWarning</code> with the message <code>'Skipping SYSTEM_VARIABLE record'</code>. I want all other warnings, including all other <code>UserWarning</code>s with different messages, to be propagated and printed to <code>stderr</code> as usual.</p>
<p>The only way I could find to do this is to replace <a href="https://docs.python.org/3/library/warnings.html#warnings.showwarning" rel="nofollow noreferrer"><code>warnings.showwarning</code></a> with a custom implementation, as in the following test script:</p>
<pre><code>import warnings

def showw(message, category, filename, lineno, file=None, line=None):
    print(message, category, filename, lineno, file, line, sep='|')
    print(message == 'Skipping SYSTEM_VARIABLE record')
    print(category == UserWarning)
    if category == UserWarning and message == 'Skipping SYSTEM_VARIABLE record':
        print('Doing a thing here')
    else:
        original(message, category, filename, lineno, file=file, line=line)

original = warnings.showwarning
warnings.showwarning = showw

warnings.warn('Skipping SYSTEM_VARIABLE record')
</code></pre>
<p>This script prints out the following output:</p>
<pre><code>Skipping SYSTEM_VARIABLE record|&lt;class 'UserWarning'&gt;|x.py|15|None|None
False
True
x.py:15: UserWarning: Skipping SYSTEM_VARIABLE record
  warnings.warn('Skipping SYSTEM_VARIABLE record')
</code></pre>
<p>I find this output surprising because the first line indicates that the message is in fact <code>'Skipping SYSTEM_VARIABLE record'</code>, so the second line should read <code>True</code>, and the <code>if</code> rather than the <code>else</code> should be executed. However, it seems that the two strings are not identical for some reason.</p>
<p>Why is this happening? Why is the "custom action" <code>print('Doing a thing here')</code> not being triggered? </p>
<p>I have tried replacing all three occurrences of <code>'Skipping SYSTEM_VARIABLE record'</code> with just <code>'a'</code> in the script to eliminate the possibility of a typo. The exact same result happens.</p>
<p>I am using Python 3.5.2 on Anaconda 2.4.0 on a CentOS 7 server, so str vs. unicode should not be a problem.</p>
</div>
<div class="post-text" itemprop="text">
<p>Figured out the answer on a hunch a couple of minutes after posting:</p>
<p>The reason that the comparison fails is that <code>message</code> is not a string, but the actual warning object, whose string representation (via <code>str</code>) happens to just be the warning message.</p>
<p>An additional printout, <code>print(type(message))</code> demonstrates this fact:</p>
<pre><code>&lt;class 'UserWarning'&gt;
</code></pre>
<p>The correct comparison is <code>str(message) == 'Skipping SYSTEM_VARIABLE record'</code>.</p>
<p>The only reason that I am keeping this question and answer around is that there does not appear to be anything in the documentation of <a href="https://docs.python.org/3/library/warnings.html#warnings.showwarning" rel="nofollow noreferrer"><code>warnings.showwarning</code></a> to explicitly describe this behavior.</p>
</div>
