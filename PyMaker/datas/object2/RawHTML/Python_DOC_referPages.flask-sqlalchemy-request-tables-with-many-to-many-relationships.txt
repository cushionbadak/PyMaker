<div class="post-text" itemprop="text">
<p>I used Flask and SQLAlchemy to create an application based on a database. Here is the classes that I have defined:</p>
<p><em>models.py</em></p>
<pre><code> class HasTag(db.Model):
    tagged_document_id = db.Column(db.Integer, db.ForeignKey('Document.id'), primary_key=True)
    document_tag_id = db.Column(db.Integer, db.ForeignKey('Tag.id'), primary_key=True)

class Document(db.Model):
    id = db.Column(db.Integer, unique=True, nullable=False, primary_key=True, autoincrement=True)
    title = db.Column(db.Text)
    tag = db.relationship("Tag",
                    secondary=HasTag,
                    back_populates="tagged_document",
                    lazy="dynamic")

class Tag(db.Model):
    id = db.Column(db.Integer, unique=True, nullable=False, primary_key=True, autoincrement=True)
    label = db.Column(db.String, nullable=False)
    tagged_document = db.relationship("Document",
                    secondary=HasTag,
                    back_populates="tag",
                    lazy="dynamic")
</code></pre>
<p>In the application, I have an advanced search form where it is possible to do a full text search through the different fields of the Document table.</p>
<p><em>routes.py</em></p>
<pre><code>@app.route("/search")
def search():
    keyword = request.args.get("keyword", None)   
    query = Document.query

    if keyword:
        query = Document.query.filter(or_(
            Document.title.like("%{}%".format(keyword)),
            ...
        ))
</code></pre>
<p>The thing is, I'd like to be able to search the keyword given by the user also in the label of the tag. I tried something like:</p>
<pre><code>    if keyword:
        query = Document.query.join(Tag).filter(or_(
            Document.title.like("%{}%".format(keyword)),
            ...,
            Tag.label.like("%{}%".format(keyword))
        ))
</code></pre>
<p>But I get this error: <code>AttributeError: 'HasTag' object has no attribute 'foreign_keys'</code></p>
<p>Can you help me? Thanks!</p>
</div>
<div class="post-text" itemprop="text">
<p>I have a similar structure in one of my projects, and this is how I define <code>relatioship</code>:</p>
<pre><code>leagues = db.relationship("League", 
                          secondary=LeagueTeamAssociation.__tablename__,
                          back_populates="teams")
</code></pre>
<p>So, You need to provide table name to <code>secondary</code> parameter, either using above syntax (You'll need to add <code>__tablename__</code> to your <code>HasTag</code> class) or using string "has_tag" (provided that this is the name of the table in the database).</p>
</div>
<span class="comment-copy"><a href="https://stackoverflow.com/questions/19205290/flask-sqlalchemy-model-has-no-attribute-foreign-keys" title="flask sqlalchemy model has no attribute foreign keys">stackoverflow.com/questions/19205290/…</a> might help</span>
<span class="comment-copy">check the accepted answer here <a href="https://stackoverflow.com/questions/6044309/sqlalchemy-how-to-join-several-tables-by-one-query" title="sqlalchemy how to join several tables by one query">stackoverflow.com/questions/6044309/…</a></span>
