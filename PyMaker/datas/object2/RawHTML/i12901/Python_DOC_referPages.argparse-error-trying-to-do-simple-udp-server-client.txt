<div class="post-text" itemprop="text">
<p>I've been trying this code and getting this message from the console:</p>
<pre><code>usage: Experimental.py [-h] [-p PORT] {client,server}
Experimental.py: error: the following arguments are required: role
</code></pre>
<p>I can't decide what's wrong, this is the code:</p>
<pre><code>    import argparse, socket
    from datetime import datetime
    MAX_BYTES = 65535
    def server(port):
        sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
        sock.bind(('127.0.0.1', port))
        print('Listening at {}'.format(sock.getsockname()))
        while True:
            data, address = sock.recvfrom(MAX_BYTES)
            text = data.decode('ascii')
            print('The client at {} says {!r}'.format(address, text))
            text = 'Your data was {} bytes long'.format(len(data))
            data = text.encode('ascii')
            sock.sendto(data, address)
    def client(port):
        sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
        text = 'The time is {}'.format(datetime.now())
        data = text.encode('ascii')
        sock.sendto(data, ('127.0.0.1', port))
        print('The OS assigned me the address{}'.format(sock.getsockname()))
        data, address = sock.recvfrom(MAX_BYTES) # Danger!
        text = data.decode('ascii')
        print('The server {} replied {!r}'.format(address, text))


if __name__ == '__main__':
    choices = {'client': client, 'server': server}
    parser = argparse.ArgumentParser(description='Send and receive UDP locally')
    parser.add_argument('role', choices=choices, help='which role to play')
    parser.add_argument('-p', metavar='PORT', type=int, default=1060, help='UDP port (default 1060)')
    args = parser.parse_args()
    function = choices[args.role]
    function(args.p)
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>The program is using the <a href="https://docs.python.org/3/library/argparse.html" rel="nofollow">argparse module</a>'s <code>ArgumentParser</code> class, which <a href="https://docs.python.org/3/library/argparse.html#required" rel="nofollow">assumes by default that positional arguments are required</a>, so you can't omit them as you have. The argparse tutorial offers <a href="https://docs.python.org/3/howto/argparse.html#concepts" rel="nofollow">a good definition of a positional argument</a>: </p>
<blockquote>
<p>[A positional argument is] named so because the program should know what to do with the value, <strong>solely based on where it appears on the command line</strong>. This concept is more relevant to a command like cp, whose most basic usage is cp SRC DEST. The first position is what you want copied, and the second position is where you want it copied to.</p>
</blockquote>
<p>In this case, when calling <code>Experimental.py</code>, you've left out the positional argument named <code>role</code>, which is defined near the end of your program:</p>
<pre><code>parser.add_argument('role', choices=choices, help='which role to play')
</code></pre>
<p>(Because the first argument (<code>'role'</code>) doesn't start with a <code>-</code> (like <code>-p</code>), <a href="https://docs.python.org/3/library/argparse.html#name-or-flags" rel="nofollow"><code>add_argument</code> registers it as a positional argument</a>.)</p>
<p><a href="https://docs.python.org/3/library/argparse.html#choices" rel="nofollow">The <code>choices</code> keyword argument to <code>add_argument</code> requires an iterable containing the possible values to supply</a>, so the author of the program passes <code>choices</code>, a dictionary defined as:</p>
<pre><code>choices = {'client': client, 'server': server}
</code></pre>
<p>This is actually pretty clever; iterating over a dictionary yields the keys, so argparse allows <code>client</code> and <code>server</code> as values for <code>role</code>. So, to fix this error, you should pass either <code>client</code> or <code>server</code> as an argument to the program, thereby supplying a value for <code>role</code>. Even better, you can check out the <a href="https://docs.python.org/3/howto/argparse.html" rel="nofollow">argparse tutorial</a>. (I hate telling people to read the manual, but I think it might be helpful)</p>
<p><strong>tl;dr:</strong> instead of:</p>
<pre><code>$ python3 Experimental.py
</code></pre>
<p>you should try one of the following:</p>
<pre><code>$ python3 Experimental.py server
$ python3 Experimental.py client
</code></pre>
</div>
<span class="comment-copy">This site is for questions about programming, not about how to run programs someone else wrote.</span>
<span class="comment-copy">The error message kind of tells you what's wrong: An argument called <code>role</code> is required, but you aren't specifying it when you run the program from the command line. You must specify either <code>client</code> or <code>server</code>, in this case. Like <code>&gt; python Experimental.py server</code>.</span>
