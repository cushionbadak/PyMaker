<div class="post-text" itemprop="text">
<p>I want to script updating code for my AWS Lambda using a Fabric task. Boto3 api expects a byte array of base-64 encoded zip file. </p>
<p>What would be the simplest way to create it assuming I have the source code files as the input?</p>
</div>
<div class="post-text" itemprop="text">
<p>With the current boto3, don't unzip it, don't base64 encode it.
You can do it with an open and a read like this:</p>
<pre><code>import boto3
c = boto3.client('lambda')
c.create_function({
    'FunctionName': 'your_function',
    'Handler': 'your_handler',
    'Runtime': 'python3.6',
    'Code': {'ZipFile': open('./deploy.zip', 'rb').read()}
})
</code></pre>
<p>I use the zip file above for getting started quickly. You can also upload the deploy.zip to a S3 bucket and pass the bucket + key as strings in the 'Code' dict as 'S3Bucket' and 'S3Key'.</p>
</div>
<div class="post-text" itemprop="text">
<p>Actually boto3 documentation is out of date, you should pass the bytes directly:</p>
<p><a href="https://github.com/boto/boto3/issues/201" rel="nofollow">https://github.com/boto/boto3/issues/201</a></p>
<p>As to the zip file this should point you in the right direction:</p>
<ul>
<li><a href="http://docs.aws.amazon.com/lambda/latest/dg/lambda-python-how-to-create-deployment-package.html" rel="nofollow">http://docs.aws.amazon.com/lambda/latest/dg/lambda-python-how-to-create-deployment-package.html</a></li>
<li><a href="http://www.devshed.com/c/a/Python/Python-UnZipped/" rel="nofollow">http://www.devshed.com/c/a/Python/Python-UnZipped/</a></li>
<li><a href="https://docs.python.org/3/library/functions.html#bytearray" rel="nofollow">https://docs.python.org/3/library/functions.html#bytearray</a></li>
</ul>
</div>
<span class="comment-copy">Yes, I've looked at them. They don't answer my question though. As I've mentioned I'd like to use boto create_function method that accepts a byte array of base-64 encoded zip file.</span>
<span class="comment-copy">actually IIUC  you can pass the bytes directly, did you tried that?<a href="https://github.com/boto/boto3/issues/201" rel="nofollow noreferrer">github.com/boto/boto3/issues/201</a></span>
<span class="comment-copy">Thats useful! So the remaining part is how to zip file and then get the bytes out of it in elegant way? Ideally I was thinking about doing it all in memory without intermediary files.</span>
<span class="comment-copy">I edited the answer so it could provide the pointers necessary for you and for future reference.</span>
<span class="comment-copy">There is code in kappa that does this.  Perhaps it would be useful.  Specifically, checkout: <a href="https://github.com/garnaat/kappa/blob/develop/kappa/function.py#L121" rel="nofollow noreferrer">github.com/garnaat/kappa/blob/develop/kappa/function.py#L121</a></span>
