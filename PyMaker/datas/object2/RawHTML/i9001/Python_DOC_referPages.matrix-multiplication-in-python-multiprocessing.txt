<div class="post-text" itemprop="text">
<p>I'm very beginner in Python. 
I have problem with matrix multiplication. 
I read matrix from txt file using list of lists (matrices). </p>
<p>When I want to use multiprocessing I have problem with divide list and use new lists in Pool function. </p>
<p>How can I fix this problem?</p>
<p>Please Help</p>
<pre><code>def matrix_multiplication(list1, list2):
    A = numpy.matrix(list1)
    B = numpy.matrix(list2)
    return A*B

def counting(dane):

     left_matrix = matrices[0]

     for matrix in matrices[1:]:
         left_matrix = numpy.matrix(left_matrix)
         matrix = numpy.matrix(matrix)
         left_matrix = matrix_multiplication(left_matrix, matrix)


if __name__ == "__main__":


    matrices = []
    with open('sample-probka2.txt', 'r') as file:
        matrix_reader = csv.reader(file, delimiter=';')
        current_matrix = []

        for row in matrix_reader:
            if len(row) == 0:
                matrices.append(current_matrix)
                current_matrix = []
            else:
                current_matrix.append(list(map(float, row)))

    print (matrices)

    counting(matrices)


    np = multiprocessing.cpu_count()
    print('You have', np, 'processors')


    matrices2 = numpy.array_split(matrices, np)
    print(matrices2)


    pool = Pool(processes=np)
    count = pool.starmap(liczenie, matrices2)
    print count
</code></pre>
<p>error from comment, with an attempt to restore formatting:</p>
<pre><code>multiprocessing.pool.RemoteTraceback:  
Traceback (most recent call last): 
File "/Library/Frameworks/Python.framework/Versions/3.6/lib/pytho‌​n3.6/multiprocessing‌​/pool.py", 
line 119, in worker result = (True, func(*args, **kwds)) 
File "/Library/Frameworks/Python.framework/Versions/3.6/lib/pytho‌​n3.6/multiprocessing‌​/pool.py", line 47, 
in starmapstar return list(itertools.starmap(args[0], args[1])) TypeError: counting() takes 1 positional argument but 61 were given
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>I don't think you want <code>pool.starmap</code> in this instance. what it is doing is unpacking each matrix into 61 elements as it is handed to <code>counting()</code> which only expects one argument.</p>
<p>from the <a href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing.pool.Pool.starmap" rel="nofollow noreferrer">docs:</a></p>
<blockquote>
<p><strong>starmap(func, iterable[, chunksize])</strong></p>
<p>Like map() except that the elements of the iterable are expected to be
  iterables that are unpacked as arguments.</p>
<p>Hence an iterable of [(1,2), (3, 4)] results in [func(1,2),
  func(3,4)].</p>
</blockquote>
<p>you could fix this in a number of ways, but I think the most sensible is to use <code>pool.map</code> instead, as it won't unpack your inputs and leave them as a single variable. you could also define <code>counting(*dane)</code> to allow a variable number of inputs that would be concatenated into the list <code>dane</code> (which you don't use within the function, but I'll leave you to figure out what to do with it..)</p>
</div>
<div class="post-text" itemprop="text">
<p>In </p>
<pre><code> count = pool.starmap(liczenie, matrices2)
</code></pre>
<p>what is <code>liczenie</code>?  I don't see such a function in your code.  The error message suggests it is <code>counting</code>.</p>
<p>But in  <code>counting(dane)</code>, <code>dane</code> is never used.</p>
<p>It looks like <code>matrices</code> is a list of lists of floats.  Are all the sublists the same length?  If so, why didn't you read the <code>csv</code> file with a numpy loader like <code>np.genfromtxt</code>?  But that's a side point.</p>
<p>Does <code>counting(matrices)</code> work?  Besides the messed up calling argument, it doesn't return anything.  I'm guessing it's supposed to be doing a chained matrix product, <code>M1*M2*M3*...</code>.  <code>*</code> for <code>np.matrix</code> is matrix product, not element by element (the <code>*</code> of <code>np.array()</code>).</p>
<p>But that won't work; <code>np.matrix(alist)</code> is a (1,n) matrix.  It can't multiply another (1,n) matrix, no matter how many times you wrap it in <code>np.matrix</code> (why do you do that several times?)</p>
<pre><code>In [25]: M1 = np.matrix([1,2,3,4])
In [26]: M1*M1
....
ValueError: shapes (1,4) and (1,4) not aligned: 4 (dim 1) != 1 (dim 0)
</code></pre>
<p>What's the purpose of the multiprocessing?  What is is supposed to do that a single call to a corrected <code>counting</code> can't do?</p>
</div>
<span class="comment-copy">what is the error you're getting?</span>
<span class="comment-copy">multiprocessing.pool.RemoteTraceback:  """ Traceback (most recent call last):   File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/multiprocessing/pool.py", line 119, in worker     result = (True, func(*args, **kwds))   File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/multiprocessing/pool.py", line 47, in starmapstar     return list(itertools.starmap(args[0], args[1])) TypeError: counting() takes 1 positional argument but 61 were given """</span>
<span class="comment-copy">It seems to me I should modify 'matrices2'. In this situation I can't use 'pool.starmap(counting, matrices2). I should change something, but I don't know what.</span>
<span class="comment-copy">I would just like to mention that unless you have a specific reason to use <code>numpy.matrix</code> over <code>numpy.array</code>, arrays are typically the convention used, which may prevent some future heartache..</span>
