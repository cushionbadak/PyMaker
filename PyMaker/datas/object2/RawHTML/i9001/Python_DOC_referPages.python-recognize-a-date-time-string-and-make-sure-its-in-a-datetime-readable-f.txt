<div class="post-text" itemprop="text">
<p>I have a script that reads emails and pulls out date times from the body. which was working fine until it received an email with the datetime format as per below:</p>
<pre><code>06:00 Wednesday 22ndFebruary 2017
</code></pre>
<p>There was no space between the 22nd and February, hence when the function run to get the times out of the body i got the error</p>
<pre><code>Traceback (most recent call last):
  File "email_processing.py", line 137, in &lt;module&gt;
    e_start_time, e_end_time = main_dt(content)
  File "email_processing.py", line 26, in main_dt
    date = dateutil.parser.parse(re.search(pattern, data).group(0))
  File "/usr/lib/python2.7/site-packages/dateutil/parser.py", line 1168, in parse
    return DEFAULTPARSER.parse(timestr, **kwargs)
  File "/usr/lib/python2.7/site-packages/dateutil/parser.py", line 559, in parse
    raise ValueError("Unknown string format")
ValueError: Unknown string format
</code></pre>
<p>My current function is as per the below, can anyone think of a way of validating it/making sure there are spaces where there needs to be? given that there could be a space issue anywhere in the string and that the dates will obviously change as more emails come in?</p>
<p>Thanks</p>
<pre><code>def main_dt(data):
    dates = []
    for pattern in ['(?&lt;=Start Time &amp; Date: ).*', '(?&lt;=Completion Time &amp; Date: ).*']:
        try:
            date = dateutil.parser.parse(re.search(pattern, data).group(0))
        except:
            print re.search(pattern, data).group(0)
        dates.append(date)
    return dates
</code></pre>
<p>sample body:</p>
<pre><code>Dear Customer,

(Call Transferred) We are writing to inform you of planned engineering work taking place which could impact your service.

The affected site is :  XXXXXX

Maintenance window:

Start Time &amp; Date: 01:00 Wednesday 22nd February 2017               
Completion Time &amp; Date: 06:00 Wednesday 22ndFebruary 2017                

Details of Work:
...
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>This is more of a regular expression problem. </p>
<p>The part you're catching the exception, make sure you reformat the incorrect data using:</p>
<pre><code>    validation_pattern = '(.*\\d+[a-z]{2})([A-Z].*)'
    try:
        date = dateutil.parser.parse(re.search(pattern, data).group(0))
    except:
        dirty_data_group = re.search(pattern, data).group(0)
        tidy_data_group = re.sub(validation_pattern, r'\1 \2', dirty_data_group)
        date = dateutil.parser.parse(tidy_data_group)
</code></pre>
<p>This should get the right date every time in the array. This is however limited to the specific problem which you are referring to i.e. No space between the day of the month and the month itself. </p>
</div>
<span class="comment-copy">you can always catch the exception right with 'try - except' ?</span>
<span class="comment-copy">i have as per the above, but i need to format the exception correctly, thats the bit i have no idea how to do</span>
<span class="comment-copy"><a href="https://docs.python.org/3/tutorial/errors.html#handling-exceptions" rel="nofollow noreferrer">A Google search will do</a>. A slight difference in syntax for py2</span>
<span class="comment-copy">if you look at the function main_dt, i am already catching the exception and printing out the error. The rest of my script needs these date times to continue. what im trying to figure out is a way to reformat the exception so that its correctly formatted with spaces</span>
<span class="comment-copy">@AlexW Could you please check if this works for you?</span>
<span class="comment-copy">that got it! hopefully this will last a while before a new error gets sent my way</span>
