<div class="post-text" itemprop="text">
<p>I am trying to write a parser: convert string to query format. And stuck at a particular point of string replace (by matching a pattern).</p>
<p>I can't figure out the regular expression pattern matching.</p>
<p>I have a input_string like </p>
<pre><code>ip_query_string = "CITY == 'Mumbai' &amp; LOCATION in ['Harrys Bar &amp; Cafe: Mumbai','Hard Rock Cafe in Mumbai']"

#Mark the """&amp; after CITY == """ and  """ in after LOCATION""".
#Then there is another "&amp; and a string ' in '" inside values for in-condition.

#My output should be:
op_query_string = "CITY == 'Mumbai' AND LOCATION IN ['Harrys Bar &amp; Cafe: Mumbai','Hard Rock Cafe in Mumbai']"

#if i will find  ' &amp; ' or a ' in ' (before and after there are spaces):: I have to replace them with ' AND ' and ' IN ' respectively.(In this case a ip_string.replace(' &amp; ', ' AND ').replace(' in ', ' In ')) would work.BUT read next point.
#And if they are inside a in-condition values like 'Harrys Bar &amp; Cafe: Mumbai','Hard Rock Cafe in Mumbai' then don't replace them. keep them as is.
#If you look at op_string in-condition, the &amp; and in are not replaced.
</code></pre>
<p>Please help in forming a logic.</p>
<p>Or what will be the reg pattern (if &amp; or in enclosed in single quotes along with other character, don't replace, else replace)?</p>
</div>
<div class="post-text" itemprop="text">
<p>Short solution using <a href="https://docs.python.org/3/library/re.html#re.sub" rel="nofollow noreferrer"><strong><em>re.sub()</em></strong></a> function:</p>
<pre><code>import re

ip_query_string = "CITY == 'Mumbai' &amp; LOCATION in ['Harrys Bar &amp; Cafe: Mumbai','Hard Rock Cafe in Mumbai']"
op_query_string  = re.sub(r'^([^[]+?)(in)', r'\1IN', re.sub(r'^([^[]+?)(&amp;)', r'\1AND', ip_query_string))

print(op_query_string)
</code></pre>
<p>The output:</p>
<pre><code>CITY == 'Mumbai' AND LOCATION IN ['Harrys Bar &amp; Cafe: Mumbai','Hard Rock Cafe in Mumbai']
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>Got it worked in some odd way (may not be pythonic), but it worked.</p>
<pre><code>def rplc_str(s):
   sp = s.split("'")
   print('After split==',sp)
   sp1 = [x.replace(' &amp; ', ' AND ') if ((x.startswith(' &amp;')) or (x.startswith('] &amp;'))) else x for x in sp]
   print('After replacing &amp; ==',sp1)
   sp2 = [x.replace(' in ', ' IN ') if x.endswith(' [') else x for x in sp1]
   print('After replacing in ==',sp1)
   return "'".join(sp2)

ip_str = "CITY == 'Mumbai' &amp; LOCATION in ['Harrys Bar &amp; Cafe: Mumbai','Hard Rock Cafe in Mumbai']"
op_str = rplc_str(ip_str)
print(op_str)
#After split== ['CITY == ', 'Mumbai', ' &amp; LOCATION in [', 'Harrys Bar &amp; Cafe: Mumbai', ',', 'Hard Rock Cafe in Mumbai', ']']
#After replace &amp; == ['CITY == ', 'Mumbai', ' AND LOCATION in [', 'Harrys Bar &amp; Cafe: Mumbai', ',', 'Hard Rock Cafe in Mumbai', ']']
#After replace in == ['CITY == ', 'Mumbai', ' AND LOCATION in [', 'Harrys Bar &amp; Cafe: Mumbai', ',', 'Hard Rock Cafe in Mumbai', ']']
#CITY == 'Mumbai' AND LOCATION IN ['Harrys Bar &amp; Cafe: Mumbai','Hard Rock Cafe in Mumbai']
</code></pre>
<p>Hope it helps someone, but still waiting for some pythonic answers (I mean reg expr.)</p>
</div>
<span class="comment-copy">why <code>'Harry's</code> should become <code>'Harrys</code> ?</span>
<span class="comment-copy">Sorry, there was a typo,It was always been Harrys. Edited the question.</span>
<span class="comment-copy">works in this case(question), but failing, if i have a '&amp;' or 'in' inside a normal condition's value. Like for ip_query_string = "CITY == 'Mumbai in Goa' &amp; LOCATION in ['Harrys Bar &amp; Cafe: Mumbai','Hard Rock Cafe in Mumbai']"......for CITY value i have placed a ' in ' . then the above reg_expr results in "CITY == 'Mumbai IN Goa' AND LOCATION in ['Harrys Bar &amp; Cafe: Mumbai','Hard Rock Cafe in Mumbai']"...i:e it is changing that 'Mumbai in Goa' to 'Mumbai IN Goa'. Which should not happen. if ' &amp; ' and ' in ' found enclosed inside single quotes, then it should not be changed.</span>
