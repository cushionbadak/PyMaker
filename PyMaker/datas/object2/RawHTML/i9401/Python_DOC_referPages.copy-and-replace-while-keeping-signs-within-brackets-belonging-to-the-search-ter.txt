<div class="post-text" itemprop="text">
<p>I need to replace thousands of matches in a source code file.
Does anyone know how to replace <code>"bar"</code> with <code>"foo"</code> while exchanging the brackets and keeping what's inside?
This is how the copy and replace should work:</p>
<pre><code>    int v = -bar[0].fZ;
    int v = -bar[123].fZ;
</code></pre>
<p>replace with:</p>
<pre><code>    int v = -foo.foo(0).fZ;
    int v = -foo.foo(123).fZ;
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>The solution using <code>re.sub()</code> function:</p>
<pre><code>import re

code_content = '''
    int v = -bar[0].fZ;
    int v = -bar[123].fZ;
'''

code_content = re.sub(r'(\-)(bar)\[(\d+)\](?=\.\w+)', r'\1foo.foo(\3)', code_content, re.M)
print(code_content)
</code></pre>
<p>The output:</p>
<pre><code>    int v = -foo.foo(0).fZ;
    int v = -foo.foo(123).fZ;
</code></pre>
<p><a href="https://docs.python.org/3.1/library/re.html#re.sub" rel="nofollow noreferrer">https://docs.python.org/3.1/library/re.html#re.sub</a></p>
</div>
<div class="post-text" itemprop="text">
<p><a href="https://docs.python.org/3/library/re.html" rel="nofollow noreferrer"><code>regex</code></a> allows you to precisely match strings and reuse the matched groups in a substitution:</p>
<p>you can capture the number in a named group (<code>(?P&lt;number&gt;\d+)</code>) and reference it in the substitution with <code>\g&lt;number&gt;</code>:</p>
<pre><code>import re

text = '''int v = -bar[0].fZ;
int v = -bar[123].fZ;
'''

print(re.sub('int\ v\ =\ -(?P&lt;bar&gt;\w+)\[(?P&lt;number&gt;\d+)\]\.fZ;',
             'int v = -foo.foo(\g&lt;number&gt;).fZ;', text))
</code></pre>
<p>which prints:</p>
<pre><code>int v = -foo.foo(0).fZ;
int v = -foo.foo(123).fZ;
</code></pre>
<p>you are free to name and reference more groups (i also named <code>&lt;bar&gt;</code> which is a bit pointless here as i don't reference it in the substitution...).</p>
</div>
<span class="comment-copy">thanks it works nice</span>
<span class="comment-copy">@dgrat, you're welcome</span>
<span class="comment-copy">thanks it works nice</span>
