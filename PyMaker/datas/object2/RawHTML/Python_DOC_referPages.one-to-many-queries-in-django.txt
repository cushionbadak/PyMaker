<div class="post-text" itemprop="text">
<p>This is my City object:</p>
<pre><code>class City(Base):
    country = models.ForeignKey(Country, on_delete=models.CASCADE)
    name = models.CharField(max_length=255)
    latitude = models.FloatField()
    longitude = models.FloatField()
</code></pre>
<p>And this is my user:</p>
<pre><code>class User(AbstractBaseUser, PermissionsMixin, Base):
    username = models.CharField(db_index=True, null=False, unique=True, max_length=255)
    mobile = models.CharField(db_index=True, max_length=100, null=True, unique=True)
    city = models.ForeignKey(City, on_delete=models.CASCADE, null=True)
</code></pre>
<p>How do I query cities which have more than 1 user?</p>
</div>
<div class="post-text" itemprop="text">
<p>Use annotations:</p>
<pre><code>from django.db.models import Count
City.objects.annotate(user_count=Count("user")).filter(user_count__gt=1)
</code></pre>
</div>
<span class="comment-copy">Does this return the count of cities with more than one user?</span>
<span class="comment-copy">No, it returns the cities, not the count.</span>
<span class="comment-copy">This gives me a syntax error, is this complete code?</span>
<span class="comment-copy">Sorry, missed a close parenthesis, try it now.</span>
<span class="comment-copy">Yup works now, I'm using it as <code>city_count = City.objects.annotate(user_count=Count("user").filter(user_count__gt=1).count()</code></span>
