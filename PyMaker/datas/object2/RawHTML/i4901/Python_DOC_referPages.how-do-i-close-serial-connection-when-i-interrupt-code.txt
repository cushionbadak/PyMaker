<div class="post-text" itemprop="text">
<p>I have the following Python code which is just reading from an Arduino, and writing to a file:</p>
<pre><code>import serial
from datetime import datetime
import time

ser = serial.Serial('COM3', 9600, timeout=0)

text_file = open("voltages.txt", 'w') 

while 1:
    x=ser.readline()
    print(str(datetime.now()), x) 
    data = [str(datetime.now()),x]
    text_file.write("{}\n".format(data))
    text_file.flush()
    time.sleep(1)
</code></pre>
<p>Whenever I interrupt the script, I always have to type <code>ser.close()</code> in the console, otherwise I cannot start the script again (in the same console).</p>
<p>How can I close the serial communication automatically whenever I interrupt the script?</p>
</div>
<div class="post-text" itemprop="text">
<p>Use a <a href="https://docs.python.org/3/tutorial/errors.html#defining-clean-up-actions" rel="nofollow noreferrer">try/finally</a> block to insure close is called:</p>
<pre><code>try:
    while 1:
        x = ser.readline()
        ....
finally:
    ser.close()
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>You can use the <code>with</code> statement.</p>
<pre><code>import serial
from datetime import datetime
import time

with serial.Serial('COM3', 9600, timeout=0) as ser, open("voltages.txt", 'w') as text_file:
    while True:
        x=ser.readline()
        print(str(datetime.now()), x) 
        data = [str(datetime.now()),x]
        text_file.write("{}\n".format(data))
        text_file.flush()
        time.sleep(1)
</code></pre>
<p>The <code>with</code> statement will automatically close <code>ser</code> and <code>text_file</code> when execution leaves the <code>with</code> statement. This can be an exception in your case. The <code>with</code> statement has been introduced by PEP 343 to remove <code>try/finaly</code> statements by using context managers.</p>
</div>
