<div class="post-text" itemprop="text">
<p>I am trying to figure out how long does it take for my <a href="http://scikit-learn.org/stable/modules/generated/sklearn.discriminant_analysis.LinearDiscriminantAnalysis.html#sklearn.discriminant_analysis.LinearDiscriminantAnalysis" rel="nofollow noreferrer">LDA classifier</a> to predict the class of a single 1080 dimensional vector. I read these threads: </p>
<ul>
<li><a href="https://stackoverflow.com/questions/7370801/measure-time-elapsed-in-python/7370824#7370824">Measure time elapsed in Python?</a></li>
<li><a href="https://stackoverflow.com/questions/1622943/timeit-versus-timing-decorator">timeit versus timing decorator</a></li>
<li><a href="https://stackoverflow.com/questions/1557571/how-do-i-get-time-of-a-python-programs-execution/1557906#1557906">How do I get time of a Python program's execution?</a></li>
</ul>
<p>and found out there are several ways to do this. I tested few of them but they produced very different results.</p>
<p><a href="https://docs.python.org/3/library/time.html" rel="nofollow noreferrer">time module</a>:</p>
<pre><code>import time
start = time.time()
lda.predict(sample)
end = time.time()
print(str((end-start)*10**6), 'µs')
&gt;&gt;&gt; 1452.9228210449219 µs
</code></pre>
<p><a href="https://docs.python.org/3.6/library/timeit.html" rel="nofollow noreferrer">timeit module's</a> default_timer:</p>
<pre><code>from timeit import default_timer as timer
start = timer()
lda.predict(sample)
end = timer()
print(str((end-start)*10**6), 'µs')
&gt;&gt;&gt; 979.6129997994285 µs
</code></pre>
<p>iPython <a href="https://docs.python.org/3.6/library/timeit.html" rel="nofollow noreferrer">%timeit</a> magic function:</p>
<pre><code>%timeit lda.predict(sample)
&gt;&gt;&gt; 52 µs ± 873 ns per loop (mean ± std. dev. of 7 runs, 10000 loops each)
</code></pre>
<p>Am I doing something ridiculous here or is there some other explanation for the differences? Which one to trust? Thank you in advance. </p>
</div>
<div class="post-text" itemprop="text">
<p>Firstly, there may be several clocks in your system, with different resolutions and precisions. So, one clock may be really accurate (gimme deez nanoseconds, m8!), while another one may only measure time in whole days. There are probably none that actually do the latter, but you get the point. I also found a pretty interesting <a href="https://www.eecis.udel.edu/~ntp/ntpfaq/NTP-s-sw-clocks.htm" rel="nofollow noreferrer">website</a> that explains how computers measure time.</p>
<p>Secondly, the CPU doesn't <em>always</em> do your task at the same speed as it has plenty of other stuff to do! It's actually constantly switching between tons of different tasks incredibly quickly, and to us, slow humans, it looks like it does all of this simultaneously. Well, nope. So, right now your CPU might be a bit busier than it was milliseconds before, and this means your task may be executed milliseconds later, or the other way round.</p>
<p>As for iPython's <code>%timeit code</code>, it, unlike the other methods you used, runs <code>code</code> <em>multiple times</em>, so, while the first run may take a lot of time, subsequent runs may be much faster due to <em>caching</em>. So, in this case, during the first run the result is actually calculated (which is slow) then just dumped to memory, and the other 69999 runs merely fetch that result, which happens to be faster than doing the computations. I don't think you can disable caching easily as a cache is literally built into the CPU, so results of <em>any</em> repetitive job may get cached.</p>
<hr/>
<p>The latter may not be the case, though. It turns out that <code>%timeit</code> uses (a subclass of) <code>timeit.Timer</code> (definition at line 139 <a href="https://github.com/ipython/ipython/blob/master/IPython/core/magics/execution.py" rel="nofollow noreferrer">of iPython's source code</a> and usage at line 945)<sup>*</sup> that <em>disables garbage collection</em> before measuring time. And that most likely is the reason for such drastic speedup since garbage collection takes a lot of time, and provided that your code is rather complicated, the GC is bound to have lots of work to do.</p>
<hr/>
<p><sup>*</sup> Yeah, I know you can have links directly to some line, but that doesn't work for me for some reason, sorry about that.</p>
</div>
