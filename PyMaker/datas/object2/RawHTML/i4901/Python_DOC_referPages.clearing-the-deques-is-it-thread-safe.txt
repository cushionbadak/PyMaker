<div class="post-text" itemprop="text">
<p>I've been reading about the thread-safety of CPython's <code>collections.deque</code> <a href="https://stackoverflow.com/a/8554182/3019689">here</a> and <a href="https://bugs.python.org/issue15329#msg199368" rel="nofollow noreferrer">here</a>.  I understand that <code>.append()</code> and <code>.popleft()</code> operations play nice with each other across threads, as do <code>.appendleft()</code> and <code>.pop()</code>.</p>
<p>My question is: does the same apply between <code>.popleft()</code> and <code>.clear()</code>?  Or failing that, between <code>.popleft()</code> and <code>.pop()</code>?   My situation is that I have a consumer thread, call it A, continually <code>.popleft()</code>ing items from a <code>deque</code> <code>d</code>, and a producer thread B that <code>.append()</code>s them on the right.  At some point I want thread B to be able to say "cancel all pending items".  If I do this with </p>
<pre><code>d.clear()
</code></pre>
<p>will it potentially lead to undefined behaviour due to clashes with thread A's <code>.popleft()</code> operations?   How about if I say:</p>
<pre><code>while d:
    try: d.pop()
    except: break
</code></pre>
<p>instead?</p>
</div>
<div class="post-text" itemprop="text">
<p>From the <a href="https://docs.python.org/3/library/collections.html#collections.deque" rel="nofollow noreferrer">documentation of the api</a> :</p>
<blockquote>
<p>Deques support thread-safe, memory efficient appends and pops from <strong>either side</strong> of the deque with approximately the same O(1) performance in either direction 
  <strong>(emphasis mine)</strong></p>
</blockquote>
<p>Which means that you can pop on any side and still enjoy the benefits. As far as the <code>clear()</code> method goes, one can only be sure by looking at the implementation, but i would assume it's implemented just the same way you suggested.</p>
<p>Edit:
Also, if i remember correctly from the java implementation of blocking queues, which for all intended purposes should be fairly close to this one, calling <code>clear()</code> on a queue object <strong>does not guarantee</strong> that when you access it on the next code line, you will find it empty</p>
</div>
<div class="post-text" itemprop="text">
<p>If I recall, they should not interfere with what you are trying to do as they will place a mutex on the resource and perform any operation independently, and as long as you catch an exception from the resource if it is empty when attempting to pop you should be good to go. </p>
</div>
