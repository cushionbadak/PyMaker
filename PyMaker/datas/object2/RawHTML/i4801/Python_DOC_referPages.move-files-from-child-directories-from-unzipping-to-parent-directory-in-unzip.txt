<div class="post-text" itemprop="text">
<p>I've got a specific problem: 
I am downloading some large sets of data using requests. Each request provides me with a compressed file, containing a manifest of the download, and folders, each containing 1 file.</p>
<p>I can unzip the archive + remove archive, and afterwards extract all files from subdirectories + remove subdirectories.</p>
<p>Is there a way to combine this? Since I'm new to both actions, I studied some tutorials and stack overflow questions on both topics. I'm glad it is working, but I'd like to refine my code and possibly combine these two steps - I didn't encounter it while I was browsing other information.</p>
<p>So for each set of parameters, I perform a request which ends up with:</p>
<pre><code># Write the file
with open((file_location+file_name), "wb") as output_file:
    output_file.write(response.content)
# Unzip it
with tarfile.open((file_location+file_name), "r:gz") as tarObj:
    tarObj.extractall(path=file_location)
# Remove compressed file
os.remove(file_location+file_name)
</code></pre>
<p>And then for the next step I wrote a function that:</p>
<pre><code>target_dir = keyvalue[1] # target directory is stored in this tuple
subdirs = get_imm_subdirs(target_dir) # function to get subdirectories
for f in subdirs:
    c = os.listdir(os.path.join(target_dir, f)) # find file in subdir
    shutil.move(c, str(target_dir)+"ALL_FILES/") # move them into 1 subdir
os.rmdir([os.path.join(target_dir, x) for x in subdirs]) # remove other subdirs
</code></pre>
<p>Is there an action I can perform during the unzip step?</p>
</div>
<div class="post-text" itemprop="text">
<p>You can extract the files individually rather than using <code>extractall</code>.</p>
<pre><code>with tarfile.open('musthaves.tar.gz') as tarObj:
    for member in tarObj.getmembers():
        if member.isfile():
            member.name = os.path.basename(member.name)
            tarObj.extract(member, ".")
</code></pre>
<p>With appropriate credit to <a href="https://stackoverflow.com/questions/8405843/python-extract-using-tarfile-but-ignoring-directories">this SO question</a> and the <a href="https://docs.python.org/3/library/tarfile.html" rel="nofollow noreferrer">tarfile docs</a>.</p>
<p><code>getmembers()</code> will provide a list what is inside the archive (as objects); you could use <code>listnames()</code> but then you'd have to devise you own test as to whether or not each entry is a file or directory.</p>
<p><code>isfile()</code> - if it's not a file, you don't want it.</p>
<p><code>member.name = os.path.basename(member.name)</code> resets the subdirectory depth - the extractor things everything is at the top level.</p>
</div>
<span class="comment-copy">I read the docs and understood just enough to know how to open and extract stuff. I'm not that used to reading these things yet to find other useful information. But this should help a lot, thank you!</span>
