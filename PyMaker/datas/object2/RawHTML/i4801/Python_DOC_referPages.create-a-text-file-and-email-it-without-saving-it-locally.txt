<div class="post-text" itemprop="text">
<p>I would like to create a text file in Python, write something to it, and then e-mail it out (put <code>test.txt</code> as an email attachment). </p>
<p>However, I cannot save this file locally. Does anyone know how to go about doing this?</p>
<p>As soon as I open the text file to write in, it is saved locally on my computer.</p>
<pre><code>f = open("test.txt","w+")
</code></pre>
<p>I am using <code>smtplib</code> and <code>MIMEMultipart</code> to send the mail.</p>
</div>
<div class="post-text" itemprop="text">
<p><a href="https://docs.python.org/3/library/io.html#io.StringIO" rel="nofollow noreferrer">StringIO</a> is the way to go...</p>
<pre><code>from email import encoders
from email.mime.base import MIMEBase
from email.mime.multipart import MIMEMultipart

from io import StringIO

email = MIMEMultipart()
email['Subject'] = 'subject'
email['To'] = 'recipient@example.com'
email['From'] = 'sender@example.com'

# Add the attachment to the message
f = StringIO()
# write some content to 'f'
f.write("content for 'test.txt'")
f.seek(0)

msg = MIMEBase('application', "octet-stream")
msg.set_payload(f.read())
encoders.encode_base64(msg)
msg.add_header('Content-Disposition',
               'attachment',
               filename='test.txt')
email.attach(msg)
</code></pre>
</div>
<span class="comment-copy">you'd like to send <code>test.txt</code> out as one attachment of one email? or put the content of <code>test.txt</code> into email body?</span>
<span class="comment-copy">I'd like to send test.txt as the attachment of the email</span>
<span class="comment-copy">I wonder if <a href="https://docs.python.org/3/library/io.html#io.StringIO" rel="nofollow noreferrer">StringIO</a> would be useful here? It's conventionally used for constructing a file-like object without actually creating a file. No idea whether smtplib would accept such a thing though.</span>
<span class="comment-copy">Follow <a href="https://stackoverflow.com/questions/3362600/how-to-send-email-attachments#3363254" title="how to send email attachments%233363254">stackoverflow.com/questions/3362600/â€¦</a> - the <code>MimeApplication</code> method doesn't need a file - just its contents and a name to create an attachment from.</span>
<span class="comment-copy">But how would I write text into the file though?</span>
<span class="comment-copy">I'm able to send a document, but the text file is blank. Also for some reason, it sends two text files as attachments. Not too sure why.  f = StringIO()     f.write(u'hi')        msg1 = MIMEBase('application', "octet-stream")     msg1.set_payload(f.read())     #encoders.encode_base64(msg)     msg1.add_header('Content-Disposition',                'attachment',                filename='test.txt')     msg.attach(msg1)</span>
<span class="comment-copy">Got it - it should be msg.set_payload(f.getvalue())</span>
<span class="comment-copy">Sorry updated answer to fix blank read. need to `f.seek(0)</span>
