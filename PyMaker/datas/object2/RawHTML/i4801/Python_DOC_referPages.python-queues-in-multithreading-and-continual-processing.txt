<div class="post-text" itemprop="text">
<p>I have several threads doing several tasks. One thread listens to data from a UDP socket. Another thread processes the data into JSON objects and queues the data. Another thread sends the information.</p>
<p>What Im trying to work out at the moment, is how a queue works on empty data? While most routines does a </p>
<pre class="lang-python prettyprint-override"><code>while not q.empty(): 
    object = q.get()
</code></pre>
<p>I need to find out how to process the queue in the while loop when there is data on the queue.</p>
<p>I guess I could put a while True loop in and sleep(1). But the trouble is, if the data hits the queue quicker than the sleep time. If I take the sleep(1) out, then my usually understanding, is that the while loop will just eat CPU.</p>
<p>So I guess I need some way of telling the thread that there's data on the queue and therefore to run a processing routine?</p>
</div>
<div class="post-text" itemprop="text">
<p>You can use conditional variable used in classical synchronization problem, to avoid busy waiting.</p>
<p>You can read more about "Producer consumer" problem.</p>
<p>In this case, the producer threads will add one or more items to the queue, whereas a consumer would be a thread waiting for an item in the queue.</p>
<p>Look at threading.Condition class for usage and more details.</p>
<p>Ref: <a href="https://docs.python.org/3/library/threading.html#threading.Condition" rel="nofollow noreferrer">https://docs.python.org/3/library/threading.html#threading.Condition</a></p>
<p><strong>Edit:</strong></p>
<p>If you use Queue class from queue module then you don't have to implement nitty-gritty of thread lock and condition management w.r.t Queue.</p>
<p>Ref: <a href="https://docs.python.org/3.8/library/queue.html" rel="nofollow noreferrer">https://docs.python.org/3.8/library/queue.html</a></p>
<pre><code>def worker():
    while True:
        item = q.get()
        if item is None:
            break
        do_work(item)
        q.task_done()

q = queue.Queue()
threads = []
for i in range(num_worker_threads):
    t = threading.Thread(target=worker)
    t.start()
    threads.append(t)

for item in source():
    q.put(item)

# block until all tasks are done
q.join()

# stop workers
for i in range(num_worker_threads):
    q.put(None)
for t in threads:
    t.join()
</code></pre>
<p>In the above example, the worker thread is waiting for the item in the queue. If an item is made available then Queue object will notify the waiting threads and one of them will get the item from the queue.</p>
</div>
<span class="comment-copy">There are multiple Queue classes, you need to specify exactly which one you are using. For example <a href="https://docs.python.org/3/library/queue.html#module-queue" rel="nofollow noreferrer"><code>queue.Queue.get()</code></a> will <i>block</i> until an item is available. This seems to be the behavior you want.</span>
