<div class="post-text" itemprop="text">
<p>Let me explain this question a bit. I have multiple users which generate data. The data is basically as follows:</p>
<pre><code>[Name, id, points, [card_1,...card_n]]
</code></pre>
<p>Now every time this data is generated i want to store it to a file, but only if under the name there is not yet an entry in the file. If there is an entry I need to check if the values have changed and update them. There could be a cuple of thousand entries. Please let me know I you guys need additional infos to guide me in the right direction.</p>
<p>Thank you</p>
</div>
<div class="post-text" itemprop="text">
<p>A couple thousand entries is nothing, so you can just do this in the simplest possible way: Build up a dictionary in memory, mapping names to entries, then write it out at the end:</p>
<pre><code>d = {}
for path in paths:
    with open(path, 'rb') as f:
        for entry in MyParser(f):
            d.setdefault(entry.name,  entry)
with open(outpath, 'wb') as f:
    for entry in d.values():
        f.write(my_formatter(entry))
</code></pre>
<p>If your data grow by a few orders of magnitude and you can't afford to keep everything in memory, you can just replace <code>d</code> with a <a href="https://docs.python.org/3/library/shelve.html" rel="nofollow"><code>shelve</code></a> with almost no change to your code, or a <a href="https://docs.python.org/3/library/sqlite3.html" rel="nofollow"><code>sqlite3</code></a> or other more powerful database with a bit more changes. (In fact, if you don't need a specific output format, or haven't chosen one yet, you should probably consider using a database as that output format, and just skipping the second half.)</p>
<hr/>
<p>From your comment:</p>
<blockquote>
<p>There is basically no end. The script runs forever and new data sets are generated from time to time. When generated they have be stored or update the exiting data. I might also be possible, that there are several instances of the script which all generate data and try to access the same file. so i guess a database would be a good idea.</p>
</blockquote>
<p>If you're talking about key-accessible values that can be concurrently accessed and updated from other programs, yeah, that pretty much <em>is</em> a database. You can build (a simple) one yourself, or use an existing one.</p>
<p>A key-value or tuple database is still the obvious choice, but <code>shelve</code> itself (or anything based on <code>dbm</code>) isn't going to cut it, because it doesn't provide concurrency. For something this small, you can just use the same trick mail agents have used for decades: store each entry in a separate file, using the key to generate the filename, and file locks for atomicity. But really, there are so many easy-to-use, efficient, and reliable key-value stores out there (see <a href="http://nosql-database.org/" rel="nofollow">nosqldatabase</a> for a nice list) that you might as well pick one of them.</p>
<p>A SQL database will make things a little more complex (you've got to either write SQL, or use some kind of front end like SQLAlchemy), and quite possibly slower. On the other hand, the SQL database that Python comes with, <code>sqlite3</code>, <a href="http://www.sqlite.org/faq.html#q5" rel="nofollow">supports concurrency</a>. (See the <code>timeout</code> and <code>isolation_level</code> settings in <a href="https://docs.python.org/3/library/sqlite3.html#sqlite3.connect" rel="nofollow">the docs</a> for info on how to use it.) Not in the most beautiful or efficient way possible, but for a few thousand entries, it's more than good enough. So, if you want to stick with the stdlib, it might be worth considering.</p>
</div>
<span class="comment-copy">How about a database, like <a href="https://docs.python.org/2/library/sqlite3.html" rel="nofollow noreferrer">sqlite</a>?</span>
<span class="comment-copy">I had xml in mind, but i think sqlite would be faster and the parsing would be easier. Good advice, I will take a look. Ty</span>
<span class="comment-copy">@Akku: "XML" by itself isn't a good idea; a decent NoSQL database engine using XML as a storage format, on the other hand, is fine. But so is a SQL database. Or just a key-value database. I don't see how any of those affects how easy or fast the parsing is.</span>
<span class="comment-copy">There is basically no end. The script runs forever and new data sets are generated from time to time. When generated they have be stored or update the exiting data. I might also be possible, that there are several instances of the script which all generate data and try to access the same file. so i guess a database would be a good idea.</span>
<span class="comment-copy">@Akku: OK, in that case, I'd suggest either <code>sqlite3</code> or a third-party key-value store, but see the edited answer for more details.</span>
