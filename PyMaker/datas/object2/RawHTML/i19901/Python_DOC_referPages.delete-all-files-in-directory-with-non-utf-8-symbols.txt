<div class="post-text" itemprop="text">
<p>I have a set of data, but I need to work only with <code>utf-8</code> data, so I need to delete all data with non-<code>utf-8</code> symbols.</p>
<p>When I try to work with these files, I receive:</p>
<pre><code>UnicodeDecodeError: 'charmap' codec can't decode byte 0x8d in position 3062: character maps to &lt;undefined&gt; and UnicodeDecodeError: 'utf8' codec can't decode byte 0xc1 in position 1576: invalid start byte 
</code></pre>
<p>My code </p>
<pre><code>class Corpus:
        def __init__(self,path_to_dir=None):
                self.path_to_dir = path_to_dir if path_to_dir else []


        def emails_as_string(self):
                for file_name in os.listdir(self.path_to_dir):
                        if not file_name.startswith("!"):
                                with io.open(self.add_slash(self.path_to_dir)+file_name,'r', encoding ='utf-8') as body:
                                        yield[file_name,body.read()]                        

        def add_slash(self, path):
                if path.endswith("/"): return path
                return path + "/"
</code></pre>
<p>I recive error here <code>yield[file_name,body.read()]</code> and  here<code>list_of_emails = mailsrch.findall(text)</code>, but when I work with utf-8 all great.</p>
</div>
<div class="post-text" itemprop="text">
<p>I suspect you want to use the <code>errors='ignore'</code> argument on <code>bytes.decode</code>.  See <a href="http://docs.python.org/3/howto/unicode.html#unicode-howto" rel="nofollow">http://docs.python.org/3/howto/unicode.html#unicode-howto</a> and <a href="http://docs.python.org/3/library/stdtypes.html#bytes.decode" rel="nofollow">http://docs.python.org/3/library/stdtypes.html#bytes.decode</a> .for more info.</p>
<p><strong>Edit:</strong></p>
<p>Here's an example showing a good way to do this:</p>
<pre><code>for file_name in os.listdir(self.path_to_dir):
    if not file_name.startswith("!"):
        fullpath = os.path.join(self.path_to_dir, file_name)
        with open(fullpath, 'r', encoding ='utf-8', errors='ignore') as body:
            yield [file_name, body.read()]  
</code></pre>
<p>Using <code>os.path.join</code>, you can eliminate your <code>add_slash</code> method, and ensure that it works cross-platform.</p>
</div>
<span class="comment-copy">All ASCII characters are UTF-8 characters <i>too</i>.. Did you mean 'non-ASCII' perhaps?</span>
<span class="comment-copy">When I work in my program with other symbols I receive   <code>UnicodeDecodeError: 'charmap' codec can't decode byte 0x8d in position 3062: character maps to &lt;undefined&gt;</code> and <code>UnicodeDecodeError: 'utf8' codec can't decode byte 0xc1 in position 1576: invalid start byte</code></span>
<span class="comment-copy">Can you include your code too, please?</span>
<span class="comment-copy">So I suppose to add <code>.decode("utf-8", "ignore")</code> to my code  <code>yield[file_name,body.read()]</code> like this <code>yield[file_name,body.read().decode("utf-8", "ignore")]</code>? BTW, I still have error <code>UnicodeDecodeError: 'utf8' codec can't decode byte 0xc1 in position 1576: invalid start byte</code></span>
<span class="comment-copy">No, since you're using <code>io.open</code>, you would use the <code>errors</code> argument in it instead, e.g. <code>io.open(filename, 'r', encoding='utf-8', errors='ignore')</code>.  As an aside, note that its generally a good idea to <code>os.path.join</code> to build up paths.  I would also suggest using the builtin <code>open</code> instead.  I'll update my answer to show an example of these.</span>
