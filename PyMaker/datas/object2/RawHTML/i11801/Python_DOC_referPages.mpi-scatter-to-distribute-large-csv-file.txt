<div class="post-text" itemprop="text">
<p>I have a large csv file and I need to process every row to count some words. I need to use some MPI approach to distribute data processing among multiple process. Currently, I'm using scatter/gather in <code>mpi4py</code> library. The problem is that I need to create an array with length equal to number of the processes. But I get a memory error when creating the list for large row counts. </p>
<pre><code>size = comm.Get_size()
f=open('x.csv')
lines=[[] for _ in range(size)]
for line in f:
    # this line raises memory error after about 250000 rows are appended
    lines[i%size].append(line)
</code></pre>
<p>Is there another way to transfer large data among these processes?</p>
</div>
<div class="post-text" itemprop="text">
<p>You bascially have the following options:</p>
<ol>
<li>Process the data in chunks, e.g. read 200k rows, scatter, collect results, repeat.</li>
<li>Read the data locally, e.g. <code>1/size</code> of the file on each rank. This can be difficult to do efficiently. You cannot efficiently seek to a specific line in a csv file. So you have to separate the file by size, <code>seek</code> to the position where you <em>split</em> it, find the next newline and work from there until the first newline after the end of your part of the file.</li>
<li>Combine both.</li>
</ol>
<p>But then again, you could just process the file serially line by line, throwing away each line after you counted the words of it.</p>
<p>P.S. Consider the <a href="https://docs.python.org/3/library/csv.html" rel="nofollow"><code>csv</code></a> module.</p>
</div>
<span class="comment-copy">1) Does this run on multiple nodes? 2) Is this a shared file system? Generally it seems <b>very unlikely</b> that you actually gain performance from your approach rather than serially counting your words, as this is likely limited by disk I/O banwidth, not computation.</span>
<span class="comment-copy">@Zulan yes, I have multiple nodes and a shared file system. currently performance is not that much important for me, I just want to test and work with this MPI library on my file</span>
