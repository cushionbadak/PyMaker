<div class="post-text" itemprop="text">
<p>Python Version : 3.5.1</p>
<p>requests version: 2.9.1.</p>
<p>I am trying to get the IP address of url in python's request like below as explained here: <a href="https://stackoverflow.com/questions/22492484/how-do-i-get-the-ip-address-from-a-http-request-using-the-requests-library/22513161#22513161">How do I get the IP address from a http request using the requests library?</a></p>
<pre><code>import requests
rsp = requests.get('http://google.com', stream=True)
# grab the IP while you can, before you consume the body!!!!!!!!
print (rsp.raw._fp.fp._sock.getpeername())
# consume the body, which calls the read(), after that fileno is no longer available.
print (rsp.content)
</code></pre>
<p>Getting below error:</p>
<pre><code>AttributeError: '_io.BufferedReader' object has no attribute '_sock'
</code></pre>
<p>May be some version issues. Please help.</p>
<p>P.S. Unable to comment in original post.</p>
</div>
<div class="post-text" itemprop="text">
<p>You got to the <a href="https://docs.python.org/3/library/io.html#io.BufferedReader" rel="nofollow"><code>BufferedReader</code> instance</a>; it is a wrapper around the actual file object adding a buffer. The original file object is reachable via the <a href="https://docs.python.org/3/library/io.html#io.BufferedIOBase.raw" rel="nofollow"><code>raw</code> attribute</a>:</p>
<pre><code>print(rsp.raw._fp.fp.raw._sock.getpeername())
</code></pre>
<p>Demo:</p>
<pre><code>&gt;&gt;&gt; import requests
&gt;&gt;&gt; rsp = requests.get('http://google.com', stream=True)
&gt;&gt;&gt; print(rsp.raw._fp.fp.raw._sock.getpeername())
('2a00:1450:400b:c02::69', 80, 0, 0)
</code></pre>
<p>To make the code work on both Python 2 and 3, see if the <code>raw</code> attribute is there:</p>
<pre><code>fp = rsp.raw._fp.fp
sock = fp.raw._sock if hasattr(fp, 'raw') else fp._sock
print(sock.getpeername())
</code></pre>
</div>
<span class="comment-copy">Ok.. cool thanks.. that's what I wanted..</span>
