<div class="post-text" itemprop="text">
<p>I have a file with some non-ASCII characters.</p>
<pre><code>$ file bi companies.txt
text/plain; charset=utf-8
</code></pre>
<p>On my desktop with Python 3.4 I can <code>open</code> this file with no problems:</p>
<pre><code>&gt;&gt;&gt; open('companies.txt').read()
'...'
</code></pre>
<p>On a CI system with Python 3.3 I get this:</p>
<pre><code>&gt;&gt;&gt; open('companies.txt').read()
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in &lt;module&gt;
  File "/usr/local/lib/python3.3/encodings/ascii.py", line 26, in decode
    return codecs.ascii_decode(input, self.errors)[0]
UnicodeDecodeError: 'ascii' codec can't decode byte 0xc4 in position 1223: ordinal not in range(128)
</code></pre>
<p>But if I explicitly specify <code>encoding='utf8'</code>, it works:</p>
<pre><code>&gt;&gt;&gt; open('companies.txt', encoding='utf8').read()
'...'
</code></pre>
<p>On both systems, <code>sys.getdefaultencoding</code> returns <code>'utf-8'</code>.</p>
<p>Any ideas what is causing the systems to behave differently? Why is the CI system trying to use ascii?</p>
</div>
<div class="post-text" itemprop="text">
<p>The encoding for text files is determined by <a href="https://docs.python.org/3/library/locale.html#locale.getpreferredencoding" rel="nofollow">locale.getpreferredencoding</a>, rather than <a href="https://docs.python.org/3/library/sys.html#sys.getdefaultencoding" rel="nofollow">sys.getdefaultencoding</a>.</p>
</div>
<span class="comment-copy">Always specify the encoding if you know it, rather than relying on the default encoding, which may change.</span>
<span class="comment-copy">That may be good advice, but my question is particular to why the two systems are behaving differently despite the default encoding (as far as I can tell) being the same.</span>
<span class="comment-copy">@AndrewMagee. What does <code>locale.getpreferredencoding()</code> return on each system?</span>
<span class="comment-copy">Ah, that looks like it could be it. On the CI system, that returns <code>'ANSI_X3.4-1968'</code> so that would explain the difference. I wasn't aware of that being a thing. If you write that in an answer I will accept it.</span>
