<div class="post-text" itemprop="text">
<p>I am trying to run an ffmpeg command on Windows 7 (python 2.7) which runs on command line just fine, but the <code>env</code> of my <code>Popen</code> is not working.
Here is the working command line:</p>
<pre><code>SET FFREPORT=level=48:file=C\:\\temp\\TESTFFMPEGOUTPUT.txt &amp;&amp; C:\Temp\ffmpeg\ffmpeg.exe -i â€œI:\somefolder\testInput.mov" "I:\somefolder\testOutput.mov"
</code></pre>
<p>And here is my current python code:</p>
<pre><code>ffreport = "level=48:file={}".format(self.logFilePath) + " &amp;&amp; "
startupinfo = subprocess.STARTUPINFO()
startupinfo.dwFlags |= subprocess.STARTF_USESHOWWINDOW
self.process1 = Popen(command, startupinfo=startupinfo, shell=False, env={'SET FFREPORT':ffreport})
</code></pre>
<p>This results in windows reporting "ffmpeg has stopped working".
Not sure how to fix.</p>
</div>
<div class="post-text" itemprop="text">
<pre><code>command = r"C:\Temp\ffmpeg\ffmpeg.exe -i I:\somefolder\testInput.mov I:\somefolder\testOutput.mov"

self.process1 = Popen(
        shlex.split(command), shell=False, 
        env=dict(FFREPORT="level=48:file=C\:\\temp\\TESTFFMPEGOUTPUT.txt"))
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>How about this? <br/>
using <code>os.startfile(path[, operation])</code><br/>
<a href="https://docs.python.org/3/library/os.html#os.startfile" rel="nofollow">https://docs.python.org/3/library/os.html#os.startfile</a></p>
</div>
<span class="comment-copy">This gives the error - WindowsError: [Error 2] The system cannot find the file specified. I still would like to find a way to use the Popen command as is and fix the env.</span>
<span class="comment-copy">sorry about that.. <code>command = r"C:\Temp</code></span>
<span class="comment-copy">Windows <code>CreateProcess</code> takes a command-line string, so there's no point to creating a list with <code>shlex.split(command)</code>. Modify a copy of the current environment: <code>environ = os.environ.copy();</code> <code>environ['FFREPORT'] = 'level=48:file={}'.format(self.logFilePath);</code> <code>self.process1 = Popen(command, startupinfo=startupinfo, env=environ)</code>. It defaults to <code>shell=False</code>.</span>
<span class="comment-copy">Thanks eryksun, this works great, fixed. If you could do this as an answer I will mark it up as the answer.</span>
<span class="comment-copy">I now have the same sort of issue once I added in another pre command: <a href="http://stackoverflow.com/questions/34879485/popen-set-env-parameter" title="popen set env parameter">stackoverflow.com/questions/34879485/popen-set-env-parameter</a></span>
<span class="comment-copy">I wanted to work out how to fix it with the current Popen.</span>
