<div class="post-text" itemprop="text">
<p>I am trying to use youtube-dl embedded in a script.
I would like it to only download videos from a playlist after a certain date.
But, none of the options I have tried work.
I have tried dateafter and daterange.</p>
<p>Here is what I currently have:</p>
<pre><code>from __future__ import unicode_literals
import youtube_dl
from youtube_dl.utils import DateRange
import os

def prog_hook(d):
    if d['status'] == 'finished':
        path='/home/pi/.temp/Commute/'
        for filename in os.listdir(path):
            if os.path.isdir(os.path.join(path,filename)):
                mvcmd = 'rsync -a --remove-source-files /home/pi/.temp/Commute/{}/ /home/pi/Commute/{}/'.format(filename, filename)
                os.system(mvcmd)
                delcmd = 'rm -r {}'.format(filename)
                os.system(delcmd)

daterange = DateRange('20180601')

ydl_opts = {
    'format' :'bestaudio/best',
        'format' : 'mp4',
        'outtmpl' : '/home/pi/.temp/Commute/%(playlist)s/00%(playlist_index)s-%(title)s.%(ext)s',
        'download_archive' : '/home/pi/.temp/Commute/downloadedShows.txt',
        'ignoreerrors' : 'True',
        'restrictfilenames' : 'True',
        'daterange' : daterange,
        'progress_hooks' : [prog_hook],
        }

with youtube_dl.YoutubeDL(ydl_opts) as ydl:
    try:
        link = ["https://www.youtube.com/playlist?list=PLBZb_61EqeJlvaIUzRne-vxEFhNDLvmga"]
        ydl.download(link)
    except:
        pass
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>The reason the script was not reporting that videos were outside of the date range was because they were in the download archive. 
On videos that had not yet been downloaded everything worked as it should.</p>
</div>
<span class="comment-copy">How do you determine that "it does not work"? For instance, this script skips the <a href="https://www.youtube.com/watch?v=MqpVnYrNnf0" rel="nofollow noreferrer">video MqpVnYrNnf0</a>, which has been uploaded in 2015, just fine. Also, your progress hook is vulnerable to <a href="https://www.owasp.org/index.php/Command_Injection" rel="nofollow noreferrer">command injection</a> (although it is probably mitigated by <code>restrictfilenames</code>). Use <a href="https://docs.python.org/3/library/subprocess.html" rel="nofollow noreferrer"><code>subprocess</code></a> with a list argument instead. In addition, a bare <code>except</code> is a very bad idea, since it suppresses any errors you may have.</span>
<span class="comment-copy">Also, please review the the <a href="https://stackoverflow.com/help/mcve">Stack Overflow help on how to create a minimal example</a>. For instance, do you observe the same problem once you deleted the progress hook? If you remove all options but <code>daterange</code>, does that fix your problem?</span>
<span class="comment-copy">I have not tried deleting the progress or removing all options but date range. It is not working because when I set the date range to just one day it still attempts to download all the videos in the playlist.</span>
<span class="comment-copy">What does <a href="https://gist.githubusercontent.com/phihag/083275da78c38354a1ccb100f8eecb84/raw/4f31e7a5a14fb8ac25a18c08972a7e734e6df720/daterange.py" rel="nofollow noreferrer">this program</a> output for you? For me, the last line is <code>[download] 2015-07-31 upload date is not in range 2018-06-01 - 9999-12-31</code>, and the file is not downloaded. Now, if you compare that problem with yours step-by-step (for instance first adding one option, then more, then the progress hook, and so on), at which step is the video MqpVnYrNnf0 downloaded?</span>
<span class="comment-copy">Turns out the problem was the download archive. Since the videos were already in the download archive from when I first made this script. It didn't check the upload date.</span>
<span class="comment-copy">How does that describe the date range as "not working"? If the video is in the download archive, it's not going to be downloaded anyways, no matter what date is has. Both <code>startdate</code> and <code>daterange</code> only prevent videos from being downloaded; they don't add any more videos. Besides, the primary rationale of <code>download_archive</code> is precisely not having to find out the video upload date. At least, that what my use case when I wrote the code for <code>download_archive</code>.</span>
<span class="comment-copy">I updated the solution to better describe the issue. I was unaware that youtube-dl checked the download archive before it checked the date range. In retrospect it makes sense as then it doesn't have to query the video info to find out the upload date.</span>
