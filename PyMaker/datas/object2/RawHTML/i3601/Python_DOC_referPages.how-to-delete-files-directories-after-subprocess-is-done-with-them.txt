<div class="post-text" itemprop="text">
<p>I am using <a href="https://pypi.org/project/watchdog/" rel="nofollow noreferrer">Watchdog</a> to monitor a directory. If any new directories are added, I want to start subprocesses on those "Source" directories and call a program <code>anon_local</code> on the directories which will output some files.</p>
<p>My question is: What would be an elegant way of deleting the directories and their content after my subprocesses are done with that directory?</p>
<pre><code>class Handler(FileSystemEventHandler):
    @staticmethod
    def on_any_event(event):
        if event.is_directory and event.event_type == 'created':
            PATH = event.src_path
            proc = subprocess.Popen(["python2", "anon_local.py" , PATH, "-t", "target directory", "-csv", "arg", "-p", "arg"])  
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>This can be done with <a href="https://docs.python.org/2/library/shutil.html" rel="nofollow noreferrer"><code>shutil</code></a>'s <a href="https://docs.python.org/2/library/shutil.html#shutil.rmtree" rel="nofollow noreferrer"><code>rmtree</code></a> function. </p>
<p>So long as <code>PATH</code> is the directory you want deleted, just check to make sure your subprocess has finished, and then just run <code>shutil.rmtree(PATH)</code></p>
<p>If you need to wait until your subprocess is done, you can accomplish this by calling <code>.poll()</code> on your <code>proc</code> and waiting for it to return <code>None</code>. For example:</p>
<pre><code>while proc.poll() == None:  # .poll() will return a value once it's complete. 
    time.sleep(1)
[then remove your directory here]
</code></pre>
</div>
<span class="comment-copy">Can you use a <a href="https://docs.python.org/3/library/tempfile.html" rel="nofollow noreferrer">TemporaryDirectory</a>?</span>
<span class="comment-copy">@ndmeiri I would prefer avoiding that.</span>
<span class="comment-copy">Ah! I am assuming (<a href="https://stackoverflow.com/questions/43274476/is-there-a-way-to-check-if-a-subprocess-is-still-running" title="is there a way to check if a subprocess is still running">stackoverflow.com/questions/43274476/â€¦</a>) would be the way to go about checking if process is still running!</span>
<span class="comment-copy">@TheOne yes. i just update my answer to show a way to wait until the subprocess is done before removing your directory.</span>
<span class="comment-copy">Yea works well thanks!</span>
