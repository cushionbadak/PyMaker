<div class="post-text" itemprop="text">
<p>I am trying to extract statistics for an image such as the "mean", "standard-deviation" etc.
However, I cannot find anything related in the python-wand documentation about it.</p>
<p>From the command line I can get such statistics like this:</p>
<pre><code>convert MyImage.jpg -format '%[standard-deviation], %[mean], %[max], %[min]' info:
</code></pre>
<p>or</p>
<pre><code>convert MyImage.jpg -verbose info:
</code></pre>
<p>How to get such info from a python program using wand?</p>
</div>
<div class="post-text" itemprop="text">
<p>Currently, <a class="post-tag" href="/questions/tagged/wand" rel="tag" title="show questions tagged 'wand'">wand</a> doesn't support any of the statistic methods from ImageMagick's C-API (outside of <a href="http://docs.wand-py.org/en/0.3.8/whatsnew/0.3.html#histogram" rel="nofollow">histogram</a> and <a href="http://docs.wand-py.org/en/0.3.8/guide/exif.html" rel="nofollow">EXIF</a>). Luckily the <a href="http://docs.wand-py.org/en/0.3.8/wand/api.html" rel="nofollow">wand.api</a> is offered for extending functionality.</p>
<ol>
<li>Find the <a href="http://www.imagemagick.org/api/magick-image.php#MagickGetImageChannelStatistics" rel="nofollow">method you need</a> in MagickWand's documentation.</li>
<li>Use <a href="https://docs.python.org/3/library/ctypes.html" rel="nofollow">ctypes</a> to implement data types/structures (<a href="https://subversion.imagemagick.org/subversion/ImageMagick/branches/ImageMagick-6.8.9/magick/statistic.h" rel="nofollow">reference header <code>.h</code> files</a>)</li>
</ol>
<pre class="lang-py prettyprint-override"><code>from wand.api import library
import ctypes

class ChannelStatistics(ctypes.Structure):
    _fields_ = [('depth', ctypes.c_size_t),
                ('minima', ctypes.c_double),
                ('maxima', ctypes.c_double),
                ('sum', ctypes.c_double),
                ('sum_squared', ctypes.c_double),
                ('sum_cubed', ctypes.c_double),
                ('sum_fourth_power', ctypes.c_double),
                ('mean', ctypes.c_double),
                ('variance', ctypes.c_double),
                ('standard_deviation', ctypes.c_double),
                ('kurtosis', ctypes.c_double),
                ('skewness', ctypes.c_double)]

library.MagickGetImageChannelStatistics.argtypes = [ctypes.c_void_p]
library.MagickGetImageChannelStatistics.restype = ctypes.POINTER(ChannelStatistics)
</code></pre>
<ol start="3">
<li>Extend <code>wand.image.Image</code>, and use the newly supported methods.</li>
</ol>
<pre class="lang-py prettyprint-override"><code>from wand.image import Image

class MyStatisticsImage(Image):
    def my_statistics(self):
        """Calculate &amp; return tuple of stddev, mean, max, &amp; min."""
        s = library.MagickGetImageChannelStatistics(self.wand)
        # See enum ChannelType in magick-type.h
        CompositeChannels = 0x002F
        return (s[CompositeChannels].standard_deviation,
                s[CompositeChannels].mean,
                s[CompositeChannels].maxima,
                s[CompositeChannels].minima)
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>Just a note to anyone following the excellent suggestion by @emcconville:</p>
<ol>
<li>The documentation on the imagemagick site is for v7.x</li>
<li>Wand will only work with imagemagick 6.x</li>
<li>In IM6.x, there is actually one more field on the end of _ChannelStatistics, a double called entropy, and if you leave it out of your ChannelStatistics declaration your structure won't align properly with what you get back and it'll contain a bunch of nonsense</li>
</ol>
</div>
<span class="comment-copy">Thanks for the answer! I already implemented something similar :)</span>
