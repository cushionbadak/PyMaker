<div class="post-text" itemprop="text">
<div class="question-status question-originals-of-duplicate">
<p>This question already has an answer here:</p>
<ul>
<li>
<a dir="ltr" href="/questions/26944274/valueerror-dict-contains-fields-not-in-fieldnames">ValueError: dict contains fields not in fieldnames</a>
<span class="question-originals-answer-count">
                    3 answers
                </span>
</li>
</ul>
</div>
<p>I've written a script in python to scrape some <code>item names</code>, <code>estimated time</code> along with <code>reviews</code>, <code>reviewers</code> and <code>rating</code> connected to each <code>item name</code> from a webpage using their api and write them to a csv file. The thing is my below script can parse the data accordingly but I can't write them to a csv file.</p>
<p>However, when I try to write them to a csv file I get the following error:</p>
<pre><code>Traceback (most recent call last):
  File "C:\Users\WCS\AppData\Local\Programs\Python\Python36-32\demo000000.py", line 71, in &lt;module&gt;
    w.writerow(reviews)
  File "C:\Users\WCS\AppData\Local\Programs\Python\Python36-32\lib\csv.py", line 155, in writerow
    return self.writer.writerow(self._dict_to_list(rowdict))
  File "C:\Users\WCS\AppData\Local\Programs\Python\Python36-32\lib\csv.py", line 151, in _dict_to_list
    + ", ".join([repr(x) for x in wrong_fields]))
ValueError: dict contains fields not in fieldnames: 'reviews'
</code></pre>
<p>This is what I tried so far:</p>
<pre><code>import csv
import requests

url = "https://eatstreet.com/api/v2/restaurants/{}?yelp_site="

res = requests.get("https://eatstreet.com/api/v2/locales/madison-wi/restaurants")
with open('reviews.csv', 'w', newline='') as f:
    w = csv.DictWriter(f,['name','eta','messg','reviewer','rating'])
    w.writeheader()
    for item in res.json():
        itemid = item['id']
        req = requests.get(url.format(itemid))
        if not 'yelpReviews' in req.json():continue
        reviews = {}
        reviews['name'] = req.json()['name']
        reviews['eta'] = req.json()['waitTime']
        reviews['reviews'] = []
        for texualreviews in req.json()['yelpReviews']:
            reviews_data = {'messg':texualreviews['message'],'reviewer':texualreviews['reviewerName'],'rating':texualreviews['rating']}
            reviews['reviews'].append(reviews_data)
        w.writerow(reviews)
</code></pre>
<p>Any help to write the scraped data in a csv file will be highly appreciated. Thanks.</p>
</div>
<div class="post-text" itemprop="text">
<p>Try changing.</p>
<pre><code>w = csv.DictWriter(f,['name','eta','messg','reviewer','rating'])
</code></pre>
<p>to</p>
<pre><code>w = csv.DictWriter(f,['name','eta', 'reviews','reviewer','rating'])
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>The <a href="https://docs.python.org/3/library/csv.html#csv.DictWriter" rel="nofollow noreferrer">documentation for <code>DictWriter</code></a> states that:</p>
<blockquote>
<p>If the dictionary passed to the <code>writerow()</code> method contains a key not
  found in <em>fieldnames</em>, the optional <em>extrasaction</em> parameter indicates
  what action to take. If it is set to <code>'raise'</code>, the default value, a
  <code>ValueError</code> is raised.</p>
</blockquote>
<p>Your call to <code>writerow()</code> passes the dictionary <code>reviews</code> as the argument, whose keys are <code>name</code>, <code>eta</code>, and <code>reviews</code>. Therefore, the line right below the <code>with</code> statement should be:</p>
<pre class="lang-py prettyprint-override"><code>w = csv.DictWriter(f, ['name', 'eta', 'reviews'])
</code></pre>
<p>Other fields are not necessary; if added they will just be filled in as empty.</p>
</div>
<div class="post-text" itemprop="text">
<pre><code>ValueError: dict contains fields not in fieldnames: 'reviews'
</code></pre>
<p>Above error indicate that while writing to CSV file there is mismatch in mapping values.
Make change in your code as</p>
<pre><code> w = csv.DictWriter(f,['name', 'eta', 'reviews', 'reviewer', 'rating'])

 ...

 for texualreviews in req.json()['yelpReviews']:
   reviews_data = {'reviews':texualreviews['message'],'reviewer':texualreviews['reviewerName'],'rating':texualreviews['rating']}
   reviews['reviews'].append(reviews_data)
   w.writerow(reviews)
</code></pre>
</div>
<span class="comment-copy">@gboffi appreciate your edit I want to highlight changes in bold which is not possible in code part of the answer.</span>
<span class="comment-copy">Sorry, it is not possible to have bold parts in code using markdown.  <i>Maybe</i>  it is possible to do what you want using directly HTML â€” my advice is "it's not necessary".</span>
