<div class="post-text" itemprop="text">
<p>Don't know if the issue is with the python, the telnet library or the router but I just can't seem to get the script running like it should.</p>
<p>It's a simple script that will display the output of the routing table from the router, but somehow if you don't set the command for trap/debug it won't display/print anything at all.</p>
<p>I'm new to programming and just started to learn python, please tell me where I'm making a mistake or is it simply the routers limitation?</p>
<p>The script is fairly simple: </p>
<pre><code>import getpass
import telnetlib
import time

user= "root" 
password = "admin"

print("Router Script")

HOST = "192.168.100.1" #the gateway of the router

tn = telnetlib.Telnet(HOST)

tn.set_debuglevel(7) #the master of puppets 

tn.read_until(b"Login:")
time.sleep(1)
tn.write(user.encode('ascii') + b"\n")

tn.read_until(b"Password:")
tn.write(password.encode('ascii') + b"\n")

tn.read_until(b"WAP&gt;")
tn.write(b"display ip route\n" )

print(tn.read_all().decode('ascii'))
</code></pre>
<p><a href="https://i.stack.imgur.com/UNnaX.png" rel="nofollow noreferrer">This is what the output looks like</a></p>
<p>EDIT:
I'm running it directly on my router using powershell i.e "py.exe C:\script.py" Also the script is written in python 3.0 if I need to mention, and the library is also for that.</p>
<p>Here is the output as text as requested, it's all messy and without any order...</p>
<pre><code>Router Script
Telnet(192.168.100.1,23): recv b'\xff\xfb\x01\xff\xfb\x03\xff\xfb\x18\r\nWelcome Visiting Huawei Home Gateway\r\nC'
Telnet(192.168.100.1,23): IAC WILL 1
Telnet(192.168.100.1,23): IAC WILL 3
Telnet(192.168.100.1,23): IAC WILL 24
Telnet(192.168.100.1,23): recv b'opyright by Huawei Technologies Co., Ltd.\r\n\r\nLogin'
Telnet(192.168.100.1,23): recv b':'
Telnet(192.168.100.1,23): send b'root\n'
Telnet(192.168.100.1,23): recv b'\xff\xfc\x01\xff\xfc\x03'
Telnet(192.168.100.1,23): IAC WONT 1
Telnet(192.168.100.1,23): IAC WONT 3
Telnet(192.168.100.1,23): recv b'root\x07\r\nPassword:'
Telnet(192.168.100.1,23): send b'admin\n'
Telnet(192.168.100.1,23): recv b'\x07'
Telnet(192.168.100.1,23): recv b'\r\nPassword is default value, please modify it!\r\nWA'
Telnet(192.168.100.1,23): recv b'P&gt;'
Telnet(192.168.100.1,23): send b'display ip route\n'
Telnet(192.168.100.1,23): recv b'display ip route\x07'
Telnet(192.168.100.1,23): recv b'\r\n\r\nFlags:[B]lackhole\r\n\r\n-------------------------'
Telnet(192.168.100.1,23): recv b'--------------------------------------------------'
Telnet(192.168.100.1,23): recv b'--------------------------------------------------'
Telnet(192.168.100.1,23): recv b'---\r\nDest/MaskLen            Interface           G'
Telnet(192.168.100.1,23): recv b'ateway             SourceIP            Flags      '
Telnet(192.168.100.1,23): recv b' Metric      Origin              \r\n---------------'
Telnet(192.168.100.1,23): recv b'--------------------------------------------------'
Telnet(192.168.100.1,23): recv b'--------------------------------------------------'
Telnet(192.168.100.1,23): recv b'-------------\r\n0.0.0.0/0               Internet   '
Telnet(192.168.100.1,23): recv b'         --                  --                  -'
Telnet(192.168.100.1,23): recv b'-          10          StaticRoute         \r\nxx.xx.'
Telnet(192.168.100.1,23): recv b'xx.xx/14             VOIP                --         '
Telnet(192.168.100.1,23): recv b'         xx.xx.xx.xx         --          0        '
Telnet(192.168.100.1,23): recv b'   System              \r\nxx.xx.xx.xx/32          I'
Telnet(192.168.100.1,23): recv b'nternet            --                  xx.xx.xx.'
Telnet(192.168.100.1,23): recv b'xx      --          0           System           '
Telnet(192.168.100.1,23): recv b'   \r\n192.168.100.0/24        LocalNetwork        -'
Telnet(192.168.100.1,23): recv b'-                  192.168.100.1       --         '
Telnet(192.168.100.1,23): recv b' 0           System              \r\n---------------'
Telnet(192.168.100.1,23): recv b'--------------------------------------------------'
Telnet(192.168.100.1,23): recv b'--------------------------------------------------'
Telnet(192.168.100.1,23): recv b'-------------\r\nTotal: 4\r\n\r\nsuccess!\r\nWAP&gt;'
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>The problem is that you're calling <a href="https://docs.python.org/3/library/telnetlib.html#telnetlib.Telnet.read_all" rel="nofollow noreferrer"><code>read_all</code></a>:</p>
<blockquote>
<p>Read all data until EOF as bytes; block until connection closed.</p>
</blockquote>
<p>But the router hasn't closed the connection. It just sends you a bunch of bytes ending in this:</p>
<pre><code>success!
WAP&gt;
</code></pre>
<p>And at that point, the router is waiting for another command. </p>
<p>Until you tell it to quit, or close the connection yourself, you're never going to reach EOF.</p>
<p>Which means your code is sitting there waiting for <code>read_all</code> to finish, which will never happen. Presumably, your code just hangs there until you hit Ctrl-C.</p>
<hr/>
<p>What you probably want to do is read until the prompt again:</p>
<pre><code>print(tn.read_until(b"WAP&gt;").decode('ascii'))
</code></pre>
<p>And then maybe <code>close()</code> the connection, or <code>write(b'exit\r\n')</code> or something that will make the router close the connection for you.</p>
</div>
<span class="comment-copy">Please give us the text output as text, not as a shrunk-down screenshot of text.</span>
<span class="comment-copy">Meanwhile, from what you provided, even the <code>print("Router Script")</code> isn't showing up? How are you running this code? (For example, if you're, say, running it like <code>python3 myscript.py &gt;/dev/null</code>, so you can't see stdout and only stderr, then you'd probably get something that looks like this, but in that case, the obvious answer is to not send the output you want to /dev/nullâ€¦)</span>
<span class="comment-copy">@abarnert I have updated my original post, please check it out. If any more info is needed I will provide it. Thanks</span>
<span class="comment-copy">Your router runs Windows, and has Python 3.0 on it? Both of those seem implausible. Even if it <i>is</i> true, is there a reason you can't upgrade it to Python 3.7, or at least 3.2 or so? 3.0 was a big mess that nobody used in production.</span>
<span class="comment-copy">Sorry english isn't my native language, what I meant to say is that I run the script immediately and test it directly to the router which I'm currently connected to. About the python versions, I thought the difference was between 2 and 3 so I just wrote 3... anyways I'm running on python 3.6.</span>
<span class="comment-copy">I've managed to find it on my own...after leaving and being AFK for about 20mins while the script was still runing when I got back on the PC I was greeted with a nice output(without the gibberish). Meanwile Wireshark helped a lot in troubleshooting this issue. But you were 100% about everything, the script hang and the command. Thank you for being patient, and setting the light to this issue. The end command was print(tn.read_until(match=b"WAP&gt;").decode('ascii'))</span>
