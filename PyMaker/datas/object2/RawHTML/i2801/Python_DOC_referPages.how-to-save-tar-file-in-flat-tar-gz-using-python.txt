<div class="post-text" itemprop="text">
<p>I have a tar file with the following structure:</p>
<pre><code>example.tar
--file1
--file2
</code></pre>
<p>and I want to save the file as tar.gz, so it will look like:</p>
<pre><code>example.tar.gz
--file1
--file2
</code></pre>
<p>I tried to use <code>TarFile.add()</code> in <code>tarfile</code> module, but I only managed to create tar.gz file with another hierarchy.</p>
<p>I managed to find only two solutions, which doesn't seems optimal:</p>
<ol>
<li>"un-tar" the file, and then put them in a new "tar.gz" file</li>
<li>calling the following Unix command from the Python script <code>gzip -c example.tar &gt; example.tar.gz</code></li>
</ol>
<p>Is there a batter way of doing it in Python?</p>
</div>
<div class="post-text" itemprop="text">
<p>A <code>tar.gz</code> file is just a <code>tar</code> file that's been <code>gzip</code>ped. As you must know given that you wrote this Unix command:</p>
<pre><code>gzip -c example.tar &gt; example.tar.gz
</code></pre>
<p>If you want to do the same thing from within Python, just use the <a href="https://docs.python.org/3/library/gzip.html" rel="nofollow noreferrer"><code>gzip</code></a> library:</p>
<pre><code>with open('example.tar', 'rb') as inf, gzip.open('example.tar.gz', 'wb') as outf:
    shutil.copyfileobj(inf, outf)
</code></pre>
<p>In fact, this is directly equivalent to one of the <a href="https://docs.python.org/3/library/gzip.html#examples-of-usage" rel="nofollow noreferrer">Examples of Usage</a> in the docs.</p>
<p>Is this optimal?</p>
<ul>
<li>We're avoiding the untarring and tarring part. Which is pretty minimal work (<code>tar</code> is a dead-simple formatâ€¦), but not zero.</li>
<li>We obviously have to read every byte of the tarball, and you have to write every byte of the gzipped tarball, but we want to avoid reading the whole file at once (which might use up all your RAM) or reading so little at a time that you can't keep the disk moving. <code>copyfileobj</code> takes care of that for you.</li>
</ul>
<p>So, it's pretty much exactly the same work that the <code>gzip</code> tool does. But we're not creating a child process, and we're not relying on a tool that might not be there (e.g., on Windows, or iOS, or in some really weird scenario where you created a chroot that has python but not gzip).</p>
</div>
<span class="comment-copy">I obviously missed the example of usageyou mentioned. this is the solution I was looking for, Thanks</span>
