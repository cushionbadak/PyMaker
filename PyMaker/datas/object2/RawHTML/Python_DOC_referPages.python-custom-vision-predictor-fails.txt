<div class="post-text" itemprop="text">
<p>I'm using Python to retrieve a Blob image from Azure storage and then send it to Custom Vision for a prediction.
This is the code:</p>
<pre><code>import io
from azure.storage.blob import BlockBlobService
from azure.cognitiveservices.vision.customvision.prediction import CustomVisionPredictionClient



block_blob_service = BlockBlobService(
    account_name=account_name,
    account_key=account_key
)

fp = io.BytesIO()
block_blob_service.get_blob_to_stream(
    container_name, 
    blob_name, 
    fp, 
    max_connections=2
)

predictor = CustomVisionPredictionClient(
    cv_prediction_key, 
    endpoint=cv_endpoint
)

# This call breaks with the below error message
results = predictor.predict_image(
    cv_project_id,
    image_data.getvalue(),
    iteration_id=cv_iteration_id
)
</code></pre>
<p>However, executing the <code>predict_image</code> function results in the following error:</p>
<pre><code>System.Private.CoreLib: Exception while executing function: Functions.ReloadPostgres. System.Private.CoreLib: Result: Failure
Exception: HttpOperationError: Operation returned an invalid status code 'Resource Not Found'
Stack:   File "~/.local/share/virtualenvs/py_func_app-GVYYSfCn/lib/python3.6/site-packages/azure/functions_worker/dispatcher.py", line 288, in _handle__invocation_request
    self.__run_sync_func, invocation_id, fi.func, args)
  File "~/.pyenv/versions/3.6.8/lib/python3.6/concurrent/futures/thread.py", line 56, in run
    result = self.fn(*self.args, **self.kwargs)
  File "~/.local/share/virtualenvs/py_func_app-GVYYSfCn/lib/python3.6/site-packages/azure/functions_worker/dispatcher.py", line 347, in __run_sync_func
    return func(**params)
  File "~/py_func_app/ReloadPostgres/__init__.py", line 14, in main
    data_handler.fetch_prediction_data()
  File "~/py_func_app/Shared_Code/data_handler.py", line 127, in fetch_prediction_data
    cv_handler.predict_image(image_data.getvalue(), cv_model)
  File "~/py_func_app/Shared_Code/custom_vision.py", line 30, in predict_image
    raise e
  File "~/py_func_app/Shared_Code/custom_vision.py", line 26, in predict_image
    iteration_id=cv_model.cv_iteration_id
  File "~/.local/share/virtualenvs/py_func_app-GVYYSfCn/lib/python3.6/site-packages/azure/cognitiveservices/vision/customvision/prediction/custom_vision_prediction_client.py", line 215, in predict_image
    raise HttpOperationError(self._deserialize, response)
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>Here in below i am providing similar example using custom vision prediction using image URL, you can change it to image file :</p>
<p><div class="snippet" data-babel="false" data-console="true" data-hide="false" data-lang="js">
<div class="snippet-code">
<pre class="snippet-code-js lang-js prettyprint-override"><code># -*- coding: utf-8 -*-
"""
Created on Tue Mar 19 11:04:54 2019

@author: moverm
"""
#from azure.storage.blob import BlockBlobService
from azure.cognitiveservices.vision.customvision.prediction import CustomVisionPredictionClient


#block_blob_service = BlockBlobService(
#    account_name=account_name,
#    account_key=account_key
#)
#
#fp = io.BytesIO()
#block_blob_service.get_blob_to_stream(
#    container_name, 
#    blob_name, 
#    fp, 
#    max_connections=2
#)

predictor = CustomVisionPredictionClient(
    "prediction-key", 
    endpoint="https://southcentralus.api.cognitive.microsoft.com"
)
# This call breaks with the below error message
#results = predictor.predict_image(
#    'prediction-key',
#    image_data.getvalue(),
#    iteration_id=cv_iteration_id
#)
test_img_url = "https://pointsprizes-blog.s3-accelerate.amazonaws.com/316.jpg"
results = predictor.predict_image_url("project-Id", "Iteration-Id", url=test_img_url)

# Display the results.
for prediction in results.predictions:
    print ("\t" + prediction.tag_name + ": {0:.2f}%".format(prediction.probability * 100))</code></pre>
</div>
</div>
</p>
<p>Basically issue is related to endpoint.Use <a href="https://southcentralus.api.cognitive.microsoft.com" rel="nofollow noreferrer">https://southcentralus.api.cognitive.microsoft.com</a> for an endpoint.</p>
<p>It should work, and you should be able to see the prediction probability.</p>
<p>Hope it helps.</p>
<hr/>
</div>
<div class="post-text" itemprop="text">
<p>I tried to reproduce your issue and got a similar issue, which was caused by using the incorrect endpoint from Azure portal when I created a Cognitive Service on the region of Janpa East, as the figure below.</p>
<p><a href="https://i.stack.imgur.com/uCTlM.png" rel="nofollow noreferrer"><img alt="enter image description here" src="https://i.stack.imgur.com/uCTlM.png"/></a></p>
<p>As the figure above shown, the endpoint is <code>https://japaneast.api.cognitive.microsoft.com/customvision/training/v1.0</code> for version 1, but the <a href="https://pypi.org/project/azure-cognitiveservices-vision-customvision/" rel="nofollow noreferrer"><code>azure-cognitiveservices-vision-customvision</code></a> PyPI page points out the corrent endpoint which should be <code>https://{AzureRegion}.api.cognitive.microsoft.com</code> as the figure below.</p>
<p><a href="https://i.stack.imgur.com/5qsK7.png" rel="nofollow noreferrer"><img alt="enter image description here" src="https://i.stack.imgur.com/5qsK7.png"/></a></p>
<p>So I got the similar issue with yours if using the incorrent endpoint, as below. My code used is the same as yours, the only difference is the running environment which yours is on Azure Functions, but mine is a console script.</p>
<p><a href="https://i.stack.imgur.com/rq6qp.png" rel="nofollow noreferrer"><img alt="enter image description here" src="https://i.stack.imgur.com/rq6qp.png"/></a></p>
<p>Meanwhile, according to the source code <code>custom_vision_prediction_client.py</code> of Azure Cognitive Service SDK for Custom Vision, you can see the code <a href="https://github.com/Azure/azure-sdk-for-python/blob/master/azure-cognitiveservices-vision-customvision/azure/cognitiveservices/vision/customvision/prediction/custom_vision_prediction_client.py#L38" rel="nofollow noreferrer"><code>base_url = '{Endpoint}/customvision/v2.0/Prediction'</code></a> to concat your passed endpoint with <code>/customvision/v2.0/Prediction</code> to generate the real endpoint for calling prediction api.</p>
<p>Therefore, as @MohitVerma-MSFT said, using <code>https://&lt;your cognitive service region&gt;.api.cognitive.microsoft.com</code> for the current version of Python package.</p>
<p>Additional notes as below, there is an announce of important update for <code>customvision.ai</code> you need to know, it may make effect for your current code working soon after.</p>
<p><a href="https://i.stack.imgur.com/QAms1.png" rel="nofollow noreferrer"><img alt="enter image description here" src="https://i.stack.imgur.com/QAms1.png"/></a></p>
</div>
<span class="comment-copy">Please accept it as an answer if it helped.</span>
