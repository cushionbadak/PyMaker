<div class="post-text" itemprop="text">
<p>I'm trying to use the sh library for Python3 to run a command as another user. But I'm not getting any output and the command ran appears correct. Anybody know how to get this to work?</p>
<p><strong>Edit:</strong> It does return an error code of 1.</p>
<p><strong>Code:</strong></p>
<pre><code>passwd = input('Enter pass:')
passwd = r'{0}\n'.format(passwd)

my_user = sh.sudo.bake('-S', '-u', 'www-data', _in=passwd)
try:
    a = my_user.ls('/home/dev/xxxxxx/html/')
    print(a)
except Exception as e:
    print('\n\n{0}'.format(e))
</code></pre>
<p><strong>Output:</strong></p>
<pre><code>dev@node:~/scripts$ ./backup.py
Enter pass:xxxxxxx

  RAN: /usr/bin/sudo -S -u www-data ls /home/dev/xxxxxxx/html/

  STDOUT:

  STDERR:
[sudo] password for dev:

dev@node:~/scripts$
</code></pre>
<p><strong>Manually Ran:</strong></p>
<pre><code>dev@node:~/scripts$ /usr/bin/sudo -S -u www-data ls /home/dev/xxxxxxx/html/
[sudo] password for dev:
index.php        wp-admin              wp-config-sample.php  wp-links-opml.php  wp-settings.php
license.txt      wp-blog-header.php    wp-content            wp-load.php        wp-signup.php
readme.html      wp-comments-post.php  wp-cron.php           wp-login.php       wp-trackback.php
wp-activate.php  wp-config.php         wp-includes           wp-mail.php        xmlrpc.php
dev@node:~/scripts$
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>I ended up not using sh to change user. Instead I adjusted permissions or groups of the system and ran sudo -u $user ./script.py. Where the $user has rights to the files used in the script. </p>
</div>
