<div class="post-text" itemprop="text">
<p>This is my current code to test if a host is SSH-able. It works just fine when the host is up with or without SSH service running. However, it seems to just hang when the host crashes, which is the unique usecase that I need to depend on it giving me a quick True/False response. Due to OS and other dependencies, we need to keep the Python version to 2.6 for now. So I need a way to get this function to work and with a timeout of 1-2s.</p>
<pre><code>import commands

def test_ssh(host):
    output = commands.getstatusoutput("ssh " + host + " hostname")
    if output[0] == 0:
        return True
    else:
        print(host + " not accessible via SSH!")
        return False
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>You need to determine if it is actually a connect timeout, or if it can connect, but the server is accepting the connection and doesn't send anything.</p>
<p>If you were to use telnet to manually test, telnet  22 and see if you get a response from the server at all, you should see something like this if it connects:</p>
<pre>
$ telnet localhost 22
Connected to localhost.
Escape character is '^]'.
SSH-2.0-OpenSSH_7.2
</pre>
<p>If it connects and you don't get any response, then I think you will have to try a test using sockets in python. </p>
<p>You can find info here: 
<a href="https://docs.python.org/3/library/socket.html" rel="nofollow">https://docs.python.org/3/library/socket.html</a></p>
</div>
<div class="post-text" itemprop="text">
<p>If you want to be sure that an SSH connection (including authentication) can be established correctly, the best way probably is to connect in batch mode with a small timeout (<code>-o BatchMode=yes -o ConnectTimeout=2</code>).</p>
</div>
<div class="post-text" itemprop="text">
<p>you could wrap your call to <code>ssh</code> into <code>timelimit</code> so it gets cancelled after a certain timeout if it does not finish on time.</p>
<ul>
<li>homepage: <a href="http://devel.ringlet.net/sysutils/timelimit/" rel="nofollow">http://devel.ringlet.net/sysutils/timelimit/</a></li>
<li>manpage: <a href="http://manpages.ubuntu.com/manpages/xenial/man1/timelimit.1.html" rel="nofollow">http://manpages.ubuntu.com/manpages/xenial/man1/timelimit.1.html</a></li>
</ul>
</div>
<span class="comment-copy">Does <code>ssh -o ConnectTimeout=5 ...</code> work?</span>
<span class="comment-copy">I'll give it a try. The flag works just fine, and I added BatchMode per suggestion below. However, I am unable to reproduce the state the server was in when it had crashed on demand so I cannot say for sure until it happens again.</span>
<span class="comment-copy">I got the function working with socket. Since I cannot reproduce the state of the server on demand. I am unable to determine if this is guarantee to work given the state it may be in.</span>
<span class="comment-copy">Thank you for the suggestion. I'll give it a try. The flags works as expected, though I will only know for sure if it works given the server had crashed the next time it happens.</span>
