<div class="post-text" itemprop="text">
<p>I have written a Python class that cannot possibly support pickling. Still, every now and then a user tries to pickle instances of this class, which leads to confusing errors. Therefore I wish to throw a custom, informative error message whenever any attempts to pickle instances of my class are made.</p>
<p>How do I best go about doing this?
I am particularly interested in solutions that have a broad coverage, i.e., do not only work for the standard-library <code>pickle</code> but also for alternatives to it.</p>
<p><em>As to what I’ve found so far, I’ll write <a href="https://stackoverflow.com/a/53021038/2127008">a self-answer</a>, but I am not sure whether that’s the best way.</em></p>
</div>
<div class="post-text" itemprop="text">
<p>From reading the documentation, I gathered that if the class has a <a href="https://docs.python.org/3/library/pickle.html#object.__getstate__" rel="nofollow noreferrer"><code>__getstate__</code></a> method, it will be called when a pickling attempt is made. Therefore, a solution is to overwrite this method to raise an exception, for example:</p>
<pre><code>import pickle

class Foo(object):
    def __getstate__(self):
        raise pickle.PickleError("No pickling for Foo.")
</code></pre>
<p>This appears to work:</p>
<pre><code>some_foo = Foo()
try:
    pickle.dumps(some_foo)
except pickle.PickleError:
    print("Error raised.")
else:
    raise AssertionError("Error not raised")
</code></pre>
</div>
<span class="comment-copy">You can catch more serializers by throwing the exception in <a href="https://docs.python.org/3/library/pickle.html#object.__reduce__" rel="nofollow noreferrer"><code>__reduce__</code></a>, but since that method is used by the copy protocol, things like <a href="https://docs.python.org/3/library/copy.html#copy.copy" rel="nofollow noreferrer"><code>copy.copy</code></a> will also stop working with your class. That can be fixed by implementing a <code>__copy__</code> method though (see the <a href="https://docs.python.org/3/library/copy.html" rel="nofollow noreferrer"><code>copy</code></a> module docs for details).</span>
