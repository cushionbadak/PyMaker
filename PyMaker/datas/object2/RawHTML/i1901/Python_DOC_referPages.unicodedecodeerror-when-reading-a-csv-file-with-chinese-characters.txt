<div class="post-text" itemprop="text">
<p>I'm trying to index a Chinese csv as document in Elasticsearch. The data in the CSV starts with the following bytes:</p>
<pre><code>b'Chapter,Content,Score\r\n1.1.1,\xacO\xa7_\xa4w\xc5\xe7\xc3\xd2\xab~\xbd\xe8\xa8t\xb2\xce\xa9\xd2\xbb\xdd\xaa\xba\xa6U\xb6\xb5\xba\xde\xa8\xee\xacy\xb5{\xa1H,1\r\n1.1.2,\xab~\xbd\xe8\xba\xde\xb2z\xa8t\xb2\xce\xacO\xa7_\xb2\xc5\xa6XISO\xbc\xd0\xb7\xc7\xaa\xba\xadn\xa8D\xa1H,1\r\n'
</code></pre>
<p>And the code is simple as below</p>
<pre><code>import csv
import json
import pandas as pd
from elasticsearch import Elasticsearch
es=Elasticsearch("https://xxx.us-east-1.es.amazonaws.com/")
from elasticsearch import helpers
import codecs
def csv_reader(file_name):
es = Elasticsearch("https://xxx.us-east-1.es.amazonaws.com/")
with codecs.open(file_name, 'r', 'utf-8') as outfile:
    reader = csv.DictReader(outfile)
    helpers.bulk(es, reader, index="checklist", doc_type="quality")
if __name__ == "__main__":
with open('checklist1.csv') as f_obj:
    csv_reader('checklist1.csv')
</code></pre>
<p>And then error message below:   </p>
<pre><code>UnicodeDecodeError: 'utf-8' codec can't decode byte 0xac in position 0: invalid start byte
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>The file is not UTF8-encoded, which is pretty clear from the error. Opening the csv with an editor suggested that it might be <code>latin2</code>, which is clearly wrong because that doesn't include Chinese characters. Sure enough, using that encoding "works" (doesn't raise an error) but is gibberish:</p>
<pre><code>Chapter,Content,Score
1.1.1,ŹO§_¤wĹçĂŇŤ~˝č¨t˛ÎŠŇťÝŞşŚUśľşŢ¨îŹyľ{ĄH,1
</code></pre>
<p>Looking at the <a href="https://docs.python.org/3/library/codecs.html#standard-encodings" rel="nofollow noreferrer">standard encodings shipping with python</a> there's <code>big5</code> and <code>big5hkscs</code> which are for Traditional Chinese. Both of which give the same result when <code>print</code>ed:</p>
<pre><code>Chapter,Content,Score
1.1.1,是否已驗證品質系統所需的各項管制流程？,1
</code></pre>
<p>Whether that makes any sense can only be answered by someone who speaks Chinese, but the fact that the conversion succeeded without errors is a bit promising.</p>
</div>
<div class="post-text" itemprop="text">
<p>Here's a reproducible example of your issue.  You must use the correct encoding.  Note <code>codecs</code> is an old module and the built-in <code>open</code> in Python 3 works with encodings directly:</p>
<pre><code>import csv

s = b'Chapter,Content,Score\r\n1.1.1,\xacO\xa7_\xa4w\xc5\xe7\xc3\xd2\xab~\xbd\xe8\xa8t\xb2\xce\xa9\xd2\xbb\xdd\xaa\xba\xa6U\xb6\xb5\xba\xde\xa8\xee\xacy\xb5{\xa1H,1\r\n1.1.2,\xab~\xbd\xe8\xba\xde\xb2z\xa8t\xb2\xce\xacO\xa7_\xb2\xc5\xa6XISO\xbc\xd0\xb7\xc7\xaa\xba\xadn\xa8D\xa1H,1\r\n'

# Create a file with your sample byte string
with open('checklist.csv','wb') as f:
    f.write(s)

# Open it with the correct encoding and newline requirements for using DictReader.
with open('checklist.csv',encoding='big5',newline='') as f:
    r = csv.DictReader(f)
    for line in r:
        print(line['Content'])
</code></pre>
<p>Output:</p>
<pre><code>是否已驗證品質系統所需的各項管制流程？
品質管理系統是否符合ISO標準的要求？
</code></pre>
</div>
<span class="comment-copy">Please fix your indentation. And remove unnecessary imports; <code>csv</code> and <code>json</code> and <code>pandas</code> all seem superfluous.</span>
