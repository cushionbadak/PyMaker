<div class="post-text" itemprop="text">
<p>I have written the program but it apparently does not work. I mean that last part of the code. The program is creating the file and adding some stuff to csv file. The last part of the code should add some more data to the already existing file but every time I want to run this program I have got this kind of error:</p>
<pre><code>Traceback (most recent call last):
  File "/Users/grzegorzspytek/Desktop/Sending_automated_mails/nw_csv.py", line 121, in &lt;module&gt;
    for row in reader:
  File "/Library/Frameworks/Python.framework/Versions/3.7/lib/python3.7/csv.py", line 111, in __next__
    self.fieldnames
  File "/Library/Frameworks/Python.framework/Versions/3.7/lib/python3.7/csv.py", line 98, in fieldnames
    self._fieldnames = next(self.reader)
_csv.Error: iterator should return strings, not bytes (did you open the file in text mode?)
</code></pre>
<p>After that, I changed "open mode" from "rb" to "r+"</p>
<pre><code>Traceback (most recent call last):
  File "/Users/grzegorzspytek/Desktop/Sending_automated_mails/nw_csv.py", line 125, in &lt;module&gt;
    "Email": row["Email"]
  File "/Library/Frameworks/Python.framework/Versions/3.7/lib/python3.7/csv.py", line 155, in writerow
    return self.writer.writerow(self._dict_to_list(rowdict))
  File "/Library/Frameworks/Python.framework/Versions/3.7/lib/python3.7/tempfile.py", line 481, in func_wrapper
    return func(*args, **kwargs)
TypeError: a bytes-like object is required, not 'str' 
</code></pre>
<p>It looks like I was asked to change it back, but every time I do that the errors occur alternately. Any solution for that?</p>
<p>Here is the code of my program:</p>
<pre><code>import csv
import shutil
import os
from tempfile import NamedTemporaryFile


def get_len(path):
    with open(path, "r") as csvfile:
        reader = csv.reader(csvfile)
        read_list = list(reader)
    return len(read_list)

#check if this is the file,
def append_data(path, name, email):
    if not os.path.isfile(path):
        with open(path, "w") as csvfile:
            fieldnames = ["ID", "Name", "Email"]
            writer = csv.DictWriter(csvfile, fieldnames = fieldnames)
            writer.writeheader()
            print("Creating file...")

    with open(path, "a") as csvfile:
        fieldnames = ["ID", "Name", "Email"]
        writer = csv.DictWriter(csvfile, fieldnames = fieldnames)
        writer.writerow({
            "ID": get_len(path),
            "Name": name,
            "Email": email
        })
        print("Adding data for " + name)



path = "/Users/grzegorzspytek/Desktop/Sending_automated_mails/data.csv"
append_data(path, "grzesiek", "grz.spy")

filename = "data.csv"
temp_file = NamedTemporaryFile(delete=False)





with open("data.csv", "rb") as csvfile, temp_file:
    reader = csv.DictReader(csvfile)
    fieldnames = ["ID", "Name", "Email"]
    writer = csv.DictWriter(temp_file, fieldnames = fieldnames)
    for row in reader:
        writer.writerow({
            "ID": row["ID"],
            "Name": row["Name"],
            "Email": row["Email"]
        })
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>You should open your temporary file in text mode instead:</p>
<pre><code>temp_file = NamedTemporaryFile(mode='w+', delete=False)
</code></pre>
<p>Otherwise the temporary file is opened in binary mode by default as <a href="https://docs.python.org/3/library/tempfile.html#tempfile.NamedTemporaryFile" rel="nofollow noreferrer">documented</a>.</p>
</div>
<span class="comment-copy">Unfortunately it is still not working the same error like before:  Traceback (most recent call last)   File "/Users/grzegorzspytek/Desktop/ python/Sending_automated_mails/nw_csv.py", line 125, in &lt;module&gt;     "Email": row["Email"]   File "/Library/Frameworks/Python.framework/Versions/3.7/lib/python3.7/csv.py", line 155, in writerow     return self.writer.writerow(self._dict_to_list(rowdict))   File "/Library/Frameworks/Python.framework/Versions/3.7/lib/python3.7/tempfile.py", line 481, in func_wrapper     return func(*args, **kwargs) TypeError:abytes-like object is required, not 'str'</span>
<span class="comment-copy">I see. I've updated my answer with a more fitting solution.</span>
<span class="comment-copy">Did you try it out? I put it into the compiler and got the error asking for the string instead of bytes.</span>
<span class="comment-copy">Yes I did. After specifying the mode to <code>w+</code>, it works. The default mode is <code>w+b</code> for binary mode and that is why <code>csv.writer</code> raises the exception in your code.</span>
<span class="comment-copy">I added the line you gave up above and changed open("rb") to open("r+"). It's working now. Thanks.</span>
