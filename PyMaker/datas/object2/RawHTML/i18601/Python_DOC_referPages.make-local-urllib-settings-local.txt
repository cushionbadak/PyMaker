<div class="post-text" itemprop="text">
<p>I have a multi-threaded process. And for each thread, the following code is ran; however, it overwrites the proxy used for each thread to the latest proxy added. Is there a way I can make this proxy-settings local to the thread?</p>
<pre><code>        self.p_handler = urllib.request.ProxyHandler({'http' : self.proxy})
        self.opener = urllib.request.build_opener(self.p_handler)
        urllib.request.install_opener(self.opener)
        urllib.request.urlretrieve(url, filename)
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>Instead of using <code>install_opener</code> (which installs it globally), just call the <code>open</code> method of your <code>opener</code> object, and then transfer the results into a file.</p>
<pre><code>self.p_handler = urllib.request.ProxyHandler({'http' : self.proxy})
self.opener = urllib.request.build_opener(self.p_handler)
result = self.opener.open(url)
with open(filename, 'wb') as f:
    for chunk in iter(lambda: result.read(1024), ''):
        f.write(chunk)
</code></pre>
<p>The last 2 lines here are just to avoid having to hold the entire file in memory; they allow it to stream through in kilobyte-sized chunks. If you don't mind having it in memory, the last bit gets simpler:</p>
<pre><code>result = self.opener.open(url)
with open(filename, 'wb') as f:
    f.write(result.read())
</code></pre>
</div>
<span class="comment-copy">Ah, didn't see I could do that directly. Thank you. :)</span>
<span class="comment-copy">The opener object does not have the function "retrieve." <a href="http://puu.sh/3KnGf.png" rel="nofollow noreferrer">puu.sh/3KnGf.png</a></span>
<span class="comment-copy">Oh, right, forgot that <code>urlretrieve</code> was deprecated. I think the preferred way to do this now is to use <code>open()</code> and read the contents from it, writing them into a file. If you really don't want to do that, however, you can create your own <code>URLopener</code> object: <a href="http://docs.python.org/3/library/urllib.request.html#urllib.request.URLopener" rel="nofollow noreferrer">docs.python.org/3/library/â€¦</a></span>
