<div class="post-text" itemprop="text">
<p>I've been testing the OpenERP import on the products table.  I have 25k+ products to import and the OpenERP import is really, really slow... so, I came across a script that does a direct import into PostgresQL.  I tried it and I'm getting a "bad magic number" error.  I watched this vid:  <a href="http://www.firstclasscomputerconsulting.com/OpenERP/OpenERP70Videos/tabid/145/articleType/ArticleView/articleId/3/Import-data-into-OpenERP-7-using-direct-PostGRES-method.aspx" rel="nofollow">http://www.firstclasscomputerconsulting.com/OpenERP/OpenERP70Videos/tabid/145/articleType/ArticleView/articleId/3/Import-data-into-OpenERP-7-using-direct-PostGRES-method.aspx</a>  which uses the same script and I'm doing exactly the same thing.</p>
<p>My import file looks like this:</p>
<pre><code>Rabbit Patch 6x10 Chart/Black,0.01,0.01
DAZL-HARES EAR DK DUN PER LB,0.01,0.01
SQUIRREL DUBBING MED H.E./LB!,0.01,0.01
</code></pre>
<p>I created both the py file and the .csv using Zeus for windows.</p>
<p>I read the other threads on this error on this site, but I didn't see any references to this problem in conjunction with OpenERP.</p>
<p>Here's the script:</p>
<pre><code>import csv
import psycopg2

conn_string = "dbname='OpenERP' user='openpg' password='openpgpwd'"

conn = psycopg2.connect(conn_string)
cursor = conn.cursor()

reader = csv.reader(open('products_import.csv','rb'))

for row in reader:
    print row[1]

    statement = "INSERT INTO product_template (name,standard_price,list_price,mes_type,uom_id,uom_po_id," \
    "type,procure_method,cost_method,categ_id,supply_method,sale_ok) VALUES ('" + row[1] + "'," \
    + str(row[2]) + "," + str(row[2]) + ",'fixed',1,1,'product','make_to_stock','standard',1,'buy',True) RETURNING id"

    cursor.execute(statement)
    conn.commit()
    templateid = cursor.fetchone()[0]

    statement = "INSERT INTO product_product (product_tmpl_id,default_code,active,valuation) VALUES \
    (" + str(templateid) + ",'" + row[0] + "',True,'manual_periodic')"

    cursor.execute(statement)
    conn.commit()
</code></pre>
<p>Any suggestions?</p>
<p>I copied the py file and the csv into my Python33 directory and tried from there, now I get a syntax error on the "print row[1]" line... wth?</p>
</div>
<div class="post-text" itemprop="text">
<p>The bad magic number error is not specific to OpenERP at all, it's related to Python internals.</p>
<p>As you've probably read in other questions, it's often a symptom of using Python <code>.pyc</code> files produced with a different version of Python. Have you made sure all to delete all the <code>*.pyc</code> or <code>*.pyo</code> files that you can find next to your Python script, as explained e.g. <a href="https://stackoverflow.com/questions/514371/whats-the-bad-magic-number-error">in this other question</a>?
If you've initially tried to run the script with Python 3 (and failed because of the syntax error), you need to delete these artifacts before you can run them with Python 2.</p>
<p>As for the syntax error you get when you try to run the script with Python 3, it's because your script uses Python 2 syntax. In Python 3 <code>print</code> is not a keyword anymore, it's builtin function that you need to call like a normal function:</p>
<pre><code>print(row[1])
</code></pre>
<p>You can start with <a href="http://docs.python.org/dev/howto/pyporting.html#use-2to3" rel="nofollow noreferrer">this guide</a> if you want to convert your code to Python 3, but it's not trivial if you're not familiar with Python concepts like encoding, bytestrings vs unicode strings, etc., especially when file reading operations are involved, like here.
In your script you would typically need to correct the <code>print</code> call and change the <code>open</code> to this form (as indicated in <a href="http://docs.python.org/3/library/csv.html#examples" rel="nofollow noreferrer">the documentation</a>):</p>
<pre><code>reader = csv.reader(open('products_import.csv', 'r', newline=''))
</code></pre>
</div>
<span class="comment-copy">Ok, the version difference was obvious and I just didn't think about it - OpenERP runs 2.6.or 2.7 and that's what I should have tried - it's been a long week  :)  I'm going to try it on a completely different machine that hasn't had any other Python versions installed and see what happens.  I will post results.  Thanks for your help!</span>
<span class="comment-copy">Update:  I ran the script on a different machine with a clean install of openerp.  i took out the insert statements and just had the script print the csv lines. it ran fine the first time, no bad magic number error or syntax error, watched it scroll through 12k+ lines in a few seconds...  the second time i ran it, it just opened up the script with the editor... what's up with that?  starting to hate python...</span>
