<div class="post-text" itemprop="text">
<p>Here is my code that connects to gmail and parses the emails:</p>
<pre><code>import imaplib
from email.parser import HeaderParser

conn = imaplib.IMAP4_SSL('imap.gmail.com')
conn.login('example@gmail.com', 'password')
conn.select()
conn.search(None, 'ALL')
data = conn.fetch('1', '(BODY[HEADER])')
header_data = data[1][0][1]
parser = HeaderParser()
msg = parser.parsestr(header_data)
</code></pre>
<p>At this stage i get the error message "TypeError: initial_value must be str or None, not bytes"</p>
<p>Im using python 3. How do i convert the result to a string so ican parse the headers using parser.parsestr?</p>
</div>
<div class="post-text" itemprop="text">
<p>Replace </p>
<pre><code>header_data = data[1][0][1]
</code></pre>
<p>with </p>
<pre><code>header_data = data[1][0][1].decode('utf-8')
</code></pre>
<p>That should make it work on Python 3.x.x</p>
<p>This is one of the pain points of migrating code to make it Python 3, but once you understand it, it is very easy to fix. Also, if you make that change, it will break compatibility with python 2.x.x</p>
<p>In python 3 all strings are unicode, and if you receive bytes, you have to first convert them to <code>str</code> data type. <a href="https://docs.python.org/3/howto/unicode.html" rel="nofollow">You can read more about that here</a></p>
</div>
<span class="comment-copy">Thanks mate. Last thing, where i have data = conn.fetch('1', '(BODY[HEADER])'). Instead of 1, how can i select all the emails?</span>
<span class="comment-copy">not sure, if its a separate question, please qualify it with a code example to illustrate the issue and post as a new question. Also, if this answer helped solve your question, please mark it accepted to let the community know. cheers.</span>
