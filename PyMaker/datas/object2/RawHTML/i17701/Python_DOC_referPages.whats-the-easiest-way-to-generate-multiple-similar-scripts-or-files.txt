<div class="post-text" itemprop="text">
<p>I've been submitting multiple matlab scripts to a cluster as an array job, which is efficient. But I've been generating each of the scripts manually! For say <code>x = 1:1000</code>, I would like to change:</p>
<p>filename = <code>foo_x.m</code></p>
<p>and parameters within the mscript</p>
<pre><code>a = x;
b = 'x_1';
c = 'x_2';
</code></pre>
<p>I.e. the task is to generate multiple files which are exactly the same, except for their values of x. x appears both within the script and the filename.</p>
<p>I have a small amount of experience with python, sed and vim. Any suggestions on the best way to tackle a task like this, or any tutorials out there? </p>
</div>
<div class="post-text" itemprop="text">
<p>A quick solution in Matlab using <a href="http://www.mathworks.es/es/help/matlab/ref/diary.html" rel="nofollow"><code>diary</code></a>:</p>
<pre><code>for x = 1:1000
    diary(['foo_' num2str(x) '.m' ])
    disp(['a = ' num2str(x) ';'])
    disp(['b = ''' num2str(x) '_1'';'])
    disp(['c = ''' num2str(x) '_2'';'])
    diary off
    disp(' ')
end
</code></pre>
<p>If you need file names of the form "foo_0001.m" (i.e. fill numbers with zeros to the left), replace the first line within the loop by</p>
<pre><code>    diary(['foo_' num2str(x,'%.4d') '.m' ])
</code></pre>
</div>
<div class="post-text" itemprop="text">
<h2>Python solution</h2>
<p>Use <a href="http://docs.python.org/3/library/stdtypes.html#str.format" rel="nofollow"><code>str.format</code></a>. </p>
<p>In the following code <code>template</code> contains <code>{0}</code>. Think of it as placeholder. Using <code>str.format</code>, you can replace that with argument with the first argument of the <code>str.format</code>.</p>
<pre><code>template = '''
a = {0};
b = '{0}_1';
b = '{0}_2';
'''

for x in range(1, 1000+1): # loop from 1 to 1000
    with open('foo_{}.m'.format(x), 'w') as f: # Open file ("w"rite mode)
        f.write(template.format(x)) # render the template string
                                    #  replacing placeholder (`{0}`)
</code></pre>
<p>Replace <code>foo_{}.m</code> with <code>foo_{:04}.m</code> if you want filenames look like <code>foo_0012.m</code> instead of <code>foo_12.m</code>.</p>
</div>
<span class="comment-copy">This sounds strange.  Are you sure there's no way in your cluster software to submit a MATLAB function with a varying parameter?  Or to extract the job number from inside the MATLAB script and use that to select x?  Or to access and modify a shared file with a running value for x?</span>
<span class="comment-copy">Aha yeah these are definitely great suggestions and will make my directories nicer to look in! The way i did it was my natural progression from submitting each (embarrassingly parallel) job via qsub, to submitting them all together in an array job.</span>
<span class="comment-copy">love this thanks. didn't realise matlab had such capabilities</span>
<span class="comment-copy">Oh, but you have to put <code>disp('')</code> around every single line you want in the files?</span>
<span class="comment-copy">Yes. <code>disp</code> displays its input string on the command window; and <code>diary</code> saves to disk whatever is shown on the command window</span>
