<div class="post-text" itemprop="text">
<p>I have some source where I am trying to remove some tags, I do know that using regular expression for removing tags and such is not advised but figured this would be the easiest route to take.</p>
<p>What I need to do is remove all <code>img</code> and <code>a</code> tags along with the contents of the <code>a</code> tags that are <strong>only</strong> inside a <code>p</code> tag but I am unsure how to do this using regular expression.</p>
<p>For example when it comes across:</p>
<pre><code>&lt;p&gt;&lt;img src="center.jpg"&gt;&lt;a href="?center"&gt;center&lt;/a&gt;TEXT&lt;img src="right.jpg"&gt;&lt;a href="?rightspan"&gt;right&lt;/a&gt; MORE TEXT&lt;img src="another.jpg"&gt;&lt;/p&gt;
</code></pre>
<p>The output should be the following where all <code>a</code> tags and content and <code>img</code> tags are removed.</p>
<pre><code>&lt;p&gt;TEXT MORE TEXT&lt;/p&gt;
</code></pre>
<p>The problem is like I stated i'm not sure how to do this, and my regular expression removes <strong>all</strong> of the <code>a</code> and <code>img</code> tags in the source, not just the ones inside of a <code>p</code> tag.</p>
<pre><code>re.sub(r'&lt;(img|a).*?&gt;|&lt;/a&gt;', '', text)
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>Your regular expression indeed will remove all tags without using some type of assertion. Although you possibly could use regular expression to perform this, I do advise not going this route for many reasons.</p>
<p>You could simply use <a href="http://www.crummy.com/software/BeautifulSoup/bs4/doc/#" rel="nofollow"><code>BeautifulSoup</code></a> to pass a list of what to remove.</p>
<pre><code>&gt;&gt;&gt; from BeautifulSoup import BeautifulSoup
&gt;&gt;&gt; html = '&lt;p&gt;&lt;img src="center.jpg"&gt;&lt;a href="?center"&gt;center&lt;/a&gt;TEXT&lt;img src="right.jpg"&gt;&lt;a href="?rightspan"&gt;right&lt;/a&gt; MORE TEXT&lt;img src="another.jpg"&gt;&lt;/p&gt;'
&gt;&gt;&gt; soup = BeautifulSoup(html)
&gt;&gt;&gt; for m in soup.findAll(['a', 'img']):
...   if m.parent.name == 'p':
...      m.replaceWith('')

&gt;&gt;&gt; print soup

&lt;p&gt;TEXT MORE TEXT&lt;/p&gt;
</code></pre>
<blockquote>
<blockquote>
<p><strong>Note</strong>: This will replace all <code>&lt;a&gt;, &lt;/a&gt;</code> and <code>&lt;img&gt;</code> elements (including content) that are inside of a <code>&lt;p&gt;</code> element leaving the rest untouched. If you have <strong>BS4</strong>, use <a href="http://www.crummy.com/software/BeautifulSoup/bs4/doc/#find-all" rel="nofollow"><code>find_all()</code></a> and <a href="http://www.crummy.com/software/BeautifulSoup/bs4/doc/#replace-with" rel="nofollow"><code>replace_with()</code></a></p>
</blockquote>
</blockquote>
</div>
<span class="comment-copy">"but figured this would be the easiest route to take" - well, as you can see it's not that easy. Why not try other routes then? :)</span>
<span class="comment-copy">Here is an easier route to take <a href="http://stackoverflow.com/questions/13058284/remove-all-a-tags">Remove all &lt;a&gt; tags</a>.</span>
<span class="comment-copy">I'll be the first to say <a href="http://stackoverflow.com/questions/1732348/regex-match-open-tags-except-xhtml-self-contained-tags/1732454#1732454">this</a>, and recommend the wonderful tools of <a href="http://docs.python.org/3/library/html.parser.html" rel="nofollow noreferrer">the standard library</a> (or Beautiful Soup).</span>
<span class="comment-copy">Thanks for the all the links and references. I know now not to use regular expression as it is much easier to use a parser.</span>
<span class="comment-copy">Noticing your good regex and looking for things to learn in some of your old posts... And +1'ing this for an instructive solution that has nothing to do with regex!</span>
<span class="comment-copy">@zx81 Go here <a href="http://chat.stackoverflow.com/rooms/52067/foo">http://chat.stackoverflow.com/rooms/52067/foo</a></span>
