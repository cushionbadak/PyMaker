<div class="post-text" itemprop="text">
<p>I'm writing a script to help me manipulate .csv files.  The goal is to read the specified .csv, then split the data into several temporary files for further manipulation.  A blank row (a list of empty strings) in the input .csv denotes where I want to split up the data.</p>
<p>I apologize if my code runs against anything in PEP 8.  Python (and coding in general, for that matter) is still very new for me.</p>
<pre><code>import os
import csv
import tempfile

def importFromCSV(filepath):
    print("Reading data from",os.path.basename(filepath))
    datalist = []
    with open(filepath) as csvfile:
        file_dialect = csv.Sniffer().sniff(csvfile.readline(),[',',';',':','\t','.'])
        csvfile.seek(0)
        filereader = csv.reader(csvfile,dialect = file_dialect)
        for row in filereader:
            datalist.append(row)
    return datalist

def SplitToTemp(datalist, target_dir):
    tmpnamelist = []
    templist = []
    for item in datalist:
        if item[0] != '':
            templist.append(item)
        else:
            del item
            f = tempfile.NamedTemporaryFile(delete = False, dir = target_dir)
            tmpnamelist.append(f.name)
            dw = csv.writer(f, delimiter = ',', quotechar = '|', quoting = csv.QUOTE_MINIMAL)
            for row in templist:
                dw.writerow(row)
            f.close()
            templist = []
    return tmpnamelist

###############################################################################
pathname = os.path.normpath('C:/Python33/myprograms/myclassandfx/BenchLink/blrtest.csv')
tempdir = tempfile.mkdtemp(dir = os.path.normpath('c:/users/'+os.getlogin()+'/desktop'))

filedata = import_from_csv(pathname)
tempnames = SplitToTemp(filedata, tempdir)
</code></pre>
<p>However, when I run the code, I encounter this:</p>
<pre><code>Traceback (most recent call last):
  File "C:\Python33\myprograms\myclassandfx\BenchLink\BenchLinkReader_classless.py", line 56, in &lt;module&gt;
    tempnames = SplitToTemp(filedata, tempdir)
  File "C:\Python33\myprograms\myclassandfx\BenchLink\BenchLinkReader_classless.py", line 45, in     SplitToTemp
    dw.writerow(row)
TypeError: 'str' does not support the buffer interface
</code></pre>
<p>The part that puzzles me is that when I do <code>print(temp)</code>, I still get a list of lists.</p>
<p>What am I doing wrong here?</p>
</div>
<div class="post-text" itemprop="text">
<p>The <code>tempfile.NamedTemporaryFile()</code> object is opened in <em>binary</em> mode, by default; quoting from the <a href="http://docs.python.org/3/library/tempfile.html#tempfile.TemporaryFile" rel="nofollow">documentation</a>:</p>
<blockquote>
<p>The <em>mode</em> parameter defaults to <code>'w+b'</code> so that the file created can be read and written without being closed. Binary mode is used so that it behaves consistently on all platforms without regard for the data that is stored.</p>
</blockquote>
<p>You need to open it in text mode instead:</p>
<pre><code>f = tempfile.NamedTemporaryFile(mode='w+', delete=False, dir=target_dir)
</code></pre>
<p>The error is thrown when the <code>dw.writerow()</code> method tries to write unicode <code>str</code> values to a file object that'll only support <code>bytes</code> (objects supporting the buffer interface).</p>
</div>
<span class="comment-copy">Thanks!  I guess I should've looked a bit more closely at the <code>tempfile</code> documentation...</span>
