<div class="post-text" itemprop="text">
<p>I have created a document using docx and tried to send as an email attachment without saving the document on the server. Below is my code:</p>
<pre><code>Document = document()
paragraph = document.add_paragraph("Test Content")
f = BytesIO()
document.save(f)
file_list = []
file_list.append(["Test.docx",f, "application/vnd.openxmlformats-officedocument.wordprocessingml.document"]
email = EmailMessage(subject = 'Test', body = 'Hi', to = ['test@test.com'], attachments = file_list)
email.send()
</code></pre>
<p>I am getting the following error:</p>
<blockquote>
<p>TypeError: expected bytes-like object, not BytesIO</p>
</blockquote>
<p>on the line <code>email.send()</code></p>
<p>I tried converting BytesIO to StringIO as mentioned <a href="https://stackoverflow.com/questions/24566630/convert-io-bytesio-to-io-stringio-to-parse-html-page">here</a></p>
<pre><code>f = f.read()
f = StringIO(f.decode('UTF-8'))
</code></pre>
<p>and then I get the error:</p>
<blockquote>
<p>TypeError: expected bytes-like object, not StringIO</p>
</blockquote>
<p>I looked at the solution from <a href="https://stackoverflow.com/questions/46215083/create-word-document-and-then-attach-it-to-email-django">this</a>, but didn't understand how the <code>document</code> is sent as an attachment.</p>
<p>Any help or pointers is appreciated.</p>
<p>Thanks!</p>
</div>
<div class="post-text" itemprop="text">
<p>The answer was in the error message.</p>
<p>Instead of </p>
<pre><code>file_list.append(["Test.docx",f, "application/vnd.openxmlformats-officedocument.wordprocessingml.document"]
</code></pre>
<p>I did</p>
<pre><code>file_list.append(["Test.docx", f.getValue(), "application/vnd.openxmlformats-officedocument.wordprocessingml.document"]
</code></pre>
<p>Because in my code <code>f</code> is a <code>BytesIO</code> object and <code>f.getValue()</code> returns the contents of the object as <code>bytes</code>. </p>
<p>Documentation: <a href="https://docs.python.org/3/library/io.html#io.BytesIO.getvalue" rel="nofollow noreferrer">https://docs.python.org/3/library/io.html#io.BytesIO.getvalue</a></p>
</div>
