<div class="post-text" itemprop="text">
<p>I have been trying to run this code to start the communication with different sites but cannot establish one. Can someone help me with what I am missing here?</p>
<pre><code>import socket
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
print(s)

server = 'www.python.org'
port = 80 #defining port / acting like a browser

server_ip = socket.gethostbyname(server)
print(server_ip)

request = "GET / HTTPS/1.1\nHost: "+server+"\n\n"
s.connect((server_ip,port))
s.send(request.encode())
result = s.recv(4096)

while (len(result) &gt; 0):
     print(result)
     result = s.recv(1024)
</code></pre>
<p>Every time with different sites, I have been getting this error message:</p>
<pre><code>&lt;socket.socket fd=508, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0&gt;
</code></pre>
<p>151.101.152.223
b'HTTP/1.1 301 Moved Permanently\r\nServer: Varnish\r\nRetry-After: 0\r\nLocation: <a href="https://www.python.org/" rel="nofollow noreferrer">https://www.python.org/</a>\r\nContent-Length: 0\r\nAccept-Ranges: bytes\r\nDate: Wed, 05 Dec 2018 17:10:03 GMT\r\nVia: 1.1 varnish\r\nConnection: close\r\nX-Served-By: cache-bom18222-BOM\r\nX-Cache: HIT\r\nX-Cache-Hits: 0\r\nX-Timer: S1544029803.224270,VS0,VE0\r\nStrict-Transport-Security: max-age=63072000; includeSubDomains\r\n\r\n'</p>
</div>
<div class="post-text" itemprop="text">
<p>This request is wrong un multiple levels:</p>
<pre><code>port = 80 #defining port / acting like a browser
...
request = "GET / HTTPS/1.1\nHost: "+server+"\n\n"
</code></pre>
<p>There is no <code>HTTPS/1.1</code> protocol. There is only <code>HTTP/1.1</code>. To access a <code>https://..</code> URL you need to first connect to the site (default port 443 and not 80 as you used), <a href="https://docs.python.org/3/library/ssl.html#ssl.SSLContext.wrap_socket" rel="nofollow noreferrer">upgrade the TCP socket to SSL</a> and the issue a proper HTTP request, i.e. with <code>HTTP/1.1</code> not <code>HTTPS/1.1</code>.</p>
<p>Additionally the line and header delimiter must be <code>\r\n</code> instead of only <code>\n</code> you used. Most servers will ignore the difference though.</p>
<p>Also, <code>HTTP/1.1</code> implicitly enables persistent HTTP connections (HTTP keep-alive). This means the server might not close the connection immediately after the response as your code expect but might wait a long time for more requests inside the same connection. For such simple requests it is better to use <code>HTTP/1.0</code> which has no implicit keep-alive and also is simpler in other ways (no chunked transfer encoding).</p>
<pre><code>.... b'HTTP/1.1 301 Moved Permanently ... Location: https://www.python.org/
</code></pre>
<p>This not even an error. It is a HTTP redirect which says that you should access the site with <code>https://</code> (which you likely tried to do but did the wrong way).</p>
<p>At the end your code might look like this:</p>
<pre><code>import socket
import ssl

(server,port) = ('www.python.org',443)
request = "GET / HTTP/1.0\r\nHost: "+server+"\r\n\r\n"

s = socket.socket()
s.connect((server,port))
s = ssl.create_default_context().wrap_socket(s, server_hostname=server)
s.send(request.encode())

result = s.recv(4096)
while (len(result) &gt; 0):
     print(str(result))
     result = s.recv(1024)
</code></pre>
<p>Still, even if this code is working I really recommend to use a HTTP library like <a href="http://www.python-requests.org/" rel="nofollow noreferrer">requests</a>. If you instead insist on writing your own HTTP stack then please study the standard - the protocol is significantly more complex than a short look at a few examples suggests. </p>
</div>
<span class="comment-copy">In your code you are using 80 port to connect with HTTPS protocol. Try to use 443 (default port for HTTPS) port to connect to the host. Also for HTTPS connection you must implement TLS handshake or use TLS/SSL wrapper from standard library (<a href="https://docs.python.org/3/library/ssl.html" rel="nofollow noreferrer">docs.python.org/3/library/ssl.html</a>).</span>
<span class="comment-copy">Can you explain this to me that: how by just changing this line; "GET / HTTPS/1.1\nHost: " to this; "GET / HTTP/1.0\r\n\r\nHost:" and editing the port to 80 made my code run.</span>
<span class="comment-copy">@SaralJain: I have no idea what you mean with <i>"... made my code run..."</i>. You code ran before too but gave you a result you did not expect since you did it wrong. Changing port to 80 and <code>HTTPS/1.1</code> to <code>HTTP/1.0</code> returns also a 301 redirect for me with <code>www.python.org</code> and I would be surprised if it would return anything else for you - but you don't provide any details. Of course, sites which return content on <code>http://</code> (instead of only redirecting to <code>https://</code>) will return this content now since the request is correct.</span>
