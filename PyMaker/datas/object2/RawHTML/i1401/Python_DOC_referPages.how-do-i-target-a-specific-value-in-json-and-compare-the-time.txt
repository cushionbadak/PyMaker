<div class="post-text" itemprop="text">
<p>I'm trying to get my home automation project to switch a light on at sunset.  I'm using this code to get sunset from my location:</p>
<pre><code>import requests
import json

url = "http://api.sunrise-sunset.org/json?lat=xx.xxxxxx&amp;lng=-x.xxxxx"
response = requests.request("GET", url)
data=response.json()
print(json.dumps(data, indent=4, sort_keys=True))
</code></pre>
<p>This returns:</p>
<pre><code>{
    "results": {
        "astronomical_twilight_begin": "5:46:47 AM",
        "astronomical_twilight_end": "6:02:36 PM",
        "civil_twilight_begin": "7:08:37 AM",
        "civil_twilight_end": "4:40:45 PM",
        "day_length": "08:15:09",
        "nautical_twilight_begin": "6:26:43 AM",
        "nautical_twilight_end": "5:22:39 PM",
        "solar_noon": "11:54:41 AM",
        "sunrise": "7:47:07 AM",
        "sunset": "4:02:16 PM"
    },
    "status": "OK"
}
</code></pre>
<p>I'm only just starting to get my head round JSON so my questions are:</p>
<ul>
<li>How to I extract just the sunset time from the above?</li>
<li>Is (in the example) "4:02:16 PM" a time?  I know it is when I look at it but
will Python know it's an actual time so that I can compare it?</li>
</ul>
<p>What I'm trying to do is:</p>
<pre><code>Get the time now
Get sunset time
If time.now &gt; sunset
    switch light on
</code></pre>
<p>I've got about 5 hours to find the answer or I'll have to wait 24 hours to test it :)</p>
</div>
<div class="post-text" itemprop="text">
<p>You need <code>time</code> module and <code>strptime</code> function to parse the value. I let you study format specification by yourself with following url:
<a href="https://docs.python.org/3/library/datetime.html#strftime-strptime-behavior" rel="nofollow noreferrer">https://docs.python.org/3/library/datetime.html#strftime-strptime-behavior</a></p>
<p>This example parses your time and outputs it. </p>
<pre><code>import time
import datetime

data = {
    "results": {
        "astronomical_twilight_begin": "5:46:47 AM",
        "astronomical_twilight_end": "6:02:36 PM",
        "civil_twilight_begin": "7:08:37 AM",
        "civil_twilight_end": "4:40:45 PM",
        "day_length": "08:15:09",
        "nautical_twilight_begin": "6:26:43 AM",
        "nautical_twilight_end": "5:22:39 PM",
        "solar_noon": "11:54:41 AM",
        "sunrise": "7:47:07 AM",
        "sunset": "4:02:16 PM"
    },
    "status": "OK"
}

t = time.strptime(data['results']['sunset'], '%I:%M:%S %p')

sunset = datetime.datetime.fromtimestamp(time.mktime(t)).time()
now = datetime.datetime.now().time()

print('Now: {}, Sunset: {}'.format(now, sunset))
if now &lt; sunset:
    print('Wait man...')
else:
    print('Turn it ON!')
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>Heres is your complete code:</p>
<pre><code>import requests
import datetime
import json

url = "https://api.sunrise-sunset.org/json?lat=36.7201600&amp;lng=-4.4203400"
response = requests.request("GET", url)
data=response.json() #Getting JSON Data
sunset_time_str=data['results']['sunset'] #Getting the Sunset Time

current_date=datetime.date.today() #Getting Today Date
sunset_time=datetime.datetime.strptime(sunset_time_str,'%I:%M:%S %p') #Converting String time to datetime object so that we can compare it current time
sunset_date_time=datetime.datetime.combine(current_date,sunset_time.time()) #Combine today date and time to single object

current_date_time=datetime.datetime.now()

if current_date_time &gt; sunset_date_time:
  print('Turn On light')
else:
  print('Dont Turn ON')
</code></pre>
</div>
<span class="comment-copy">This works and if I do: now = "11:00:00 PM" and if now &gt; sunset.  If I do now = datetime.datetime.now().time() then I get TypeError: '&gt;' not supported between instances of 'datetime.time' and 'str'</span>
<span class="comment-copy">Yeah, that is struct_time vs time. Edited an answer - added conversion</span>
<span class="comment-copy">Thanks for that.  The MASSIVE thing for me, actually, is knowing that I can drill down into the JSON using data['results']['sunset'], for example.  I'm working on some other stuff with much bigger sets of data and I'd pretty much given up.  I think the penny has just dropped with that.</span>
<span class="comment-copy">Ha!  Just spotted this.  It's almost exactly where I'd got to.  Yours is probably a bit more elegant than mine :)</span>
