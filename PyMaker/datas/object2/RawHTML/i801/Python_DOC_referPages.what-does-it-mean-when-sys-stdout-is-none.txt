<div class="post-text" itemprop="text">
<p>i can silence and restore <code>sys.stdout</code> this way:</p>
<pre><code>import sys
sys.stdout = None
print('hello')  # does not write to stdout
sys.stdout = sys.__stdout__
print('hello')  # writes to stdout
</code></pre>
<p>i know i'd better be using <a href="https://docs.python.org/3/library/contextlib.html?highlight=redirect_stdout#contextlib.redirect_stdout" rel="nofollow noreferrer"><code>contextlib.redirect_stdout</code></a> which probably does something similar but my question is: why does the above code work?</p>
<p>i'd have assumed python would call things like <code>sys.stdout.write()</code> so whatever i replace <code>sys.stdout</code> with should have a <code>write</code> method (like e.g. <a href="https://docs.python.org/3/library/io.html?highlight=stringio#io.StringIO" rel="nofollow noreferrer"><code>io.StringIO</code></a>) at least.</p>
</div>
<div class="post-text" itemprop="text">
<p><a href="https://github.com/python/cpython/blob/v3.6.5/Python/bltinmodule.c#L1773" rel="noreferrer"><code>print</code> has an explicit check for <code>None</code>.</a></p>
<pre class="lang-c prettyprint-override"><code>    /* sys.stdout may be None when FILE* stdout isn't connected */
    if (file == Py_None)
        Py_RETURN_NONE;
</code></pre>
</div>
<span class="comment-copy">The footnote in docs says they can be None in some conditions: Under some conditions <code>stdin</code>, <code>stdout</code> and <code>stderr</code> as well as the original values <code>__stdin__</code>, <code>__stdout__</code> and <code>__stderr__</code> can be None.</span>
<span class="comment-copy">I think this is <a href="https://docs.python.org/3.4/library/sys.html#sys.__stdout__" rel="nofollow noreferrer">the footnote</a> @AshwiniChaudhary may be referring to.</span>
<span class="comment-copy">ok, i missed the footnote. thanks!</span>
<span class="comment-copy">i was digging through the source code and had trouble finding that (should have grepped for <code>builtin_print</code>)... thanks!</span>
<span class="comment-copy">Pypy is also following it as is: <a href="https://bitbucket.org/pypy/pypy/src/ed869ecba5203208b21f7ec6f0be86fbffa3fcb0/pypy/module/__builtin__/app_io.py?at=default&amp;fileviewer=file-view-default#app_io.py-92" rel="nofollow noreferrer">bitbucket.org/pypy/pypy/src/â€¦</a></span>
<span class="comment-copy">is it a documented behavior we may rely on?</span>
<span class="comment-copy">@jfs: The fact that sys.stdout may be None is <a href="https://docs.python.org/3/library/sys.html#sys.__stdin__" rel="nofollow noreferrer">documented</a>; as far as I can tell, the behavior of print when it encounters None for sys.stdout is not.</span>
