<div class="post-text" itemprop="text">
<p>I am studying <a href="http://do1.dr-chuck.com/pythonlearn/EN_us/pythonlearn.pdf" rel="nofollow noreferrer">"Python for Everybody"</a> book written by Charles R. Severance and I have a question to the exercise2 from Chapter7. </p>
<p>The task is to go through the <a href="https://www.py4e.com/code3/mbox-short.txt" rel="nofollow noreferrer">mbox-short.txt</a> file and "When you encounter a line that starts with “X-DSPAM-Confidence:” pull apart the line to extract the floating-point number on the line. Count these lines and then compute the total of the spam confidence values from these lines. When you reach the end of the file, print out the average spam confidence." </p>
<p>Here is my way of doing this task:</p>
<pre><code>fname = input('Enter the file name: ') 
try:
    fhand = open(fname) 
except:
    print('File cannot be opened:', fname)
    exit()
count = 0
values = list()
for line in fhand:
    if line.startswith('X-DSPAM-Confidence:'): 
        string = line
        count = count + 1
        colpos = string.find(":")
        portion = string[colpos+1:]
        portion = float(portion)
        values.append(portion)   
print('Average spam confidence:', sum(values)/count)
</code></pre>
<p>I know this code works because I get the same result as in the book, however, I think this code can be simpler. The reason I think so is because I used a list in this code (declared it and then stored values in it). However, "Lists" is the next topic in the book and when solving this task I didn't know anything about lists and had to google them. I solved this task this way, because this is what I'd do in the R language (which I am already quite familiar with), I'd make a vector in which I'd store the values from my iteration.  </p>
<p>So my question is: Can this code be simplified? Can I do the same task without using list? If yes, how can I do it?</p>
</div>
<div class="post-text" itemprop="text">
<p>I could change the "values" object to a floating type. The overhead of a list is not really needed in the problem. </p>
<pre><code>values = 0.0
</code></pre>
<p>Then in the loop use</p>
<pre><code>values += portion 
</code></pre>
<p>Otherwise, there really is not a simpler way as this problem has tasks and you must meet all of the tasks in order to solve it.</p>
<ol>
<li>Open File</li>
<li>Check For Error</li>
<li>Loop Through Lines</li>
<li>Find certain lines</li>
<li>Total up said lines</li>
<li>Print average</li>
</ol>
<p>If you can do it in 3 lines of code great but that doesn't make what goes on in the background necessarily simpler. It will also probably look ugly.</p>
</div>
<div class="post-text" itemprop="text">
<p>You could filter the file's lines before the loop, then you can collapse the other variables into one, and get the values using list-comprehension. From that, you have your count from the length of that list. </p>
<pre><code>interesting_lines = (line.startswith('X-DSPAM-Confidence:') for line in fhand)
values = [float(line[(line.find(":")+1):]) for line in interesting_lines]
count = len(values)
</code></pre>
<blockquote>
<p>Can I do the same task without using list?</p>
</blockquote>
<p>If the output needs to be an average, yes, you can accumlate the sum and the count as their own variables, and not need a list to call <code>sum(values)</code> against</p>
<p>Note that <code>open(fname)</code> is giving you an iterable collection anyway, and you're looping over the "list of lines" in the file. </p>
</div>
<div class="post-text" itemprop="text">
<p>List-comprehensions can often replace for-loops that add to a list:</p>
<pre><code>fname = input('Enter the file name: ') 
try:
    fhand = open(fname) 
except:
    print('File cannot be opened:', fname)
    exit()

values = [float(l[l.find(":")+1:]) for l in fhand if l.startswith('X-DSPAM-Confidence:')]

print('Average spam confidence:', sum(values)/len(values))
</code></pre>
<p>The inner part is simply your code combined, so perhaps less readable.</p>
<p>EDIT: Without using lists, it can be done with "reduce":</p>
<pre><code>from functools import reduce
fname = input('Enter the file name: ') 
try:
    fhand = open(fname) 
except:
    print('File cannot be opened:', fname)
    exit()

sum, count = reduce(lambda acc, l: (acc[0] + float(l[l.find(":")+1:]), acc[1]+1) if l.startswith('X-DSPAM-Confidence:') else acc, fhand, (0,0))

print('Average spam confidence:', sum / count)
</code></pre>
<p>Reduce is often called "fold" in other languages, and it basically allows you to iterate over a collection with an "accumulator". Here, I iterate the collection with an accumulator which is a tuple of <code>(sum, count)</code>. With each item, we add to the sum and increment the count. See <a href="https://docs.python.org/3/library/functools.html#functools.reduce" rel="nofollow noreferrer">Reduce documentation</a>.</p>
<p>All this being said, "simplify" does not necessarily mean as little code as possible, so I would stick with your own code if you're not comfortable with these shorthand notations.</p>
</div>
<span class="comment-copy">For questions about simplifing working code, you can ask on <a href="https://codereview.stackexchange.com/tour">codereview.stackexchange.com/tour</a></span>
<span class="comment-copy">You could just make values a variable and += the actual values. A list just looks nicer in my opinion.</span>
