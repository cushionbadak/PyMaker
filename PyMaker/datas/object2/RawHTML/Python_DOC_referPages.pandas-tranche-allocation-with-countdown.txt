<div class="post-text" itemprop="text">
<p>I have not been able to find an answer for this generic problem.</p>
<p>Let's assume the following dataframe:</p>
<pre><code>df = pd.DataFrame({'qty':[7,7,7], 'elt':['a','b','c'], 'limit':[2,4,100]})

df
   qty elt  limit
0    7   a      2
1    7   b      4
2    7   c    100
</code></pre>
<p>In which 'qty' denotes the total quantity to allocate. Each element 'elt' represents a tranche and has a limit of quantity it can support. I want to determine how much quantity needs to be allocated against each element constrained by the limit.</p>
<p>The resulting dataframe should be:</p>
<pre><code>df
   qty elt  limit  allocation
0    7   a      2           2
1    7   b      4           4
2    7   c    100           1
</code></pre>
<p>Any advice on how to do this? :)</p>
</div>
<div class="post-text" itemprop="text">
<p>Check with <code>np.where</code> with <code>cumsum</code></p>
<pre><code>df['allocation']=np.where(df.limit.cumsum()&lt;=df.qty,df.limit,df.qty-df.limit.cumsum().shift())
df
Out[806]: 
   qty elt  limit  allocation
0    7   a      2         2.0
1    7   b      4         4.0
2    7   c    100         1.0
</code></pre>
</div>
<span class="comment-copy">Excellent, that works perfectly, thanks @wen-ben!</span>
