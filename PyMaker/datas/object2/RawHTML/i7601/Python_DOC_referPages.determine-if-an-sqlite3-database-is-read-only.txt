<div class="post-text" itemprop="text">
<p>I'd like to open an sqlite3 database, and immediately check that it is not opened read-only. Since I know I'll need to write to it, I want to return an error immediately at start-up, and not have to wait until a later time when the program first tries to do a write.</p>
<p>I see there is a sqlite3 <a href="https://sqlite.org/c3ref/db_readonly.html" rel="nofollow noreferrer">C API function <code>sqlite3_db_readonly()</code></a>. Is it possible to access this function from the Python API? Or is there some other way to check if a database is read-only from the Python API?</p>
</div>
<div class="post-text" itemprop="text">
<p>no and yes.see the source code of the python standard library sqlite3.</p>
<pre><code>rc = sqlite3_open_v2(database, &amp;self-&gt;db,
                        SQLITE_OPEN_READWRITE | SQLITE_OPEN_CREATE |
                       (uri ? SQLITE_OPEN_URI : 0), NULL);
</code></pre>
<p>this means even if you didn't set the <code>uri</code>,it will open in read-only mode when the file in read-only mode.and search in the code.there are no invoke of <code>sqlite3_db_readonly()</code>.so you cannot do it by library sqlite3.</p>
<p>but yes,there are other library,for example<a href="http://code.google.com/p/apsw/" rel="nofollow noreferrer">APSW</a>.the code</p>
<pre><code>`static PyObject*
Connection_readonly(Connection *self, PyObject *name)
{
  int res=-1;
  res=sqlite3_db_readonly(self-&gt;db, PyBytes_AS_STRING(utf8name));
}`
</code></pre>
<p>then read the DOC,just call <code>Connection.readonly(name)</code></p>
</div>
<div class="post-text" itemprop="text">
<p>Apart from other possibilities mentioned, you can just try writing to it.  For example, if the <code>user_version</code> of the database is 0 (which it will be unless you have changed it), issue <code>pragma user_version=0;</code>.  This will have no effect if the database is writable, but will result in an error if the database is read-only.</p>
</div>
<span class="comment-copy">You have to <a href="https://stackoverflow.com/questions/10205744/opening-sqlite3-database-from-python-in-read-only-mode">go to lengths</a> to open it as read-only. Why would you not know it was read-only?</span>
<span class="comment-copy">@PeterWood If the DB file doesn't have write permissions, then it will be opened in read-only mode.</span>
<span class="comment-copy">You could use <a href="https://docs.python.org/3/library/os.html#os.access" rel="nofollow noreferrer"><b><code>os.access</code></b></a>, e.g: <code>os.access(db, os.W_OK)</code>.</span>
<span class="comment-copy">@PeterWood "I/O operations may fail even when <code>access()</code> indicates that they would succeed, particularly for operations on network filesystems which may have permissions semantics beyond the usual POSIX permission-bit model." I don't want something that works except for the times when it doesn't.</span>
<span class="comment-copy">You can tailor it to your situation. If you want something bulletproof for all situations then you need to consider that permissions can change, that writing can fail for other reasons, and you should be handling exceptions anyway. I guess you could access <code>sqlite3_db_readonly</code> from the DLL using <code>ctypes.CDLL</code>. Also, see <a href="https://stackoverflow.com/questions/10154978/determine-if-an-sqlite-3-database-is-read-only-without-using-sqlite3-db-readon">this related question</a></span>
