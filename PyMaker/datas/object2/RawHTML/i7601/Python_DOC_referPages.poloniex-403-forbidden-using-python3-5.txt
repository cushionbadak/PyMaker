<div class="post-text" itemprop="text">
<p>I am trying to create a basic authenticated connection to poloniex and I keep getting a 403 forbidden error returned back from their API.</p>
<pre><code>time import time
import urllib.request
import urllib.parse
import hashlib
import hmac

APIkey = b'provert-kee'
secret = b'ceecret'
url = 'https://poloniex.com/tradingApi'

payload = {
    'command': 'returnBalances',
    'nonce': int(time() * 1000),
}

paybytes = urllib.parse.urlencode(payload).encode('utf8')
print(paybytes)

sign = hmac.new(secret, paybytes, hashlib.sha512).hexdigest()
print(sign)

headers = {
    'Key': APIkey,
    'Sign': sign,
}

req = urllib.request.Request(url, headers=headers, data=paybytes)
with urllib.request.urlopen(req) as response:
    the_page = response.read()
    print(the_page)
</code></pre>
<p>output:</p>
<pre><code>#python3 apicalltest3.py 
b'command=returnBalances&amp;nonce=1498380606389'
5555555
Traceback (most recent call last):
  File "apicalltest3.py", line 29, in &lt;module&gt;
    with urllib.request.urlopen(req) as response:
  File "/usr/lib/python3.5/urllib/request.py", line 163, in urlopen
    return opener.open(url, data, timeout)
  File "/usr/lib/python3.5/urllib/request.py", line 472, in open
    response = meth(req, response)
  File "/usr/lib/python3.5/urllib/request.py", line 582, in http_response
    'http', request, response, code, msg, hdrs)
  File "/usr/lib/python3.5/urllib/request.py", line 510, in error
    return self._call_chain(*args)
  File "/usr/lib/python3.5/urllib/request.py", line 444, in _call_chain
    result = func(*args)
  File "/usr/lib/python3.5/urllib/request.py", line 590, in http_error_default
    raise HTTPError(req.full_url, code, msg, hdrs, fp)
urllib.error.HTTPError: HTTP Error 403: Forbidden
</code></pre>
<p>on their support page they have a sample wrapper in python2.7 using hmac 512 as well</p>
<p><a href="https://poloniex.com/support/api/" rel="nofollow noreferrer">API doc</a></p>
<p>How do I get a basic authenticated connection to poloniex?</p>
</div>
<div class="post-text" itemprop="text">
<p>According to <a href="https://docs.python.org/3/library/string.html" rel="nofollow noreferrer">the Official Documentation</a>:</p>
<blockquote>
<p>'b' : Binary format. Outputs the number in base 2.</p>
</blockquote>
<p>In your code, you provide the key &amp; secret as <code>binary</code>, but it is required to be a <code>string</code></p>
<p>So please replace:</p>
<pre><code>APIkey = b'provert-kee'
secret = b'ceecret'
</code></pre>
<p>by</p>
<pre><code>APIkey = 'provert-kee' # or s'provert-kee'
secret = 'ceecret' # or s'ceecret'
</code></pre>
</div>
