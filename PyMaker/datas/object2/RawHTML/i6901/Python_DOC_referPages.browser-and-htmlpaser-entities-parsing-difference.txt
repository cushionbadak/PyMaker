<div class="post-text" itemprop="text">
<p>I have the following character <code>&amp;#151;</code> from the HTML of a webpage. And it renders like "<strong>—</strong>" (EM DASH) on the webpage (via Google Chrome browser if it is matter). No matter how I play with file encoding ("utf-8", "cp1251", "cp866") it is always "—" on the webpage. But when I run the following python code:</p>
<pre><code>from HTMLParser import HTMLParser

h_parser = HTMLParser()
print h_parser.unescape('&amp;#151;')
</code></pre>
<p>it outputs some control symbol which is "End of Guarded Area" in unicode table.</p>
<p>What python code should I use to get "—" from the <code>&amp;#151;</code> string/unicode string. I use python2.7</p>
</div>
<div class="post-text" itemprop="text">
<p>The numeric value in the character reference (151 in your case) refers to Unicode codepoint 151 (0x97), which is in the <a href="https://unicode-table.com/en/blocks/latin-1-supplement/" rel="nofollow noreferrer">Latin-1 Supplement</a> where it represents a control character.</p>
<p>Most likely the invalid value 151 is being used because it corresponds to the dash character in Windows code page 1252. That it is rendered as em dash by browsers is probably an attempt to handle this common error.</p>
<p>The correct character reference for em dash is <code>&amp;#8212</code>.</p>
<pre><code>&gt;&gt;&gt; import unicodedata
&gt;&gt;&gt; unicodedata.name(unichr(151))
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in &lt;module&gt;
ValueError: no such name

&gt;&gt;&gt; unicodedata.lookup('em dash')
u'\u2014'
&gt;&gt;&gt; unicodedata.lookup('em dash').encode('cp1252')
'\x97'
</code></pre>
<p>While Python 2 struggles with this, in Python 3 the <a href="https://docs.python.org/3/library/html.html#html.unescape" rel="nofollow noreferrer"><code>html.unescape()</code></a> function explicitly handles invalid character references as specified in the <a href="https://www.w3.org/TR/html5/syntax.html#tokenizing-character-references" rel="nofollow noreferrer">HTML 5 spec</a>. You might solve your problem by using Python 3, if possible:</p>
<pre><code>&gt;&gt;&gt; from html import unescape
&gt;&gt;&gt; unescape('&amp;#151;')
'—'
</code></pre>
<p>If you can't use Python 3 you could copy the code from the Python 3 <code>html</code> module (see the <a href="https://github.com/python/cpython/blob/b5db7bb9da1120912a1795fbc6106d0eba5a01c7/Lib/html/__init__.py#L122" rel="nofollow noreferrer"><code>__init__.py</code></a> file) and pass the HTML code through it before handing off to <code>HTMLParser</code>.</p>
</div>
