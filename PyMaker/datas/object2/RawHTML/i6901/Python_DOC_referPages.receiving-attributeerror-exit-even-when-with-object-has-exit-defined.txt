<div class="post-text" itemprop="text">
<p>I'm receiving an error of <code>AttributeError: __exit__</code> in the code below after finishing the <code>with</code> section. The Element object has is being returned in the <code>with</code> and it has <code>__exit__</code> defined, so I'm baffled.</p>
<pre><code>class Builder:
    def __init__(self):
        print("Builder init fires")

    def __getattr__(self, name):
        return Element(name, self)

class Element:
    def __init__(self, name, builder):
        self.name = name
        self.builder = builder
        print("Element init fires for name of", self.name)
    def __call__(*args, **kargs):
        print("CALL fires, now with attributes listed:")
        for attr, value in sorted(kargs.items()):
            print(' %s=&gt;%s' % (attr, value))

    def __enter__(self):  
        return self

    def __exit__(self, type, value, traceback): 
        pass

aa = Builder()        
with aa.feed(xmlns='http://www.w3.org/2005/Atom'):
    print("INSIDE THE WITH")
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>The value of expression after <code>with</code> keyword must be a valid context manager. That means the <strong>value</strong> of the expresion must have attributes <strong><code>__enter__</code></strong> and <strong><code>__exit__</code></strong> and these must accept parameters described in docs <a href="https://docs.python.org/3/reference/datamodel.html#context-managers" rel="nofollow noreferrer">With Statement Context Managers</a>. You can easily verify that the part <code>aa.feed</code> would be acceptable, but the value of whole expression is <code>None</code> and it has no necessary attribute. A difference between Python 3.5 and 3.6 is that one fails on missing <code>__exit__</code> and the latter on missing <code>__enter__</code>. Nothing unexpected.</p>
<p>You also forgot <code>self</code> in the line <code>def __call__(self, *args, **kargs):</code> that would be a problem if you will use args and it is a pythonic pattern also with unused args.</p>
</div>
<span class="comment-copy">When I run the code, I get an AttributeError for <code>__enter__</code>, because your <code>__call_</code> returns None.</span>
<span class="comment-copy">It appears that under python 3.5.2 it receives an <code>AttributeError</code> for <code>__exit__</code> but under python 3.6.1 its for <code>__enter__</code>. I see you're correct that <code>__call__()</code> determines what is being returned by the <code>with</code> and it needs to have <code>return self</code>. Thanks.</span>
<span class="comment-copy">Similar to missing parameters, omitting params  and () completely will throw the same exception.  For example: <code>with aa.feed:</code></span>
