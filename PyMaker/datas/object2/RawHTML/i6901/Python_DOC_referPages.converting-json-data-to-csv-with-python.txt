<div class="post-text" itemprop="text">
<p>I am trying to pull stat tables from NHL.com and convert them to csv for later use in excel. I am able to pull the tables but am having issues converting them to csv. I have found plenty of previous questions about converting json to csv but none of the solutions have worked for me. Some of the solutions utilized pandas, which for some reason keeps giving me a traceback error. Here is the code up until the conversion to csv.</p>
<pre><code>import requests
import lxml.html
from pprint import pprint 
from sys import exit
import json
import csv
import datetime 
import dateutil.relativedelta


now = datetime.datetime.now()
one_month_ago = now + dateutil.relativedelta.relativedelta(months=-15)

today_date = now.strftime('%Y-%m-%d')
one_month_ago_date = one_month_ago.strftime('%Y-%m-%d')

url = 'http://www.nhl.com/stats/rest/individual/skaters/basic/game/skatersummary?cayenneExp=gameDate%3E=%22'+one_month_ago_date+'T04:00:00.000Z%22%20and%20gameDate%3C=%22'+today_date+'T03:59:59.999Z%22%20and%20gameLocationCode=%22H%22%20and%20gameTypeId=%222%22&amp;factCayenneExp=shots%3E=1&amp;sort=[{%22property%22:%22points%22,%22direction%22:%22DESC%22},{%22property%22:%22goals%22,%22direction%22:%22DESC%22},{%22property%22:%22assists%22,%22direction%22:%22DESC%22}]'
resp = requests.get(url).text
resp = json.loads(resp)
</code></pre>
<p>Any help would be greatly appreciated!</p>
<p>Edit:
Some of the csv conversion methods I tried included the highest rated answers from <a href="https://stackoverflow.com/questions/1871524/how-can-i-convert-json-to-csv">How can I convert JSON to CSV?</a>.
I was having issues pasting and formatting them here so I just provided the link instead.</p>
<p>This is my output when trying to use pandas.</p>
<pre><code>Traceback (most recent call last):
File "NHL Data Scrape.py", line 1, in &lt;module&gt;
from pandas.io.json import json_normalize

File "C:\Users\Brett\AppData\Local\Programs\Python\Python36\lib\site-
packages\pandas\__init__.py", line 13, in &lt;module&gt;
__import__(dependency)

File "C:\Users\Brett\AppData\Local\Programs\Python\Python36\lib\site-
packages\numpy\__init__.py", line 142, in &lt;module&gt;
from . import add_newdocs

File "C:\Users\Brett\AppData\Local\Programs\Python\Python36\lib\site-
packages\numpy\add_newdocs.py", line 13, in &lt;module&gt;
from numpy.lib import add_newdoc

File "C:\Users\Brett\AppData\Local\Programs\Python\Python36\lib\site-
packages\numpy\lib\__init__.py", line 8, in &lt;module&gt;
from .type_check import *

File "C:\Users\Brett\AppData\Local\Programs\Python\Python36\lib\site-
packages\numpy\lib\type_check.py", line 11, in &lt;module&gt;
import numpy.core.numeric as _nx

File "C:\Users\Brett\AppData\Local\Programs\Python\Python36\lib\site-
packages\numpy\core\__init__.py", line 35, in &lt;module&gt;
from . import _internal  # for freeze programs

File "C:\Users\Brett\AppData\Local\Programs\Python\Python36\lib\site-
packages\numpy\core\_internal.py", line 18, in &lt;module&gt;
from .numerictypes import object_

File "C:\Users\Brett\AppData\Local\Programs\Python\Python36\lib\site-
packages\numpy\core\numerictypes.py", line 962, in &lt;module&gt;
_register_types()

File "C:\Users\Brett\AppData\Local\Programs\Python\Python36\lib\site-
packages\numpy\core\numerictypes.py", line 958, in _register_types
    numbers.Integral.register(integer)

AttributeError: module 'numbers' has no attribute 'Integral'


------------------
(program exited with code: 1)

Press any key to continue . . .
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>You can use <code>json_normalize()</code> from <code>pandas.io.json</code>, e.g.:</p>
<pre><code>In []:
from pandas.io.json import json_normalize

...
resp = requests.get(url).json()
json_normalize(resp, 'data')

Out[]:
     assists  faceoffWinPctg  gameWinningGoals  gamesPlayed  goals  otGoals   ...
0         31          0.0967                 2           41     20        1   ...
1         27          0.0000                 3           38     22        0   ...
2         35          0.5249                 4           41     14        2   ...
3         34          0.4866                 3           41     14        1   ...
...
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>You could utilize python's built-in <a href="https://docs.python.org/3/library/csv.html#csv.DictWriter" rel="nofollow noreferrer">csv.DictWriter</a></p>
<pre><code>resp = requests.get(url).json() # get response data in json

# resp['data'] is a list of dicts which contains players info.
# resp['data'][0].keys() is a dictionary keys. We'll use it for csv header.
with open('nhl_players.csv', 'w') as f:
    w = csv.DictWriter(f, resp['data'][0].keys())
    w.writeheader()
    w.writerows(resp['data'])
</code></pre>
<p>Here's the output CSV file <a href="https://www.dropbox.com/s/1mmprenx0eniflg/nhl_players.csv?dl=0" rel="nofollow noreferrer">https://www.dropbox.com/s/1mmprenx0eniflg/nhl_players.csv?dl=0</a> </p>
<p>Hope this helps.</p>
</div>
<span class="comment-copy">What have you tried in terms of conversion to CSV? You could also provide small samples of the JSON and your expected result (the CSV), which would make answering a lot easier!</span>
<span class="comment-copy">what version of pandas are you using? and what happens when you simply run <code>import pandas</code>?</span>
<span class="comment-copy">I am using pandas 0.20.3, which I installed via pip. I just reinstalled Python and all of the packages to see if that would help and it didn't change anything. Also, when I simply use "import pandas" I get the same error</span>
<span class="comment-copy">This formatting is exactly how I would like it to look! The only problem is when I try to run it I get a long traceback error that first references "from pandas.io.json import json_normalize" then gives the file location of <i>init</i>.py in the pandas folder then does the same for various numpy modules as well. I have them both installed and located in the Python36 folder so I'm unsure why it does that. I'm going to work on trying to resolve this issue.</span>
<span class="comment-copy">Thank you for this respone though! If I can get pandas to work in the future I will fool around with it because it seems to be super useful and simple.</span>
<span class="comment-copy">Looks like you have a bad installation of numpy. I would try reinstalling it.</span>
<span class="comment-copy">Thank you so much! This worked perfectly!</span>
