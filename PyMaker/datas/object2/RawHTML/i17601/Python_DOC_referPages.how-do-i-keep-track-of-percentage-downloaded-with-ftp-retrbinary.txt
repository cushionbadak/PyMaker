<div class="post-text" itemprop="text">
<p>I am currently using this code to print out the percentage downloaded from a ftp server using ftp.retrbinary but the download completes at 0.27 percent complete, and only says that sizeWritten finished with 27828224 bits.  Where am I going wrong?</p>
<pre><code>from ftplib import FTP

ftp = FTP('host')
ftp.login('usr','pass')
totalSize = ftp.size('100file.zip')
print(totalSize, "bytes")

def download_file(block):
    global sizeWritten
    file.write(block)
    sizeWritten += 1024
    print(sizeWritten, "= size written", totalSize, "= total size")
    percentComplete = sizeWritten / totalSize
    print (percentComplete, "percent complete")

try:
    file = open('100file.zip', "wb")
    ftp.retrbinary("RETR " + '100file.zip' ,download_file)
    print("Download Successful!")
except:
    print("Error")

file.close()
ftp.close()
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>You've ignoring the size of the blocks, and pretending each one is 1K:</p>
<pre><code>sizeWritten += 1024
</code></pre>
<p>Just change that to:</p>
<pre><code>sizeWritten += len(block)
</code></pre>
<p>Your client can send a max block size to the server, with the <a href="http://docs.python.org/3/library/ftplib.html#ftplib.FTP.retrbinary" rel="nofollow"><code>blocksize</code></a> argument. But you aren't passing one, so you get the default of 8192.</p>
<p>So, why aren't you getting exactly 12.5%, if you're off by exactly a factor of 8? Well, first, the last block is almost always going to be less than the maximum, so you should expect a bit more than 12.5%. And second, you're only giving the server a <em>max</em> block size; it's free to decide it never wants to send more than, say, 4K, in which case you'd get a bit more than 25% instead.</p>
</div>
<span class="comment-copy">How do you know that each block is 1024 bytes long?</span>
<span class="comment-copy">As a side note you appear to be mixing up bits and bytes, which is hardly likely to help things when you have numbers that are off by 4xâ€¦ or is that 1/2x?</span>
