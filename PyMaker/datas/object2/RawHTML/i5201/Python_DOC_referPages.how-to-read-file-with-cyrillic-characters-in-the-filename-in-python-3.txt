<div class="post-text" itemprop="text">
<p>I am trying to read image file with filenames having cyrillic characters. </p>
<pre><code>ls /home/atin/test
ОД Д.bmp
</code></pre>
<p>Now I am trying to read 'ОД Д.bmp' in python 3</p>
<pre><code>image_path='/home/atin/test/ОД Д.bmp'
import matplotlib.pyplot as plt
sample_image=plt.imread(image_path)
</code></pre>
<p>But I get this error.</p>
<pre><code>SystemError: &lt;built-in function read_png&gt; returned NULL without setting an error
</code></pre>
<p>But <code>os.listdir('/home/atin/test')</code> gives following output</p>
<p>['\udcd0\udc9e\udcd0\udc94 \udcd0\udc94.bmp']</p>
<p>How can I decode the above output to original file name which is ОД Д.bmp.
I am using python 3.6 in ubuntu here.  </p>
</div>
<div class="post-text" itemprop="text">
<p>Your system has an incorrect locale configured. On Linux, Python takes the filesystem codec from the locale. From the <a href="https://docs.python.org/3/library/sys.html#sys.getfilesystemencoding" rel="nofollow noreferrer"><code>sys.getfilesystemencoding()</code> documentation</a>:</p>
<blockquote>
<p>Return the name of the encoding used to convert between Unicode filenames and bytes filenames.</p>
<p>[...]</p>
<ul>
<li>On Unix, the encoding is the locale encoding.</li>
</ul>
</blockquote>
<p>You have a filesystem that uses UTF-8 but Python is not reading the data correctly.</p>
<p>As a result, the UTF-8 data can't correctly be decoded, there is an decoding error, and the <a href="https://docs.python.org/3/library/codecs.html#error-handlers" rel="nofollow noreferrer"><code>surrogateescape</code> error handler</a> kicks in, and it has 'preserved' the bytes as <a href="https://en.wikipedia.org/wiki/UTF-16#U+D800_to_U+DFFF" rel="nofollow noreferrer">low surrogate codepoints</a>.</p>
<p>You can reverse the issue by encoding to UTF-8 with the same error handler:</p>
<pre><code>&gt;&gt;&gt; '\udcd0\udc9e\udcd0\udc94 \udcd0\udc94.bmp'.encode('utf8', 'surrogateescape')
b'\xd0\x9e\xd0\x94 \xd0\x94.bmp'
</code></pre>
<p>The result happens to be the correct UTF-8 encoding for your filename:</p>
<pre><code>&gt;&gt;&gt; '\udcd0\udc9e\udcd0\udc94 \udcd0\udc94.bmp'.encode('utf8', 'surrogateescape').decode('utf8')
'ОД Д.bmp'
</code></pre>
<p>You'll want to use <code>LC_CTYPE=en_US.UTF-8</code> <em>at the very least</em>, to avoid this issue. In your case you appear to have <code>LC_CTYPE=UTF-8</code>, which is invalid (you could use <code>LC_CTYPE=en_SG.UTF-8</code> instead).</p>
<p>Another work-around is to use <em>bytes</em> paths:</p>
<pre><code>image_path = '/home/atin/test/ОД Д.bmp'.encode('utf8')
</code></pre>
</div>
<span class="comment-copy"><code>ОД р1</code> is not the same thing as <code>ОД Д</code>. The error doesn't immediately indicate to me that the filename was the issue here.</span>
<span class="comment-copy">What does <a href="https://docs.python.org/3/library/sys.html#sys.getfilesystemencoding" rel="nofollow noreferrer"><code>sys.getfilesystemencoding()</code></a> return? That may be a wrong value. What operating system is this?</span>
<span class="comment-copy">Those <code>\u</code> escape sequences are low surrogate points. This may indicate that the filesystem encoding is not UTF-8 but Python is expecting UTF-8. The bytes are then preserved via the <i>surrogateescape</i> error handler, but that'd mean the original data was <code>b'\xd0\x9e\xd0\x94 \xd0\x94.bmp'</code>, which is <i>valid UTF-8</i>.</span>
<span class="comment-copy">I have made the necessary edit, sorry for the wrong input. But still the error is the same.</span>
<span class="comment-copy">What does the UNIX command <code>locale</code> produce? That is almost certainly wrong, for the given filesystem.</span>
<span class="comment-copy">Thanks a lot, however <code>image_path = '/home/atin/test/ОД Д.bmp'.encode('utf8')</code> still doesn't work, I am getting an error <code>SystemError: &lt;built-in function read_png&gt; returned NULL without setting an error</code></span>
<span class="comment-copy">@AtinGhosh: presumably then <code>plt.imread()</code> decodes the path again.</span>
<span class="comment-copy">Sorry actually <code>image_path = '/home/atin/test/ОД Д.bmp'.encode('utf8')</code> works, but when I try <code>plt.imread('/home/atin/test/ОД Д.bmp'.encode('utf8'))</code> then it throws the above error.</span>
<span class="comment-copy">any suggestion how to solve that?</span>
<span class="comment-copy">I tried this <code>plt.imread("b'/home/atin/test/\xd0\x9e\xd0\x94 \xd0\x94.bmp'")</code>, then I get following error. <code>UnicodeEncodeError: 'ascii' codec can't encode characters in position 18-21: ordinal not in range(128)</code></span>
