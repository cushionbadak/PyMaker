<div class="post-text" itemprop="text">
<p>I wrote a script to scrape the titles of a YouTube playlist page  </p>
<p>Everything works fine, according to print statements, until I try to write the titles into a text file, at which point I get "UnicodeEncodeError: 'charmap' codec can't encode characters in position..."</p>
<p>I've tried adding "encoding='utf8'" when I open the file, and while that fixes the error, all the Chinese characters are replaced by random, gibberish characters</p>
<p>I also tried encoding the output string with 'replace', then decoding it, but that also just replaces all the special characters with question marks</p>
<p>Here is my code:</p>
<pre><code>from bs4 import BeautifulSoup as BS
import urllib.request
import re

playlist_url = input("gib nem: ")

with urllib.request.urlopen(playlist_url) as response:
  playlist = response.read().decode('utf-8')
  soup = BS(playlist, "lxml")

title_attrs = soup.find_all(attrs={"data-title":re.compile(r".*")})
titles = [tag["data-title"] for tag in title_attrs]

titles_str = '\n'.join(titles)#.encode('cp1252','replace').decode('cp1252')

print(titles_str)
with open("playListNames.txt", "a") as f:
    f.write(titles_str)
</code></pre>
<p>And here is the sample playlist I've been using to test:
<a href="https://www.youtube.com/playlist?list=PL3oW2tjiIxvSk0WKXaEiDY78KKbKghOOo" rel="nofollow noreferrer">https://www.youtube.com/playlist?list=PL3oW2tjiIxvSk0WKXaEiDY78KKbKghOOo</a></p>
</div>
<div class="post-text" itemprop="text">
<p>The <a href="https://docs.python.org/3/library/functions.html#open" rel="nofollow noreferrer">documentation</a> is clear about file encoding:</p>
<blockquote>
<p><code>encoding</code> is the name of the encoding used to decode or encode the
  file. This should only be used in text mode. The default encoding is
  platform dependent (whatever <code>locale.getpreferredencoding()</code> returns),
  but any text encoding supported by Python can be used. See the codecs
  module for the list of supported encodings.</p>
</blockquote>
<p>To answer questions from your last comment.</p>
<ol>
<li><p>You can find out what's the preferred encoding on Windows with</p>
<pre><code>import locale
locale.getpreferredencoding()
</code></pre></li>
</ol>
<p>If <code>playListNames.txt</code> was created with <code>open('playListNames.txt', 'w')</code> then the value returned by <code>locale.getpreferredencoding()</code> was used for encoding.</p>
<p>If the file was created manually then the encoding depends on the editor's default/preferred encoding.</p>
<ol start="2">
<li>Refer to <a href="https://stackoverflow.com/questions/191359/how-to-convert-a-file-to-utf-8-in-python">How to convert a file to utf-8 in Python?</a> or <a href="https://stackoverflow.com/questions/7256049/how-do-i-convert-an-ansi-encoded-file-to-utf-8-with-notepad">How do I convert an ANSI encoded file to UTF-8 with Notepad++? [closed]</a>.</li>
</ol>
</div>
<div class="post-text" itemprop="text">
<p>Using an encoding will fix your problem.  Windows defaults to an ANSI encoding that on US Windows is Windows-1252.  It doesn't support Chinese.  You should use <code>utf8</code> or <code>utf-8-sig</code> as the encoding.  Some Windows editors prefer the latter and assume ANSI otherwise.</p>
<pre><code>with open('playListNames.txt','w',encoding='utf-8-sig') as f:
</code></pre>
</div>
<span class="comment-copy">Are you sure that the gibberish is not due to your editor/whatever you use to display the results?</span>
<span class="comment-copy">I just copied this code into a file and ran it without errors using the URL to gave. I'd show you some output but I'm having copy-and-paste issues, sorry. Are you running this code under Python 2, by any chance?</span>
<span class="comment-copy">@ArneRecknagel I don't think so; I'm using Sublime Text 2</span>
<span class="comment-copy">@holdenweb That's strange; I'm running the code under Python 3 with the Spyder IDE</span>
<span class="comment-copy">You are appending to <code>playListNames.txt</code>. Are you sure the file's encoding is UTF? Did you try <code>creating a new file open("playListNames_new.txt", "w")</code> (and perhaps set encoding)?</span>
<span class="comment-copy">To be more accurate, <i>Windows</i> doesn't care about file encodings at all, it is <i>Text Editors</i>, like Notepad, that do.</span>
