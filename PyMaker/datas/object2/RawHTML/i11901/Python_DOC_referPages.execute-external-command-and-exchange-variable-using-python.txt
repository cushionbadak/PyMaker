<div class="post-text" itemprop="text">
<h3>1. Introduction</h3>
<p>I have a bunch of files in <strong>netcdf</strong> format. 
Each file contain the meteorology condition of somewhere in different period(hourly data).<br/>
I need to extract the first 12 h data for each file. So I select to use NCO(netcdf operator) to deal with.     </p>
<p><strong>NCO</strong> works with terminal environment. With <code>&gt;ncks -d Time 0,11 input.nc output.nc</code>, I can get one datafile called <code>out.nc</code>which contain the first 12h data of <code>in.nc</code>.</p>
<h3>2. My attempt</h3>
<p>I want to keep all the process inside my ipython notebook. But I stuck on two aspects.   </p>
<blockquote>
<ol>
<li><p>How to execute terminal code in python loop</p></li>
<li><p>How to transfer the string in python into terminal code.    </p></li>
</ol>
</blockquote>
<p>Here is my fake code for example.     </p>
<pre><code>files = os.listdir('.')
for file in files:
    filename,extname = os.path.splitext(file)
    if extname == '.nc':   
        output = filename + "_0-12_" + extname
        ## The code below was my attempt
        !ncks -d Time 0,11 file output` 
</code></pre>
<h3>3. Conclusion</h3>
<p>Basically, my target was letting the fake code <code>!ncks -d Time 0,11 file output</code> coming true.  That means:</p>
<ol>
<li>execute netcdf operator directly in python loop...</li>
<li>...using <code>filename</code> which is an string in python environment.   </li>
</ol>
<p>Sorry for my unclear question. Any advice would be appreciated!</p>
</div>
<div class="post-text" itemprop="text">
<p>You can use <a href="https://docs.python.org/3/library/subprocess.html#subprocess.check_output" rel="nofollow"><code>subprocess.check_output</code></a> to execute external program:</p>
<pre><code>import glob
import subprocess

for fn in glob.iglob('*.nc'):
    filename, extname = os.path.splitext(fn)
    output_fn = filename + "_0-12_" + extname
    output = subprocess.call(['ncks', '-d', 'Time', '0,11', fn, output_fn])
    print(output)
</code></pre>
<p>NOTE: updated the code to use <a href="https://docs.python.org/3/library/glob.html#glob.iglob" rel="nofollow"><code>glob.iglob</code></a>; you don't need to check extension manually.</p>
</div>
<div class="post-text" itemprop="text">
<p>You may also check out <a href="http://pynco.readthedocs.org/en/latest/#examples" rel="nofollow">pynco</a> which wraps the NCO with subprocess calls, similar to @falsetru's answer. Your application may look something like</p>
<pre><code>nco = Nco()
for fn in glob.iglob('*.nc'):
    filename, extname = os.path.splitext(fn)
    output_fn = filename + "_0-12_" + extname
    nco.ncks(input=filename, output=output_fn, dimension='Time 0,11')
</code></pre>
</div>
<span class="comment-copy">"<code>...input.nc output.nc</code>, I can get one datafile called <b>out.nc</b> which contain the first 12h data of <b>in.nc</b>" can I assume this inconsistency of files is a typo?</span>
<span class="comment-copy">have you looked at <a href="https://docs.python.org/2/library/os.html?module-os#os.system" rel="nofollow noreferrer"><code>os.system</code></a>, <a href="https://docs.python.org/2/library/subprocess.html#subprocess.call" rel="nofollow noreferrer"><code>subprocess.call</code></a> and <a href="https://docs.python.org/2/library/sys.html?highlight=sys.argv#sys.argv" rel="nofollow noreferrer"><code>sys.argv</code></a>?</span>
<span class="comment-copy">I tried <code>os.system("my command here")</code> and <code>subprocess.call([])</code>. They all failed to achieve.</span>
<span class="comment-copy">I meant did you look at the documentation, <code>subprocess.call</code> won't let you just use <code>ncks</code> without specifying the full path or <code>shell=True</code></span>
<span class="comment-copy">Thanks for you comments! I have tried <code>subprocess.call</code> and <code>subprocess.check_output</code> in ipython notebook environment. The second one works. But they all works well in python console.</span>
<span class="comment-copy">you could've used <code>files = glob('*.nc')</code></span>
<span class="comment-copy">Thanks for your answer. I have already try it, but it seems not working.</span>
<span class="comment-copy">@NizamMohamed, Thank you for your comment. I updated the code to use <code>glob.iglob</code>.</span>
<span class="comment-copy">@HanZhengzu, How does it not work? It would be nice if you give more detail.</span>
<span class="comment-copy">For a test, directly using <code>subprocess.call(['ncks', '-d', 'Time', '0,11', "test.nc", "output.nc"])</code>. The python console return <code>&gt; 1</code>. But using <code>!ncks -d Time,0,11 test.nc output.nc </code> works.</span>
<span class="comment-copy">Thanks for your answer!</span>
