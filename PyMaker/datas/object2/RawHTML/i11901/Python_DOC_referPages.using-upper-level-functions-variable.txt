<div class="post-text" itemprop="text">
<div class="question-status question-originals-of-duplicate">
<p>This question already has an answer here:</p>
<ul>
<li>
<a dir="ltr" href="/questions/2009402/read-write-python-closures">Read/Write Python Closures</a>
<span class="question-originals-answer-count">
                    7 answers
                </span>
</li>
</ul>
</div>
<p>I want to use the <code>num_samples</code> variable that I have defined in the <code>make_averaged</code> function. When I use the variable in <code>fun_averaged</code> it should search it in the scope of its <code>upper level</code> function.</p>
<pre><code>def make_averaged(fn, num_samples=1000):
    def fun_averaged(*args) :
        totalave = 0
        savenum = num_samples
        while not num_samples == 0:
            totalave = fn(*args) + totalave
            num_samples -= 1
        avetagevalue = totalave/savenum
        return avetagevalue
    return fun_averaged
</code></pre>
<p>However I get an Error</p>
<pre><code>    while not samples1 == 0:
UnboundLocalError: local variable 'samples1' referenced before assignment
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>Changing:</p>
<pre><code>while not num_samples == 0:
    totalave = fn(*args) + totalave
    num_samples -= 1
</code></pre>
<p>into:</p>
<pre><code>for _ in range(num_samples):
    totalave = fn(*args) + totalave
</code></pre>
<p>Should help. You can access <code>num_samples</code> from the outer function but you cannot assign to it with <code>+=</code>.</p>
<p>I do <strong>not</strong> recommend it for this case, but in Python 3 you can use <a href="https://docs.python.org/3/reference/simple_stmts.html?highlight=nonlocal#nonlocal" rel="nofollow"><code>nonlocal</code></a> to actual do what you intend:</p>
<pre><code>nonlocal num_samples
while not num_samples == 0:
    totalave = fn(*args) + totalave
    num_samples -= 1
</code></pre>
<p>It works for the first call of <code>fun_averaged</code>. But the next time you call <code>fun_averaged</code> the value of <code>num_samples</code> will be <code>0</code>.</p>
</div>
<span class="comment-copy">Wouldn't just one function be simpler here?</span>
<span class="comment-copy">The error doesn't seem to have occurred in the code shown.</span>
<span class="comment-copy">So where do you define <code>samples1</code>?</span>
<span class="comment-copy">You are not passing any arguments to <code>fun_averaged()</code>.</span>
<span class="comment-copy">Read <a href="http://stackoverflow.com/q/141642">What limitations have closures in Python compared to language X closures?</a></span>
<span class="comment-copy">I have to use outer function? I thought "fun_averaged(*args)" will search the value of "num_samples" in "make_averaged" because it live inside of  "make_averaged"</span>
<span class="comment-copy">It can see and use it, but it cannot assigned to it. As soon as you use <code>+=</code> it considers <code>num_samples</code> a local variable.</span>
<span class="comment-copy">Thank you very much!</span>
<span class="comment-copy">Actually,it can not be used in outer function too.I can only use nonlocal</span>
