<div class="post-text" itemprop="text">
<p>I have a number of non-JPEG image files that I want to process using Google Cloud Vision, but the API only accepts certain formats (see question <a href="https://stackoverflow.com/questions/36728347/cloud-vision-api-pdf-ocr">Cloud Vision API - PDF OCR</a> and answer <a href="https://cloud.google.com/vision/docs/supported-files" rel="nofollow noreferrer">https://cloud.google.com/vision/docs/supported-files</a>).</p>
<p>I can use PIL or some such to convert a TIFF to JPEG to be uploaded, but I'd like to avoid a temp file if possible.</p>
<p>So, in python, how do I convert a TIFF in-memory for upload to GCV? numpy array, base64, string..?</p>
</div>
<div class="post-text" itemprop="text">
<p>As suggested, you should use StringIO or BytesIO for Python 3.</p>
<p>See this question: <a href="https://stackoverflow.com/questions/45176829/python-resize-image-and-send-to-google-vision-function">Python resize image and send to google vision function</a></p>
<p>Example making a request string:</p>
<pre><code>output = BytesIO()
image_object.save(output, 'JPEG', quality=90)
contents = output.getvalue()
output.close()
ctxt = b64encode(contents).decode()

request_string = [{
    'image': {'content': ctxt},
    'features': [{
        'type': 'TEXT_DETECTION',
        'maxResults': 1
        }]
}]
</code></pre>
</div>
<span class="comment-copy">Consider writing to a string instead of to a disk file: <a href="https://docs.python.org/2/library/stringio.html" rel="nofollow noreferrer">docs.python.org/2/library/stringio.html</a></span>
<span class="comment-copy">wouldn't it be more logic to go for a <a href="https://docs.python.org/3/library/io.html#buffered-streams" rel="nofollow noreferrer">BytesIO</a> instead of a string representation?</span>
<span class="comment-copy">@YvesDaoust So how exactly (example code) do I use to convert to stringio/BytesIO, and how do I send that to GCV? Thanks!</span>
<span class="comment-copy">Fine, but I don't think it's an unreasonable request. Nor is it straightforward question. Being a coding site, answers are often given in terms of code, no?</span>
<span class="comment-copy">Also, the GCV documentation is poor/internally written - stackoverflow seems like the obvious location to augment this</span>
<span class="comment-copy">Thank you - just what I was looking for - was all very opaque to me - will give it a whirl :)</span>
<span class="comment-copy">Pay attention to the quality setting. The default setting is 75 which might deteriorate your image quality and the subsequent results you get from Google. Setting it too high will increase your image size and you might hit the 4MB image size limit.</span>
<span class="comment-copy">Thanks, indeed, noted!</span>
