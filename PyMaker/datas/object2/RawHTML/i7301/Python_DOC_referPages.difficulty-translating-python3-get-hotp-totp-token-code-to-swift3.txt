<div class="post-text" itemprop="text">
<p>Recently I found <a href="https://codereview.stackexchange.com/questions/169424/2-factor-authentication-code-generator-in-python-3">this awesome 2-factor authentication code generator</a> written in Python 3. I was trying to convert it to Swift 3, but I am having trouble with one specific part, though:</p>
<pre><code>def get_hotp_token(secret, intervals_no):
    key = base64.b32decode(secret)
    msg = struct.pack("&gt;Q", intervals_no)
    h = hmac.new(key, msg, hashlib.sha1).digest()
    o = h[19] &amp; 15
    h = (struct.unpack("&gt;I", h[o:o+4])[0] &amp; 0x7fffffff) % 1000000
    return h
</code></pre>
<p>I so far have only been able to do the first line of the function body :p using code from <a href="https://gist.github.com/troupmar/b5bf94be41108a905fcc6a8d09031ced" rel="nofollow noreferrer">here</a></p>
<pre><code>func getHotpToken(secret: String) -&gt; [Int] {
    let data = secret.base32DecodedData
    &lt;...&gt;
    return theTokens
}
</code></pre>
<p>I tried reading the documentation on <code>struct.pack</code> <a href="https://docs.python.org/2/library/struct.html" rel="nofollow noreferrer">here</a> and reading about what packing actually is <a href="http://number-none.com/product/Packing%20Integers/index.html" rel="nofollow noreferrer">here</a>, but I still find the concept/implementation confusing, and I have no idea what the equivalent would be in Swift.</p>
<p>According to the documentation, <code>struct.pack</code> returns a string in the given format. The format in my case is <code>&gt;Q</code>, which means that the byte order is <code>little-endian</code> and the C Type is an <code>unsigned long long</code>. Again, I am not exactly sure how this is supposed to look in Swift. </p>
<p>... And that is only the second line! I don't really understand how <a href="https://docs.python.org/3/library/hmac.html" rel="nofollow noreferrer"><code>HMAC</code></a> works (I can't even find the actual 'background' code), so I can't even translate the entire function. I could not find any native library for Swift that has this behavior.</p>
<p>Any pointers or help translating this function will be highly appreciated!</p>
<p><em><sub>P.S. I checked and I think that this is <a href="https://stackoverflow.com/help/on-topic">on topic</a></sub></em></p>
<p>Relevant imports:</p>
<pre><code>import base64, struct, hmac
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>I just finished converting my code to Swift 3. This is a little different from the Python version, since this is more of a framework-type thing. It took a lot of experimentation to get the <code>get_hotp_token</code> to work (for example the Wikipedia page says it used SHA256 but it actually uses SHA1. </p>
<p>You can find it <a href="https://github.com/danielVebman/Totp-Token/blob/master/DigitCode.swift" rel="nofollow noreferrer">here</a>. </p>
<p>When you use this, be sure to add a bridging header with <code>#import &lt;CommonCrypto/CommonHMAC.h&gt;</code></p>
<p>Enjoy!</p>
</div>
