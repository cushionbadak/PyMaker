<div class="post-text" itemprop="text">
<p>I'm using Python and OpenPyXL to merge two Excel reports.
When a report has a row of all zero values, that row should be deleted.</p>
<p>The command to delete rows seems simple enough, but it simply doesn't work. <a href="https://stackoverflow.com/questions/52144059/how-to-delete-excel-rows-in-openpyxl">Another post</a> suggests delete rows doesn't play nice with <code>append</code>. I'm not using this function, but maybe there are other finicky bits?</p>
<p>I'm processing the Excel files opening and saving groups of actions. Here is a comment-for-code version of the block where I'm deleting these rows. </p>
<pre><code># Get WB
# Get WS
i = 0
del_rows = []
for row in ws.iter_rows():
    i += 1
    if row[0].value is None:
        # INVALID DATA ROW - BLANK ROW
    else:
        rowcellvals = []
        j = 0
        for cell in row:
            j += 1
            if cell.value == row[0].value:
                # INVALID COLUMN VAL - SKIP ACC NAME COL
                continue
            elif cell.value is None:
                # SKIP TITLE ROWS
                break
            else:
                # VALID DATA ROW
                if j % 2 == 0:
                    rowcellvals.append(cell.value)

        if not rowcellvals:
            continue
        else:
            if sum(rowcellvals) == 0:
                del_rows.append(i)

for r in del_rows:
       ws.delete_rows(r, 1)

# SAVE
</code></pre>
<p>Any ideas why delete rows is not deleting?</p>
</div>
<div class="post-text" itemprop="text">
<p>Because you are deleting rows from the top of the worksheet you are adjusting row indices as you go. This means that as soon as you have deleted a single row, the indices for all the other rows you want to delete are wrong. To avoid this you should always delete rows from the bottom of the worksheet.</p>
<pre><code>for r in revesed(del_rows):
    ws.delete_rows(r)
</code></pre>
</div>
<span class="comment-copy">Don't use delete_rows in a loop, or if you do, reverse it.</span>
<span class="comment-copy">reverse it? I'm not familiar with a Python idiom as such.</span>
<span class="comment-copy">Read <a href="https://docs.python.org/3/library/stdtypes.html#range" rel="nofollow noreferrer">range</a>, view the example with <b>negative step</b>.</span>
