<div class="post-text" itemprop="text">
<p>I am trying to delete rows in SQLite based on Count and * of days.</p>
<p>Instead of writing multiple SQL commands like this:</p>
<pre class="lang-sql prettyprint-override"><code>DELETE * FROM result WHERE Count = 1 AND ("min(_time)" &lt; strftime('%s','now', '-7 day'));
DELETE * FROM result WHERE Count = 2 AND ("min(_time)" &lt; strftime('%s','now', '-14 day'))
DELETE * FROM result WHERE Count = 3 AND ("min(_time)" &lt; strftime('%s','now', '-28 day'));
</code></pre>
<p>and so on...</p>
<p>I am trying to find a way to use for loop where it increments Count and the * days</p>
<p>I tried this:</p>
<pre><code>data = c1.execute('''SELECT * FROM result;''')

for row in data:
    Count = row[1]
    days = row[7]
    c1.execute('''DELETE * FROM result WHERE Count = ? AND ("min(_time)" &lt; strftime('%s','now', '-? day'));''', (Count, days))
</code></pre>
<p>I am getting a <code>IndexError: tuple index out of range</code> under <code>days = row[7]</code>.  </p>
<p>I looked up the <a href="https://docs.python.org/3/library/exceptions.html#IndexError" rel="nofollow noreferrer">error</a> and changed the number see if it would fix it, still indexerror.</p>
<p>Sample data of the result table looks like this: "select * from result;" Columns exported from Splunk: src_ip, 'min(_time)', Count</p>
<pre><code>183.78.180.27|1542266993|1
185.189.150.42|1542246169|1
185.189.150.61|1542271436|1
2002:8672:d515::8672:d515|1537536602|3
150.135.165.114|1537288499|3
</code></pre>
<p>Am I getting the concept for the script correct? Any suggestions on the indexerror? Thank you!</p>
</div>
<div class="post-text" itemprop="text">
<p>Consider parameterizing the entire interval date, <code>'-7 day'</code>, <code>'-14 day'</code>, ... since qmark placeholders should not be quoted. Then, pass the built string into <code>.execute()</code> call:</p>
<pre><code>delete_sql = '''DELETE FROM result 
                WHERE [Count] = ? 
                AND ("min(_time)" &lt; strftime('%s', 'now', ?));
             '''

data = c1.execute("SELECT * FROM ...")

for i in data.fetchall():
    Count = i[0]
    days = '-{} day'.format(i[7])

    c1.execute(delete_sql, (Count, days))
    conn.commit()
</code></pre>
</div>
<div class="post-text" itemprop="text">
<blockquote>
<p><strong>Question</strong>: I am trying to find a way to use for loop where it increments Count and the * days</p>
</blockquote>
<p>Increment <code>Count</code> and <code>days</code>:</p>
<pre><code>    day = -7        
    for count in range(1, 4):
        print("WHERE Count = {} AND '{} day')".format(count, day))
        day = day * 2
</code></pre>
<blockquote>
<p><strong>Output</strong>:<br/>
<strong>Note</strong>: This is <strong>not</strong> ready to use for a SQL statement!</p>
<pre><code>WHERE Count = 1 AND '-7 day')
WHERE Count = 2 AND '-14 day')
WHERE Count = 3 AND '-28 day')
</code></pre>
</blockquote>
<p><strong><em>Tested with Python:3.5.3</em></strong></p>
</div>
<span class="comment-copy">It looks like you're assigning count the same thing every iteration of the for loop.</span>
<span class="comment-copy">I don't understand your second example code -- it does a SELECT and then another SELECT in a loop -- it never tries to DELETE, which is what you said you want.</span>
<span class="comment-copy">Please fix <a href="https://docs.python.org/2/library/sqlite3.html#sqlite3.Cursor.fetchall" rel="nofollow noreferrer"><code>cursor.fetchall</code></a> as it does not receive parameters.</span>
<span class="comment-copy">Thanks! So the Count gets incremented 0,1, 2, 3,... and so on, as well with days? Sorry I'm new with python :/   the code outputs an 'IndexError: tuple index out of range' at 'days = '-{} day'.format(row[7])' I am looking for a solution, appreciate any help!</span>
<span class="comment-copy"><i>Count</i> does not increment but uses what ever is the first column in your <code>SELECT * FROM ...</code> query and similarly the day value will derive from 8th column of same query. Please post a few rows of this result to see what loop fetches.</span>
<span class="comment-copy">appreciate the response! I work part time at university so my response can be late. Ok, I am getting an index error therefore could not get a result from the script. my select statement is <code>"SELECT * FROM result;"</code> I also need to increment Count so I put <code>Count = i[1]</code>. I am trying to delete rows based on Count and days like stated in the first commands I posted in the question. still looking into this. I appreciate the help!!</span>
<span class="comment-copy">Please edit your post with sample data of <i>result</i> table for a <a href="https://stackoverflow.com/help/mcve">Minimal, Complete, and Verifiable example</a>.</span>
<span class="comment-copy">@acb452: You have to use <code>Count = i[2]</code> and <code>days = '-{} day'.format(i[1])</code></span>
