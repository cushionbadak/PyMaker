<div class="post-text" itemprop="text">
<p>Good afternoon,</p>
<p>I am writing some ETL scripts with Python, and am currently using win32com.client to open and refresh some data connections in Excel. </p>
<p>My question is this: should I be using a <strong><em>with</em></strong> statement to open/close "Excel.Application" as such</p>
<pre><code>import win32com.client
xl = win32com.client.DispatchEx("Excel.Application")

def wb_ref(file):
    xl.DisplayAlerts = False
    with xl.workbooks.open(file) as wb:
        wb.RefreshAll()
        wb.Save()

wb_ref('C:/Users/smugs/Documents/folder_a/workbooks/test.xlsx')
</code></pre>
<p>When I have tried this an exception occurs, so I am obviously not using it correctly.</p>
<pre><code>Traceback (most recent call last):
  File "C:/Users/smugs/Documents/Python Scripts/Work/km_jobs/utils/xl_conv.py", line 32, in &lt;module&gt;
    wb_ref( 'C:/Users/smugs/Documents/folder_a/workbooks/test.xlsx')
  File "C:/Users/smugs/Documents/Python Scripts/Work/km_jobs/utils/xl_conv.py", line 11, in wb_ref
    with xl.workbooks.open(file) as wb:
AttributeError: __enter__
</code></pre>
<p>Or do I need to explicitly call the close command</p>
<pre><code>def wb_ref(file):
    xl.DisplayAlerts = False
    wb = xl.workbooks.open(file)
    wb.RefreshAll()
    wb.Save()
    wb.Close()

wb_ref('C:/Users/smugs/Documents/folder_a/workbooks/test.xlsx')
</code></pre>
<p>The second example is what I have been using, and it works. I guess I am just wondering what is the more pythonic way to script the above function.</p>
<p>(fyi - first time asker, longtime reader)</p>
</div>
<div class="post-text" itemprop="text">
<p>You get the <code>AttributeError: __enter__</code> error because <code>xl.workbooks.open</code> is not a <a href="https://docs.python.org/3/library/stdtypes.html#context-manager-types" rel="nofollow noreferrer">context manager</a>, and so it doesn't support the <code>with</code> statement.</p>
<p>If you want to use a <code>with</code> statement in your code you can use the <a href="https://docs.python.org/3/library/contextlib.html#contextlib.closing" rel="nofollow noreferrer">closing</a> function from the <a href="https://docs.python.org/3/library/contextlib.html" rel="nofollow noreferrer">contextlib</a> module in the standard library, like this:</p>
<pre><code>from contextlib import closing

def wb_ref(file):
    xl.DisplayAlerts = False
    with closing(xl.workbooks.open(file)) as wb:
        wb.RefreshAll()
        wb.Save()
</code></pre>
<p><code>contextlib.closing</code> will automatically call <code>close</code> on the object that is passed to it when the code in the <code>with</code> block has completed execution.</p>
</div>
<span class="comment-copy">you've provided some useful key details, but what do you mean by "is it okay?"  what have you tried?  what happened when you tried?  in what way were the results unexpected?  if they weren't unexpected, what about it is making you wonder whether or not it's "okay"?  please elaborate a bit, and I think it will be easier for others to answer your question; HTH</span>
<span class="comment-copy">Thank you @landru27 - I have updated the question with the exception that occurs when I use the with statement, which should help explain why I am asking the question.</span>
