<div class="post-text" itemprop="text">
<p>I'm building a docker image for some code that needs to be compiled using <a href="https://docs.python.org/3/extending/building.html" rel="nofollow noreferrer"><code>distutils.extension</code></a>. I have a Makefile which runs <code>python setup.py build_ext --inplace</code>.</p>
<p>Should I do </p>
<pre><code>RUN make 
</code></pre>
<p>or </p>
<pre><code>CMD ["make"]
</code></pre>
<p>I found a <a href="https://medium.com/@alexeiled/docker-pattern-the-build-container-b0d0e86ad601" rel="nofollow noreferrer">blog post for maven compile</a> which used <code>RUN</code>. Also this <a href="https://hub.docker.com/_/gcc/" rel="nofollow noreferrer">gcc image</a> suggests using <code>RUN gcc -o myapp main.c</code>, suggesting that <code>RUN</code> will work to compile my code, but  other resources (<a href="https://forums.docker.com/t/how-to-build-c-image-in-a-container/37668" rel="nofollow noreferrer">How to build a c-image in a container</a>, <a href="https://stackoverflow.com/questions/41688748/should-i-compile-my-application-inside-of-a-docker-image">Should I Compile My Application Inside of a Docker Image</a>) suggest that including compiled code in the image balloons its size, which makes me think I should use <code>CMD</code> because that won't be executed until the container is run. </p>
</div>
<div class="post-text" itemprop="text">
<p>RUN comamnds are executed once when the image is building. CMD will execute everytime the container is started.</p>
<p>Using CMD will cause your code to compile every time the container is started. Does your image intends on running the aplication or just creating the aplication, then move it somewhere else? For the former you will definitely want to use RUN to compile it when the image is being built.</p>
<p>Increased image size isn't a concern anymore since the introducion of <a href="https://docs.docker.com/develop/develop-images/multistage-build/#use-multi-stage-builds" rel="nofollow noreferrer">multi stage builds</a>, as you can compile your application in one image then only transfer the resulting executable to the final image.</p>
<p>It makes no sense to compile in the CMD phrase unless you have a specific reason to do so.</p>
</div>
