<div class="post-text" itemprop="text">
<p>I am creating a Dataframe by taking input file from user on a website and processing it.After that I want the user to download the final result in a csv file.For that a Dataframe is required from previous function.</p>
<p>I have tried passing the dataframe but it is giving me error as it is defined in another function.</p>
<p>My code is </p>
<pre><code>from flask import Flask, render_template, request, redirect
from werkzeug import secure_filename
app = Flask(__name__)


@app.route('/uploader', methods = ['GET','POST'])
def upload():
 new=nrecs[['UserID','ProductID','Rating']]
 new['Recommendations'] = list(zip(new.ProductID, new.Rating))
 res=new[['UserID','Recommendations']]  
 res_new=res['Recommendations'].groupby([res.UserID]).apply(list).reset_index()
 pd.options.display.max_colwidth = 500
 return render_template('simple.html', tables=[res_new.to_html(classes='data')], titles='') 

@app.route('/download-csv', methods = ['GET'])
def download():
return res_new.to_csv('Recommendations.csv')
</code></pre>
<p>This is a small snipet of my code not the full code.</p>
<p>When a user will click on download recommendations button it should download the csv file.</p>
<p>Is there any other way around it can be done.</p>
</div>
<div class="post-text" itemprop="text">
<p>You can also store the file on the server and send it to the user in your download-csv route. Here is a <a href="https://pythonprogramming.net/flask-send-file-tutorial/" rel="nofollow noreferrer">send file tutorial</a></p>
<pre><code>from flask import Flask, render_template, send_file
app = Flask(__name__)

@app.route('/uploader', methods = ['GET','POST'])
def upload():
    new=nrecs[['UserID','ProductID','Rating']]
    new['Recommendations'] = list(zip(new.ProductID, new.Rating))
    res=new[['UserID','Recommendations']]
    res_new=res['Recommendations'].groupby([res.UserID]).apply(list).reset_index()

    # store the dataframe on the server.
    res_new.to_csv('Recommendations.csv')

    pd.options.display.max_colwidth = 500
    return render_template('simple.html', tables=[res_new.to_html(classes='data')], titles='')

@app.route('/download-csv', methods = ['GET'])
def download():

    # return the CSV file to the user here.
    return send_file('Recommendations.csv')
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>You can try using a session object. See <a href="https://stackoverflow.com/questions/49664010/using-variables-across-flask-routes">this question/answer</a>. However, depending on the size of the dataframe, and what you are ultimately trying to do, this may not be the best way to do this. If you are trying to set up upload/download routes, storing the file on the server/elsewhere and then sending it to the user when they request it may be a better solution.</p>
<pre><code>from flask import Flask, render_template, session
app = Flask(__name__)
# secret key is needed for session
app.secret_key = 'your secret key'

@app.route('/uploader', methods = ['GET','POST'])
def upload():
    new=nrecs[['UserID','ProductID','Rating']]
    new['Recommendations'] = list(zip(new.ProductID, new.Rating))
    res=new[['UserID','Recommendations']]
    res_new=res['Recommendations'].groupby([res.UserID]).apply(list).reset_index()

    session['reco_df'] = res_new

    pd.options.display.max_colwidth = 500
    return render_template('simple.html', tables=[res_new.to_html(classes='data')], titles='')

@app.route('/download-csv', methods = ['GET'])
def download():
    return session['reco_df'].to_csv('Recommendations.csv')
</code></pre>
</div>
<span class="comment-copy">I don't see where/how <code>nrecs</code> is defined. Does it come from a form submission in that /uploader route?</span>
<span class="comment-copy">This is not the full code I have tried to upload the important parts of my code as it would be lenghty..nrecs is coming from after processing the file which user have uploaded.I have not shown that code.</span>
<span class="comment-copy">I want to use res_new dataframe in another function download () which is defined below in the code.</span>
<span class="comment-copy">Thanks for helping.But this is not working.</span>
<span class="comment-copy">What is not working? What errors are you getting, etc?</span>
<span class="comment-copy">I am getting KeyError: reco_df</span>
<span class="comment-copy">Is that happening when you try to download, or in which route? Have you tried to print out what is in the session variable?</span>
<span class="comment-copy">The key error is solved.After searching I came to know that for storing dataframe in session I have to use method given in this answer. <a href="https://stackoverflow.com/questions/43302961/trying-load-a-pandas-dataframe-into-flask-session-and-use-that-throughout-the-se" title="trying load a pandas dataframe into flask session and use that throughout the se">stackoverflow.com/questions/43302961/â€¦</a></span>
