<div class="post-text" itemprop="text">
<p>I'm trying to use <a href="https://docs.python.org/2/library/csv.html#csv.Sniffer" rel="noreferrer">python's CSV sniffer tool</a> as suggested in many StackOverflow answers to guess if a given CSV file is delimited by <code>;</code> or <code>,</code>.</p>
<p>It's working fine with basic files, but when a value contains a delimiter, it is surrounded by double quotes (as the standard goes), and the sniffer throws <code>_csv.Error: Could not determine delimiter</code>.</p>
<p>Has anyone experienced that before?</p>
<p>Here is a minimal failing CSV file:</p>
<pre><code>column1,column2
0,"a, b"
</code></pre>
<p>And the proof of concept:</p>
<pre><code>Python 3.5.1 (default, Dec  7 2015, 12:58:09) 
[GCC 5.2.0] on linux
Type "help", "copyright", "credits" or "license" for more information.
&gt;&gt;&gt; import csv
&gt;&gt;&gt; f = open("example.csv", "r")
&gt;&gt;&gt; f.seek(0);
0
&gt;&gt;&gt; csv.Sniffer().sniff(f.read(), delimiters=';,')
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in &lt;module&gt;
  File "/usr/lib/python3.5/csv.py", line 186, in sniff
    raise Error("Could not determine delimiter")
_csv.Error: Could not determine delimiter
</code></pre>
<p>I have total control over the generation of input CSV file; but sometimes it is modified by a third party using MS Office and the delimiter is replaced by semicolumns, so I have to use this guessing approach.
I know I could stop using commas in the input file, but I would like to know if I'm doing something wrong first.</p>
</div>
<div class="post-text" itemprop="text">
<p>You are giving the sniffer too much input. Your sample file does work if you run:</p>
<pre><code>csv.Sniffer().sniff(f.readline())
</code></pre>
<p>which uses only the header row to determine the delimiter character. If you want to understand why the Sniffer heuristics fail for more data, there is no substitute for <a href="https://github.com/python/cpython/blob/master/Lib/csv.py#L165" rel="noreferrer">reading the csv.py library source code</a>.</p>
</div>
<span class="comment-copy">Thanks, I ended up doing like you suggested. That's sad that that's the only way though.</span>
<span class="comment-copy">Thank you!! This seems like a major deficiency of the <a href="https://docs.python.org/3/library/csv.html#csv.Sniffer" rel="nofollow noreferrer">Python documentation</a> which shows the problematic method of reading 1024 bytes: <code>dialect = csv.Sniffer().sniff(csvfile.read(1024))</code>. CSV files are always text files with multiple lines, so it seems that <code>f.readline()</code> is the right option.</span>
<span class="comment-copy">@msw the link to the CSV source, line 165 now points to an empty line. Not sure if you meant to point to a specific part of the source or not, but if you did it would be a good idea to link to a specific commit for a stable line linking.</span>
