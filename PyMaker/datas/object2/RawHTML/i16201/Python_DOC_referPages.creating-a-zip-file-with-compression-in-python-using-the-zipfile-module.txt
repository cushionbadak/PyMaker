<div class="post-text" itemprop="text">
<p>I am new to python. My requirement is to zip (with compression) all files from a source directory to a target directory. I have used following code from stackOverFlow. </p>
<pre><code>import zipfile, os
locfile = "D:\Python\Dir_dir\Dir_dir\ABC.txt"
loczip = "D:\Python\Dir_dir\Dir_dir2\ABC_TEST.zip"
zip = zipfile.ZipFile (loczip, "w")
zip.write (locfile)
zip.close()
</code></pre>
<p>It is creating a zip file but it contains the entire inherited directory structure. Except the drive(D:/) the rest of the structure is added to zip. It looks like the following:
        "D:\Python\Dir_dir\Dir_dir2\ABC_TEST.zip\Python\Dir_dir\Dir_dir\ABC.txt"</p>
<p>whereas i wanted:
         "D:\Python\Dir_dir\Dir_dir2\ABC_TEST.zip\ABC.txt"</p>
<p>Also it is not compressed.</p>
<p>Please anyone share the solution for this problem.</p>
<p>Thanks,
Subrat</p>
</div>
<div class="post-text" itemprop="text">
<p>To enable compression, specify compression method in the constructor:</p>
<pre><code>zip = zipfile.ZipFile(loczip, "w", zipfile.ZIP_DEFLATED)
</code></pre>
<p>I think you are asking to remove the relative paths of files inside the zip file. If you <em>really</em> want that, you could write:</p>
<pre><code>zip.write(locfile, os.path.basename(locfile))
</code></pre>
<p>However this is probably a bad idea, since removing all path information would result in a naming conflict if you zip up two files with the same name.</p>
</div>
<div class="post-text" itemprop="text">
<p>Check the <a href="https://docs.python.org/3/library/zipfile.html" rel="nofollow">official documentation</a> and it addresses your issues clearly.</p>
<pre><code>ZipFile.write(filename, arcname=None, compress_type=None)
</code></pre>
<p>compress should be one of the defined constants, e.g., ZIP_DEFLATED</p>
<p>Note that you can also specifcy the conmpression type on the constructor and it
will apply to all files added to the zip archive.</p>
<p>The documentation also includes this note: Archive names should be relative to the archive root, that is, they should not start with a path separator.</p>
<p>Also if you had simply entered <strong>python zipfile</strong> into any search engine, you would have seen the official documentation as one of the first links.</p>
</div>
<span class="comment-copy">Your code does not create a zip file that "contains the entire inherited directory structure". It has one file in with a path of <code>Python\Dir_dir\Dir_dir</code> which is correct (see <a href="https://dl.dropboxusercontent.com/u/5508445/stackoverflow/Zipfile_module_test.png" rel="nofollow noreferrer">screenshot</a>) since archive file names should be relative to the archive root, so shouldn't start with path separator (or drive letter). This is in the <a href="https://docs.python.org/2/library/zipfile.html?highlight=write#zipfile.ZipFile.write" rel="nofollow noreferrer">documentation</a>, so I suggest you augment your reading of stackOverFlow code with looking at that.</span>
<span class="comment-copy">As an aside, use raw strings or double-escape backslashes in Windows path names (add an r to the front like <code>r"D:\Python\Dir_dir\Dir_dir2\ABC_TEST.zip"</code>). Otherwise, Python will convert sequences like '\t' and '\n' to tabs and new lines.</span>
<span class="comment-copy">Or just use forward slashes, easy to do, easy to read.</span>
<span class="comment-copy">Completely removing the directory structure of the file added to the archive is not what the OP wants. You might also mention how you've arranged for the data to be compressed.</span>
<span class="comment-copy">@martineau - explained compression as you suggested</span>
<span class="comment-copy"><code>os.path.basename(locfile)</code> sets the file name in the archive to just <code>'ABC.txt'</code> with all path information stripped. That might be OK for first level files in the source directory, but there are some in any subfolders, it likely be a problem.</span>
<span class="comment-copy">We're interpreting "i wanted: "D:\Python\Dir_dir\Dir_dir2\ABC_TEST.zip\ABC.txt" differently. Did you look at the <a href="https://dl.dropboxusercontent.com/u/5508445/stackoverflow/Zipfile_module_test.png" rel="nofollow noreferrer">screenshot</a> I made of what's produced?</span>
<span class="comment-copy">@martineau - I have reworded my answer to make my interpretation of the question clearer, and to make sure the OP understands why it could be a problem.</span>
