<div class="post-text" itemprop="text">
<p>How tuples, lists and dictionaries are stored in backend in python?
Why cannot we change tuples once assigned? How it works in background?</p>
</div>
<div class="post-text" itemprop="text">
<p>How they're stored in the backend is different for each Python implementation.</p>
<p>But how they're stored has almost nothing to do with why you can't change tuples. You can't change tuples because they were designed to be immutable. They don't implement a <code>__setitem__</code> method or an <code>append</code> method. In <a href="https://docs.python.org/3/library/collections.abc.html#abcs-abstract-base-classes" rel="nofollow">ABC</a> terms (which is almost always what you actually care about, not the underlying implementation), they implement only <code>Sequence</code>, not <code>MutableSequence</code>. Under the covers, on most implementations, they aren't much different from lists, except that they may not know how to expand; the difference is really just that the mutating methods are not implemented.</p>
<hr/>
<p>In CPython:</p>
<p>Tuples and lists are a small header and a pointer to a contiguous array of pointers to <code>PyObject</code>. If you append to a list when it's already filled the array, it allocates a new, larger array, copies over the existing pointers, then erases the old one.</p>
<p>Dictionaries are a small header plus a pointer to a hash table,* where each bucket is a hash value, a key, and a value (with the keys and values being pointers to <code>PyObject</code>).</p>
<p>The details are documented as part of the C API, in the <a href="https://docs.python.org/3/c-api/concrete.html" rel="nofollow">Concrete Objects Layer</a>. The source code is in the <a href="http://hg.python.org/cpython/file/default/Objects" rel="nofollow">Objects</a> directory. (Notice that at the C API level, you can actually call <code>PyTuple_SetItem</code>, and even <code>_PyTuple_Resize</code>, but you're strongly discouraged from doing so if any Python code may be able to see the tuple.)</p>
<p><sub>* Actually, in the latest versions, the hash table can be split into two parts, so that multiple dictionaries can share the same keys. See <a href="http://legacy.python.org/dev/peps/pep-0412/" rel="nofollow">PEP 412</a> and the comments in <code>dictobject.c</code> for details on how that works.</sub></p>
<hr/>
<p>In PyPy, Python list, tuple, and dict objects are actually implemented in RPython (a subset of Python), which is translated to C through the usual PyPy magic. The tuple and list are pretty much what you'd expect, but the dict has some clever tricks that are worth reading.*</p>
<p><sub>* It basically takes the same "split table" idea furtherâ€”or, more accurately, CPython borrowed PyPy's split table idea and didn't take it as far.</sub></p>
<hr/>
<p>In Jython and IronPython, they're implemented in Java and C#, respectively. IIRC, early versions of Jython directly used Java collection types for Python types, but they stopped that a long time ago and the code is more similar to CPython (just on top of a Java Array instead of a C pointer-to-a-<code>malloc</code>-region). The implementation is pretty similar to CPython in the 2.5-2.7 days. I assume IronPython is similar, but I haven't looked.</p>
<hr/>
<p>In both of the partial Python-in-JavaScript implementations I know of, all three types are implemented on top of JS <code>Object</code>s, but they have to do some ugly stuff with the keys for <code>dict</code>.</p>
</div>
<span class="comment-copy">You can't change tuples because they promise to be immutable. This way 10 objects can share one tuple object without needing to make copies to avoid accidental changes</span>
<span class="comment-copy">Which backend? CPython? Jython? PyPy?</span>
<span class="comment-copy">Don't view immutable as "cannot change", see it as "does not change". It's a good thing, as @Kos mentions. We, the programmers, chose it. It's often possible to change immutable objects, it's just not meant to be done. To get your answers you probably need to look at some source code.</span>
<span class="comment-copy">@keyser How, exactly, does one change an immutable object?</span>
<span class="comment-copy">@chepner It depends on the language/structure. Of course it isn't always possible. All I'm saying is that it's more of a pattern than a lock. Making it hard/impossible to actually change the object comes with the territory, but sometimes it's just a contract, from what I've read. (I tried to find a related javalobby post, but with no luck)</span>
