<div class="post-text" itemprop="text">
<p>I am trying to build docker with simple python script the read from a file and print it.<br/>
I want that the python script will continue to read from the file as new data may be available in the file.<br/>
But when the <strong>file does not exist</strong> when the scripts start it seems that tail does not work and does not read the file.<br/>
Here is simple example:  </p>
<p><strong>dockerfile</strong> (uncomment to illustrate the problem)  </p>
<pre><code>FROM ubuntu:18.10
RUN apt-get update     &amp;&amp; apt-get install -y --no-install-recommends python3    &amp;&amp; rm -rf /var/lib/apt/lists/*
#RUN touch /tmp/file # uncomment will cause the problem
COPY . /app/
CMD ["python3","/app/main.py"]
</code></pre>
<p><strong>main.py</strong> </p>
<pre><code>import subprocess
argsList = ['tail', '-c-1', '-F', '/tmp/file']
f = subprocess.Popen(argsList, stdout=subprocess.PIPE, stderr=subprocess.PIPE)
line = f.stdout.readline()
while line != b'':
    line = f.stdout.readline().decode("utf-8")
    print(line)
</code></pre>
<p>If I enter to the docker (<strong>when there is no</strong> /tmp/file) and start to write to that file (using echo "text" &gt;&gt; /tmp/file) I <strong>can</strong> see the output in the docker screen.<br/>
But if I <strong>uncomment the touch comment</strong> in the dockerfile (that cause /tmp/file to be created) I <strong>can not</strong> see any output in the docker screen although I use the same command(echo "text" &gt;&gt; /tmp/file).<br/>
Why there is such a diffrent and how I can see the output even if the file exists?</p>
<p><strong><em>-- edit --</em></strong><br/>
I have tried to add exit(1) after the first read line to negate buffer problem.<br/>
The result was pretty much the same:<br/>
When the line was commant the container exit as expected (with exit code 1)<br/>
but when the line was uncommant the container does not exit at all (probably stuck on reading from the pipe).<br/>
<strong>main.py</strong></p>
<pre><code>import subprocess
argsList = ['tail', '-c-1', '-F', '/tmp/file']
f = subprocess.Popen(argsList, stdout=subprocess.PIPE, stderr=subprocess.PIPE)
line = f.stdout.readline()
exit(1)
</code></pre>
<p><strong><em>-- edit 2 --</em></strong><br/>
The problem happen also if there is only the docker file:<br/>
<strong>dockerfile</strong></p>
<pre><code>FROM ubuntu:18.10
#RUN touch /tmp/file
CMD "tail" "-c-1" "-F" "/tmp/file"
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>Try with sys.stdout.flush() after print, to force output buffer being printed on the screen too. It seems to work for me (same dockerfile and script)</p>
</div>
<div class="post-text" itemprop="text">
<p>It's known behavior, this problem related to zero size file, and if you will try to use simple <code>tail -f</code> in the container, you will see the same behavior. The same <a href="https://stackoverflow.com/questions/43802109/output-of-tail-f-at-the-end-of-a-docker-cmd-is-not-showing">topic</a> explains why.</p>
<p>This option, that zero file exists is synthetic, in real life real streams creates files with content, so this is why this question is not so popular across the Internet.</p>
<p>As mentioned in topic, you need to verify that file exists and size is not zero.</p>
</div>
<span class="comment-copy">It is interesting and maybe my problem but the difference is that I run tail with -F and in this question the tail run with -f.</span>
<span class="comment-copy">Have you tried to uncomment the touch command in the docker file?  The problem happen only if there is already a file.</span>
<span class="comment-copy">Yes, i tested with your dockerfile (<a href="https://pastebin.com/DF28GcBN" rel="nofollow noreferrer">pastebin.com/DF28GcBN</a>) and this main.py (<a href="https://pastebin.com/g3F884vd" rel="nofollow noreferrer">pastebin.com/g3F884vd</a>)</span>
<span class="comment-copy">I tried to do as you suggested but same result. I can not see any output from the container.</span>
<span class="comment-copy">Anyway I have added example without print,so unfortunately is not the buffer. :(</span>
<span class="comment-copy">Strange, it is working for me <a href="https://imgur.com/H8LaWhO" rel="nofollow noreferrer">imgur.com/H8LaWhO</a></span>
