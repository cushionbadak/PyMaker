<div class="post-text" itemprop="text">
<p>I have a python program with multiple threads.  Each thread detects events, which I would like to store somewhere so that I can read them in again (for testing).  Right now, I'm using Pickle to output the events, and each thread outputs to a different file.  Ideally, I would only use one output file, and all the threads would write to it, but when I try this, it looks like the various threads try to write their output at the same time, and they don't get pickled properly.  Is there a way to do this?</p>
</div>
<div class="post-text" itemprop="text">
<p>seems like a good place to use a <a href="http://docs.python.org/library/queue.html" rel="nofollow"><code>Queue</code></a>.</p>
<ul>
<li>Have all your event detection threads put items on a shared Queue.</li>
<li>Create another thread to get items from the queue, and write/pickle/whatever from this thread.</li>
</ul>
<p>from the Queue docs:</p>
<blockquote>
<p>"The Queue module implements multi-producer, multi-consumer queues. It
  is especially useful in threaded programming when information must be
  exchanged safely between multiple threads. The Queue class in this
  module implements all the required locking semantics. It depends on
  the availability of thread support in Python; see the threading
  module."</p>
</blockquote>
</div>
<div class="post-text" itemprop="text">
<p>Yes, with <a href="http://docs.python.org/library/threading.html#lock-objects" rel="nofollow">threading.Lock()</a> objects.
You create a lock before creating all your threads, you give it to the method that is responsible of saving/pickling items, and this method should acquire the lock before writing into the file and releasing it after.</p>
</div>
<div class="post-text" itemprop="text">
<p>You could create a <a href="http://docs.python.org/library/threading.html#lock-objects" rel="nofollow">lock</a> and acquire/release it around every call to <code>pickle.dump()</code>.</p>
</div>
<div class="post-text" itemprop="text">
<p>The <a href="http://docs.python.org/library/logging.html#module-logging" rel="nofollow">logging</a> module has a <code>Rlock</code> built into its Handlers. So you could <code>logging</code> as normal (just create a handler to log to a file.)</p>
</div>
<div class="post-text" itemprop="text">
<p>Here is an example using <a href="https://docs.python.org/3/library/threading.html#lock-objects" rel="nofollow noreferrer">threading.Lock()</a>:</p>
<pre><code>import threading
import pickle
picke_lock = threading.Lock()
   def do(s):
       picke_lock.acquire()
       try:
           ps = pickle.dumps(s)
       finally:
           picke_lock.release()
       return ps

t1 = threading.Thread(target=do, args =("foo",))
t2 = threading.Thread(target=do, args =("bar",))
p1 = t1.start()
p2 = t2.start()

inpt = raw_input('type anything and click enter... ')
</code></pre>
</div>
