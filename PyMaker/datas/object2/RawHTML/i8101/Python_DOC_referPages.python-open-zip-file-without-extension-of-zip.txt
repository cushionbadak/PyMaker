<div class="post-text" itemprop="text">
<div class="question-status question-originals-of-duplicate">
<p>This question already has an answer here:</p>
<ul>
<li>
<a dir="ltr" href="/questions/12025469/how-to-read-from-a-zip-file-within-zip-file-in-python">How to read from a zip file within zip file in Python?</a>
<span class="question-originals-answer-count">
                    3 answers
                </span>
</li>
</ul>
</div>
<p>I have a zip file called "main.zip". Inside that, I have another zip called "meta" which does not have the ".zip" extension. I want to open the "meta" zip file which contains lots of text files. But when I try to open the "meta" zip file, I get an error saying <code>zipfile.BadZipfile: File is not a zip file</code>. Below is my code:</p>
<pre><code>zf = zipfile.ZipFile(inputZipFile, 'r')
print(zf.namelist())    # [u'meta']
zf2 = zipfile.ZipFile(zf.open('meta')) # throws error
</code></pre>
<p>I can't extract and open "meta" because I want to do this entirely in memory without writing to the disk.</p>
<p>My ultimate goal is to modify one of the text files and output  a new zip.</p>
</div>
<div class="post-text" itemprop="text">
<p>If you're intent on doing this in memory, you need to create a file-like object to call <code>zipfile.ZipFile</code> on. Although <a href="https://docs.python.org/3/library/zipfile.html?highlight=zipfile#zipfile.ZipFile.open" rel="nofollow noreferrer"><code>ZipFile.open</code></a> says that it does this, in practice I'm getting the same error you are.</p>
<p>What I've gotten to work is to read the binary with <a href="https://docs.python.org/3/library/zipfile.html?highlight=zipfile#zipfile.ZipFile.read" rel="nofollow noreferrer"><code>ZipFile.read</code></a> and toss it into a <a href="https://docs.python.org/3/library/io.html?highlight=stringio#io.BytesIO" rel="nofollow noreferrer"><code>io.BytesIO</code></a> stream.</p>
<pre><code>import io

with zipfile.ZipFile("main.zip") as zf:
    f2 = io.BytesIO(zf.read("meta"))
    with zipfile.ZipFile(f2) as zf2:
        # this is inside the inner zip file
</code></pre>
</div>
<span class="comment-copy">What about <code>tempfile</code>?</span>
<span class="comment-copy">Is it just the extension, or is <code>meta</code> perhaps corrupted? Compare opening zip files with and without the extension.  What happens?</span>
<span class="comment-copy">@Prune I tried opening <code>meta</code> with .zip and it opened perfectly. And it's not currepted. I need to open it just as it is cuz I get the file from somewhere else.</span>
<span class="comment-copy">The extension is not the issue here, you are passing a <code>ZipExtFile</code> to <code>zipfile.ZipFile</code>.</span>
<span class="comment-copy">@JaredGoguen Per the documentation that should work though. <code>ZipFile.open</code> produces a "binary file-like object" which is what <code>zipfile.Zipfile</code> expects. I proposed a workaround as an answer below.</span>
<span class="comment-copy">That worked like magic. Seriously, I have been trying something similar since hours with <code>StringIO</code> but it didn't work. <code>BytesIO</code> did the job. Thank you</span>
