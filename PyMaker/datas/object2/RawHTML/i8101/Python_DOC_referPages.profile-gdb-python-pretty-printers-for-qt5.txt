<div class="post-text" itemprop="text">
<p>I'm trying to improve my own GDB pretty printers using the GDB python API.</p>
<p>Currently I'm testing them with a core. </p>
<p>I'm trying to get info for some QMap, QList content, but they have so many elements that printing them with it's contents is really slow (minutes). </p>
<p>So, I would like to know if there is any known way to profile which parts are slower.</p>
<p>I've already checked <a href="https://docs.python.org/3/library/profile.html#module-cProfile" rel="nofollow noreferrer">Python profile manual</a> and <a href="https://stackoverflow.com/a/2625366/721929">google-perftools</a>, but I don't know how to use them in the GDB execution cycle.</p>
<p>gdbcommands.txt:</p>
<pre><code>source /home/user/codigo/git/kde-dev-scripts/gdb/load-qt5printers.py
source /home/user/codigo/myownprinters.py
core ../../core.QThread.1493215378
bt
p longQMapofQList
</code></pre>
<p>Link to <a href="https://github.com/KDE/kde-dev-scripts/blob/master/gdb/load-qt5printers.py" rel="nofollow noreferrer">load-qt5-printers.py content</a>:</p>
<p>Then I launch gdb to automatically run those commands:</p>
<pre><code>gdb-multiarch --command=~/bin/gdbcommands.txt
</code></pre>
</div>
<div class="post-text" itemprop="text">
<blockquote>
<p>they have so many elements that printing them with it's contents is really slow (minutes).</p>
</blockquote>
<p>Do the Qt pretty-printers respect the <code>print-elements</code> limit? Is your limit set too high?</p>
<p>Profiling is unlikely to help here: if you are printing a list with (say) 1000 elements, it's likely that GDB will need to execute 10,000 or more <code>ptrace</code> calls, and ~all the time is spent waiting for these calls. </p>
<p>You can run <code>gdb</code> under <code>strace -c</code> and observe how many <code>ptrace</code>s are executed while printing a list of 10 elements, and 100 elements.</p>
<p>If the increase is linear, you can try to optimize the pretty printer to do fewer accesses. If the increase is quadratic, the pretty printer may do unnecessary pointer chasing (and that would certainly explain why printing long lists takes minutes).</p>
</div>
<span class="comment-copy">I've disabled the prints limits, because I would like to print them all. That's why I ask for help to profile slower parts.  And it's a core file, as far as I know, ptrace is not used here. Thanks for your answer.</span>
<span class="comment-copy">@kikeenrique Assuming you use QT pretty-printers from <a href="https://cgit.kde.org/kde-dev-scripts.git/tree/gdb" rel="nofollow noreferrer">cgit.kde.org/kde-dev-scripts.git/tree/gdb</a>, I can print QList&lt;QString&gt; with 1000 elements from a core dump in 0.13s. Just how big are your lists?</span>
