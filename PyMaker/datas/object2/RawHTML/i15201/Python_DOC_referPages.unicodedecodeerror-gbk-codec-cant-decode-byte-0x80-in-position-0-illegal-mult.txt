<div class="post-text" itemprop="text">
<p>I use python 3.4 with win 7 64-bit system. I ran the following code:</p>
<pre><code>      6   """ load single batch of cifar """
      7   with open(filename, 'r') as f:
----&gt; 8     datadict = pickle.load(f)
      9     X = datadict['data']
</code></pre>
<p>The wrong message is <code>UnicodeDecodeError: 'gbk' codec can't decode byte 0x80 in position 0: illegal multibyte sequence</code></p>
<p>I changed the line 7 as:</p>
<pre><code>      6   """ load single batch of cifar """
      7   with open(filename, 'r'，encoding='utf-8') as f:
----&gt; 8     datadict = pickle.load(f)
      9     X = datadict['data']
</code></pre>
<p>The wrong message became <code>UnicodeDecodeError: 'utf-8' codec can't decode byte 0x80 in position 0: invalid start byte</code>.</p>
<p>The message finally points to the Python34\lib\codecs.py in decode(self, input, final).</p>
<pre><code>    311         # decode input (taking the buffer into account)
    312         data = self.buffer + input
--&gt; 313         (result, consumed) = self._buffer_decode(data, self.errors, final)
    314         # keep undecoded input until the next call
    315         self.buffer = data[consumed:]
</code></pre>
<p>I further changed the code as:</p>
<pre><code>      6 """ load single batch of cifar """ 
      7 with open(filename, 'rb') as f:
----&gt; 8 datadict = pickle.load(f) 
      9 X = datadict['data'] 10 Y = datadict['labels']
</code></pre>
<p>Well, this time is <code>UnicodeDecodeError: 'ascii' codec can't decode byte 0x8b in position 6: ordinal not in range(128)</code>.</p>
<p>What is the problem and how to solve it?</p>
</div>
<div class="post-text" itemprop="text">
<p>Pickle files are binary data files, so you always have to open the file with the <code>'rb'</code> mode when loading. Don't try to use a text mode here.</p>
<p>You are trying to load a Python 2 pickle that contains string data. You'll have to tell <code>pickle.load()</code> how to convert that data to Python 3 strings, or to leave them as bytes.</p>
<p>The default is to try and decode those strings as ASCII, and that decoding fails. See the <a href="https://docs.python.org/3/library/pickle.html#pickle.load"><code>pickle.load()</code> documentation</a>:</p>
<blockquote>
<p>Optional keyword arguments are <em>fix_imports</em>, <em>encoding</em> and <em>errors</em>, which are used to control compatibility support for pickle stream generated by Python 2. If <em>fix_imports</em> is true, pickle will try to map the old Python 2 names to the new names used in Python 3. The <em>encoding</em> and <em>errors</em> tell pickle how to decode 8-bit string instances pickled by Python 2; these default to ‘ASCII’ and ‘strict’, respectively. The <em>encoding</em> can be ‘bytes’ to read these 8-bit string instances as bytes objects.</p>
</blockquote>
<p>Setting the encoding to <code>latin1</code> allows you to import the data directly:</p>
<pre><code>with open(filename, 'rb') as f:
    datadict = pickle.load(f, encoding='latin1') 
</code></pre>
<p>It appears that it is the <code>numpy</code> array data that is causing the problems  here as all strings in the set use ASCII characters <em>only</em>.</p>
<p>The alternative would by to use <code>encoding='bytes'</code> but then all the filenames and top-level dictionary keys are <code>bytes</code> objects and you'd have to decode those or prefix all your key literals with <code>b</code>.</p>
</div>
<span class="comment-copy">What is the full traceback of the last version? The <code>pickle</code> documentation states that the file object <i>should return bytes</i>, so you <b>have</b> to open the file object in binary mode with <code>'rb'</code>, but you now have a new error. How was the pickle file created in the first place?</span>
<span class="comment-copy">‘ import pickle as pickle import numpy as np import os  def load_CIFAR_batch(filename):   """ load single batch of cifar """   with open(filename, 'rb') as f:     datadict = pickle.load(f)’  This is how the pickle is created.</span>
<span class="comment-copy">You can <a href="https://stackoverflow.com/posts/28165639/edit">edit</a> your post to add more information.</span>
<span class="comment-copy">You are telling me how the pickle is being <b>loaded</b>, not how it was written.</span>
<span class="comment-copy">pickle is the standard python module. I did not touch it.</span>
