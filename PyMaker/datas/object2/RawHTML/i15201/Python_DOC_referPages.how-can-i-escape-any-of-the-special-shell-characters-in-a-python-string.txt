<div class="post-text" itemprop="text">
<p>How can I escape any of the special shell characters in a Python string?</p>
<p>The following characters need to be escaped:</p>
<pre><code>$,!,#,&amp;,",',(,),|,&lt;,&gt;,`,\,;
</code></pre>
<p>For example say I have this string:</p>
<pre><code>str="The$!cat#&amp;ran\"'up()a|&lt;&gt;tree`\;"
</code></pre>
<p>TIA</p>
</div>
<div class="post-text" itemprop="text">
<p>In Python3, the required batteries are included as <a href="https://docs.python.org/3/library/shlex.html#shlex.quote" rel="noreferrer"><code>shlex.quote</code></a>.</p>
<blockquote>
<pre><code>shlex.quote(s)
</code></pre>
<p>Return a shell-escaped version of the string <em><code>s</code></em>. The returned value is a string that can safely be used as one token in a shell command line [â€¦].</p>
</blockquote>
<p>In your example:</p>
<pre><code>import shlex

s = "The$!cat#&amp;ran\"'up()a|&lt;&gt;tree`\;"
print(shlex.quote(s))
</code></pre>
<p>Output:</p>
<pre class="lang-none prettyprint-override"><code>'The$!cat#&amp;ran"'"'"'up()a|&lt;&gt;tree`\;'
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>Not sure why you want to escape everything rather than quote as much as feasible, but, this should do it (replace <code>'@'</code> with another character not present in your string, if needed):</p>
<pre><code>&gt;&gt;&gt; escape_these = r'([$!#&amp;"()|&lt;&gt;`\;' + "'])"
&gt;&gt;&gt; print(re.sub(escape_these, r'@\1', s).replace('@','\\'))
The\$\!cat\#\&amp;ran\"\'up\(\)a\|\&lt;\&gt;tree\`\\;
</code></pre>
<p>It may be doable with a tad less escape-trickery, but the unfortunate fact that strings, <code>re</code>, and the shell, all use the <code>\</code> (backslash) for escaping and other special purposes, does complicate things a bit:-).</p>
</div>
<div class="post-text" itemprop="text">
<p><code>re.sub</code> will do the job:</p>
<pre><code>re.sub("(!|\$|#|&amp;|\"|\'|\(|\)|\||&lt;|&gt;|`|\\\|;)", r"\\\1", astr)
</code></pre>
<p><strong>Output</strong></p>
<pre><code>The\$\!cat\#\&amp;ran\"\'up\(\)a\|\&lt;\&gt;tree\`\\\;
</code></pre>
</div>
<span class="comment-copy">what are you trying to do?</span>
<span class="comment-copy">Is this string just going to be used as a string (in which this isn't an issue), or passed to some shell command?</span>
<span class="comment-copy">Off-topic: Please don't name variables <code>str</code>.  It will shadow the builtin <code>str</code> class.</span>
<span class="comment-copy">Its passed to a shell script, I just used str here, the actual script has a different name.</span>
<span class="comment-copy"><code>shlex.quote </code> is python3 only</span>
<span class="comment-copy">The Python 2.7 equivalent is <a href="https://docs.python.org/2/library/pipes.html#pipes.quote" rel="nofollow noreferrer"><code>pipes.quote</code></a>, which is the same as <code>shlex.quote</code> in Python 3.</span>
<span class="comment-copy">Thanks!  Looks like that will work.</span>
<span class="comment-copy">@SamRoberts, what are you actually trying to do?</span>
<span class="comment-copy">Actually, pipes.quote isn't escaping these 5 characters: ! $ ' " ` Any ideas?</span>
