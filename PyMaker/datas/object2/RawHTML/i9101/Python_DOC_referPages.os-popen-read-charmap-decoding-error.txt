<div class="post-text" itemprop="text">
<p>I have already read <a href="https://stackoverflow.com/questions/9233027">UnicodeDecodeError: 'charmap' codec can't decode byte X in position Y: character maps to &lt;undefined&gt;</a>. While the  error message is similar, the code is completely different, because I use <code>os.popen</code> in this question, not <code>open</code>. I cannot use the answers from the other questions to solve this problem.</p>
<pre><code>output = os.popen("dir").read()
</code></pre>
<p>This line, which is supposed to assign the output of command "dir" to variable "output", is causing this error:</p>
<pre><code>'charmap' codec can't decode byte 0x88 in position 260: character maps to &lt;undefined&gt;
</code></pre>
<p>I think this might be happenning because some files in the folder contain letters such as <strong>ł, ą, ę</strong> and <strong>ć</strong> in their names. I have no idea how to fix this though.</p>
</div>
<div class="post-text" itemprop="text">
<p><code>os.popen</code> is just a wrapper around <code>subprocess.Popen</code> along with a <code>io.TextIOWrapper</code> object:</p>
<blockquote>
<p>The returned file object reads or writes text strings rather than bytes.</p>
</blockquote>
<p>If Python's default encoding doesn't work for you, you should use <code>subprocess.Popen</code> directly.</p>
<p>The underlying issue is that cmd writes ansi garbage by default, even when the output is to a pipe. This behavior may depend on your Windows version.</p>
<p>You can fix this by passing <code>/U</code> flag to cmd:</p>
<pre><code>p = subprocess.Popen('cmd /u /c dir', stdout=subprocess.PIPE)
result = p.communicate()
text = result[0].decode('u16')
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>In this case, using <code>subprocess.Popen</code> is too general, too verbose and too hard to remember. Use <a href="https://docs.python.org/3/library/subprocess.html#subprocess.check_output" rel="nofollow noreferrer"><code>subprocess.check_output</code></a> instead.</p>
<p>It returns a <code>bytes</code> object, which can be converted to <code>str</code> with <code>decode</code> function.</p>
<pre><code>import subprocess
x = subprocess.check_output(['ls','/'])
print(x.decode('utf-8'))
</code></pre>
<p><a href="https://tio.run/##K6gsycjPM/7/PzO3IL@oRKG4NKmgKD85tbiYq0LBFomrl5yRmpwdn19aUlBaohGtnlOsrqOurx6ryVVQlJlXolGhl5KanJ@SqqFeWpKma6Guqfn/PwA" rel="nofollow noreferrer" title="Python 3 – Try It Online">Try it online!</a></p>
</div>
<span class="comment-copy">Possible duplicate of <a href="http://stackoverflow.com/questions/9233027/unicodedecodeerror-charmap-codec-cant-decode-byte-x-in-position-y-character">UnicodeDecodeError: 'charmap' codec can't decode byte X in position Y: character maps to &lt;undefined&gt;</a></span>
<span class="comment-copy">It may be because your title -- the exact error message -- is instant trigger bait. <i>By far the most</i> of similar questions are plain duplicates. If you edit your title and point out that it is specifically <code>os.popen</code>, a file system related function rather than local file encoding, you might get a better reception. (Unless it <i>is</i> the same issue --  I'm not sure about either.)</span>
<span class="comment-copy"><b>subprocess.Popen()</b> is confusing. I already tried using it, but it never worked properly no matter how hard I tried.</span>
<span class="comment-copy">The definition of os.popen shows the invocation that you will already have been using, so you can use that as a starting point. <a href="https://hg.python.org/cpython/file/3.6/Lib/os.py" rel="nofollow noreferrer">hg.python.org/cpython/file/3.6/Lib/os.py</a> There's a Popen object whose stdout file you've been looking at only.</span>
<span class="comment-copy">Can't figure it out. So far only managed to cause the same error again.</span>
<span class="comment-copy">cmd uses the wide-character API when writing to the console. So it's not "even when" but rather <i>because</i> the output is a pipe or file that cmd outputs ANSI, unless <code>/u</code> overrides this to write UTF-16LE.</span>
<span class="comment-copy">Use a command line string when running cmd.exe / <code>shell=True</code>. <code>subprocess.list2cmdline</code> does not know how to quote and escape command lines for cmd.exe.</span>
