<div class="post-text" itemprop="text">
<p>(PREFACE: I know, this problem has been talked about a hundred of times, but I still don't understand it)</p>
<p>I am trying to load a html-page and output the text, even though I am getting the webpage correctly, BeautifulSoup destroys somehow the encoding of accented characters which are not part of the first 127 ASCII-characters: </p>
<pre><code># -*- coding: utf-8 -*-
import sys
from urllib import urlencode
from urlparse import parse_qsl
import re
import urlparse
import json
import urllib
from bs4 import BeautifulSoup

url = "http://www.rtve.es/alacarta/interno/contenttable.shtml?ctx=29010&amp;locale=es&amp;module=&amp;orderCriteria=DESC&amp;pageSize=15&amp;mode=TEXT&amp;seasonFilter=40015"
html=urllib2.urlopen(url).read()
soup = BeautifulSoup(html)
div = soup.find_all("span", class_="detalle")
capitulo_detalle = div[0].text   (doesn't work, capitulo_detalle is type str with utf-8, div[0].tex is type unicode)
</code></pre>
<p>Output of <code>div[0].text</code> should be something like: </p>
<p>S<strong>á</strong>tur se dirige al sur en busca de Estuarda y Gabi, pero un compa<strong>ñ</strong>ero de viaje inesperado har<strong>á</strong> que cambie de rumbo. Los hombres de Juan siguen presos. El enemigo comienza a realizar ejecuciones. <strong>Á</strong>guila Roja tiene...</p>
<p>But the result I get is: </p>
<p>u'S\xe1tur se dirige al sur en busca de Estuarda y Gabi, pero un compa\xf1ero de
 viaje inesperado har\xe1 que cambie de rumbo. Los hombres de Juan siguen presos
. El enemigo comienza a realizar ejecuciones. \xc1guila Roja tiene...'</p>
<p><strong>--&gt; What do I have to change to get the 'right' characters?</strong> </p>
<p>I know it must be a duplicate of these questions, but the answers doesn't seem to work here: 
<a href="https://stackoverflow.com/questions/7219361/python-and-beautifulsoup-encoding-issues">Python and BeautifulSoup encoding issues</a>
<a href="https://stackoverflow.com/questions/20205455/how-to-correctly-parse-utf-8-encoded-html-to-unicode-strings-with-beautifulsoup">How to correctly parse UTF-8 encoded HTML to Unicode strings with BeautifulSoup?</a></p>
<p>I also read the typical documentations about unicode, utf-8, ascii, e.g. <a href="https://docs.python.org/3/howto/unicode.html" rel="nofollow noreferrer">https://docs.python.org/3/howto/unicode.html</a>, obviously without success...</p>
</div>
<div class="post-text" itemprop="text">
<p>I believe I finally got it...</p>
<pre><code>&gt;&gt;&gt; div = soup.find("span", class_="detalle")
&gt;&gt;&gt; div.text
u'S\xe1tur se dirige al sur en busca de Estuarda y Gabi, pero
</code></pre>
<p>---&gt; this is unicode, \xe1 is the 'code' for 'á' (<a href="http://www.utf8-chartable.de/unicode-utf8-table.pl?start=4096&amp;number=128&amp;names=-&amp;utf8=string-literal" rel="nofollow noreferrer">http://www.utf8-chartable.de/unicode-utf8-table.pl?start=4096&amp;number=128&amp;names=-&amp;utf8=string-literal</a>)</p>
<pre><code>&gt;&gt;&gt; print(div.text)
Sátur se dirige al sur en busca de Estuarda y Gabi, pero
</code></pre>
<p>---&gt; 'print' evaluates the unicode code point correctly</p>
<pre><code>&gt;&gt;&gt; div.text.encode('utf-8')
'S\xc3\xa1tur se dirige al sur en busca de Estuarda y Gabi, pero
</code></pre>
<p>---&gt; Unicode is encoded to utf-8 according to the table given on the url cited above. I didn't understand why the output is shown as \xc3\xa1 and not as 'á'. </p>
<pre><code>&gt;&gt;&gt; print div.text.encode('utf-8')
S├ítur se dirige al sur en busca de Estuarda y Gabi, pero
</code></pre>
<p>---&gt; and I didn't understand why print now evaluates it to a strange symbol....</p>
<pre><code>&gt;&gt;&gt; blurr = div.text.encode('cp850')
&gt;&gt;&gt; blurr
'S\xa0tur se dirige al sur en busca de Estuarda y Gabi, pero
&gt;&gt;&gt; type(blurr)
&lt;type 'str'&gt;
</code></pre>
<p>---&gt; Unicode encoded to codepage 850, used within the python-shell under Windows</p>
<pre><code>&gt;&gt;&gt; print(blurr)
Sátur se dirige al sur en busca de Estuarda y Gabi, pero
</code></pre>
<p>---&gt; Finally, it's right !!! </p>
<p>In Kodi I can use the utf-8 representation, so that e.g. the character 'á' is saved within the variable as \xc3\xa1, but when the content of the variable is displayed for example with "xbmcgui.Dialog().ok(addonname, blurr) it is shown correctly on the screen with an 'á'......</p>
<p>Und sowas soll man wissen......</p>
</div>
<div class="post-text" itemprop="text">
<pre><code>import requests
from bs4 import BeautifulSoup

url = "http://www.rtve.es/alacarta/interno/contenttable.shtml?ctx=29010&amp;locale=es&amp;module=&amp;orderCriteria=DESC&amp;pageSize=15&amp;mode=TEXT&amp;seasonFilter=40015"
html=requests.get(url)
soup = BeautifulSoup(html.text, 'lxml')
div = soup.find("span", class_="detalle")
capitulo_detalle = div.text 
</code></pre>
<p>out:</p>
<pre><code>'Sátur se dirige al sur en busca de Estuarda y Gabi, pero un compañero de viaje inesperado hará que cambie de rumbo. Los hombres de Juan siguen presos. El enemigo comienza a realizar ejecuciones. Águila Roja tiene...'
</code></pre>
<p>use <code>requests</code> and <code>python3</code>, and the problem will never show up</p>
</div>
<span class="comment-copy">how do you run this code ? in Python Shell or <code>python script.py</code> ? How do you get this text ? Did you use <code>print div[0].text</code> or Python Shell printed this automatically for you ? You have correct text but Python Shell uses <code>print repr( div[0].text )</code> to show text usefull for debugging. So try <code>print repr(div[0].text)</code> and <code>print div[0].text</code> and you will see different text.</span>
<span class="comment-copy">I am using Python 2.7.13, the example could be run within the Shell or as a script, doesn't matter. And yes, 'print' shows the correct output, but I need the text within a variable.</span>
<span class="comment-copy">You already have the right characters. The literal <code>u'S\xe1tur se dirige...'</code> exactly represents the text <code>Sátur se dirige...</code>. If you <code>print()</code> it you will see the raw characters (assuming your console can print them, which if it is Windows it might not).</span>
<span class="comment-copy">@bobince: Yes, but I am using Python 2.7.13 with utf-8. If I assign div[0].text (which is unicode) to a normal string variable (which is utf-8), I get in trouble.</span>
<span class="comment-copy">use only <code>unicode</code> and you will have no problem - so convert all strings to unicode. It is the solution.</span>
<span class="comment-copy">I also tried the example with 'requests', which doesn't change anything.  Well, <code>python3</code> handles unicode a priori, but now I started with python 2.7.13 and I don't want to change the whole code, looking for inconsistencies. Furthermore I don't know if Kodi supports python3.</span>
