<div class="post-text" itemprop="text">
<p>[Python3] I have a script that reads a (long) CSV file, containing email addresses and corresponding country codes, and splits these out by country code. This is going fine, but I want the script to print out the number of lines (i.e. emails) (it has written) as per each file.</p>
<p>Also, I'm very new to programming and Python so I would be very glad to receive any optimization suggestions or other tips in general!</p>
<p>Input file looks something like this:</p>
<pre><code>12345@12345.com     us
xyz@xyz.com         gb
aasdj@ajsdf.com     fr
askdl@kjasdf.com    de
sdlfj@aejf.com      nl
...                 ...
</code></pre>
<p>The output should look something like this:</p>
<pre><code>Done!
us: 20000
gb: 20000
de: 10000
fr: 10000
nl: 10000
...
</code></pre>
<p>My code is the following:</p>
<pre><code>import csv, datetime
from collections import defaultdict

"""
Script splits a (long) list of email addresses with associated country codes by country codes.
Input file should have only two columns of data - ideally.
"""

# Declaring variables
emails = defaultdict(list)
in_file = "test.tsv"          # Write filename here.
filename = in_file.split(".")

"""Checks if file is comma or tab separated and sets delimiter variable."""
if filename[1] == "csv":
    delimiter = ','
elif filename[1] == "tsv":
    delimiter = '\t'

"""Reads csv/tsv file and cleans email addresses."""
with open(in_file, 'r') as f:
    reader = csv.reader(f, delimiter=delimiter)
    for row in reader:
        # Gets rid of empty rows
        if row:
            # Gets rid of non-emails
            if '@' in row[0]:
                # Strips the emails from whitespace and appends to the 'emails' list
                # Also now 'cc' is in the first position [0] and email in the second [1]
                emails[row[1].strip()].append(row[0].strip()+'\n')

""""Outputs the emails by cc and names the file."""
for key, value in emails.items():
    # Key is 'cc' and value is 'email'
    # File is named by "today's date-original file's name-cc"
    with open('{0:%Y%m%d}-{1}-{2}.csv'.format(datetime.datetime.now(), filename[0], key), 'w') as f:
        f.writelines(value)
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>To get the output you want you need to print the key (your country code) and the length of the value (your email list), like this:</p>
<pre><code>""""Outputs the emails by cc and names the file."""
for key, value in emails.items():
    # Key is 'cc' and value is 'email'
    # File is named by "today's date-original file's name-cc"
    with open('{0:%Y%m%d}-{1}-{2}.csv'.format(datetime.datetime.now(), filename[0], key), 'w') as f:
        f.writelines(value)

    # The file is closed (de-indented from the with), but we're still in the for loop
    # Use the format() method of a string to print in the form `cc: number of emails`
    print(`{}: {}`.format(key, len(value)))
</code></pre>
<p>This uses <a href="http://docs.python.org/3/library/functions.html#format" rel="nofollow"><code>format()</code></a> to make a string like <code>gb: 30000</code> (<a href="http://docs.python.org/3/library/string.html#format-examples" rel="nofollow">more examples</a> of usage).</p>
</div>
<span class="comment-copy">Can you post a short example of the <code>emails</code> dict? Say 5 or 10 emails?</span>
<span class="comment-copy">Is this not just <code>len(value)</code></span>
<span class="comment-copy">@jamylak i think op wants a seperate count for each country code which would involve looking at the adresses i guess.</span>
<span class="comment-copy">@pypat: it's already in <code>key</code> at the time of the write.</span>
<span class="comment-copy">It sounds like you want <code>print("{}: {}".format(key, len(value))</code>. Here's the <a href="http://docs.python.org/3/library/functions.html#format" rel="nofollow noreferrer">documentation</a>.</span>
