<div class="post-text" itemprop="text">
<p>After uploading a file from the UI, how to create the a new directory with the current timestamp in /opt/files/  and copy the uploaded zip file to this directory, and unzip the zip file in the new directory and maintain the new directory name in a variable</p>
<pre><code>def upload_info(request):
    if request.method == 'POST':
        file=request.FILES['file']
        dir = "/opt/files"
        file_name = "%s/%s" % (dir, file.name)
        form = UploadFileForm(request.POST, request.FILES)
        try:
            handle_uploaded_file( file_name , file )

def handle_uploaded_file(file_name,f):
    destination = open(file_name, 'wb+')
    for chunk in f.chunks():
        destination.write(chunk)
    destination.close()
    return
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>Creating a directory can be achieved using Python's <code>os</code> module (see <a href="http://docs.python.org/library/os.html#os.mkdir" rel="noreferrer">documentation</a>). For example:</p>
<pre><code>import os
from datetime import datetime
dirname = datetime.now().strftime('%Y.%m.%d.%H.%M.%S') #2010.08.09.12.08.45 
os.mkdir(os.path.join('/opt/files', dirname))
</code></pre>
<p>You can use <code>os.rename</code> (<a href="http://docs.python.org/library/os.html#os.rename" rel="noreferrer">documentation</a>) to move the file as you choose (provided you have the necessary permissions). Unzipping can be done through the command line using <a href="http://docs.python.org/library/subprocess.html" rel="noreferrer">Subprocesses</a> or using a <a href="http://docs.python.org/library/zipfile.html" rel="noreferrer">Python module</a> (Examples using <code>gzip</code> module can be found <a href="http://docs.python.org/library/gzip.html#examples-of-usage" rel="noreferrer">here</a>). </p>
</div>
<div class="post-text" itemprop="text">
<p>Here's a function I use:</p>
<pre><code>def makedirs(path):
    try:
        os.makedirs(path)
    except OSError as e:
        if e.errno == 17:
            # Dir already exists. No biggie.
            pass
</code></pre>
</div>
<span class="comment-copy">What if that directory already exists? Will it overwrite the existing one or just throw a "File exists" error?</span>
<span class="comment-copy">@teewuane If it already exists, it will throw an error. <a href="https://docs.python.org/3/library/os.html#os.makedirs" rel="nofollow noreferrer"><code>os.makedirs</code></a> will create missing parent directories, and in Python 3.2, you can use <code>ok_exists=True</code> to avoid an error if the directory already exists.</span>
