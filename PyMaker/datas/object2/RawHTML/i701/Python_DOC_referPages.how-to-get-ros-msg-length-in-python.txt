<div class="post-text" itemprop="text">
<p>I have a problem that needs to count the length of each ROS topic msg.</p>
<p>I modified rostopic(/opt/ros/smart-ros/lib/python2.7/dist-packages/rostopic / __ init__.py):</p>
<pre><code>Class CallbackEcho(object) -&gt;
Def callback (self, data, callback_args, current_time = None):
    Print('message length =',sys.getsizeof(data)) #statics msg length
</code></pre>
<p>But when the message contains a vector or struct list, the length is incorrect.</p>
<p>Please help solve this problem?</p>
<p>Thanks.</p>
</div>
<div class="post-text" itemprop="text">
<p>The problem is the behaviour of <a href="https://docs.python.org/3/library/sys.html#sys.getsizeof" rel="nofollow noreferrer">sys.getsizeof</a>:</p>
<blockquote>
<p>Only the memory consumption directly attributed to the object is accounted for, not the memory consumption of objects it refers to.</p>
</blockquote>
<p>This means only the size of the reference to a list is used to calculate the object size.</p>
<p>There are already a few questions dealing with this:</p>
<ul>
<li><a href="https://stackoverflow.com/questions/449560/how-do-i-determine-the-size-of-an-object-in-python">How do I determine the size of an object in Python?</a></li>
<li><a href="https://stackoverflow.com/questions/1331471/in-memory-size-of-a-python-structure">In-memory size of a Python structure</a></li>
</ul>
<p>The solution is to <strong>use <a href="https://pythonhosted.org/Pympler/" rel="nofollow noreferrer">Pympler</a> and its module <a href="https://pythonhosted.org/Pympler/asizeof.html#asizeof" rel="nofollow noreferrer">asizeof</a></strong> which provides a function to the required calculation:</p>
<blockquote>
<p>Function asizeof calculates the combined (approximate) size of one or several Python objects in bytes</p>
</blockquote>
<p>After installing the package using <em>pip</em></p>
<blockquote>
<p>pip install pympler</p>
</blockquote>
<p>and importing it to your code like</p>
<pre><code>from pympler.asizeof import asizeof
</code></pre>
<p>you are able to print the correct object size in your callback like</p>
<pre><code>print('Size: ' + str(asizeof(data)))
</code></pre>
</div>
<span class="comment-copy">rosmsg show XXXX/XXXX std_msgs/Header header   uint32 seq   time stamp   string frame_id bool a float64 c float64 m float64 g  but the message length is 96.</span>
<span class="comment-copy">I am not sure what you mean by the "length" of a message. Do you mean if the message has a vector on it, you want to know how many elements are in it? In any event, you shouldn't be monkeying with the ROS source code, there is probably a way to do what you want in some client code.</span>
<span class="comment-copy">Thanks in advance, but my python version is 2.7. nvidia@p22:~$ pip install pympler Collecting pympler   Could not find a version that satisfies the requirement pympler (from versions: ) No matching distribution found for pympler You are using pip version 8.1.1, however version 19.0.1 is available. You should consider upgrading via the 'pip install --upgrade pip' command.</span>
<span class="comment-copy">nvidia@p22:~$ pip install --upgrade pip Collecting pip   Could not find a version that satisfies the requirement pip (from versions: ) No matching distribution found for pip You are using pip version 8.1.1, however version 19.0.1 is available. You should consider upgrading via the 'pip install --upgrade pip' command.</span>
<span class="comment-copy">My answer is compatible with Python 2.7. You need to upgrade pip and install Pympler.</span>
<span class="comment-copy">Thank you in advance, pympler was installed successfully. pip upgrade failed，Use this command： pip install --trusted-host pypi.org --trusted-host pypi.python.org --trusted-host files.pythonhosted.org Pympler</span>
<span class="comment-copy">So the solution works now?</span>
