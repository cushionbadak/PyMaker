<div class="post-text" itemprop="text">
<pre><code>#Delete suspense window
class dWindow(QtGui.QMainWindow, Ui_dWindow):
    def __init__(self, parent = None):
        QtGui.QMainWindow.__init__(self, parent)
        self.setupUi(self)

        for row in cursor.execute("SELECT FIRSTNAME FROM Staff"):
            self.comboUser.addItems(row)
        con.close()

        self.btnDeleteSuspense.clicked.connect(self.btnDeleteSuspense_Clicked)

    def btnDeleteSuspense_Clicked(self):
        user = self.comboUser.currentText() #finds selected user
        date = self.dateEdit.date().toString("M/d/yyyy")
        numrecord = cursor.execute() ??
</code></pre>
<p>Here is a sample DB and program file to further help me explain</p>
<p><img alt="programsample" src="https://i.stack.imgur.com/sYTN5.png"/></p>
<p><img alt="dbsample" src="https://i.stack.imgur.com/BL5XF.png"/></p>
<p>I have created variables to hold the selection of the combobox and the dateEdit box.</p>
<p>The next step (the one I'm struggling with) is to then use those variables in an SQL query that will first find the count of rows with the selected user name and having a date &lt;= than the selected date.  That will populate the numrecord variable so that I can display a "This will delete 'x' rows, are you sure?"</p>
<p>If the user selects yes then I will then use the variable in a delete query to delete the selected rows.</p>
<p>I believe if I can figure out how to use the variables I have in a SQL query then the DELETE query should be rather simple.</p>
<p>An example of a possible DELETE query to show what I'm trying to do</p>
<pre><code>cursor.execute("DELETE TO, count(*) FROM Suspense where TO = [user] and DATE = [date]")
</code></pre>
<p>I know that is wrong but maybe it will help clarify.</p>
<p>I hope I have explained my question fully and I appreciate any help provided.</p>
<p>Edit: Thanks so much!!</p>
<p>Just before I saw that you had posted this I figured it out.</p>
<p>What I came up with was the following:</p>
<pre><code>qdate = self.dateTimeEdit.dateTime().toPyDateTime() #grabs the raw datetime from the QDateTimeEdit object and converts to python datetime

query = "SELECT DATE FROM Suspense WHERE DATE &gt;= ?"  #creates the query using ? as a placeholder for variable

cursor.execute(query, (qdate,)) #executes the query and passes qdate as a tuple to the placeholder
</code></pre>
<p>With this knowledge I can recreate my queries to include both variables.</p>
</div>
<div class="post-text" itemprop="text">
<p>As mentioned in a comment to another answer, you should be using a proper <em>parameterized query</em>, for example:</p>
<pre class="lang-python prettyprint-override"><code># assumes that autocommit=False (the default)
crsr = conn.cursor()
sql = "DELETE FROM [Suspense] WHERE [TO]=? AND [DATE]&lt;=?"
user = self.comboUser.currentText()  # as before
date = self.dateEdit.date()  # Note: no .toString(...) required
params = (user, date)
crsr.execute(sql, params)
msg = "About to delete {} row(s). Proceed?".format(crsr.rowcount)
if my_confirmation_dialog(msg):
    conn.commit()
else:
    conn.rollback()
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>What I came up with was the following:</p>
<pre><code>qdate = self.dateTimeEdit.dateTime().toPyDateTime() #grabs the raw datetime from the QDateTimeEdit object and converts to python datetime

query = "SELECT DATE FROM Suspense WHERE DATE &gt;= ?"  #creates the query using ? as a placeholder for variable

cursor.execute(query, (qdate,)) #executes the query and passes qdate as a tuple to the plac
</code></pre>
<p>With this knowledge I can now add both variables to the query as needed.</p>
<p>Thanks everyone for their help, especially Gord Thompson!</p>
</div>
<div class="post-text" itemprop="text">
<p>You use the <a href="http://www.w3schools.com/sql/sql_delete.asp" rel="nofollow"><code>DELETE</code></a> sql command.</p>
<p>This assumes your <code>DATE</code> field is actually a date field and not a string field.</p>
<pre><code>user = self.comboUser.currentText()
date = self.dateEdit.date().toString("yyyy-MM-dd")
cmd = "DELETE FROM Suspense WHERE TO = '{}' AND DATE &gt;= '{}'".format(user, date)
cursor.execute(cmd)
</code></pre>
<p>Also, you may want to look into using an ORM framework (<a href="http://www.sqlalchemy.org/" rel="nofollow"><code>sqlalchemy</code></a> is probably the most popular, but there are others).  It's best to avoid manually constructing sql queries if possible.</p>
</div>
<span class="comment-copy">What is the schema of the <i>suspense</i> table?  Is <code>TO</code> a string column, or a foreign key column?</span>
<span class="comment-copy">String column. The dbsample image is a section of the suspense table showing the columns that I will be targeting with my queries to find the # of rows matching the variables and then delete those rows</span>
<span class="comment-copy">Thanks so much! I posted an edit explaining what I found out to fix it just before you posted.  BTW how do I tag someone with a space in their name?</span>
<span class="comment-copy">@ricketyCode re: <i>"how do I tag someone with a space in their name?"</i> - You can just use the first few characters (e.g., @Gord) provided that it uniquely identifies a participant in the comment thread. If you are posting from a web browser then after typing "@" and the first letter you should also get a pop-up with valid selections (e.g., @GordThompson).</span>
<span class="comment-copy">ok awesome thanks for your help!</span>
<span class="comment-copy">I  think I should have clarified better. The "Staff" table isn't relevant to the DELETE query (the table being targeted with the DELETE is 'Suspense'), it's merely to clarify which user is being targeted in the TO column. I'm targeting a selection of rows with TO and DATE where DATE is equal to or older than the selected date. The primary key of the Suspense table is COUNTER, but I don't think it's useful in this case since I don't care if the rows are duplicate or not I'm merely deleting all rows for a specific user equal to or older than the date specified.</span>
<span class="comment-copy">So you'd like to delete rows in the SUSPENSE table based off of a selection from the STAFF table? Sorry if I'm reading this wrong, but I'm not fully awake. If so, however, you need to look into <code>joins</code>.</span>
<span class="comment-copy">@ricketyCode Updated based on your edits.</span>
<span class="comment-copy">No I only use the Staff table to populate the combobox. After a name and date is clicked on in the window the actual delete will be targeting the TO and DATE fields of the Suspense table.</span>
<span class="comment-copy">@BrendanAbel. The <a href="http://docs.python.org/3/library/sqlite3.html#sqlite3.Cursor.execute" rel="nofollow noreferrer">execute</a> method supports parameterization, so there's no need to use <code>format</code>. It will ensure quotes are escaped correctly as well.</span>
