<div class="post-text" itemprop="text">
<p>I am creating a python program using the <a href="https://docs.python.org/3/library/argparse.html"><code>argparse</code> module</a> and I want to allow the program to take either one argument or 2 arguments.</p>
<p>What do I mean?  Well, I am creating a program to download/decode MMS messages and I want the user to either be able to provide a phone number and MMS-Transaction-ID to download the data or provide a file from their system of already downloaded MMS data.</p>
<p>What I want is something like this, where you can either enter in 2 arguments, or 1 argument:</p>
<pre><code>./mms.py (phone mmsid | file)
</code></pre>
<p><sub>NOTE: <code>phone</code> would be a phone number (like <code>15555555555</code>), <code>mmsid</code> a string (MMS-Transaction-ID) and <code>file</code> a file on the user's computer</sub></p>
<p>Is this possible with <code>argparse</code>?  I was hoping I could use <code>add_mutually_exclusive_group</code>, but that didn't seem to do what I want.</p>
<pre><code>parser = argparse.ArgumentParser()
group = parser.add_mutually_exclusive_group(required=True)
group.add_argument('phone', help='Phone number')
group.add_argument('mmsid', help='MMS-Transaction-ID to download')
group.add_argument('file', help='MMS binary file to read')
</code></pre>
<p>This gives the error (removing <code>required=True</code> gives the same error):</p>
<blockquote>
<p>ValueError: mutually exclusive arguments must be optional</p>
</blockquote>
<p>It looks like it wants me to use <code>--phone</code> instead of <code>phone</code>:</p>
<pre><code>parser = argparse.ArgumentParser()
group = parser.add_mutually_exclusive_group(required=True)
group.add_argument('--phone', help='Phone number')
group.add_argument('--mmsid', help='MMS-Transaction-ID to download')
group.add_argument('--file', help='MMS binary file to read')
</code></pre>
<p>When running my program with no arguments, I see:</p>
<blockquote>
<p>error: one of the arguments --phone --mmsid --file is required</p>
</blockquote>
<p>This is closer to what I want, but can I make <code>argparse</code> do <code>(--phone --msid) or (--file)</code>?</p>
</div>
<div class="post-text" itemprop="text">
<p>This is a little beyond the scope of what <code>argparse</code> can do, as the "type" of the first argument isn't known ahead of time. I would do something like</p>
<pre><code>import argparse

p = argparse.ArgumentParser()
p.add_argument("file_or_phone", help="MMS File or phone number")
p.add_argument ("mmsid", nargs="?", help="MMS-Transaction-ID")

args = p.parse_args()
</code></pre>
<p>To determine whether <code>args.file_or_phone</code> is intended as a file name or a phone number, you need to check whether or not <code>args.mmsid</code> is <code>None</code>.</p>
</div>
<span class="comment-copy">Could you use <a href="https://docs.python.org/2/library/argparse.html#sub-commands" rel="nofollow noreferrer">subcommands</a>?</span>
<span class="comment-copy">@mgilson: I didn't look into that.  Is there a way to make a "default" command?  Like <code>./mms.py file.bin</code> instead of <code>./mms.py decode file.bin</code> or <code>./mms.py 15555555555 abcd</code> instead of <code>./mms.py download 15555555555 abcd</code>.</span>
<span class="comment-copy">That's a good question.  I don't see anything documented :-/...</span>
<span class="comment-copy">You mean something like <a href="http://stackoverflow.com/q/17909294/3001761">stackoverflow.com/q/17909294/3001761</a>?</span>
<span class="comment-copy">The suggested duplicate <a href="http://stackoverflow.com/questions/17909294/python-argparse-mutual-exclusive-group" title="python argparse mutual exclusive group">stackoverflow.com/questions/17909294/â€¦</a>, is about nesting groups of optionals.  This question is about handling 3 positionals.  That question may help, but it is not a duplicate.</span>
<span class="comment-copy">This seems, more or less, like exactly what I was trying to do.  In my <code>file</code> argument, I had <code>type=argparse.FileType('rb')</code>.  I guess I'll have to manually call <code>open(args.file_or_phone, 'rb')</code> if needed.</span>
<span class="comment-copy">Also, it looks like I can override the text displayed to show <code>./mms.py (phone mmsid | file)</code> (and maybe add an "only with phone number" to mmsid) and then process the arguments as needed.</span>
<span class="comment-copy">You could define a custom action that, based on the value given, decide if it is a phone number or a file name and act accordingly. However, the argument itself would still be something like <code>p.add_argument("file_or_phone", action=MyCustomAction, help="...")</code>.</span>
<span class="comment-copy">A variant would be to accept one argument with <code>nargs='+'</code>, and then parse the list based on length and content.  Though this is basically the same as looking at <code>sys.argv[1:]</code> directly.</span>
