<div class="post-text" itemprop="text">
<p>There's a fair amount of weirdness that I've observed recently when playing around with timeit and Python's exponents recently.</p>
<p>First, knowing that math.sin(1) == (e**1j).imag, I was curious about their relative speeds. Here is what I found:</p>
<pre><code>&gt;&gt;&gt; timeit('sin(1)', 'from math import sin')
0.12068345113220857

&gt;&gt;&gt; timeit('(e**1j).imag', 'from math import e')
0.27201285586511403

&gt;&gt;&gt; timeit('exp(1j).imag', 'from cmath import exp')
0.25259275173584683

&gt;&gt;&gt; timeit('(2.718281828459045**1j).imag')
0.04272853350335026
</code></pre>
<p>This is bizarre to me. Why is using the number itself and <code>**</code> so much faster than anything else? Why is it faster than sin? I know it's not due to the import; I ruled that out separably. Also consider:</p>
<pre><code>&gt;&gt;&gt; (2.718281828459045**1j).imag
0.8414709848078965

&gt;&gt;&gt; sin(1)
0.8414709848078965
</code></pre>
<p>So, it is giving the correct answers.</p>
<p>I decided to dig a bit deeper, and found that .imag is the real culprit of the slowness of <code>(2.718281828459045**1j).imag</code>. In fact,</p>
<pre><code>&gt;&gt;&gt; timeit('2.718281828459045**1j')
0.013987474140321865
</code></pre>
<p>It doesn't seem to be anything specific to 1j; I can use 2j or 0.95j and get the same speed. Additionally, it's even as fast as complex and regular multiplication!</p>
<pre><code>&gt;&gt;&gt; timeit('1*1j')
0.01617102287718808

&gt;&gt;&gt; timeit('1*1')
0.016536898499907693
</code></pre>
<p>I am thoroughly confused. How can it be so much faster than sin, when it's doing at least as much work (and also calculating cos)? How can it be as fast as integer multiplication? I suspect part of this is due to noise from the overhead of timeit (there's gotta be a loop somewhere), but even that doesn't explain everything. I would appreciate any help with understanding.</p>
</div>
<div class="post-text" itemprop="text">
<p>You can explain your observation by looking at the bytecode generated by CPython using the <a href="https://docs.python.org/3/library/dis.html#dis.dis" rel="nofollow noreferrer">dis</a> module. Lets take a look.</p>
<pre><code>********************************************************************************
from match import sin; sin(1)
  1           0 LOAD_CONST               0 (0)
              2 LOAD_CONST               1 (('sin',))
              4 IMPORT_NAME              0 (match)
              6 IMPORT_FROM              1 (sin)
              8 STORE_NAME               1 (sin)
             10 POP_TOP
             12 LOAD_NAME                1 (sin)
             14 LOAD_CONST               2 (1)
             16 CALL_FUNCTION            1
             18 POP_TOP
             20 LOAD_CONST               3 (None)
             22 RETURN_VALUE
********************************************************************************
from math import e; (e**1j).imag
  1           0 LOAD_CONST               0 (0)
              2 LOAD_CONST               1 (('e',))
              4 IMPORT_NAME              0 (math)
              6 IMPORT_FROM              1 (e)
              8 STORE_NAME               1 (e)
             10 POP_TOP
             12 LOAD_NAME                1 (e)
             14 LOAD_CONST               2 (1j)
             16 BINARY_POWER
             18 LOAD_ATTR                2 (imag)
             20 POP_TOP
             22 LOAD_CONST               3 (None)
             24 RETURN_VALUE
********************************************************************************
from cmath import exp; exp(1j).imag
  1           0 LOAD_CONST               0 (0)
              2 LOAD_CONST               1 (('exp',))
              4 IMPORT_NAME              0 (cmath)
              6 IMPORT_FROM              1 (exp)
              8 STORE_NAME               1 (exp)
             10 POP_TOP
             12 LOAD_NAME                1 (exp)
             14 LOAD_CONST               2 (1j)
             16 CALL_FUNCTION            1
             18 LOAD_ATTR                2 (imag)
             20 POP_TOP
             22 LOAD_CONST               3 (None)
             24 RETURN_VALUE
********************************************************************************
(2.718281828459045**1j).imag
  1           0 LOAD_CONST               0 ((0.5403023058681398+0.8414709848078965j))
              2 LOAD_ATTR                0 (imag)
              4 RETURN_VALUE
</code></pre>
<p>As you can see, your last example is so fast because the interpreter is turning the value into a constant when the bytecode is created. You aren't actually doing any work in your last timeit except for the call to <code>imag</code>.</p>
</div>
