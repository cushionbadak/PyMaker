<div class="post-text" itemprop="text">
<p>I'm using subprocess to output std output and std error to their respective files. When I try to output time to both files before the respective messages, it is being written at the end.</p>
<p>Below is the code</p>
<pre><code>import time
from subprocess import call

datetime_log = time.strftime("%Y-%m-%d %H:%M:%S")
with open("stdout.txt","ab") as stdout_file, open("stderr.txt","ab") as stderr_file:
    stdout_file.write(datetime_log + '\n'); stderr_file.write(datetime_log + '\n')
    call(['ls'], stdout = stdout_file, stderr = stderr_file)
</code></pre>
<p>The output of stdout.txt is:</p>
<pre><code>pyshell1.py
pyshell2.py
stderr.txt
stdout.txt
2019-03-11 17:59:48
pyshell1.py
pyshell2.py
stderr.txt
stdout.txt
2019-03-11 18:06:17
</code></pre>
<p>How do I print the time <strong>before</strong> the output of <code>ls</code> subprocess command.</p>
</div>
<div class="post-text" itemprop="text">
<p>You need to flush the buffer:</p>
<pre><code>stdout_file.write(datetime_log + '\n')
stderr_file.write(datetime_log + '\n')
stdout_file.flush()
stderr_file.flush()
call(['ls'], stdout=stdout_file, stderr=stderr_file)
</code></pre>
</div>
<span class="comment-copy">You might also need to call <a href="https://docs.python.org/3/library/os.html#os.fsync" rel="nofollow noreferrer"><code>fsync</code></a> after flushing the buffers. Your data might get stuck in the file system buffer after being flushed from the FILE* stream buffer.</span>
