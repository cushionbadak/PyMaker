<div class="post-text" itemprop="text">
<p>I am trying to parallelize my task and decided to use the multiprocessing (mp) module.
I have soon learnt that mp can't handle nested functions, so I had to unnest a function similar to this:</p>
<pre><code>def foo(nomer1, nomer2):

    def bar(nomer1, nomer2):
        return ([nomer1] * nomer2)

    return(bar(nomer1, nomer2))
</code></pre>
<p>to this:</p>
<pre><code>def bar(nomer1, nomer2):
    return([nomer1]*nomer2)

def foo(nomer1, nomer2):
    return(bar(nomer1, nomer2))
</code></pre>
<p>However, when I run:</p>
<pre><code>import multiprocessing as mp
n_proc = 2
pool = mp.Pool(processes=n_proc)
pool.starmap(foo, [11, 2])
</code></pre>
<p>The console produces this error:</p>
<pre><code>Traceback (most recent call last):
  File "&lt;input&gt;", line 1, in &lt;module&gt;
  File "C:\Users\user\Anaconda2\envs\env1\lib\multiprocessing\pool.py", line 274, in starmap
    return self._map_async(func, iterable, starmapstar, chunksize).get()
  File "C:\Users\user\Anaconda2\envs\env1\lib\multiprocessing\pool.py", line 644, in get
    raise self._value
  File "C:\Users\user\Anaconda2\envs\env1\lib\multiprocessing\pool.py", line 424, in _handle_tasks
    put(task)
  File "C:\Users\user\Anaconda2\envs\env1\lib\multiprocessing\connection.py", line 206, in send
    self._send_bytes(_ForkingPickler.dumps(obj))
  File "C:\Users\user\Anaconda2\envs\env1\lib\multiprocessing\reduction.py", line 51, in dumps
    cls(buf, protocol).dump(obj)
_pickle.PicklingError: Can't pickle &lt;function foo at 0x00000189D37902F0&gt;: attribute lookup foo on __main__ failed
</code></pre>
<p>Foo is on top-most level, as specified in the <a href="https://docs.python.org/3/library/pickle.html#what-can-be-pickled-and-unpickled" rel="nofollow noreferrer">documentation</a>, but mp still fails to pickle it.
How can I solve this, preferably w/out installing additional packages?</p>
</div>
<div class="post-text" itemprop="text">
<p>I have solved this, using <code>concurrent.futures</code><br/>
This package should goes with my Python installation and the issue is resolved as easily as:</p>
<pre><code>pool = ThreadPoolExecutor(2)
future = pool.submit(foo, 11,2)
print(future.result()) 
</code></pre>
<p>The error seems to be a result of <a href="https://github.com/jonathanslenders/ptpython/issues/193" rel="nofollow noreferrer">a known bug</a>. The suggested Anaconda update doesn't help, though. I wonder if this bug is still present after a year of being reported.</p>
<p>Meanwhile, future's <code>ProcessPoolExecutor</code> produces a similar error:</p>
<pre><code>Traceback (most recent call last):
  File "C:\Users\user\Anaconda2\envs\env1\lib\multiprocessing\queues.py", line 234, in _feed
    obj = _ForkingPickler.dumps(obj)
  File "C:\Users\user\Anaconda2\envs\env1\lib\multiprocessing\reduction.py", line 51, in dumps
    cls(buf, protocol).dump(obj)
_pickle.PicklingError: Can't pickle &lt;function foo at 0x000001D816CF5510&gt;: attribute lookup foo on __main__ failed
</code></pre>
</div>
<span class="comment-copy">This may be relevant <a href="https://github.com/ipython/ipython/issues/1252" rel="nofollow noreferrer">github.com/ipython/ipython/issues/1252</a></span>
