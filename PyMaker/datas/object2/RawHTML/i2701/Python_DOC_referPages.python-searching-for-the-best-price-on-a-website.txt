<div class="post-text" itemprop="text">
<p>I have a bunch of unused steam keys and I'm trying to write a small python script to search for the best prices of every game I own on some of the cheapest steam keys sites. At the moment I've tried as an example to find the best prices on g2a. The script runs almost fine (yes, sometimes returning a single price doesn't exactly return the price for the game I own, but that is not the main problem). The problem is that it seems I can't correctly search for a webpage whenever part of the name contains special characters. I've tried to remove special characters but the problem is still there. Any advices? </p>
<p>This is my script:</p>
<pre><code>import pandas as pd
import sys
from urllib.request import urlopen, Request
from bs4 import BeautifulSoup
import urllib.parse
carica = pd.read_csv("list.csv")
rows=0
pageh = urlopen(Request('https://www.google.com'))
while rows&lt;len(carica)-1:

#while rows&lt;3:
  rows=rows+1
  filename = (carica.values[rows,0])
  filename = filename.replace(",","")
  filename = filename.replace(" ","%20")
  filename = filename.replace("'","")
  if filename is None:filename='Demo'


  quote_page = ('https://www.g2a.com/en-us/search?query='+filename)


  try:page = urlopen(Request(quote_page, headers={'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_4) AppleWebKit/603.1.30 (KHTML, like Gecko) Version/10.1 Safari/603.1.30'}))
  except IOError: page=pageh

  soup = BeautifulSoup(page,'html.parser')


  namea = carica.values[rows,0]
  pricea = soup.find(class_='Card__price-cost price')
  if pricea is None:pricea.text='non trovato'
  testo='\x1b[0m' + carica.values[rows,0] + '\x1b[0m'
  print(testo, '--&gt;', pricea.text)
</code></pre>
<p>A version of it including the list of the games is here:
<a href="https://repl.it/@PaoloVeronesi/g2a-prices" rel="nofollow noreferrer">https://repl.it/@PaoloVeronesi/g2a-prices</a></p>
</div>
<div class="post-text" itemprop="text">
<p>You should not be doing these string "quoting" manually - there is a special set of library functions available for that in Python - <a href="https://docs.python.org/3/library/urllib.parse.html#urllib.parse.quote" rel="nofollow noreferrer"><code>quote()</code></a> or <a href="https://docs.python.org/3/library/urllib.parse.html#urllib.parse.quote_plus" rel="nofollow noreferrer"><code>quote_plus()</code></a> from <code>urllib.parse</code> module:</p>
<pre><code>In [1]: from urllib.parse import quote

In [2]: s = "Small Town Terrors: Galdor's Bluff Collector's Edition"

In [3]: quote(s)
Out[3]: 'Small%20Town%20Terrors%3A%20Galdor%27s%20Bluff%20Collector%27s%20Edition'

In [4]: quote_plus(s)
Out[4]: 'Small+Town+Terrors%3A+Galdor%27s+Bluff+Collector%27s+Edition'
</code></pre>
<p>Or, even better, would be to switch to using <a href="http://docs.python-requests.org/en/master/" rel="nofollow noreferrer"><code>requests</code></a> package that would just do the quoting implicitly and under-the-hood.</p>
</div>
<span class="comment-copy">What are the special characters you are trying to remove? Have you looked into writing a regex?</span>
<span class="comment-copy">I don't know what characters exactly cause the problem. If I use this string for example (Small Town Terrors: Galdor's Bluff Collector's Edition) the page can't be found.</span>
<span class="comment-copy">What are you setting that string as? <code>filename</code>?</span>
<span class="comment-copy">yes as filename so the final page should look like: <a href="https://www.g2a.com/en-us/search?query=Small" rel="nofollow noreferrer">g2a.com/en-us/search?query=Small</a> Town Terrors: Galdor's Bluff Collector's Edition and that works in Chrome.</span>
<span class="comment-copy">I've tried it, that's why I'm importing urllib.parse at the beginning. But that doesn't work anyway.</span>
<span class="comment-copy">@user8472609 well, I think <code>quote()</code> is actually doing it correctly compared to what you had posted - for instance, look how a single quote becomes <code>%27</code>, but you are just replacing it with an empty string. Btw, I do get the same quoted <code>query</code> as when I search for the <code>Small Town Terrors: Galdor's Bluff Collector's Edition</code> on the site itself: <a href="https://www.g2a.com/en-us/search?query=Small%20Town%20Terrors%3A%20Galdor%27s%20Bluff%20Collector%27s%20Edition" rel="nofollow noreferrer">g2a.com/en-us/â€¦</a>.</span>
<span class="comment-copy">So maybe the problem is not in the query itself but in the returned page?  I don't understand what's wrong. The program simply stops.</span>
