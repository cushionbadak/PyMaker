<div class="post-text" itemprop="text">
<p><a href="https://i.stack.imgur.com/JWGIw.png" rel="nofollow noreferrer"><img alt="enter image description here" src="https://i.stack.imgur.com/JWGIw.png"/></a></p>
<p>I'm trying to use python huey (<a href="https://github.com/coleifer/huey/blob/master/huey/api.py" rel="nofollow noreferrer">https://github.com/coleifer/huey/blob/master/huey/api.py</a>) to allow usage of a task queue with flask. </p>
<p>Starting with a function:</p>
<pre><code>def some_long_calculation():
    driver = create_chromedriver(True)
    print(driver.capabilities['version'])
    driver.get("https://www.yahoo.com/news/")
</code></pre>
<p>I import it into the tasks.py file and turn into into a task function with:</p>
<pre><code>from . import my_huey
some_long_calculation_task = my_huey.task(some_long_calculation)
</code></pre>
<p>I then import some_long_calculation_task  into main/views.py and try to run it with:</p>
<pre><code>@main.route('/sanity_check')
def sanity_check():
    png = some_long_calculation_task()
    return send_file(io.BytesIO(png),mimetype='image/png')
</code></pre>
<p>but I get:</p>
<pre><code>traceback (most recent call last):
  File "...lib\site-packages\flask\app.py", line 1994, in __call__
    return self.wsgi_app(environ, start_response)
  File "...lib\site-packages\flask\app.py", line 1985, in wsgi_app
    response = self.handle_exception(e)
  File "...lib\site-packages\flask\app.py", line 1540, in handle_exception
    reraise(exc_type, exc_value, tb)
  File "...lib\site-packages\flask\_compat.py", line 33, in reraise
    raise value
  File "...lib\site-packages\flask\app.py", line 1982, in wsgi_app
    response = self.full_dispatch_request()
  File "...lib\site-packages\flask\app.py", line 1614, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "...lib\site-packages\flask\app.py", line 1517, in handle_user_exception
    reraise(exc_type, exc_value, tb)
  File "...lib\site-packages\flask\_compat.py", line 33, in reraise
    raise value
  File "...lib\site-packages\flask\app.py", line 1612, in full_dispatch_request
    rv = self.dispatch_request()
  File "...lib\site-packages\flask\app.py", line 1598, in dispatch_request
    return self.view_functions[rule.endpoint](**req.view_args)
  File "...app\main\views.py", line 123, in sanity_check
    png = some_long_calculation_task()
TypeError: decorator() missing 1 required positional argument: 'func'

&gt;&gt;&gt; some_long_calculation_task
&lt;function Huey.task.&lt;locals&gt;.decorator at 0x0000028CF8CF2BF8&gt;
</code></pre>
<p>How can I fix this?</p>
</div>
<div class="post-text" itemprop="text">
<p>Based on the error message, <code>task</code> returns a decorator (usually used with <code>@</code> as a syntax sugar).</p>
<p>Try this code instead:</p>
<pre><code>from . import my_huey
some_long_calculation_task = my_huey.task()(some_long_calculation)
</code></pre>
<p>The "normal" usage from this would be something like</p>
<pre><code>@my_huey.task()
def my_function(...):
    ...
</code></pre>
</div>
<span class="comment-copy">I'm pretty sure this is the right answer. The <code>task</code> function is not a decorator itself, but a decorator factory. It probably can take some optional arguments that customize the behavior of the decorator (though the questioner may not need to pass any if the defaults do what they want).</span>
<span class="comment-copy">This appears to work, but now I'm getting other errors. I will ask a follow up, Thank you.</span>
<span class="comment-copy">Is there a way to add an argument e.g. some_long_calculation_task (arg) = my_huey.task()(some_long_calculation(arg)) ?</span>
<span class="comment-copy"><a href="https://docs.python.org/3/library/functools.html#functools.partial" rel="nofollow noreferrer"><code>functools.partial</code></a> maybe what you're looking for?</span>
