<div class="post-text" itemprop="text">
<p>People are spamming channels to gain "XP" (I've used dollars instead) and I was trying to add XP (dollars) if the user doesn't spam, but remove a bit more if they spam the channel. Right now the code is adding dollars, but it seems to be adding +2 dollars each time and not removing dollars if the user spams the channel. I used <code>if not message.author.id == "111176943920152603":</code> to make sure it's the user and not the bot</p>
<pre><code>client = discord.Client()

user_timer = {}
user_spam_count = {}
rdollars = random.randint(0,3)

def save_cash():
with open("cash.json", "w+") as fp:
    json.dump(cash, fp, sort_keys=True, indent=4)

def add_dollars(user: discord.User, dollars: int):
    id = user.id
    if id not in cash:
        cash[id] = {}
    cash[id]["dollars"] = cash[id].get("dollars", 0) + dollars
    print("{} now has {} dollars".format(user.name, cash[id]["dollars"]))
    save_cash()

def remove_dollars(user: discord.User, dollars: int):
    id = user.id
    if id not in cash:
        cash[id] = {}
    cash[id]["dollars"] = cash[id].get("dollars", 0) - dollars
    print("{} now has {} dollars".format(user.name, cash[id]["dollars"]))
    save_cash()

@client.event
async def on_message(message):
    if not message.author.id == "111176943920152603":
    user_timer[message.author.id] = time.time()
            try:
                if time.time() &gt;= user_timer[message.author.id] + 2:
                    user_spam_count[message.author.id] = 0
                    add_dollars(message.author, rdollars)

                if time.time() &lt; user_timer[message.author.id] + 2:
                    user_spam_count[message.author.id] += 1
                    if user_spam_count[message.author] &gt;= 4:
                        remove_dollars(message.author, 25)
                    if user_spam_count[message.author.id] &gt;= 10:
                        remove_dollars(message.author, 50)

            except KeyError:
                add_dollars(message.author, rdollars)
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>You're missing <code>.id</code> in</p>
<pre><code>if user_spam_count[message.author] &gt;= 4:
    remove_dollars(message.author, 25)
</code></pre>
<p>This  </p>
<pre><code>if user_spam_count[message.author.id] &gt;= 4:
    remove_dollars(meesage.author,25) 
</code></pre>
<p>should work fine  </p>
<p>It kept catching a KeyError because of this and adding money instead of going inside the if statement and removing it</p>
<p>This should fix time issue you were having:</p>
<pre><code>@client.event
async def on_message(message):
  if not message.author.id == "111176943920152603":
    try:
      last_post_time = user_timer[message.author.id]
      user_timer[message.author.id] = time.time()

      if user_timer[message.author.id] - last_post_time &gt;= 2:
        user_spam_count[message.author.id] = 0
        add_dollars(message.author, rdollars)

      elif user_timer[message.author.id] - last_post_time &lt; 2:
        user_spam_count[message.author.id] += 1
        if user_spam_count[message.author.id] &gt;= 4:
          remove_dollars(message.author, 25)
        elif user_spam_count[message.author.id] &gt;= 10:
          remove_dollars(message.author, 50)
        else:
          add_dollars(message.author, rdollars)

    except KeyError:
      user_timer[message.author.id] = time.time()
      user_spam_count[message.author.id]=0
      print(user_timer)
      add_dollars(message.author, rdollars)
</code></pre>
<p>The way to detect if someone sent a message in a certain timeframe after their last message is to check if the current_time_of_message - time_of_last_message &lt; desired_amount_of_time  </p>
<ul>
<li>The current_time_of_message is time.time()</li>
<li>The time_of_last_message is the value in your {userID:time}
dictionary</li>
<li>The desired amount is the amount of time it has to pass between 2
messages before they're not considered spam anymore</li>
</ul>
<p>In this case, you've set it to 2 and I've left it as is  </p>
<p>You kept checking based on the same value (You would set your dictionary time to time.time() and compare it to time.time() 2 lines below it)<br/>
Instead, it's better to store that value in a variable and compare using if/elif</p>
</div>
<span class="comment-copy">Is this the complete code? I don't see where the <code>save_cash</code> function is defined. I also cannot see where <code>user_timer</code> is updated, as it only seems to be part of your <code>if</code> statements.</span>
<span class="comment-copy">Oops, i did forget the user_timer code, i didn't add the "save_cash()" because I wasn't trying to spam the question with code lol.</span>
<span class="comment-copy">Thank you for the reply! I added .id to <code>user_spam_count[message.author.id] &gt;=4:</code> but now it seems like everytime I send a message, it adds 3 dollars. When I spam, it doesn't remove any dollars at all either.</span>
<span class="comment-copy">I've edited my answer to hopefully fix this issue</span>
<span class="comment-copy">Thanks so much for your solution! It makes sense now I've tested it for an hour now. <code>time.time()</code> counts by seconds correct? I've ran into another issue where it will add_dollars for the first message the user sends but any message after that it doesn't count as XP, it only keeps adding messages until the user reaches the user_spam_count and then starts to deduct XP instead of adding XP each time the user sends a message without hitting the user_spam_count.</span>
<span class="comment-copy">I've edited the code above and fixed that problem now.   Here is the documentation for <code>time.time()</code> <a href="https://docs.python.org/3/library/time.html#time.time" rel="nofollow noreferrer">docs.python.org/3/library/time.html#time.time</a></span>
<span class="comment-copy">Thank you! This works flawlessly now. I appreciate all of your knowledge and help.</span>
