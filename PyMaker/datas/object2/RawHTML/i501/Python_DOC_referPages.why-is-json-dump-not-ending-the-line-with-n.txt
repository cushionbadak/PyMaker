<div class="post-text" itemprop="text">
<p>When serializing with Python's <code>json</code> module, the <code>dump</code> function is not adding a newline character at the end of the line:</p>
<pre class="lang-py prettyprint-override"><code>import json


data = {'foo': 1}
json.dump(data, open('out.json', 'w'))
</code></pre>
<p>We can check that using <code>wc</code>:</p>
<pre class="lang-sh prettyprint-override"><code>$ wc -l out.json
0 out.json
</code></pre>
<p>Why is it doing that? Considering that:</p>
<ul>
<li>The serialized JSON is a text file and <a href="https://stackoverflow.com/questions/729692/why-should-text-files-end-with-a-newline">text files should end with a newline</a></li>
<li>The POSIX standard defines a line as "<em>A sequence of zero or more non-newline characters plus a terminating newline character.</em>"</li>
<li>Python's documentation notes that "<a href="https://docs.python.org/3/library/json.html#json.dump" rel="nofollow noreferrer"><em>Unlike pickle and marshal, JSON is not a framed protocol, so trying to serialize multiple objects with repeated calls to dump() using the same fp will result in an invalid JSON file</em></a>.</li>
<li>Many tools expect that newline (like <code>wc</code> shown above).</li>
<li>Many editors will add it automatically if you edit the JSON file by hand.</li>
</ul>
</div>
<div class="post-text" itemprop="text">
<p>A serialized JSON is just a sequence of text, not a text file, and there's no requirement for a sequence of text to end with a newline, so the <code>json.dump</code> method is right to produce an output without additional white space characters outside the boundary of the JSON object itself. In many cases such as sending the JSON object over a socket (as pointed out by @deceze in the comments), a newline would be entirely unnecessary, so it's up to the caller the decide whether or not a trailing newline is appropriate for the application.</p>
</div>
<span class="comment-copy">See <a href="https://codeyarns.com/2017/02/22/python-json-dump-misses-last-newline/" rel="nofollow noreferrer">codeyarns.com/2017/02/22/python-json-dump-misses-last-newline</a></span>
<span class="comment-copy">On the contra side, it should dump <i>only</i> the JSON value and not care about surrounding convention regarding files. What if the file-like object was a socket instead?</span>
<span class="comment-copy">@liamhawkins That seems to be a workaround (which I knew about). I would like to know if there is a reason for that behavior, not how to avoid it.</span>
<span class="comment-copy">"The serialized JSON is a text file and text files should end with a newline".. No, a serialized JSON is just a sequence of text, not a text file. There's no requirement for a sequence of text to end with a newline. That's all.</span>
<span class="comment-copy">@Peque Note also that <code>json.dump</code> does not claim to write a text file; it simply writes a JSON serialization of its first argument to a file-like object.</span>
<span class="comment-copy">You could mention, in particular, @deceze's point (a JSON that could be written to a socket instead of a text file in disk).</span>
<span class="comment-copy">Done as requested then. Thanks.</span>
