<div class="post-text" itemprop="text">
<p>I'm trying to redirect the user to my homepage. Its suppose to be as simple as </p>
<pre><code>print "Location:http://localhost:8000/index.html"
print ""
</code></pre>
<p>This isn't working for some reason. I'm running CGIHTTPServer on Kali Linux. I'm using Python 2.7.3
When I try to run the script it simply prints out </p>
<pre><code>Location:http://localhost:8000/index.html
</code></pre>
<p>I have also tried using 127.0.0.1 instead of localhost. It doesn't work either.Here is the CGI script that I'm trying to run</p>
<pre><code>#!/usr/bin/python
import MySQLdb,cgi, os, sys
db=MySQLdb.connect(host="localhost", user="root", passwd="", db="test")
flag=False
query = db.cursor()
sys.stdout.write("Content-type: text/html\r\n\r\n")
sys.stdout.write("")
sys.stdout.write("&lt;html&gt;&lt;body&gt;")
form = cgi.FieldStorage()
name = form.getvalue('temp')
passwd = form.getvalue('temp2')

if(query.execute("select * from cred where uname='"+name+"' and pass='"+passwd+"'")):
    db.commit()
    sys.stdout.write("Hello "+name)

else:
    db.commit()
    flag=True
sys.stdout.write("&lt;/body&gt;&lt;/html&gt;")

if(flag == True):
    print "Location:http://localhost:8000/"
    print ""
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>You have 2 problems here:</p>
<ol>
<li><p>You <em>always</em> write the <code>Content-Type</code> header <em>plus extra newlines</em> at the start. You've now completed all headers and you can no longer add more.</p>
<p>Write these headers <em>only</em> when you are <em>not</em> redirecting.</p></li>
<li><p>A <code>Location</code> header is only used for redirects, a status 30x HTTP response. You'll need to add a <code>Status:</code> header to signal to the web server to respond with a status other than 200.</p></li>
</ol>
<p>Adjusting your code to address these issues:</p>
<pre><code>#!/usr/bin/python
import cgitb
cgitb.enable()

import MySQLdb, cgi, os, sys

db = MySQLdb.connect(host="localhost", user="root", passwd="", db="test")

form = cgi.FieldStorage()
name = form.getvalue('temp')
passwd = form.getvalue('temp2')

with db as query:
    query.execute("select * from cred where uname=%s and %s", (name, passwd))
    result = query.fetchone()

if result is None:
    # no such user, redirect
    print 'Status: 302 Found'
    print 'Location: http://localhost:8000/'
    print

else:
    print 'Content-type: text/html'
    print
    print '&lt;html&gt;&lt;body&gt;Hello {}&lt;/body&gt;&lt;/html&gt;'.format(name)
</code></pre>
<p>Note that I altered the code somewhat to use some best practices:</p>
<ol>
<li><p><strong>NEVER</strong> use string interpolation to put user-information into a SQL query. You'll get hammered by a SQL injection attack that way. Use SQL parameters to have the database driver escape the values for you.</p></li>
<li><p>You can use the connection as a context manager to auto-commit.</p></li>
<li><p>I used string formatting to produce the HTML output.</p></li>
</ol>
</div>
<div class="post-text" itemprop="text">
<p>As the accepted answer states, you'll need a <code>Status: 302 Found</code> or <code>Status: 301 Moved Permanently</code> header along with the <code>Location</code> header to do your redirect properly.  </p>
<p>Also, the Python built-in CGIHTTPServer "cannot execute redirects (HTTP code 302), because code 200 (script output follows) is sent prior to execution of the CGI script. This pre-empts the status code." (<a href="https://docs.python.org/2/library/cgihttpserver.html" rel="nofollow">https://docs.python.org/2/library/cgihttpserver.html</a>)</p>
<p>Unfortunately this is also the case in Python 3.  (<a href="https://docs.python.org/3/library/http.server.html#http.server.CGIHTTPRequestHandler" rel="nofollow">https://docs.python.org/3/library/http.server.html#http.server.CGIHTTPRequestHandler</a>)</p>
<p>There's a ticket about it (<a href="http://bugs.python.org/issue10487" rel="nofollow">http://bugs.python.org/issue10487</a>) but as of right now, there's no way to use the Status header.  This shouldn't be a problem with other CGI servers.</p>
</div>
<span class="comment-copy">I did all the changes as you asked me to, it isn't working yet. I get no errors on my server log and the web page displayed is just blank. Not to mention it did not redirect.</span>
<span class="comment-copy">@user3905719: it looks as if your web server then does not honour the <code>Status:</code> header in that case; that's a violation of the CGI protocol. You can add a <code>Content-type: text/html</code> header, plus a <code>print '&lt;html&gt;&lt;head&gt;&lt;meta http-equiv="refresh" content="0;url=http://localhost:8000" /&gt;&lt;/head&gt;&lt;/html&gt;'</code> line to add a HTML body that <i>also</i> instructs the browser to redirect.</span>
<span class="comment-copy">@user3905719: in modern browsers you can use the developer tools to look at what headers a server sent; look for the network tab.</span>
<span class="comment-copy">Used the developer tools. It says Status text:200.Anyway I added the other header. Now it works just fine. Thank you.</span>
<span class="comment-copy">Good information about the CGIHTTPServer not supporting redirects, I could have spent hours scratching my head if I hadn't read your answer.</span>
