<div class="post-text" itemprop="text">
<p>In Python 3.4.1, why doesn't <a href="https://docs.python.org/3/library/sqlite3.html" rel="nofollow">sqlite3</a> insert the auto-incremented ID into the table in the below program? According to <a href="http://www.sqlite.org/faq.html#q1" rel="nofollow">the SQLite documentation</a>, an integer primary key column should auto-increment, and I can see that from cur.lastrowid returning a valid integer, BUT the same value is not inserted into the table (it becomes NULL instead).</p>
<pre><code>import sqlite3


with sqlite3.connect(':memory:') as conn:
    cur = conn.cursor()
    # Note that column 'id' is an integer primary key
    cur.execute('create table test (id int primary key , name text)')
    cur.execute('insert into test (name) values (?)', ('Test',))
    last_id = cur.lastrowid
    assert last_id is not None

    id_, = cur.execute('select id from test').fetchone()
    assert id_ == last_id, '{} != {}'.format(id_, last_id)
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>Apparently, I was mistaken in thinking that 'int' is a synonym for 'integer' in SQLite. In fact, columns <a href="http://www.sqlite.org/datatypes.html" rel="nofollow">are typeless in SQLite</a> and <code>integer primary key</code> is an exception to this rule, declaring effectively an auto-incremented column:</p>
<pre><code>import sqlite3


with sqlite3.connect(':memory:') as conn:
    cur = conn.cursor()
    # Note that column 'id' is an integer primary key
    cur.execute('create table test (id integer primary key , name text)')
    cur.execute('insert into test (name) values (?)', ('Test',))
    last_id = cur.lastrowid
    assert last_id is not None

    id_, = cur.execute('select id from test').fetchone()
    assert id_ == last_id, '{} != {}'.format(id_, last_id)
</code></pre>
</div>
<span class="comment-copy">This is not a bug; the documentation clearly states you need to use <code>INTEGER PRIMARY KEY</code>.</span>
<span class="comment-copy">The official type name is <code>INTEGER</code>, other names merely create a <a href="http://www.sqlite.org/datatype3.html" rel="nofollow noreferrer">type affinity</a>.</span>
<span class="comment-copy">@MartijnPieters Yeah, you're right, I was able to dig up more information in the meantime. Wasn't aware of SQLite's typelessness until now. Thanks!</span>
