<div class="post-text" itemprop="text">
<p>I have code in multi threads to create folder if not exists</p>
<pre><code>if not os.path.exists(folder): os.makedirs(folder)
</code></pre>
<p>I got error like this</p>
<pre><code>The folder cannot be created since a file already exists with the same path
</code></pre>
<p>I am not sure what can I do for this error, do you have any idea?</p>
</div>
<div class="post-text" itemprop="text">
<p>Read <a href="https://docs.python.org/3/library/os.html#os.makedirs" rel="nofollow noreferrer">the docs</a>. If you don't care whether the directory already existed, just that it does when you're done, just call:</p>
<pre><code>os.makedirs(folder, exist_ok=True)
</code></pre>
<p>Don't even check for the existence of the directory with <code>exists</code> (subject to race conditions), just call <code>os.makedirs</code> with <code>exist_ok=True</code> and it will create it if it doesn't exist and do nothing if it already exists.</p>
<p>This requires Python 3.2 or higher, but if you're on an earlier Python, you can achieve the same silent ignore with exception handling:</p>
<pre><code>import errno

try:
    os.makedirs(folder)
except OSError as e:
    if e.errno != errno.EEXIST:
        raise  # Reraise if failed for reasons other than existing already
</code></pre>
</div>
<span class="comment-copy">Do you have multiple threads trying to create the same folder? The problem is that thread 1 might create the folder between the time thread 2 checks if it exists and then tries to create it.</span>
<span class="comment-copy">you need to implement mutual exclusion between the threads, so that the test and creation are performed atomically.</span>
<span class="comment-copy">I am afraid performance if I use Mutual. In fact, I check and create folder in main thread at first, but I don't want to create folder if no any image download so that I move that function to just before save in threads, is there any way to not affect performance and do what I need?</span>
<span class="comment-copy">Unless you're calling this code frequently, don't worry about the performance. Get it right first, then worry about performance if it's a bottleneck.</span>
<span class="comment-copy">You could just try to create the directory, and ignore the error if it already exists. Then whichever thread gets here first will create it.</span>
<span class="comment-copy">Great! This is what I need!</span>
