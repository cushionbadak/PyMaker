<div class="post-text" itemprop="text">
<p>I am using some pretty standard code:</p>
<pre><code> 1   if not os.path.exists(args.outputDirectory):
 2       if not os.makedirs(args.outputDirectory, 0o666):
 3           sys.exit('Fatal: output directory "' + args.outputDirectory + '" does not exist and cannot be created')
</code></pre>
<p>I remove the directory and the check at <code>1</code> drops through to <code>2</code>. I one-step beyond that and hit the error message at <code>3</code>. </p>
<p>However, when I check, the directory was created successfully. </p>
<pre><code>drwxrwsr-x 2 userId userGroup  4096 Jun 25 16:07 output/
</code></pre>
<p>What am I missing??</p>
</div>
<div class="post-text" itemprop="text">
<p><code>os.makedirs</code> does not indicate whether it succeeded through its return value: it always returns <code>None</code>.</p>
<p><code>None</code> is <code>False</code>-y, therefore, <code>not os.makedirs(args.outputDirectory, 0o666)</code> is always <code>True</code>, which triggers your <code>sys.exit</code> code path.</p>
<hr/>
<p>Fortunately, you don't need any of that. If <code>os.makedirs</code> fails, it'll throw an <code>OSError</code>.</p>
<p>You should catch the exception, not check the return value:</p>
<pre><code>try:
    if not os.path.exists(args.outputDirectory):
        os.makedirs(args.outputDirectory, 0o666):
except OSError:
    sys.exit('Fatal: output directory "' + args.outputDirectory + '" does not exist and cannot be created')
</code></pre>
<p>If no <code>OSError</code> is thrown, that means the directory was successfully created.</p>
</div>
<div class="post-text" itemprop="text">
<p>You don't need to call <code>os.path.exists()</code> (or <code>os.path.isdir()</code>); <code>os.makedirs()</code> has <code>exist_ok</code> parameter.</p>
<p>And <a href="https://stackoverflow.com/a/31052931/4279">as @Thomas Orozco mentioned</a>, you shouldn't check <code>os.makedirs()</code>' return value because <code>os.makedirs()</code> indicates errors by raising an exception instead:</p>
<pre><code>try:
    os.makedirs(args.output_dir, mode=0o666, exist_ok=True)
except OSError as e:
    sys.exit("Can't create {dir}: {err}".format(dir=output_dir, err=e))
</code></pre>
<p>Note: Unlike <code>os.path.exist()</code>-based solution; it raises an error if the path exists but it is not a directory (or a symlink to a directory).</p>
<p>There could be issues with the <code>mode</code> parameter, <a href="https://docs.python.org/3/library/os.html#os.makedirs" rel="nofollow noreferrer">see the note for versions of Python before 3.4.1</a></p>
</div>
<span class="comment-copy">Aside: You are probably better off with <code>if os.path.isdir(...)</code> rather than <code>if os.path.exists(...)</code>. Your code will have unexpected results if intended directory name already exists as a regular file.</span>
<span class="comment-copy">For some reason, passing the access mode as a parameter to <code>makedirs</code> did not take effect. The directory was creed, but not with the desired mode.  I added a following <code>os.chmod(args.outputDirectory, 0o666)</code> and that worked just fine (Python 3.2).</span>
