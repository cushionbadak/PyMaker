<div class="post-text" itemprop="text">
<p>While porting code from <code>python2</code> to <code>3</code>, I get this error when reading from a URL </p>
<blockquote>
<p>TypeError: initial_value must be str or None, not bytes.</p>
</blockquote>
<pre><code>import urllib
import json
import gzip
from urllib.parse import urlencode
from urllib.request import Request


service_url = 'https://babelfy.io/v1/disambiguate'
text = 'BabelNet is both a multilingual encyclopedic dictionary and a semantic network'
lang = 'EN'
Key  = 'KEY'

    params = {
        'text' : text,
        'key'  : Key,
        'lang' :'EN'

        }

url = service_url + '?' + urllib.urlencode(params)
request = Request(url)
request.add_header('Accept-encoding', 'gzip')
response = urllib.request.urlopen(request)
if response.info().get('Content-Encoding') == 'gzip':
            buf = StringIO(response.read())
            f = gzip.GzipFile(fileobj=buf)
            data = json.loads(f.read())
</code></pre>
<p>The exception is thrown at this line  </p>
<pre><code>buf = StringIO(response.read())  
</code></pre>
<p>If I use python2, it works fine.</p>
</div>
<div class="post-text" itemprop="text">
<p><code>response.read()</code> returns an instance of <code>bytes</code> while <a href="https://docs.python.org/3/library/io.html#io.StringIO" rel="noreferrer"><code>StringIO</code></a> is an in-memory stream for text only. Use <a href="https://docs.python.org/3/library/io.html#io.BytesIO" rel="noreferrer"><code>BytesIO</code></a> instead.</p>
<p>From <a href="https://docs.python.org/3.0/whatsnew/3.0.html#text-vs-data-instead-of-unicode-vs-8-bit" rel="noreferrer">What's new in Python 3.0 - Text Vs. Data Instead Of Unicode Vs. 8-bit</a></p>
<blockquote>
<p>The <code>StringIO</code> and <code>cStringIO</code> modules are gone. Instead, import the <code>io</code> module and use <code>io.StringIO</code> or <code>io.BytesIO</code> for text and data respectively.</p>
</blockquote>
</div>
<div class="post-text" itemprop="text">
<p>This looks like another python3 <code>bytes</code> vs. <code>str</code> problem. Your response is of type <code>bytes</code> (which is different in python 3 from <code>str</code>). You need to get it into a string first using <code>response.read().decode('utf-8')</code> say and then use <code>StringIO</code> on it. Or you may want to use <code>BytesIO</code> as someone said - but if you expect it to be <code>str</code>, preferred way is to <code>decode</code> into an <code>str</code> first.</p>
</div>
<span class="comment-copy">Can you please provide full traceback?</span>
<span class="comment-copy">It just gives this error and halts.                                                                                 TypeError: initial_value must be unicode or None, not str</span>
<span class="comment-copy">can you include the value of your variable <code>url</code>? when I try it with <code>url = 'http://www.google.com'</code> the code runs fine for me</span>
<span class="comment-copy">It's gzip encoded content not text.</span>
<span class="comment-copy">Then <code>BytesIO</code> is a good idea.</span>
