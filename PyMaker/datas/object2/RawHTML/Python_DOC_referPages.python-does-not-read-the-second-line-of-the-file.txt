<div class="post-text" itemprop="text">
<p>i have a text file with the below contents</p>
<pre><code>url1,user1,xxxxxxxxx
url2,user2,yyyyyyyyy
</code></pre>
<p>I have a block of code that is supposed to get the value <code>xxxxxxxxx</code> or <code>yyyyyyyyy</code> based on the <code>env</code> value passed(<code>prod</code> or <code>test</code>)</p>
<pre><code>#!/usr/bin/python
import os

class test:
    def __init__(self, env):
        self.env = env

    def func(self):
        res = []
        try:
            if os.path.exists("file.txt"):
                    try:
                        with open("file.txt", 'r') as fp:
                            for line in fp:
                                print("line is " +line)
                                line_api = line.split(',')[2]
                                print(line_api)
                                res.append(line_api)
                                print(res)
                                if self.env == "prod":
                                    self.api = res[0]
                                    print(self.api)
                                else:
                                    self.api = res[1]
                                    print(self.api)
                    except Exception as e:
                        print(e)
        except Exception as e:
            print(e)
</code></pre>
<p>value when <code>else</code> part is executed</p>
<pre><code>list index out of range
</code></pre>
<p>Now when the <code>env</code> passed is <code>prod</code> the function works but when the value is <code>test</code> and the <code>else</code> part is executed the value of list <code>res</code> is only <code>xxxxxx</code>, there is only one value in list and the code <code>self.api = res[1]</code> fails. <code>print(res)</code> only prints <code>['xxxxxxxxxxxx\n']</code> but when <code>url</code> passed is <code>url1</code> <code>print(res)</code> only prints  both ['xxxxxxxxxxx\n', 'yyyyyyyyy \n']</p>
<p>What is wrong with my code?</p>
</div>
<div class="post-text" itemprop="text">
<p>The issue with your code is that you split each line that you read in with <code>line_api = line.split(',')[2]</code> and the <code>[2]</code> is referencing the third element that exists in that list which is <code>xxxxxxxxx</code> or <code>yyyyyyyyy</code>, then when you call <code>self.api = res[0]</code> you reference the first (and only) element in that list.</p>
<p><code>self.api = res[1]</code> will always throw an error because it will never exist in the 1 element list. I'm not sure what the goal was for this else statement, but I would suggest using DirtyBit's elegant solution</p>
</div>
<div class="post-text" itemprop="text">
<p>Since it is hard to debug your already excessive code, Here is a shorter snippet:</p>
<p>Using <a href="https://www.tutorialspoint.com/python/string_startswith.htm" rel="nofollow noreferrer"><code>startswith()</code></a>:</p>
<p>list.txt:</p>
<pre><code>url1,user1,xxxxxxxxx
url2,user2,yyyyyyyyy
</code></pre>
<p><strong>Hence</strong>:</p>
<pre><code>logFile = "list.txt"    

def getUrlValue(url):
    with open(logFile) as f:
        content = f.readlines()

    # you may also want to remove empty lines
    content = [l.strip() for l in content if l.strip()]    

    for line in content:
        if line.startswith(url):
            print(line.split(',')[2])

getUrlValue("url1")
getUrlValue("url2")
</code></pre>
<p><strong>OUTPUT</strong>:</p>
<pre><code>xxxxxxxxx
yyyyyyyyy
</code></pre>
</div>
<span class="comment-copy">So the intention is to find the respective value of a url?</span>
<span class="comment-copy">@DirtyBit  the intention is to find the <code>api</code> value..i.e, the 3rd col value in the text file, value should be 1st col value(xx) if url1 and 2nd col value(yyy) if url2 is passed</span>
<span class="comment-copy">Understood and posted an answer already, see if it helps?</span>
<span class="comment-copy">@DirtyBit i edited my code to be more understandable</span>
<span class="comment-copy">Update: the problem was with the if condition check, the if should be outside for loop.</span>
