<div class="post-text" itemprop="text">
<p>I am running my ui tests with Python + pytest + selenium.
I need to do a screenshot on any test fail (any exception / assertion error etc.)</p>
<p>I would like to impement it in my BaseEnvironment class, which looks like this now</p>
<pre><code>@pytest.mark.flaky(max_runs=3, min_passes=1)
class Rerun:
    pass

class BaseEnvironment(Rerun):
    @classmethod
    def setup_class(cls):
        warnings.simplefilter("ignore")
        cls.driver = create_webdriver()

    @classmethod
    def teardown_class(cls):
        cls.driver.close()
        cls.driver.quit()
</code></pre>
<p>I found a lot of solutions with google but its really complicated or for pyrhon 2.x. I need something simple, like decorator. It must apply to all my tests.
But not something like add to setup <strong>test_status = False</strong>, on the end of each test <strong>test_status = True</strong> and check it in teardown. I would like to do it clean, if it possible. 
Thanks in advice!</p>
</div>
<div class="post-text" itemprop="text">
<p>Here is a decorator that should take a screenshot after each exception and failed assertion which I believe is what you want.  Try something like the following?</p>
<pre><code> def decorator_screenshot(func):
     def wrapper(func, *args, **kwargs):
        try:
           return func(*args, **kwargs)
        except:
           return get_screenshot()
    return wrapper

@decorator_screenshot
def test_something():
    Assert.fail("failed test")
</code></pre>
</div>
<span class="comment-copy">Its not working, getting this error before even test starts  ============================= test session starts ============================= platform win32 -- Python 3.7.1, pytest-4.3.0, py-1.7.0, pluggy-0.8.1 rootdir: C:\Tests\, inifile: plugins: xdist-1.26.1, sugar-0.9.2, rerunfailures-6.0, forked-1.0.2, flaky-3.5.3 Dependencies.py:None (Dependencies.py) Dependencies.py:11: in &lt;module&gt;     class TestDependencies(BaseEnvironment):  E   TypeError: function() argument 1 must be code, not str collected 0 items / 1 errors</span>
<span class="comment-copy">I think I just had to ensure to return a function from the decorator.  Does the above edit help?</span>
<span class="comment-copy">same error :(  TypeError: function() argument 1 must be code, not str</span>
