<div class="post-text" itemprop="text">
<p>I want to connect to gmail SMTP server using secure sockets. I have downloaded the <code>mail.google.com.crt</code> cert file by using my browser - Firefox (I simply opened a <code>gmail.com</code> page and then exported the certificate using my browser export cert button).</p>
<p>However, its seems that there is a problem, and I do not know why. when I changed <code>mail.google.com.crt</code> to <code>GeoTrustGlobalCA.pem</code> (I found it somewhere online) it worked (didnt show the erros). Am I not understand something here?</p>
<pre><code>if __name__ == '__main__':

    HOST = 'smtp.gmail.com'
    PORT = 465

    sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    sock.connect((HOST, PORT))

    context = ssl.SSLContext(ssl.PROTOCOL_SSLv23)
    context.verify_mode = ssl.CERT_REQUIRED
    context.load_verify_locations('mail.google.com.crt')

    # check SNI extension
    if ssl.HAS_SNI:
        secure_sock = context.wrap_socket(sock, server_hostname=HOST)
    else:
        secure_sock = context.wrap_socket(sock)

    cert = secure_sock.getpeercert()
    print cert

    if not cert or ('commonName', 'smtp.google.com') not in cert['subject'][4]: raise Exception("erroe" )

    secure_sock.recv(1024)

    secure_sock.close()
    sock.close()
</code></pre>
</div>
<div class="post-text" itemprop="text">
<blockquote>
<pre><code>context.load_verify_locations('mail.google.com.crt')
</code></pre>
</blockquote>
<p>Verify locations are expected to contain trusted CA certificates. The server certificate you've specified is no CA certificate. From the <a href="https://docs.python.org/3/library/ssl.html#ssl.SSLContext.load_verify_locations" rel="nofollow noreferrer">documentation</a>:</p>
<blockquote>
<p>Load a set of “certification authority” (CA) certificates used to validate other peers’ certificates  ...</p>
</blockquote>
</div>
<span class="comment-copy">I see, thank you. So it seems that I should always export the first (from up to bottom) certificate, because only this one is trusted?</span>
<span class="comment-copy">Does it also mean that if I would like to build my own CA, this would not work? And how about self-signed certificates?</span>
<span class="comment-copy">@yak: if you would built your own CA you can simply add your own root CA. And with self-signed it will work as long as these are a CA too (which the usually are but not always). And <i>"because only this one is trusted?"</i> : nothing is trusted unless you declare it as trusted.</span>
<span class="comment-copy">Thank you so much</span>
