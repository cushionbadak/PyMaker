<div class="post-text" itemprop="text">
<p>While studying Ajax/jQuery, I am trying to setup this test environment:</p>
<ol>
<li>the server recursively copy a full folder form one location to
another; </li>
<li>the client should display the list of copied files, one
by one, in real time until the copy ends;</li>
<li>in the client thereshould be a button to abort the copy operation.</li>
</ol>
<p>Can you pls point me to a simple skeleton of this problem, or give me any clue?
Thanks, I appreciate.</p>
</div>
<div class="post-text" itemprop="text">
<p>Some general ideas for the client:</p>
<ul>
<li>It needs to establish a session. This is both so that it can see the file copy progress of the files it is copying and no other (possibly malicious) third party can see it. This can be done with some sort of a token. This can be stored as a cookie and the server can read this to see what session the request is from.</li>
<li>You need the client to keep requesting the state at a steady interval. This is called <a href="https://en.wikipedia.org/wiki/Polling_(computer_science)" rel="nofollow noreferrer">polling</a>.</li>
</ul>
<p>So, all your client has to do is request to establish a session, request which folder needs to be copied (Possibly needing to request a directory tree), and then make a request for which folder needs to be copied where, and keep making requests for the progress every few seconds or minutes until it is done. In the mean time, if the user wishes to cancel it, send a cancel request to some endpoint.</p>
<p>On the server side, there are many technologies to do this. <a href="https://www.djangoproject.com/" rel="nofollow noreferrer"><code>django</code></a> is the most popular, but this seems like a smaller project, so might I recommended <a href="http://flask.pocoo.org/" rel="nofollow noreferrer"><code>flask</code></a>.</p>
<p>As for the actual task, <a href="https://docs.python.org/3/library/shutil.html#shutil.copytree" rel="nofollow noreferrer"><code>shutil.copytree()</code></a> is what you are looking for. It takes a custom copy function, which you can specify to update a sessions "currently copying" file when a new file needs to be copied:</p>
<pre class="lang-py prettyprint-override"><code>import shutil

def copy_dir(session_id, source, destination):
    def copy_fn(src, dest):
        if sessions[session_id]['data'].aborted:
            return  # Stop copying once requested.
        # Or however your session data is structured
        sessions[session_id]['data'].current_copy = [src, dest]
        shutil.copy2(src, dest)  # Actual copy work
    shutil.copytree(source, destination, copy_function=copy_fn)
</code></pre>
<p>To get the percentage of how much of the file has been copied, compare the size of the file that is being copied to to the file it is being copied from.</p>
<p>Another way to get the percentage of copying, <a href="https://docs.python.org/3/library/os.html#os.walk" rel="nofollow noreferrer"><code>os.walk</code></a> on a directory to generate all the file names, then open the files and copy it in chunks. Update the progress every few chunks. Note that this is very error prone.</p>
</div>
<span class="comment-copy">See <a href="https://stackoverflow.com/questions/42475492/how-to-read-and-echo-file-size-of-uploaded-file-being-written-at-server-in-real">How to read and echo file size of uploaded file being written at server in real time without blocking at both server and client?</a></span>
<span class="comment-copy">Great post, Artyer! I am using Flask, indeed! And my copy_dir function is already working on cli app, fully tested. I already have the copy_fn(src, dest) and at the moment it prints out in the terminal each file been copied. The problem is that now I need to move from cli to web application (that's why Flask) an I need to display in user's screen those file names while they get listed. So, the proble is: "how to implement AJAX/jQuery on the client side?</span>
<span class="comment-copy">At the end, I managed to build this behaviour using WebSockets (Flask.SocketIO)</span>
