<div class="post-text" itemprop="text">
<p>Given a datetime.timedelta, how to convert it into a string of ISO 8601 duration format?</p>
<p>Ex,</p>
<pre><code>&gt;&gt;&gt; iso8601(datetime.timedelta(0, 18, 179651))
'PT18.179651S'
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>This is a function from <a href="https://github.com/RusticiSoftware/TinCanPython" rel="nofollow">Tin Can Python</a> project (Apache License 2.0) that can do the conversion:</p>
<pre><code>def iso8601(value):
    # split seconds to larger units
    seconds = value.total_seconds()
    minutes, seconds = divmod(seconds, 60)
    hours, minutes = divmod(minutes, 60)
    days, hours = divmod(hours, 24)
    days, hours, minutes = map(int, (days, hours, minutes))
    seconds = round(seconds, 6)

    ## build date
    date = ''
    if days:
        date = '%sD' % days

    ## build time
    time = u'T'
    # hours
    bigger_exists = date or hours
    if bigger_exists:
        time += '{:02}H'.format(hours)
    # minutes
    bigger_exists = bigger_exists or minutes
    if bigger_exists:
      time += '{:02}M'.format(minutes)
    # seconds
    if seconds.is_integer():
        seconds = '{:02}'.format(int(seconds))
    else:
        # 9 chars long w/leading 0, 6 digits after decimal
        seconds = '%09.6f' % seconds
    # remove trailing zeros
    seconds = seconds.rstrip('0')
    time += '{}S'.format(seconds)
    return u'P' + date + time
</code></pre>
<p>E.g.</p>
<pre><code>&gt;&gt;&gt; iso8601(datetime.timedelta(0, 18, 179651))
'PT18.179651S'
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>Although the <a href="https://docs.python.org/3/library/datetime.html" rel="nofollow noreferrer"><code>datetime</code> module</a> contains an implementation for a ISO 8601 notation for <code>datetime</code> or <code>date</code> objects, it does not currently (Python 3.7) support the same for <code>timedelta</code> objects.  However, the <a href="https://pypi.org/project/isodate/" rel="nofollow noreferrer"><code>isodate</code> module (pypi link)</a> has functionality to generate a duration string in ISO 8601 notation:</p>
<pre><code>In [15]: import isodate, datetime

In [16]: print(isodate.duration_isoformat(datetime.datetime.now() - datetime.datetime(1985, 8, 13, 15)))
P12148DT4H20M39.47017S
</code></pre>
<p>which means 12148 days, 4 hours, 20 minutes, 39.47017 seconds.</p>
</div>
<span class="comment-copy"><a href="https://pypi.python.org/pypi/isodate" rel="nofollow noreferrer">The <code>isodate</code> module on PyPI</a> can do that. You can <a href="https://github.com/gweis/isodate/blob/master/src/isodate/isostrf.py#L122" rel="nofollow noreferrer">look into its source code</a> to see how it's implemented.</span>
<span class="comment-copy">@Carsten It works quite well through isodate: <code>isodate.duration_isoformat(timedelta)</code>. Thanks.</span>
