<div class="post-text" itemprop="text">
<p>I am using python 3 &amp; I have this code, trying to get base64 out of stream and returnn as json  - but not working.</p>
<pre><code>       stream = BytesIO()
       img.save(stream,format='png')
       return base64.b64encode(stream.getvalue())
</code></pre>
<p>in my view, I have:</p>
<pre><code>hm =mymap()
    strHM = hm.generate(data)
return HttpResponse(json.dumps({"img": strHM}),content_type="application/json"  )
</code></pre>
<p>getting error  is not JSON serializable.  base64.b64encode(stream.getvalue()) seems giving bytes</p>
</div>
<div class="post-text" itemprop="text">
<p>In Python 3.x, <a href="https://docs.python.org/3/library/base64.html#base64.b64encode"><code>base64.b64encode</code></a> accepts a <code>bytes</code> object and returns a <code>bytes</code> object.</p>
<pre><code>&gt;&gt;&gt; base64.b64encode(b'a')
b'YQ=='
&gt;&gt;&gt; base64.b64encode(b'a').decode()
'YQ=='
</code></pre>
<p>You need to convert it to <code>str</code> object, using <a href="https://docs.python.org/3/library/stdtypes.html#bytes.decode"><code>bytes.decode</code></a>:</p>
<pre><code>return base64.b64encode(stream.getvalue()).decode()
</code></pre>
</div>
<span class="comment-copy">strHM is base64.b64encode(stream.getvalue())</span>
<span class="comment-copy">I was missing <code>.decode()</code> in my Flask app. Thank you!</span>
<span class="comment-copy">Any drawbacks to leaving the default argument of <a href="https://docs.python.org/3/library/stdtypes.html#bytes.decode" rel="nofollow noreferrer"><code>encoding="utf-8"</code></a>, considering UTF-8 isn't being used here?</span>
<span class="comment-copy">@esmail, utf-8 is default in Python 3.x, so I think there's no drawback. If you're not sure, you can specify <code>ascii</code> explicitly.</span>
