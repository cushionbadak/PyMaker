<div class="post-text" itemprop="text">
<p>I am trying to plot a seaborn histogram on a <a href="http://www.kaggle.com" rel="noreferrer">Kaggle</a> notebook in this way:</p>
<pre><code> sns.distplot(myseries, bins=50, kde=True)
</code></pre>
<p>but I get this error:</p>
<pre><code>TypeError: slice indices must be integers or None or have an __index__ method
</code></pre>
<p>Thi is the Kaggle notebook: 
<a href="https://www.kaggle.com/asindico/slice-indices-must-be-integers-or-none/" rel="noreferrer">https://www.kaggle.com/asindico/slice-indices-must-be-integers-or-none/</a></p>
<p>here is the series head:</p>
<pre><code>0     5850000
1     6000000
2     5700000
3    13100000
4    16331452
Name: price_doc, dtype: int64
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>As @ryankdwyer pointed out, it was an <a href="https://github.com/mwaskom/seaborn/issues/1092" rel="nofollow noreferrer">issue</a> in the underlying <code>statsmodels</code> implementation which is no longer existent in the <code>0.8.0</code> release.</p>
<p>Since kaggle won't allow you to access the internet from any kernel/script, upgrading the package is not an option. You basically have the following two alternatives:</p>
<ol>
<li>Use <code>sns.distplot(myseries, bins=50, kde=False)</code>. This will of course not print the kde.</li>
<li>Manually patch the <code>statsmodels</code> implementation with the <a href="https://github.com/statsmodels/statsmodels/blob/570604b3a8f044a89627c71494c8e324ed37cf85/statsmodels/nonparametric/kdetools.py" rel="nofollow noreferrer">code</a> from version <code>0.8.0</code>. Admittedly, this is a bit hacky, but you will get the kde plot.</li>
</ol>
<p>Here is an example (and a <a href="https://www.kaggle.com/jantrienes/notebookbd8218e4ad/" rel="nofollow noreferrer">proof on kaggle</a>):</p>
<pre><code>import numpy as np

def _revrt(X,m=None):
    """
    Inverse of forrt. Equivalent to Munro (1976) REVRT routine.
    """
    if m is None:
        m = len(X)
    i = int(m // 2+1)
    y = X[:i] + np.r_[0,X[i:],0]*1j
    return np.fft.irfft(y)*m

from statsmodels.nonparametric import kdetools

# replace the implementation with new method.
kdetools.revrt = _revrt

# import seaborn AFTER replacing the method. 
import seaborn as sns

# draw the distplot with the kde function
sns.distplot(myseries, bins=50, kde=True)
</code></pre>
<p>Why does it work? Well, it relates to the way Python loads modules. From the Python <a href="https://docs.python.org/3/reference/import.html#the-module-cache" rel="nofollow noreferrer">docs</a>:</p>
<blockquote>
<p><strong>5.3.1. The module cache</strong></p>
<p>The first place checked during import search is <code>sys.modules</code>. This mapping serves as a cache of all modules that have been previously imported, including the intermediate paths. So if <code>foo.bar.baz</code> was previously imported, <code>sys.modules</code> will contain entries for <code>foo</code>, <code>foo.bar</code>, and <code>foo.bar.baz</code>. Each key will have as its value the corresponding module object.</p>
</blockquote>
<p>Therefore, the <code>from statsmodels.nonparametric import kdetools</code> is inside this module cache. The next time seaborn acquires it, the cached version will be returned by the Python module loader. Since this cached version is the module that we have adapted, our patch of the <code>revrt</code> function is used. By the way, this practice is very handy when writing unit tests and is called <em>mocking</em>. </p>
</div>
<div class="post-text" itemprop="text">
<p>This error appears to be a known issue. </p>
<p><a href="https://github.com/mwaskom/seaborn/issues/1092" rel="nofollow noreferrer">https://github.com/mwaskom/seaborn/issues/1092</a></p>
<p>Potential Solution -&gt; update your statsmodels package to 0.8.0 </p>
<p><code>pip install -U statsmodels</code></p>
</div>
<div class="post-text" itemprop="text">
<p>From the seaborn issue from @ryankdwyer, it sounds like a bug in the kde. Try turning it off with kde=False.</p>
<pre><code> sns.distplot(myseries, bins=50, kde=False)
</code></pre>
</div>
<span class="comment-copy">Of what type is your Series?</span>
<span class="comment-copy">@Kyle I have updated the question</span>
<span class="comment-copy">@Kyle you were right kde=False fix the issue. If you post the right answer I can assign you the bounty</span>
<span class="comment-copy">it happens on Kaggle ... I can not uninstall/update anything</span>
<span class="comment-copy">If you can live without the KDE it might avoid this bug.</span>
<span class="comment-copy">@kyle <a href="http://www.kaggle.com" rel="nofollow noreferrer">kaggle.com</a> Kaggle ...</span>
<span class="comment-copy">@kyle I have seen other Kaggle kernels successfully using it</span>
