<div class="post-text" itemprop="text">
<p>I have a dataframe (my real one has 50 000 rows and 34 columns):</p>
<pre><code>df = pd.DataFrame({
    'NAME': ['APPLE COMPANY A', 'BANANA COMPANY B', 'ORANGE COMPANY C', 'APPLE COMPANY A'],
    'INVESTMENTS': ['OIL LTD', 'GOLD LTD', 'GAS LTD', 'GAS LTD'],
    'STOCKS' : [100, 200, 300, 400],
    'OIL LTD': [0, 0, 0, 0],
    'GOLD LTD': [0, 0, 0, 0],
    'GAS LTD': [0, 0, 0, 0],
    })

               NAME INVESTMENTS  STOCKS  OIL LTD  GOLD LTD  GAS LTD
0   APPLE COMPANY A     OIL LTD     100        0         0        0
1  BANANA COMPANY B    GOLD LTD     200        0         0        0
2  ORANGE COMPANY C     GAS LTD     300        0         0        0
3   APPLE COMPANY A     GAS LTD     400        0         0        0
</code></pre>
<p>How can I lookup the values from column <code>STOCKS</code> based on values from <code>NAME</code> and column names? For example for the first value in column <code>OIL LTD</code> it searches for <code>APPLE COMPANY A</code> in column <code>NAME</code> and <code>OIL LTD</code> (based on the column with the same name) in column <code>INVESTMENTS</code>, which gives the value <code>100</code> and can be seen below. Thus, the value it search for is from the column name <code>OIL LTD</code>, <code>GOLD LTD</code>, <code>GAS LTD</code> etc. based on values from <code>NAME</code> and <code>INVESTMENTS</code>.</p>
<p>I want the output to look like this:</p>
<pre><code>               NAME INVESTMENTS  STOCKS  OIL LTD  GOLD LTD  GAS LTD
0   APPLE COMPANY A     OIL LTD     100      100         0      400
1  BANANA COMPANY B    GOLD LTD     200        0       200        0
2  ORANGE COMPANY C     GAS LTD     300        0         0      300
3   APPLE COMPANY A     GAS LTD     400        0         0      400
</code></pre>
<p>I would usually use <code>pd.merge()</code> if I want to lookup one value, but not sure if that works with two values. It works with Excel, but it takes 15 minutes to run the function per column, which is not efficient.</p>
</div>
<div class="post-text" itemprop="text">
<p>If last columns are filled only by <code>0</code> solution is <code>pivot</code>, thn remove columns and last join:</p>
<pre><code>df1 = df.pivot('NAME','INVESTMENTS','STOCKS').fillna(0).astype(int)
df = df.drop(df1.columns, axis=1).join(df1, on='NAME')
print (df)
               NAME INVESTMENTS  STOCKS  GAS LTD  GOLD LTD  OIL LTD
0   APPLE COMPANY A     OIL LTD     100      400         0      100
1  BANANA COMPANY B    GOLD LTD     200        0       200        0
2  ORANGE COMPANY C     GAS LTD     300      300         0        0
3   APPLE COMPANY A     GAS LTD     400      400         0      100
</code></pre>
<p>If order of columns is necessary same like in original DataFrame:</p>
<pre><code>cols = df.columns.drop(['NAME','INVESTMENTS','STOCKS'])
df1 = df.pivot('NAME','INVESTMENTS','STOCKS').fillna(0).astype(int)[cols]
df = df.drop(df1.columns, axis=1).join(df1, on='NAME')
print (df)
               NAME INVESTMENTS  STOCKS  OIL LTD  GOLD LTD  GAS LTD
0   APPLE COMPANY A     OIL LTD     100      100         0      400
1  BANANA COMPANY B    GOLD LTD     200        0       200        0
2  ORANGE COMPANY C     GAS LTD     300        0         0      300
3   APPLE COMPANY A     GAS LTD     400      100         0      400
</code></pre>
</div>
<span class="comment-copy">Are last columns filled by <code>0</code> only?</span>
<span class="comment-copy">Yes, that is correct @jezrael.</span>
<span class="comment-copy">I get error <code>KeyError: "[' GAS LTD'] not found in axis"</code> when I run <code>df = df.drop(df1.columns, axis=1).join(df1, on='NAME')</code>, which is strange, because it does exist. I think has to do with duplicates as<code>GAS LTD</code> occur twice.</span>
<span class="comment-copy">@Mataunited17 - I remove it in sample data - <code>['OIL LTD', 'GOLD LTD', 'GAS LTD', ' GAS LTD'],</code> to <code>['OIL LTD', 'GOLD LTD', 'GAS LTD', 'GAS LTD'],</code>, because columns names in sample data have no <code>' GAS LTD': [0, 0, 0, 0],'GAS LTD': [0, 0, 0, 0],</code>, only <code>'GAS LTD': [0, 0, 0, 0],</code></span>
<span class="comment-copy">I get the error message <code>ValueError: Index contains duplicate entries, cannot reshape</code> when I run it for my population data. I tried using <code>df.reset_index(drop=True)</code> to remove duplicates, and my column names consist mainly of unique strings.</span>
<span class="comment-copy">@Mataunited17 - I think there are duplicates, need <code>df.pivot_table(index='NAME',columns='INVESTMENTS',values='STOCKS', fill_value=0, aggunc='mean')[cols]</code></span>
<span class="comment-copy">@Mataunited17 - It aggregate duplicated <code>('NAME','INVESTMENTS')</code> by <code>mean</code></span>
