<div class="post-text" itemprop="text">
<p>im trying to create a shortcut that needs administrator privileges ... i found this code on the internet but its coded in powershell ... i test it its working !! but i need it in python how i can do the same with python </p>
<p>powershell code : </p>
<blockquote>
<p>Read the .lnk file in as an array of bytes. Locate byte 21 (0x15) and
  change bit 6 (0x20) to 1. This is the RunAsAdministrator flag. Then
  you write you byte array back into the .lnk file.</p>
</blockquote>
<pre><code>$WshShell = New-Object -comObject WScript.Shell
$Shortcut = $WshShell.CreateShortcut("$Home\Desktop\ColorPix.lnk")
$Shortcut.TargetPath = "C:\Program Files (x86)\ColorPix\ColorPix.exe"
$Shortcut.Save()

$bytes = [System.IO.File]::ReadAllBytes("$Home\Desktop\ColorPix.lnk")
$bytes[0x15] = $bytes[0x15] -bor 0x20 #set byte 21 (0x15) bit 6 (0x20) ON
[System.IO.File]::WriteAllBytes("$Home\Desktop\ColorPix.lnk", $bytes)
</code></pre>
<p>this is my python code : </p>
<pre><code>filename = r'C:\Users\root\Desktop\qassam.lnk'

with open(filename, "rb") as f2:

    while True:
      current_byte = f2.read(1)
      if (not current_byte):
        break
      val = ord(current_byte)
      q = hex(val)
      print q 
</code></pre>
<p>i dont know what is the next step can u help me ? </p>
</div>
<div class="post-text" itemprop="text">
<p>You could either use a library for editing <code>.lnk</code> files (not checked by me):</p>
<ul>
<li><a href="https://github.com/libyal/liblnk" rel="nofollow noreferrer">https://github.com/libyal/liblnk</a></li>
<li><a href="https://pypi.org/project/pylnk/" rel="nofollow noreferrer">https://pypi.org/project/pylnk/</a></li>
</ul>
<p>Or emulate the behavior of your command using <a href="https://docs.python.org/3/library/functions.html#func-bytearray" rel="nofollow noreferrer"><code>bytearray</code></a></p>
<pre><code>filename = r'C:\Users\root\Desktop\qassam.lnk'

# $bytes = [System.IO.File]::ReadAllBytes("$Home\Desktop\ColorPix.lnk")
with open(filename, "rb") as f2:
  ba = bytearray(f2.read())

# $bytes[0x15] = $bytes[0x15] -bor 0x20 #set byte 21 (0x15) bit 6 (0x20) ON
ba[0x15] = ba[0x15] | 0x20

# [System.IO.File]::WriteAllBytes("$Home\Desktop\ColorPix.lnk", $bytes)
with open(filename, "wb") as f3:
  f3.write(ba)
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>This code generated the shortcut. But I didn't understand exactly what you wanted.</p>
<p>Code:</p>
<pre><code>import os

def short(Shortcut_Path, _Path):
    Shortcut = """
    $WshShell = New-Object -comObject WScript.Shell
    $Shortcut = $WshShell.CreateShortcut("{}")
    $Shortcut.TargetPath = "{}"
    $Shortcut.Save()""".format(Shortcut_Path, _Path)

    open("Shortcut.ps1", "w").write(Shortcut)
    os.system("Shortcut.ps1")
    os.remove("Shortcut.ps1")

short(os.environ["USERPROFILE"] + r"\Desktop\AIMP.lnk", r"C:\Program Files 
(x86)\AIMP\AIMP.exe")
</code></pre>
</div>
<span class="comment-copy">i got this error :      with open(filename, "wb") as f3: IOError: [Errno 13] Permission denied: 'C:\\Users\\Public\\Desktop\\Google Chrome.lnk'</span>
<span class="comment-copy">@evilcode1 Could you try with a <code>.lnk</code> created by yourself? It would make sense to me that you don't have the rights to edit the chrome shortcut (which is what a virus would do)</span>
<span class="comment-copy">solved thank u very much .... can u explain what this line doing and what is | for ?? ( ba[0x15] = ba[0x15] | 0x20 )</span>
<span class="comment-copy">@evilcode1 i've matched the lines with the lines of your powershell example. I hope it's all clear now</span>
