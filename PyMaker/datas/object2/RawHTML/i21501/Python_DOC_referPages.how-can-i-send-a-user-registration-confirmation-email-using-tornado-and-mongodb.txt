<div class="post-text" itemprop="text">
<p>I'm working with Tornado and MongoDB and I would like to send a confirmation email to the user when he creates an account in my application.</p>
<p>For the moment, I use a simple XHTML page with a form and I send information to my MongoDB database using Tornado. I would like to have an intermediate step which sends an email to the user before inserting the data into the database.</p>
<p>I would like to know how could I send this email and insert the user account only after the user receives the email and confirms his registration.</p>
</div>
<div class="post-text" itemprop="text">
<p>What you need is an activation URL. The activation URL contains a unique ID, a UUID perhaps, which is verified when the user clicks the activation URL.</p>
<p>To avoid storing the user data in the database, you could store the user data in the activation URL sent to the user:</p>
<pre><code>import urllib
data = urllib.urlencode({'name':'joe', 'password':'1234'})
activation_url = 'http://example.com/activate?%s' % data
</code></pre>
<p>But because user information is sent in plain text this method is very insecure.</p>
<p>The correct way to approach this is to store the user's information along with an activation flag in the database. When the user clicks the activation URL, the unique ID is verified and the activation flag is set to true enabling the new user account.</p>
<p>Sending email in Python is pretty straight forward when you have access to a SMTP server or Gmail account.</p>
<p>The Python docs contain some <a href="https://docs.python.org/3/library/email.examples.html" rel="nofollow noreferrer">examples</a> of sending email from Python.</p>
</div>
<div class="post-text" itemprop="text">
<p>I wonder why you would handle registration like that. The usual way to handle registration is:</p>
<ol>
<li>Write the user info to the database, but with an 'inactive' label attached to the user.</li>
<li>Send an email to the user.</li>
<li>If the user confirms the registration, then switch the user to 'active'.</li>
</ol>
<p>If you don't want to write to the database, you can write to a cache (like memcache, redis), then when the user confirms the registration, you can get the user info from the cache and write it to the database.</p>
</div>
