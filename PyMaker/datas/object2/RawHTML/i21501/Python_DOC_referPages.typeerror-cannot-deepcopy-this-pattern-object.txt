<div class="post-text" itemprop="text">
<p>Trying to understand this error in my "Variable" class. </p>
<p>I was hoping to store a sre.SRE_Pattern  in my "Variable" class. I just started copying the Variable class and noticed that it was causing all my Variable class instances to change. I now understand that I need to deepcopy this class, but now I run into "TypeError: cannot deepcopy this pattern object". Sure, I can store the pattern as a text string but the rest of my code already expects a compiled pattern! What would be the best way to copy my Variable class with a pattern object? </p>
<pre><code>import re
from copy import deepcopy

class VariableWithRE(object):
    "general variable class"
    def __init__(self,name,regexTarget,type):
        self.name = name
        self.regexTarget = re.compile(regexTarget, re.U|re.M) 
        self.type = type 

class VariableWithoutRE(object):
    "general variable class"
    def __init__(self,name,regexTarget,type):
        self.name = name
        self.regexTarget = regexTarget
        self.type = type 

if __name__ == "__main__":

    myVariable = VariableWithoutRE("myName","myRegexSearch","myType")
    myVariableCopy = deepcopy(myVariable)

    myVariable = VariableWithRE("myName","myRegexSearch","myType")
    myVariableCopy = deepcopy(myVariable)
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p><code>deepcopy</code>  doesn't know anything about your classes and doesn't know how to copy them.</p>
<p>You can tell <code>deepcopy</code> how to copy your objects by implementing a <code>__deepcopy__()</code> method:</p>
<pre><code>class VariableWithoutRE(object):
   # ...
   def __deepcopy__(self):
      return VariableWithoutRE(self.name, self.regexTarget, self.type)
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>This seems to be fixed in Python version 3.7+:</p>
<blockquote>
<p>Compiled regular expression and match objects can now be copied using copy.copy() and copy.deepcopy(). (Contributed by Serhiy Storchaka in bpo-10076.)</p>
</blockquote>
<p>as per: <a href="https://docs.python.org/3/whatsnew/3.7.html#re" rel="nofollow noreferrer">https://docs.python.org/3/whatsnew/3.7.html#re</a></p>
<p>Testing:</p>
<pre><code>import re,copy

class C():
    def __init__(self):
       self.regex=re.compile('\d+')

myobj = C()    
foo = copy.deepcopy(myobj)
foo.regex == myobj.regex
# True
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>The problem seems to be the compiled regex. <code>deepcopy</code> cannot handle them. </p>
<p>A minimal example gives me the same error:</p>
<pre><code>import re,copy
class C():
    def __init__(self):
        self.regex=re.compile('\d+')

myobj = C()    
copy.deepcopy(myobj)
</code></pre>
<p>This throws the error: <code>TypeError: cannot deepcopy this pattern object</code>. I'm in python3.5.</p>
</div>
<span class="comment-copy">Given that compiler regexp is immutable, it's not necessary to deepcopy it. However I don't remember how tell <code>deepcopy()</code> how to handle a particular type (but note, that you <i>can</i> add attributes to the build in type if needed).</span>
<span class="comment-copy">What line from your code throwing exception? I have copied it and compile then -&gt; it works without any errors at my side. The only thing i found is that you try to use variable that rewrite python method 'type' and this is not very good style.</span>
<span class="comment-copy">The last line throws the error for me in Python 2.6.</span>
<span class="comment-copy">The problem is to copy <code>VariableWithRE</code>, so your example doesn't really help, but it goes in the right direction.</span>
<span class="comment-copy">I tried this method in both of my classes, first I got "TypeError: __deepcopy__() takes exactly 1 argument (2 given)", then I looked at <a href="http://stackoverflow.com/questions/3036648/how-can-i-override-deepcopy-in-python">this</a> question, and tried "def __deepcopy__(self,memo):". Syntax seems strange to me as someone still learning Python, but ok, memo, fine. This works in class VariableWithoutRE but still problem with class VariableWithRE! New error: "ValueError: Cannot process flags argument with a compiled pattern"</span>
<span class="comment-copy">@user789215 The problem is that you are invoking the <code>VariableWithoutRE</code> constructor (<b>init</b>) with an already compiled regex (self.regexTarget), while the constructor expects a string.</span>
<span class="comment-copy">c.f. <a href="https://github.com/django-import-export/django-import-export/issues/791" rel="nofollow noreferrer">github.com/django-import-export/django-import-export/issues/791</a></span>
