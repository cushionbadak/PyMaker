<div class="post-text" itemprop="text">
<p>I would like to list all directories on a ftp directory and then enter each of them.
The problem is that my code also list file and try to enter them as well.</p>
<ol>
<li>Is there a way to get a return value from the method ftp.cwd ? </li>
<li>Is there a way to get only directory name in the first place, or there is a better way to do what I want.</li>
</ol>
<p>Here is the code I am using now:</p>
<pre><code>    from ftplib import FTP
    ftp = FTP('ftp.overtherainbow.com')
    ftp.login()
    for name in ftp.nlst():
        print "listing: " + name
        ftp.cwd(name)
        ftp.retrlines('LIST')
        ftp.cwd('../')
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>The FTP protocol doesn't have a way of distinguishing between directories and files (as for listing). I think the best bet would be either, try and fail</p>
<pre><code>try:
    ftp.cwd(name)
except ftplib.error_perm as detail:
    print("It's probably not a directory:", detail)
</code></pre>
<p>Or otherwise you may want to parse the output from the directory listing. This will not be platform independent though, because directory listings differ from OS to OS. 
As shown <a href="https://stackoverflow.com/questions/584865/determine-if-a-listing-is-a-directory-or-file-in-python-over-ftp/585232#585232">here...</a></p>
</div>
<div class="post-text" itemprop="text">
<p>Here is a Python 3.3 solution (mlsd):
<a href="http://docs.python.org/3/library/ftplib.html#ftplib.FTP.mlsd" rel="nofollow">http://docs.python.org/3/library/ftplib.html#ftplib.FTP.mlsd</a></p>
<p>ftp.nlst and ftp.dir are "Deprecated since version 3.3: use mlsd() instead."</p>
</div>
<div class="post-text" itemprop="text">
<p>This is a bit ugly, but the <code>ftplib</code> seems not very easy to use.</p>
<pre><code>&gt;&gt;&gt; x=[]
&gt;&gt;&gt; ftp.dir('-d','*/',lambda L:x.append(L.split()[-1]))
&gt;&gt;&gt; x
['access-logs/', 'etc/', 'mail/', 'perl/', 'proxy/', 'public_ftp/', 'public_html/', 'subversion/', 'tmp/', 'web/', 'www/']
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>That worked for me:</p>
<pre><code>def get_current_dir_subdirs(self):
    ret = []
    self.ftp.dir("",ret.append)
    ret = [x.split()[-1] for x in ret if x.startswith("d")]
    return ret 
</code></pre>
</div>
