<div class="post-text" itemprop="text">
<p>I have a list of tuples like this:</p>
<pre><code>x=[('HSBC8999', 4, 179447), ('HSBC1199', 81, 864108), ('HSBC1199', 32, 715121),('HSBC8999', 4, 1447),('HSBC1199', 32, 61521) ]
</code></pre>
<p>I want to perform few task:</p>
<ol>
<li><p>group the list according to the 1st item :HSBCXXXX</p></li>
<li><p>in each group,compute the average values for 3rd item in the list which having the same 2nd item.</p></li>
</ol>
<p>something like this:
group 1:</p>
<pre><code>('HSBC8999', 4, 179447)
('HSBC8999', 4, 1447)
</code></pre>
<p>average for 4 : (179447+1447)/2</p>
<p>group 2:  </p>
<pre><code>('HSBC1199', 81, 864108)
('HSBC1199', 32, 715121)
('HSBC1199', 32, 61521)
</code></pre>
<p>Average for 81: 864108 </p>
<p>Average for 32= (715121+61521)/2</p>
</div>
<div class="post-text" itemprop="text">
<pre><code>import itertools
import operator

L = [('HSBC8999', 4, 179447), ('HSBC1199', 81, 864108), ('HSBC1199', 32, 715121),('HSBC8999', 4, 1447),('HSBC1199', 32, 61521) ]

L.sort(key=operator.itemgetter(0))
for _k, stackoverflow in itertools.groupby(L, operator.itemgetter(0)):
    subl = list(stackoverflow)
    subl.sort(key=operator.itemgetter(1))
    for k, subg in itertools.groupby(subl, operator.itemgetter(1)):
        subs = list(subg)
        print("the average of {} is {}".format(k, sum(s[2] for s in subs)/len(subs)))
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>Using nested defaultdict with float  </p>
<pre><code>from collections import defaultdict

l = [('A1', 'A', 342.5), ('A2', 'A', 509.70), ('A2', 'B', 119.34),
     ('A1', 'B', 618.42), ('A1', 'A', 173.54), ('A1', 'B', 235.21)]

d = defaultdict(lambda: defaultdict(lambda: defaultdict(float)))

for a,b,c in l:
    d[a][b]['sum'] += c
    d[a][b]['count'] += 1
    d[a][b]['average'] += (c - d[a][b]['average'])/d[a][b]['count']
</code></pre>
<p>We use the fact that the average can be calculates as (see: <a href="https://math.stackexchange.com/posts/957376/">https://math.stackexchange.com/posts/957376/</a>)</p>
<p><a href="https://i.stack.imgur.com/82vMt.png" rel="nofollow noreferrer"><img alt="enter image description here" src="https://i.stack.imgur.com/82vMt.png"/></a></p>
<p>Returns the following structure:</p>
<pre><code>{
  "A1": {
    "A": {
      "sum": 516.04,
      "count": 2.0,
      "average": 258.02
    },
    "B": {
      "sum": 853.63,
      "count": 2.0,
      "average": 426.815
    }
  },
  "A2": {
    "A": {
      "sum": 509.7,
      "count": 1.0,
      "average": 509.7
    },
    "B": {
      "sum": 119.34,
      "count": 1.0,
      "average": 119.34
    }
  }
}
</code></pre>
</div>
<span class="comment-copy"><a href="https://docs.python.org/3/library/operator.html#operator.itemgetter" rel="nofollow noreferrer">docs.python.org/3/library/operator.html#operator.itemgetter</a> and <a href="https://docs.python.org/3/library/itertools.html#itertools.groupby" rel="nofollow noreferrer">docs.python.org/3/library/itertools.html#itertools.groupby</a> may help.</span>
<span class="comment-copy">Please read this first <a href="http://stackoverflow.com/help/how-to-ask">stackoverflow.com/help/how-to-ask</a></span>
<span class="comment-copy">Thanks so much! it works for me. appreciate!</span>
