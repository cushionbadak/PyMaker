<div class="post-text" itemprop="text">
<p>I open my file thus:</p>
<pre><code>with open(sourceFileName, 'r', encoding='ISO-8859-1') as sourceFile:
</code></pre>
<p>but, when I </p>
<pre><code>previousLine = linecache.getline(sourceFileName, i - 1)
</code></pre>
<p>I get an exception</p>
<pre><code>"UnicodeDecodeError: 'utf-8' codec can't decode byte 0xb4 in position 169: 
invalid start byte
</code></pre>
<p>This is because (I think) <code>linecache.getline</code> returns a str() (which does not have a <code>decode()</code> method).</p>
<p>My script must be able to support unicode, so I can't simply convert the input file to UTF-8. </p>
</div>
<div class="post-text" itemprop="text">
<p><code>linecache</code> takes a filename, not a file object, as your usage shows.  It has no provision for an encoding.  Also from the <a href="https://docs.python.org/3.3/library/linecache.html" rel="nofollow">documentation</a>:</p>
<blockquote>
<p>This is used by the traceback module to retrieve source lines for inclusion in the formatted traceback.</p>
</blockquote>
<p>This implies that it is mainly used for Python source code.  As it turns out, if the file has a Python source file encoding comment, it works:</p>
<h3>input.txt</h3>
<pre><code># coding: iso-8859-1
!"#$%&amp;'()*+,-./0123456789:;&lt;=&gt;?@ABCDEFGHIJKLMNOPQRSTUVWXYZ
[\]^_`abcdefghijklmnopqrstuvwxyz{|}~ ¡¢£¤¥¦§¨©ª«¬­®¯°±²³´µ¶·¸¹º»
¼½¾¿ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÚÛÜÝÞßàáâãäåæçèéêëìíîïðñòóôõö÷øùúûüýþÿ
</code></pre>
<h3>test.py</h3>
<pre><code>import linecache
print(linecache.getline('input.txt', 3))
</code></pre>
<h3>Output</h3>
<pre><code>[\]^_`abcdefghijklmnopqrstuvwxyz{|}~ ¡¢£¤¥¦§¨©ª«¬­®¯°±²³´µ¶·¸¹º»
</code></pre>
<p>So <code>linecache</code> probably isn't the solution to your issue.  Instead, open the file as you've shown and perhaps cache the lines yourself:</p>
<pre><code>with open('x.txt',encoding='iso-8859-1') as f:
    lines = f.readlines()
print(lines[2])
</code></pre>
<p>You could also append lines to a list as they are read if you don't want to read the whole file, similar to <code>linecache</code>.</p>
</div>
<span class="comment-copy"><code>linecache</code> uses <a href="https://docs.python.org/3/library/tokenize.html#tokenize.detect_encoding" rel="nofollow noreferrer"><code>tokenize.open()</code> to open a file unless the filename is a module name and the PEP 302 loader has <code>get_source()</code> method. It defaults to utf-8 if  there is no encoding declaration</a>.</span>
