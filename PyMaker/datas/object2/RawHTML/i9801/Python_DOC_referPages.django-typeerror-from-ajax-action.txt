<div class="post-text" itemprop="text">
<p>I'm using DjangoTables to display records. I want to use Ajax on a Delete link to delete the relevant Site record (and the Deal records linked to it) without having to refresh the table page.</p>
<p>Clicking on 'Delete' deletes the relevant records and vanishes that row of the table as I wanted, but then I get this in my console:</p>
<pre><code>TypeError: int() argument must be a string, a bytes-like object or a number, not 'builtin_function_or_method'
[19/Nov/2016 03:51:56] "GET /sites/tested/sites/delete/?recordid=1 HTTP/1.1" 500 18116
</code></pre>
<p>That doesn't look good. Why is it there, and how do I make it go away?</p>
<p><strong>static .js file:</strong></p>
<pre><code>$(document).ready(function() {
    $(".row-delete").click(function(event) {
        event.preventDefault();
        var recordid;
        recordid = $(this).attr("data-recordid");
        $.get('sites/delete/', {recordid: recordid}, function(data){
        });
        $(this).parent().parent().fadeOut("fast");
    });
});
</code></pre>
<p><strong>View:</strong></p>
<pre><code>class SiteDelete(View):
    model=Site
    def get (self, request):
        site_id = None
        if request.method == 'GET':
            site_id = request.GET['recordid']
            DealsToDelete = Deal.objects.filter(Site=id)
            DealsToDelete.delete()      
            DeleteSite = Site.objects.get(id=site_id)
            DeleteSite.delete()
</code></pre>
<p><strong>Table</strong></p>
<pre><code>class TestedTable(tables.Table):
    Approve = tables.TemplateColumn('&lt;a href="{% url \"sites:approve\" id=record.id %}"&lt;/a&gt;Approve')
    Delete = tables.TemplateColumn('&lt;a href="{% url \"sites:delete\" %}\" data-recordid = \"{{ record.id }}\" class=\"row-delete\"&gt;Delete&lt;/a&gt;')
    Name = tables.TemplateColumn('&lt;a href="{% url \"deals:bysite\" record.id %}"&lt;/a&gt;{{ record.Name }}')
</code></pre>
<p><strong>urls.py</strong></p>
<pre><code>from django.conf.urls import url
from sites.views import SiteCreate, SiteUpdate, SiteDelete, IndexView, TestedView, DetailView, ApproveSite
from django.core.urlresolvers import reverse_lazy
app_name = 'sites'
urlpatterns = [
   url(r'^$', IndexView.as_view(), name='site-list'),
   url(r'add/$', SiteCreate.as_view(), name='site-add'),
   url(r'(?P&lt;pk&gt;[0-9]+)/update/$', SiteUpdate.as_view(), name='site-update'),
   url(r'delete/$', SiteDelete.as_view(), name='delete'),    
   url(r'tested/$', TestedView.as_view(), name='site-tested'),
   url(r'(?P&lt;pk&gt;[0-9]+)/$', DetailView.as_view(), name='detail'),
   url(r'(?P&lt;id&gt;[0-9]+)/approve/$', ApproveSite.as_view(), name='approve')
</code></pre>
<p><strong>Detailed console output:</strong></p>
<pre><code>Internal Server Error: /sites/tested/sites/delete/
Traceback (most recent call last):
  File "/home/danny/Documents/virtualenvs/AskArbyEnv/lib/python3.5/site-packages/django/core/handlers/base.py", line 149, in get_response
    response = self.process_exception_by_middleware(e, request)
  File "/home/danny/Documents/virtualenvs/AskArbyEnv/lib/python3.5/site-packages/django/core/handlers/base.py", line 147, in get_response
    response = wrapped_callback(request, *callback_args, **callback_kwargs)
  File "/home/danny/Documents/virtualenvs/AskArbyEnv/lib/python3.5/site-packages/django/views/generic/base.py", line 68, in view
    return self.dispatch(request, *args, **kwargs)
  File "/home/danny/Documents/virtualenvs/AskArbyEnv/lib/python3.5/site-packages/django/views/generic/base.py", line 88, in dispatch
    return handler(request, *args, **kwargs)
  File "/home/danny/Documents/LiClipse Workspace/AskArby/sites/views.py", line 34, in get
    DealsToDelete = Deal.objects.filter(Site=id)
  File "/home/danny/Documents/virtualenvs/AskArbyEnv/lib/python3.5/site-packages/django/db/models/manager.py", line 122, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
  File "/home/danny/Documents/virtualenvs/AskArbyEnv/lib/python3.5/site-packages/django/db/models/query.py", line 790, in filter
    return self._filter_or_exclude(False, *args, **kwargs)
  File "/home/danny/Documents/virtualenvs/AskArbyEnv/lib/python3.5/site-packages/django/db/models/query.py", line 808, in _filter_or_exclude
    clone.query.add_q(Q(*args, **kwargs))
  File "/home/danny/Documents/virtualenvs/AskArbyEnv/lib/python3.5/site-packages/django/db/models/sql/query.py", line 1243, in add_q
    clause, _ = self._add_q(q_object, self.used_aliases)
  File "/home/danny/Documents/virtualenvs/AskArbyEnv/lib/python3.5/site-packages/django/db/models/sql/query.py", line 1269, in _add_q
    allow_joins=allow_joins, split_subq=split_subq,
  File "/home/danny/Documents/virtualenvs/AskArbyEnv/lib/python3.5/site-packages/django/db/models/sql/query.py", line 1199, in build_filter
    condition = lookup_class(lhs, value)
  File "/home/danny/Documents/virtualenvs/AskArbyEnv/lib/python3.5/site-packages/django/db/models/lookups.py", line 19, in __init__
    self.rhs = self.get_prep_lookup()
  File "/home/danny/Documents/virtualenvs/AskArbyEnv/lib/python3.5/site-packages/django/db/models/fields/related_lookups.py", line 100, in get_prep_lookup
    self.lookup_name, self.rhs)
  File "/home/danny/Documents/virtualenvs/AskArbyEnv/lib/python3.5/site-packages/django/db/models/fields/__init__.py", line 744, in get_prep_lookup
    return self.get_prep_value(value)
  File "/home/danny/Documents/virtualenvs/AskArbyEnv/lib/python3.5/site-packages/django/db/models/fields/__init__.py", line 976, in get_prep_value
    return int(value)
TypeError: int() argument must be a string, a bytes-like object or a number, not 'builtin_function_or_method'
[19/Nov/2016 03:51:56] "GET /sites/tested/sites/delete/?recordid=1 HTTP/1.1" 500 18116
</code></pre>
</div>
<div class="post-text" itemprop="text">
<pre><code>DealsToDelete = Deal.objects.filter(Site=id)
</code></pre>
<p>In the above line, the coe is using <code>id</code> which is not defined by your code; so it uses the builtin function <a href="https://docs.python.org/3/library/functions.html#id" rel="nofollow noreferrer"><code>id</code></a>.</p>
<pre><code>&gt;&gt;&gt; id
&lt;built-in function id&gt;
</code></pre>
<p>You should replace the <code>id</code> with <code>site_id</code> you defined.</p>
<pre><code>DealsToDelete = Deal.objects.filter(Site=site_id)
</code></pre>
</div>
<span class="comment-copy">Great! Thank you.</span>
