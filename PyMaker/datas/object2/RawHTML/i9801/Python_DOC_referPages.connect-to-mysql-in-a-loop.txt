<div class="post-text" itemprop="text">
<p>i have to connect to mysql server and grab some data for ever</p>
<p>so i have two way</p>
<p>1)connect to mysql the grab data in a while</p>
<pre><code>conn = mysql.connector.connect(user='root',password='password',host='localhost',database='db',charset='utf8',autocommit=True)
cursor = conn.cursor(buffered=True)
while True:
  cursor.execute("statments")
  sqlData = cursor.fetchone()
  print(sqlData)
  sleep(0.5)
</code></pre>
<p>this working good but if script crashed due to mysql connection problem script goes down</p>
<p>2)connect to mysql in while</p>
<pre><code>while True:
   try:
      conn = mysql.connector.connect(user='root',password='password',host='localhost',database='db',charset='utf8',autocommit=True)
      cursor = conn.cursor(buffered=True)
      cursor.execute("statments")
      sqlData = cursor.fetchone()
      print(sqlData)
      cursor.close()
      conn.close()
      sleep(0.5)
   except:
      print("recoverable error..")
</code></pre>
<p>both code working good but my question is which is better?!</p>
</div>
<div class="post-text" itemprop="text">
<p>Among these two, better way will be to use a single connection but create a new cursor for each statement because creation of new connection takes time but creating a new cursor is fast. You may update the code as:</p>
<pre><code>conn = mysql.connector.connect(user='root',password='password',host='localhost',database='db',charset='utf8',autocommit=True)
while True:
    try:
        cursor = conn.cursor(buffered=True)
        cursor.execute("statments")
        sqlData = cursor.fetchone()
        print(sqlData)
    except Exception: # Catch exception which will be raise in connection loss

        conn = mysql.connector.connect(user='root',password='password',host='localhost',database='db',charset='utf8',autocommit=True)
        cursor = conn.cursor(buffered=True)

    finally:
        cursor.close()

conn.close()    # Close the connection
</code></pre>
<p>Also read <a href="https://docs.python.org/3/tutorial/errors.html#defining-clean-up-actions" rel="nofollow noreferrer"><em>Defining Clean-up Actions</em></a> regarding the usage of <code>try:finally</code> block.</p>
</div>
<span class="comment-copy">good,but what can i do for connection losses?! for example mysql crash on high load ,,your code dont start working after the mysql back normal because the connection left!</span>
<span class="comment-copy">If there will high load, even creating a new connection won't work. Your entire application will go down. Isn't it?</span>
<span class="comment-copy">in second code i can ignore error with try...except and after mysql server back online it will try re connecting easily but in first code or your code cant ignore errors...</span>
<span class="comment-copy">I missed the <i>forever</i> part. Updated the answer</span>
<span class="comment-copy">your except Exception code just run once!?  also what is the job of finally? while true never finish! :)</span>
