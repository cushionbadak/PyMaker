<div class="post-text" itemprop="text">
<p>I'm writing a python script to automate some bash commands and am having trouble with passing a variable inside the curl command. This is what I have:</p>
<p><code>subprocess.call('''curl -H 'Content-Type: application/json' -X PUT -d '{"name": "{}".format(someVariable), "hive_ql": "CREATE VIEW user_balance AS SELECT NAME, LOB,ACCOUNT,BALANCE FROM csvtable"}' localhost:someport/api''', shell=True)</code></p>
<p>I'm trying to pass a variable in for the 'name' parameter, denoted by 'someVariable' in this example. But I get an error stating:</p>
<p><code>"message": "Failed to decode JSON object: Expecting ',' delimiter: line 1 column 14 (char 13):</code></p>
<p>When I replace the format part with an actual string, the script executes just fine so I know I'm doing something wrong with passing the variable between the quotes, just not sure what the correct syntax is.</p>
</div>
<div class="post-text" itemprop="text">
<p>It will be clearer to pass a list to <code>subprocess.call</code>:</p>
<pre><code>import json
import subprocess

someVariable = 'hello'
hive_ql = 'CREATE VIEW user_balance AS SELECT NAME, LOB,ACCOUNT,BALANCE FROM csvtable'  # noqa

subprocess.call([
    'curl',
    '-H',
    'Content-Type: application/json',
    '-X',
    'PUT',
    '-d',
    json.dumps({
      'name': str(someVariable),
      'hive_ql': hive_ql
    }),
    'localhost:someport/api'
])
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>You aren't calling <code>.format</code>, it's inside your string.  Try this:</p>
<pre><code>subprocess.call('''curl -H 'Content-Type: application/json' -X PUT -d '{"name": "{}", "hive_ql": "CREATE VIEW user_balance AS SELECT NAME, LOB,ACCOUNT,BALANCE FROM csvtable"}' localhost:someport/api'''.format(someVariable), shell=True)
</code></pre>
<p>As it stands, the JSON you're trying to decode is:</p>
<pre><code>{
  "name": "{}".format(someVariable),
  "hive_ql": "CREATE VIEW user_balance AS SELECT NAME, LOB,ACCOUNT,BALANCE FROM csvtable"
}
</code></pre>
<p>because python is just treating <code>.format(someVariable)</code> as part of the string and not replacing it with the value of someVariable, and clearly it is not valid JSON to have that hanging onto the end of a string.</p>
<p>Edit: I forgot to escape the brackets; try this instead:</p>
<pre><code>subprocess.call('''curl -H 'Content-Type: application/json' -X PUT -d '{{"name": "{}", "hive_ql": "CREATE VIEW user_balance AS SELECT NAME, LOB,ACCOUNT,BALANCE FROM csvtable"}}' localhost:someport/api'''.format(someVariable), shell=True)
</code></pre>
</div>
<span class="comment-copy"><code>call</code> takes a list of strings.  See the docs: <a href="https://docs.python.org/3/library/subprocess.html#subprocess.run" rel="nofollow noreferrer">docs.python.org/3/library/subprocess.html#subprocess.run</a></span>
<span class="comment-copy">Don't try to generate JSON like this; use <code>json.dumps</code>.</span>
<span class="comment-copy">When I run this, I get 'curl: try 'curl --help' or 'curl --manual' for more information'</span>
<span class="comment-copy">Try removing <code>shell=True</code></span>
<span class="comment-copy">^That worked, thanks! Any idea why that might have been the issue?</span>
<span class="comment-copy">Looks like <code>shell=True</code> is only needed if subprocess is calling a single line (as opposed to an array as in this example)</span>
<span class="comment-copy">When I ran this, I got KeyError: '"name"'</span>
<span class="comment-copy">Fixed my answer in the edit!</span>
