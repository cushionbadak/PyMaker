<div class="post-text" itemprop="text">
<p>I have a view that accepts a file (.doc, docx, or pdf):</p>
<pre><code>from rest_framework.decorators import api_view
from rest_framework.parsers import FileUploadParser

@api_view(['POST'])
@parser_classes((FileUploadParser,) )
def parse_document(request, format=None):
    file_obj = request.data['file']
</code></pre>
<p>I need to parse these documents and return json. I'm using <a href="https://github.com/deanmalmgren/textract" rel="nofollow noreferrer">Textract</a> to convert the documents to text but in order for that to happen I need to pass a filepath to Textract, hence the reason I need to write the file temporarily to the file system.</p>
<p>I've tried reading the contents of the file and writing them to a temp file but I just end up with jumbled text like, \x00\x14.  I've also tried decoding the file with 'utf-8' but I receive an error saying </p>
<pre><code>'utf8' codec can't decode byte 0xe9 in position 10: invalid continuation byte
</code></pre>
<p>I can read a .txt file just fine, this error only happens with file types other than .txt.   I feel like there has to be a way to just copy the file to temp storage without needing to read the contents.</p>
<pre><code>@api_view(['POST'])
@parser_classes((FileUploadParser,) )
def parse_resume(request, format=None):
    file_obj = request.data['file']

    tempf, tempfn = tempfile.mkstemp()
    try:
        for chunk in file_obj.chunks():
            os.write(tempf, chunk)
    except:
        raise Exception("Problem with the input file %s" % file_obj.name)
    finally:
        text = textract.process(tempfn).decode('utf-8') # This is where the error described above is thrown
        os.close(tempf)

    return Response({"text": None})
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>Handling uploads by rest-framework should not be any different than doing it by Django itself (except that you can use request.data instead of request.FILES). 
Try to dissect the problem to smaller pieces, and see where things start to break. Like following:</p>
<ul>
<li>Make plain django view and store file to hardcoded file path. Make sure that things work ok. Here are docs: <a href="https://docs.djangoproject.com/en/2.0/topics/http/file-uploads/" rel="nofollow noreferrer">https://docs.djangoproject.com/en/2.0/topics/http/file-uploads/</a> </li>
<li>Replace django view with rest-framework view</li>
<li>Replace hardcoded file path with temporary file</li>
</ul>
</div>
<span class="comment-copy">here you go... use temp files <a href="https://docs.python.org/3/library/tempfile.html" rel="nofollow noreferrer">docs.python.org/3/library/tempfile.html</a></span>
<span class="comment-copy">it would help to see the code you use to create the temp file and what input creates the error</span>
<span class="comment-copy">@Jason see my updated question</span>
