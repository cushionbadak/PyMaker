<div class="post-text" itemprop="text">
<div class="question-status question-originals-of-duplicate">
<p>This question already has an answer here:</p>
<ul>
<li>
<a dir="ltr" href="/questions/34749943/python-with-as-for-custom-context-manager">Python withâ€¦as for custom context manager</a>
<span class="question-originals-answer-count">
                    3 answers
                </span>
</li>
</ul>
</div>
<p>Is there a class attribute that I can override to make an instance of a class perform something before it exits the scope of a <code>with</code> statement?</p>
<p>For example, we can ensure that we close a file handle when we're done with it:</p>
<pre><code>with open(PATH, 'wb') as f:
    f.write("SOME TEXT")
</code></pre>
<p>If I wrote a class that needs a writer to persist for the lifetime of the class like this:</p>
<pre><code>class MyWriter(object):

   def __init__(self, path):
       self.f = open(path, 'wb')
       self.buffer = ''

   def write(self, text):
       self.buffer += text
       # Just a toy example, naively relying on file system
       # page cache should outperform this 
       if len(self.buffer) &gt;= 4096:
           self.flush()

   def flush(self):
       f.write(self.buffer)
       self.buffer = ''

   def close(self):
       self.flush()
       self.f.close()
</code></pre>
<p>then I would like to force a call of <code>.close()</code> and flush before I exit the scope of <code>with</code>:</p>
<pre><code>with MyWriter(PATH) as mw:
    mw.write("SOME TEXT")
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>The term you're looking for is <strong>context manager</strong>. That's what your object is called when it's used with the <code>with</code> statement.</p>
<p>There is very good <a href="https://docs.python.org/3/reference/datamodel.html#context-managers" rel="nofollow noreferrer">documentation on context managers</a> in the official Python documentation. There is also some great background information and some good examples in <a href="https://www.python.org/dev/peps/pep-0343/" rel="nofollow noreferrer">PEP 343</a>.</p>
</div>
