<div class="post-text" itemprop="text">
<p>My testing script looks as follows:</p>
<pre><code>import os
import sys
from unittest import defaultTestLoader as loader, TextTestRunner

path_to_my_project = os.path.dirname(os.path.abspath(__file__)) + '/../'
sys.path.insert(0, path_to_my_project)

suite = loader.discover('my_project')
runner = TextTestRunner()
runner.run(suite)
</code></pre>
<p>If I run this script, the output is:</p>
<pre><code>$ python3 runtest.py
.....F.....
======================================================================
FAIL: test_insert (fate.test.test_operators.OperatorTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/chiel/Projects/tfate/libs/fate/../fate/test/test_operators.py", line 16, in test_insert
    self.assertEqual(expected, self.session.text[:14])
AssertionError: 'Foo import sys$' != 'Foo import sys'
- Foo import sys$
?               -
+ Foo import sys


----------------------------------------------------------------------
Ran 12 tests in 0.030s

FAILED (failures=1)
</code></pre>
<p>And exit code zero:</p>
<pre><code>$ echo $?
0
</code></pre>
<p>However, the <a href="https://docs.python.org/3.5/library/unittest.html#unittest.main">python docs</a> state that "By default main calls <code>sys.exit()</code> with an exit code indicating success or failure of the tests run."</p>
<p>What is wrong with my script?</p>
</div>
<div class="post-text" itemprop="text">
<p>The code is not using <a href="https://docs.python.org/3/library/unittest.html#unittest.main"><code>unittest.main</code></a>. You need to check the result using <a href="https://docs.python.org/3/library/unittest.html#unittest.TestResult.wasSuccessful"><code>TestResult.wasSuccessful</code></a> and call <a href="https://docs.python.org/3/library/sys.html#sys.exit"><code>sys.exit</code></a> manually.</p>
<pre><code>import sys

....

ret = not runner.run(suite).wasSuccessful()
sys.exit(ret)
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>I had some trouble getting <code>TextTestRunner</code> results. For those like me, here is how it works:</p>
<pre><code>"""Run all tests inside of *_test.py modules located in the same directory."""


import sys
import unittest


if __name__ == '__main__':
    test_suite = unittest.defaultTestLoader.discover('.', '*_test.py')
    test_runner = unittest.TextTestRunner(resultclass=unittest.TextTestResult)
    result = test_runner.run(test_suite)
    sys.exit(not result.wasSuccessful())
</code></pre>
</div>
<span class="comment-copy">+1 for the Python-only implementation, which is clearly missing in python docs on test discovery <a href="https://docs.python.org/2/library/unittest.html#test-discovery" rel="nofollow noreferrer">Unittest Test Discovery</a></span>
