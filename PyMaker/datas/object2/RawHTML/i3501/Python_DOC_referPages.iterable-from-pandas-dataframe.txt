<div class="post-text" itemprop="text">
<p>I need to create an iterable of the form (id, {feature name: features weight})  for using a python package.</p>
<p>my data are store in a pandas dataframe, here an example:</p>
<pre><code>data = pd.DataFrame({"id":[1,2,3],
                    "gender":[1,0,1],
                    "age":[25,23,40]})
</code></pre>
<p>for the  {feature name: features weight}) part, I know I can use this:</p>
<pre><code>fe = data.to_dict(orient='records')
Out[28]: 
[{'age': 25, 'gender': 1, 'id': 1},
 {'age': 23, 'gender': 0, 'id': 2},
 {'age': 40, 'gender': 1, 'id': 3}]
</code></pre>
<p>I know I can also iterate over the datframe for get the id, like this:</p>
<pre><code>(row[1] for row in data.itertuples())
</code></pre>
<p>But I can get this two together to get one iterable (generator object )
I tried : </p>
<pre><code>((row[1] for row in data.itertuples()),fe[i] for i in range(len(data)))
</code></pre>
<p>but the syntax is wrong.
Do you guys know how to do so ?</p>
</div>
<div class="post-text" itemprop="text">
<p><a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.itertuples.html" rel="nofollow noreferrer"><code>pd.DataFrame.itertuples</code></a> returns named tuples. You can iterate and convert each row to a dictionary via the purpose-built method <a href="https://docs.python.org/3/library/collections.html#collections.somenamedtuple._asdict" rel="nofollow noreferrer"><code>_asdict</code></a>. You can wrap this in a generator function to create a lazy reader:</p>
<pre><code>data = pd.DataFrame({"id":[1,2,3],
                    "gender":[1,0,1],
                    "age":[25,23,40]})

def gen_rows(df):
    for row in df.itertuples(index=False):
        yield row._asdict()

G = gen_rows(data)

print(next(G))  # OrderedDict([('age', 25), ('gender', 1), ('id', 1)])
print(next(G))  # OrderedDict([('age', 23), ('gender', 0), ('id', 2)])
print(next(G))  # OrderedDict([('age', 40), ('gender', 1), ('id', 3)])
</code></pre>
<p>Note that the result will be <a href="https://docs.python.org/3/library/collections.html#collections.OrderedDict" rel="nofollow noreferrer"><code>OrderedDict</code></a> objects. As a subclass of <code>dict</code>, for most purposes this should be sufficient.</p>
</div>
<div class="post-text" itemprop="text">
<p>I think need first <a href="http://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.set_index.html" rel="nofollow noreferrer"><code>set_index</code></a> by column <code>id</code> and then <a href="http://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.to_dict.html" rel="nofollow noreferrer"><code>to_dict</code></a> with <code>orient='index'</code>:</p>
<pre><code>fe = data.set_index('id', drop=False).to_dict(orient='index')
print (fe)
{1: {'id': 1, 'gender': 1, 'age': 25}, 
 2: {'id': 2, 'gender': 0, 'age': 23},
 3: {'id': 3, 'gender': 1, 'age': 40}}
</code></pre>
</div>
<span class="comment-copy">clear and clean thanks a lot!</span>
<span class="comment-copy">this work too! thanks ! I just add ((i, v) for i, v in fe.items()) to have an iterable.</span>
<span class="comment-copy">@blabla - Glad can help!</span>
