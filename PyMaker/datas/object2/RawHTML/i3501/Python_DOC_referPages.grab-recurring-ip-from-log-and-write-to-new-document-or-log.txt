<div class="post-text" itemprop="text">
<p>I am trying to find IP addresses in read.log that are listed more than 3 times.
Once found, I want to print the IP address once and write it to writelist.log.</p>
<p>I have been trying this using a set but I am not sure how I can print and write only the IP address.  </p>
<p>For example, if read.log contains...</p>
<pre><code>10.1.89.11
255.255.255.255
255.255.255.255
10.5.5.5
10.5.5.5
10.5.5.5
10.5.5.5
255.255.255.255
255.255.255.255
</code></pre>
<p>I just want to print and save the below to writelist.log</p>
<pre><code>255.255.255.255
10.5.5.5
</code></pre>
<p>With my current code, I am printing and saving this...</p>
<pre><code>set([])
set([])
set([])
set([])
set([])
set([])
set(['10.5.5.5'])
set(['10.5.5.5'])
set(['10.5.5.5', '255.255.255.255'])
</code></pre>
<p>I do not want to print <code>set([])</code> or duplicate IP addresses.</p>
<p>I know I could use the <code>string.replace()</code> method to get rid of some of that but is there a better way to do this? Possibly without a set?</p>
<p>Here is my code...</p>
<pre><code>import re

login_attempts = 3

def run():

    try:
        with open("read.log", "r+") as log:
            ip_list = []
            for line in log:
                address = "^\d{1,3}.\d{1,3}.\d{1,3}.\d{1,3}$"
                match = re.match(address, line)

                if (match):
                    match = match.group()
                    ip_list.append(match.strip())
                    s = set([i for i in ip_list if ip_list.count(i) &gt; login_attempts])

                    strs = repr(s)  # use repr to convert to string
                    with open("writelist.log", "a") as f:
                        f.write(strs)

                else:
                    continue
                log.close
    except OSError as e:
        print (e)

run()
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>Use a <a href="https://docs.python.org/3/library/collections.html#collections.Counter" rel="nofollow noreferrer"><code>Counter</code></a></p>
<pre><code>import collections
with open('read.log', 'r+') as f:
     # Place into a counter and remove trailing newline character
     count = collections.counter(f.read().splitlines())
</code></pre>
<p>Which will give</p>
<pre><code>Counter({'10.1.89.11': 1, '255.255.255.255': 4, '10.5.5.5': 4})
</code></pre>
<p>You can then iterate over the <code>Counter</code></p>
<pre><code>for ip, n in count.items():
    print(ip, n)
    # Process the IP
    ...
</code></pre>
<p>This assumes that you're receiving clean input. You will have to sanitise your data before you process it.</p>
</div>
<span class="comment-copy">This seems like a good use case for <a href="https://docs.python.org/3/library/collections.html#collections.Counter" rel="nofollow noreferrer"><code>collections.Counter</code></a>.</span>
<span class="comment-copy">@JohnB Yes and for some reason I can't find a good answer to link here. If you find one let me know and I'll dupe it.</span>
<span class="comment-copy">I did see an example using that earlier today.  I'll read up on it.</span>
<span class="comment-copy">@KadeWilliams you can read the doc <a href="https://docs.python.org/3/library/collections.html#collections.Counter" rel="nofollow noreferrer">here</a></span>
<span class="comment-copy">And to conditionally output, you could iterate over <code>count.items()</code> and only write if greater than 3.</span>
<span class="comment-copy">You could also avoid that inner loop and do <code>f.read().splitlines()</code>. It should be noted though that by stripping the new line, remember to add it when writing back each line you want to the new file too.</span>
<span class="comment-copy">For completion sake you can show the write part. Per the comment, the trick here is that you still need to call <code>items</code> on <code>count</code> just like @JohnB mentioned.</span>
<span class="comment-copy">Would this still work well if there was other data in the log?  There may be other text other than IP addresses.  I'm running 2.7 and 3.6 but getting errors in <a href="https://stackoverflow.com/questions/13311094/counter-in-collections-module-python" title="counter in collections module python">stackoverflow.com/questions/13311094/â€¦</a></span>
<span class="comment-copy">AFAIK, anything &lt; 2.7 isn't supported. you'd have to show your new code and what errors you're getting</span>
