<div class="post-text" itemprop="text">
<p>I'm trying to call a C++ function from my Python code, if I pass a Boolean or an <code>int</code> it works perfectly, but if I send a string, it only prints the first character.<br/>
I am compiling with:  </p>
<pre><code>g++ -c -fPIC foo.cpp -Wextra -Wall -o foo.o
g++ -shared -Wl,-soname,libfoo.so -o libfoo.so foo.o
python3 fooWrapper.py
</code></pre>
<p>Here is the C++ and Python code:</p>
<p>Python:</p>
<pre><code>from ctypes import cdll
lib = cdll.LoadLibrary("./libfoo.so")
lib.Foo_bar("hello")
</code></pre>
<p>c++:</p>
<pre><code>#include &lt;iostream&gt;
#include &lt;string&gt;
#include &lt;unistd.h&gt;

void bar(char* string){
    printf("%s", string);
}

extern "C" {
    void Foo_bar(char* aString){
        bar(aString);
    }
}
</code></pre>
<p>I'm aware of the <code>Boost</code> Library, but i couldn't manage to download it, and this way works well excepts for strings. 
Thank you for your help</p>
</div>
<div class="post-text" itemprop="text">
<p>The problem is that strings are passed as pointers to <em><a href="https://docs.python.org/3/library/ctypes.html#ctypes.c_wchar_p" rel="nofollow noreferrer"><code>wchar_t</code> wide characters</a></em></p></div>
<div class="post-text" itemprop="text">
<p>You may also process Python3 strings in C++ directly using the <code>wchar_t</code> type. In that case, you need to do any necessary conversions in C++ like this:</p>
<pre class="lang-cpp prettyprint-override"><code>#include &lt;iostream&gt;
#include &lt;locale&gt;
#include &lt;codecvt&gt;

void bar(wchar_t const* aString)
{
    // Kudos: https://stackoverflow.com/a/18374698
    std::wstring_convert&lt;std::codecvt_utf8&lt;wchar_t&gt;, wchar_t&gt; convert;

    std::cout &lt;&lt; convert.to_bytes(aString) &lt;&lt; std::endl;
}

extern "C" {
    void Foo_bar(wchar_t const* aString)
    {
        bar(aString);
    }
}
</code></pre>
<p>You will lose Python2 compatibility, however.</p>
</div>
<span class="comment-copy">Tell me, what does <code>%i</code> do?</span>
<span class="comment-copy">Also, why are you claiming this is C++ when you're essentially writing C?</span>
<span class="comment-copy">Just changed to <code>%s</code> , was an old try with ints.</span>
<span class="comment-copy">Because this is only a small part of the code, it's a test, but i saw I had to declare it as <code>extern "C"</code> to be able to cal it, but I can use any c++ in the <code>bar</code> function</span>
<span class="comment-copy">You should consider filing a documentation bug against Python. <a href="https://docs.python.org/3/extending/extending.html" rel="nofollow noreferrer">[Python 3] Extending Python with C or C++</a> in their manual does not appear treat the subject. <code>wchar_t</code> is shown in one place but not explained. <code>wchar_t</code> and wide chars are not explained.</span>
<span class="comment-copy">Thank you for your answer, that worked really well !</span>
