<div class="post-text" itemprop="text">
<p>I've file that contain MAC among other information, I'm trying to replace the MAC every time it is found.
the file contains something like</p>
<pre><code>Dec  3 06:44:02 2013 192.168.5.21 [245]: &lt;1234&gt; &lt;NOTI&gt; |machine1@192.168.5.21|
request: 55:aa:cc:77:dd:bb: machine 192.168.5.21-00:11:ee:20:66:22-device-name-5
</code></pre>
<p>I have wrote this code, but it's not working</p>
<pre><code>import re

with open("/home/user/infile.txt", "r+") as fin:
        for line in fin:
            mac=re.search(r'([0-9A-F]{2}[:-]){5}([0-9A-F]{2})',line, re.I).group()
            for col in mac:
                mac_h = mac.replace(":",'')
            mac_hex = "0x" + mac_h
            mac_int= int(mac_hex, 16)
            new_mac = mac_int+12345
            new_mac= hex(new_mac)
            line= line.replace(mac, new_mac)
fin.close()
</code></pre>
<p>so I'm searching for mac, here I have two problems, first, it only finds the first occurrence of mac in the line. Second, when I tried the code on the second occurrence only, it got <code>21-00:11:ee:20:66:22</code> instead of just <code>00:11:ee:20:66:22</code></p>
<p>and then I'm doing some arithmetics (this part works), but then when I tried to replace the old value with the new one. it didn't work, I checked the file, and nothing has be replace.
I can't figure out why, so can help me, please?</p>
<p>Update</p>
<p>I've changed the code, and now it write the changes to file</p>
<pre><code>import re

with open("/home/user/infile.txt", "r+") as fin:
    with open("/home/user/infile.txt", "w+") as f_out:
        for line in fin:
            mac=re.search(r'([0-9A-F]{2}[:]){5}([0-9A-F]{2})',line, re.I).group()
            for col in mac:
                mac_h = mac.replace(":",'')
            mac_hex = "0x" + mac_h
            mac_int= int(mac_hex, 16)
            new_mac = mac_int+12345
            new_mac= hex(new_mac)
            line= line.replace(mac, new_mac)
            f_out.write(line)
</code></pre>
<p>now the remaining problem is that it only find the first mac occurrence <code>55:aa:cc:77:dd:bb:</code> and move to the next line without matching the second one <code>00:11:ee:20:66:22</code>, so is there a way to make it continue to search after finding the first match??
Thanks</p>
</div>
<div class="post-text" itemprop="text">
<p>Remove the hyphen from your regex. MAC adress components are usually separated with colons.</p>
<pre><code>/([\dA-F]{2}:){5}([\dA-F]{2})/i
</code></pre>
</div>
<span class="comment-copy">if you're using <code>with</code>, then I don't think there's a reason to explicitly close the file.</span>
<span class="comment-copy">You're not updating the file anywhere, you're just setting the variable <code>line</code>.</span>
<span class="comment-copy">But I'm using <code>replace()</code> ??</span>
<span class="comment-copy">That doesn't write the data back to the file! And if you don't want to match a dash, just use <code>:</code> instead of <code>[:-]</code></span>
<span class="comment-copy">Compile the pattern with <code>re.compile</code>. Use <code>os.rename</code> to rename the file. Open it for reading. Open a new file with the original name for writing. Loop over the lines of the file. Use the <a href="http://docs.python.org/3/library/re#re.regex.sub" rel="nofollow noreferrer"><code>sub</code> method</a> of the pattern with a function that transforms the MAC address for the match object. Use <code>os.remove</code> to delete the original file.</span>
