<div class="post-text" itemprop="text">
<p>When I loop over the lines of a set of gzipped files with the module fileinput like this:</p>
<pre><code>for line in fileinput.FileInput(files=gzipped_files,openhook=fileinput.hook_compressed):
</code></pre>
<p>Then those lines are byte strings and not text strings.</p>
<p>When using the module gzip this can be prevented by opening the files with 'rt' instead of 'rb': <a href="http://bugs.python.org/issue13989" rel="noreferrer">http://bugs.python.org/issue13989</a></p>
<p>Is there a similar fix for the module fileinput, so I can have it return text strings instead of byte strings? I tried adding mode='rt', but then I get this error:</p>
<pre><code>ValueError: FileInput opening mode must be one of 'r', 'rU', 'U' and 'rb'
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>You'd have to implement your own <code>openhook</code> function to open the files with a codec:</p>
<pre><code>import os

def hook_compressed_text(filename, mode, encoding='utf8'):
    ext = os.path.splitext(filename)[1]
    if ext == '.gz':
        import gzip
        return gzip.open(filename, mode + 't', encoding=encoding)
    elif ext == '.bz2':
        import bz2
        return bz2.open(filename, mode + 't', encoding=encoding)
    else:
        return open(filename, mode, encoding=encoding)
</code></pre>
</div>
<span class="comment-copy">Sweet! Thanks! It works.</span>
<span class="comment-copy">Just read <a href="http://docs.python.org/3/library/bz2.html" rel="nofollow noreferrer">docs.python.org/3/library/bz2.html</a> after getting ValueError: Invalid mode: 'rt'. To open bz2 compressed file in text (or binary) mode use bz2.open.</span>
<span class="comment-copy">@tommy.carstensen: ah, indeed, corrected.</span>
