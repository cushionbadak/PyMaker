<div class="post-text" itemprop="text">
<p>I'm creating a xlsx output with <code>xlsxwriter</code> into a temporary file using <code>tempfile</code> module, I store the path to this temporary file inside a variable that I later use in another script to open it.</p>
<p>The problem is that sometimes opening the file fails with the error : </p>
<pre><code>"[Errno 2] No such file or directory: '/tmp/xls5TnVsx'" 
</code></pre>
<p>Sorry I don't have an exact idea about the frequency of this problem occurring but it seems like it happens from time to time, so I don't understand why...</p>
<p>This is how I save into a temporary file : </p>
<pre><code>f = tempfile.NamedTemporaryFile(prefix="xls",delete=False)
xlsfilename = f.name  
</code></pre>
<p>Then to create the xlsx output : </p>
<pre><code>wb = xlsxwriter.Workbook(filename)
ws = wb.add_worksheet(sheetName)
# Write header
....
# Write data
for row, row_data in enumerate(data, start=1):
    for column, key in enumerate(headers):
        ....
wb.close()
f.close()
</code></pre>
<p>Then in a Python CGI script I use the variable xlsxfilename which is the path to the script to open it : </p>
<pre><code>print "Content-type: application/msexcel"
print "Content-Disposition: attachment; filename="+xlsfilename
print
try :
    print open(xlsfilename,"rb").read()
finally:
    try:
        xlsfilename.close()
    except:
        pass

os.unlink(xlsfilename)
</code></pre>
<p>What am I doing wrong here and any ideas on how to solve this by maybe using another method to storing into a temporary file?</p>
</div>
<div class="post-text" itemprop="text">
<p>I believe the issue here is that your program is overwriting the created file with its own output, as the</p>
<pre><code>wb = xlsxwriter.Workbook(filename)
</code></pre>
<p>statement creates a new file. The conditions under which thish might be deleted will depend on when the named temporary file is deleted (technically this happens on <code>close()</code>).</p>
<p>You should think about using <a href="https://docs.python.org/3/library/tempfile.html#tempfile.mkstemp" rel="nofollow"><code>mkstemp</code></a> instead, since you already explicity delete the file you are creating. Overwriting that file, whose name is guaranteed unique and which is not deleted automatically, should be more controllable.</p>
</div>
