<div class="post-text" itemprop="text">
<p>I have a piece of code that takes forever to run. Does anybody know how to optimize it? </p>
<p>The purpose of the formula is to make a column that does the following: when <code>'action' != 0, if 'PX_LAST'&lt;'ma', populate 'buy_sell' with -1, if 'PX_LAST'&gt;'ma', populate 'buy_sell' with 1</code>; in the other cases, do not populate 'buy_sell' with new values.</p>
<p>Fyi - Column 'action' is populated with either 0 or 1</p>
<pre><code>#create column
df_zinc['buy_sell'] = 0
index = 0

while index &lt; df_zinc.shape[0]:
    if df_zinc['action'][index] != 0:
        continue
        if df_zinc['PX_LAST'][index]&lt;df_zinc['ma'][index]:
            df_zinc.loc[index,'buy_sell'] = -1
        elif df_zinc['PX_LAST'][index]&gt;df_zinc['ma'][index]:
            df_zinc.loc[index,'buy_sell'] = 1
    else:
        index = index + 1
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>I think you need:</p>
<pre><code>import numpy as np

mask1 = df_zinc['action'] != 0
mask2 = df_zinc['PX_LAST'] &lt; df_zinc['ma']
mask3 = df_zinc['PX_LAST'] &gt; df_zinc['ma']

df_zinc['buy_sell'] = np.select([mask1 &amp; mask2, mask1 &amp; mask3], [-1,1], 0)
</code></pre>
</div>
<span class="comment-copy">great stuff askshay. Thanks!</span>
<span class="comment-copy">I am new - not sure i know how to do that. Is it accepted now?</span>
