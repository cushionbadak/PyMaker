<div class="post-text" itemprop="text">
<p>I'm working on some machine learning code and today I've lost about 6 hours because simple typo.</p>
<p>It was this:</p>
<pre><code>numpy.empty(100,100)
</code></pre>
<p>instead of</p>
<pre><code>numpy.empty([100,100])
</code></pre>
<p>As I'm not really used to <code>numpy</code>, so I forgot the brackets. The code happily crunched the numbers and at the end, just before saving results to disk, it crashed on that line.</p>
<p>Just to put things in perspective I code on remote machine in shell, so IDE is not really an option. Also I doubt IDE would catch this.</p>
<p>Here's what I already tried:</p>
<ol>
<li>running <code>pylint</code> - well pylint kinda works. After I've disabled everything apart of errors and warnings, it even seem to be usefull. But <code>pylint</code> have serious issue with imported modules. As seen on <a href="https://bitbucket.org/logilab/pylint/issue/58/false-positive-no-member-on-numpy-imports" rel="nofollow">official bug tracker</a> devs know about it, but cannot/won't do anything about it. There is suggested workaround, but ignoring whole module, would not help in my case.</li>
<li>running <code>pychecker</code> - if I create code snippet with the mistake I made, the <code>pychecker</code> reports error - same error as python interpreter. However if I run <code>pychecker</code> on the actual source file (~100 LOC) it reported other errors (unused vars, unused imports, etc.); but the faulty numpy line was skipped.</li>
</ol>
<p>At last I have tried <code>pyflakes</code> but it does even less checking than pychecker/pylint combo.</p>
<p>So is there any reliable method which can check code in advance? Without actually running it.</p>
</div>
<div class="post-text" itemprop="text">
<p>A language with stronger type checking would have been able to save you from <em>this</em> particular error, but not from errors in general. There are plenty of ways to go wrong that pass static type checking. So if you have computations that takes a long time, it makes sense to adopt the following strategies:</p>
<ol>
<li><p>Test the code from end to end on small examples (that run in a few seconds or minutes) before running it on big data that will consume hours.</p></li>
<li><p>Structure long-running computations so that intermediate results are saved to files on disk at appropriate points in the computation. This means that when something breaks, you can fix the problem and restart the computation from the last save point.</p></li>
<li><p>Run the code from the interactive interpreter, so that in the event of an exception you are returned to the interactive session, giving you a chance of being able to recover the data using a post-mortem debugging session. For example, suppose I have some long-running computation:</p>
<pre><code>def work(A, C):
    B = scipy.linalg.inv(A) # takes a long time when A is big
    return B.dot(C)
</code></pre>
<p>I run this from the interactive interpreter and it raises an exception:</p>
<pre><code>&gt;&gt;&gt; D = work(A, C)
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in &lt;module&gt;
  File "q22080243.py", line 6, in work
    return B.dot(C)
ValueError: matrices are not aligned
</code></pre>
<p>Oh no! I forgot to transpose <code>C</code>! Do I have to do the inversion of <code>A</code> again? Not if I call <a href="http://docs.python.org/3/library/pdb.html#pdb.pm" rel="nofollow"><code>pdb.pm</code></a>:</p>
<pre><code>&gt;&gt;&gt; import pdb
&gt;&gt;&gt; pdb.pm()
&gt; q22080243.py(6)work()
-&gt; return B.dot(C)
(Pdb) B
array([[-0.01129249,  0.06886091, ...,  0.08530621, -0.03698717],
       [ 0.02586344, -0.04872148, ..., -0.04853373,  0.01089163],
       ..., 
       [-0.11463087,  0.15048804, ...,  0.0722889 , -0.12388141],
       [-0.00467437, -0.13650975, ..., -0.13894875,  0.02823997]])
</code></pre>
<p>Now, unlike in Lisp, I can't just set things right and continue the execution. But at least I can recover the intermediate results:</p>
<pre><code>(Pdb) D = B.dot(C.T)
(Pdb) numpy.savetxt('result.txt', D)
</code></pre></li>
</ol>
</div>
<div class="post-text" itemprop="text">
<p>Do you use <a href="http://en.wikipedia.org/wiki/Unit_testing" rel="nofollow">unit tests</a>? There is really no better way.</p>
</div>
<span class="comment-copy">switch to a static precompiled language .... ?</span>
<span class="comment-copy">I use pycharm for this type of thing. In this case the IDE would let you click on "empty" and go to the source code and see why it's crashing. It's by far their best feature.</span>
<span class="comment-copy">I don't see a general solution here using Python alone but you can pickle the intermediate results of your computations to avoid losing a lot of time when something like this happens.</span>
<span class="comment-copy">@JoranBeasley I'm doing some research on deep neural networks with Theano and there isn't port to another language.  @ nwk This was part of backup routine. The computed data are on GPU, so I have to download them RAM first, before storing, hence the empty array.</span>
