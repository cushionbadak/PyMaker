<div class="post-text" itemprop="text">
<p>I want something like following structure : <code>y['1'][tuple(list)] = val</code> 
as an nested dict in python but while i am trying i get <code>KeyError</code> :</p>
<p>data in csv file is like : </p>
<pre><code>Rest_id, rates, items
1,4, burger
1,8, tofu_log
2,5, burger
2,8.5, tofu_log
3,4, chef_salad
3,8, steak_salad_sandwich
4,5, steak_salad_sandwich,salad
4,2.5, wine_spritzer
5,4, extreme_fajita3,test2,test4,test
5,8, fancy_european_water
6,5, fancy_european_water
6,6,  extreme_fajita, jalapeno_poppers, extra_salsa
7,1.5, wine_spritzer
7,5, extreme_fajita, jalapeno_poppers
</code></pre>
<p>following is the code : </p>
<pre><code>y = defaultdict(dict)

with open('sample_data_tested_with.csv','r') as f:
            reader = csv.reader(f, delimiter=',', quoting=csv.QUOTE_NONE)
            reader = [[x.strip() for x in row] for row in reader]
            for i in reader:
                #cd[i[0]] = {tuple(i[2:]):i[1]}
                #cd[i[0]][tuple(i[2:])].update(i[1])
                print i[0], i[1], tuple(i[2:])
                y[i[0]][tuple(i[2:])].append(i[1])
</code></pre>
<p>Later I want to search in the dict like <code>y['rest_id']['item']</code> and find rates for that.
Thanks in advance.</p>
<p>full stack from ipython :</p>
<pre><code> In [49]: with open('sample_data_tested_with.csv','r') as f:
            reader = csv.reader(f, delimiter=',', quoting=csv.QUOTE_NONE)
            reader = [[x.strip() for x in row] for row in reader]
            for i in reader:
                #cd[i[0]] = {tuple(i[2:]):i[1]}
                #cd[i[0]][tuple(i[2:])].update(i[1])
                print i[0], i[1], tuple(i[2:])
                #x[tuple(i[2:])]=float(i[1])
                y[i[0]][tuple(i[2:])].append(i[1])
   ....:         
 1 4 ('burger',)
 ---------------------------------------------------------------------------
 KeyError                                  Traceback (most recent call last)
 &lt;ipython-input-49-ab608c2dc33a&gt; in &lt;module&gt;()
       7                     print i[0], i[1], tuple(i[2:])
       8                     #x[tuple(i[2:])]=float(i[1])
 ----&gt; 9                     y[i[0]][tuple(i[2:])].append(i[1])
       10 

  KeyError: ('burger',)
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>Looks like you could use <a href="http://docs.python.org/3/library/itertools.html#itertools.groupby" rel="nofollow">itertools.groupby</a></p>
<pre><code>&gt;&gt;&gt;import itertools
&gt;&gt;&gt;newreader,keys=[],[]
&gt;&gt;&gt;for k,g in itertools.groupby(reader,key=lambda x:x[0]):
      newreader.append(tuple(g[1:]))
      keys.append(k)
</code></pre>
<p>This should group your data into tuples.
Now we iterate through newreader converting each tuple into a dict.</p>
<pre><code>&gt;&gt;&gt;d={}
&gt;&gt;&gt;for *i,j in newreader,keys:
     d[j]=dict(i)
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>Here is the solution i got, please check and let know if anyones find any issues with it, thanks a lot.</p>
<pre><code>def create_NestedDict(filename):
    NestedDict = defaultdict(dict)
    with open(filename,'rb') as f:
        reader = csv.reader(f, delimiter=',')
        for row in reader:
            #print "row :", row
            record = row
            if record[0] not in NestedDict:
                NestedDict[record[0]] = {}
            items = tuple([ i.strip() for i in record[2:]])
            [record[0]][items] = record[1]
    return NestedDict
</code></pre>
</div>
<span class="comment-copy">i could have y = defaultdict(list) and append data but then im not able to search data based on the keys like : y['rest_id']['item']</span>
<span class="comment-copy">I am getting following error now :  ValueError Traceback (most recent call last) &lt;ipython-input-59-145e6ba39c9a&gt; in &lt;module&gt;() ----&gt; 1 for i,j in newreader,keys:       2     d[j] = dict(i)       3   ValueError: too many values to unpack</span>
<span class="comment-copy">@snehalparmar thanks for the feedback, let me check.</span>
<span class="comment-copy">@snehalparmar could you edit in the output your print statement gives into your original question?</span>
<span class="comment-copy">@snehalparmar does the updated code work? I am using Cpython so I don't know if this is implementation specific.</span>
<span class="comment-copy">@snehalparmar check now. if not, then I got nothing.</span>
