<div class="post-text" itemprop="text">
<p>I am new to django and I want to make a simple accounting app, but I am facing the following problem:
I have 3 models; accounts, journal, and journalLine,
I want every journal number can have multiple lines.For example, journal number 1 can have 4 lines and etc..
So before submitting the from i want the new journal number to be created automatically and the value assigned to the foreign key field (jounralNumber) instead of showing a list (the list only shows only the journal numbers created on the database)</p>
<p>models.py</p>
<pre><code>from django.db import models
from django import forms

# Create your models here.
# Model For chart of accounts table
class accounts(models.Model):
accNumber = models.AutoField(primary_key=True,unique=True)
accName  = models.CharField(max_length=200,unique=True)
accNumberMin = models.PositiveIntegerField(default=0,unique=True)
accNumberMax = models.PositiveIntegerField(default=0,unique=True)
#-- to definde values for choices main or sub-account-start
main = 'main'
sub = 'sub'
main_sub_choices = ((main, 'Main account'),(sub, 'Sub account'))
#-- to definde values for choices for main or sub-account-end
main_sub = 
models.CharField(max_length=10,choices=main_sub_choices,default='sub')

def __str__(self): ## to show accounts as names not objects in Admen panel
    return self.accName



class journal(models.Model):
journalNumber = models.PositiveIntegerField(default='',unique=True)
journalDate = models.DateField()
journalDesc = models.CharField(max_length=300)

def __str__(self):
    return str(self.journalNumber)



class journalLine(models.Model):
LineNumber = models.AutoField(primary_key=True)
journalNumber = models.ForeignKey(journal,on_delete=models.CASCADE)
accNumber = 
models.ForeignKey('accounts',on_delete=models.CASCADE,blank=False)
debit = models.PositiveIntegerField(default=0)
credit = models.PositiveIntegerField(default=0)

def __str__(self):
    return str(self.LineNumber)
</code></pre>
<p>views.py</p>
<pre><code>def postpage(request):
initial = {'journalNumber': journal.objects.all().count() + 1,}
lineformset = modelformset_factory(journalLine,exclude=(),extra=1)
if request.method == 'POST':
    form = journalForm(request.POST)
    lineform = lineformset(request.POST)
    if lineform.is_valid():
        lineform.save()
        form.save()
        return HttpResponseRedirect('/myacc/thanks/')
else:
    form = journalForm(initial=initial)
    lineform = lineformset(queryset=journalLine.objects.all().none())

return render(request,'myacc/post.html',{'form':form, 'lineform':lineform})
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>My suggestion is that you save your journal first, then you save the journal lines with journal_number set to that journal. You view will looks something like this,</p>
<pre><code>def postpage(request):
    initial = {'journalNumber': journal.objects.all().count() + 1,}
    lineformset = modelformset_factory(journalLine,exclude=(),extra=1)
    if request.method == 'POST':
        form = journalForm(request.POST)
        if form.is_valid():
            journal = form.save()
            lineform = lineformset(request.POST)
            if lineform.is_valid():
                lineform.save(commit=False)
                lineform.journal_number = journal # or journal.pk
                lineform.save()
                return HttpResponseRedirect('/myacc/thanks/')
    else:
        form = journalForm(initial=initial)
        lineform = lineformset(queryset=journalLine.objects.all().none())

    return render(request,'myacc/post.html',{'form':form, 'lineform':lineform})
</code></pre>
<p>Hope this helps!</p>
<p>Edit: this way you have to keep your journal_number field excluded. If you want to keep your journal number field, then your form need to be split into 2 steps, one to create the journal and the other to create the journal_line.</p>
</div>
<span class="comment-copy">Why not exclude the field and just let your backend handle that for you?</span>
<span class="comment-copy">it will not work cause even if the field is excluded, it suppose to be filled with a value and it all lines should be assigned to at  least one Journal number</span>
<span class="comment-copy">So are not all journal lines assigned to the same journal?</span>
<span class="comment-copy">no, every journal line should have at least 2 lines and can be more, in accounting journal entry is a date, description, the affected account , and debit or credit amount</span>
<span class="comment-copy">Maybe i ddnt phrase my question correctly. When you are entering journal lines, do you enter them for a certain journal number, or could each line be related to a different journal number?</span>
