<div class="post-text" itemprop="text">
<p>I'm trying to monkey patch shutil.copyfileobj() function, in order to change its default length from 16*1024 to a larger value (128*1024). Internally, other shutil methods like move call the copyfileobj() function, and I want those calls to be affected by the monkey patch as well. This doesn't seem to work:</p>
<pre><code>import shutil

shutil.copyfileobjOrig = shutil.copyfileobj

def copyfileobjFast(fsrc, fdst, length=16*1024):
    print('COPYING FILE FAST')
    shutil.copyfileobjOrig(fsrc, fdst, length=128*1024)

shutil.copyfileobj = copyfileobjFast

shutil.move('test.txt', 'testmove.txt')
</code></pre>
<p>I would expect this to print "COPYING FILE FAST" but it doesn't. Is there any way to achieve what I'm trying to do?</p>
</div>
<div class="post-text" itemprop="text">
<p>My test case was broken. shutil.move() only performs a copy if the source and destination files are on different devices. Here's an updated version that shows the monkey patch worked:</p>
<pre><code>import shutil

shutil.copyfileobjOrig = shutil.copyfileobj

def copyfileobjFast(fsrc, fdst, length=16*1024):
    print('COPYING FILE FAST')
    shutil.copyfileobjOrig(fsrc, fdst, length=128*1024)

shutil.copyfileobj = copyfileobjFast

shutil.move('/dev1/test.txt', '/dev2/testmove.txt')
</code></pre>
</div>
<span class="comment-copy"><a href="https://docs.python.org/3/library/shutil.html#shutil.move" rel="nofollow noreferrer"><code>shutil.move</code></a> only performs a copy if the source &amp; destination paths are on different filesystems.  Are they on different filesystems?</span>
<span class="comment-copy">@jwodder, doh! Thanks, that worked.</span>
