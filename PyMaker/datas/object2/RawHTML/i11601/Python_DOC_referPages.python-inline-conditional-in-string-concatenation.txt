<div class="post-text" itemprop="text">
<p>I had this:</p>
<pre><code>msg = time + b' - ' + Logger.LEVELS_WORD[msg_loglevel] + b': ' + msg.encode('utf-8') + b'\n'
</code></pre>
<p>Since sometimes msg was already bytes, I wanted to concat msg.encode('utf-8') if it was string or else just msg, so I did this:</p>
<pre><code>msg = time + b' - ' + Logger.LEVELS_WORD[msg_loglevel] + b': ' + msg if isinstance(msg, bytes) else msg.encode('utf-8') + b'\n'
</code></pre>
<p>But it is not working as I expected, since now <code>msg equals msg</code>. (time + log level isn't getting added).</p>
<p>Should I do if/else instead?</p>
</div>
<div class="post-text" itemprop="text">
<p>A conditional expression has a <a href="https://docs.python.org/3/reference/expressions.html#operator-precedence" rel="nofollow">very low precedence</a>; it is executed last only before a <code>lambda</code>. As such the expression, as written, choses between either <code>time + b' - ' + Logger.LEVELS_WORD[msg_loglevel] + b': ' + msg</code> or <code>msg.encode('utf-8')) + b'\n'</code>.</p>
<p>Put the conditional expression with the <code>if</code> and <code>else</code> branches in parentheses:</p>
<pre><code>msg = time + b' - ' + Logger.LEVELS_WORD[msg_loglevel] + b': ' + (
    msg if isinstance(msg, bytes) else msg.encode('utf-8')) + b'\n'
</code></pre>
<p>Consider using duck-typing (test for <code>hasattr(msg, 'encode')</code>), and breaking up the expression into multiple lines for readability. If you are using Python 3.5 or newer, perhaps you want to use <a href="https://docs.python.org/3/library/stdtypes.html#printf-style-bytes-formatting" rel="nofollow"><code>printf</code>-style formatting</a>:</p>
<pre><code>if hasattr(msg, 'encode'):
    msg = msg.encode('utf-8')
msg = b'%s - %s: %s\n' % (time, Logger.LEVELS_WORD[msg_loglevel], msg)
</code></pre>
</div>
<span class="comment-copy">What did you expect and what did it do?</span>
<span class="comment-copy">@AmitGold concat msg.encode('utf-8') or msg depending on if it was already bytes.</span>
<span class="comment-copy">instead of one of the <code>msg</code>s, change it to something similar like <code>_msg</code> and then do <code>msg = _msg</code></span>
<span class="comment-copy">The problem you have as stated in the answer provided is precedence, the if is taking the whole before expression. So you need to use parentheses in your conditional (msg if isinstance(msg, bytes) else msg.encode('utf-8'))</span>
