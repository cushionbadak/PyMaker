<div class="post-text" itemprop="text">
<p>I'm writting a small code for encode with arithmetic encoding. I need to set a determinate precision but I must be doing something wrong. This is the code : </p>
<pre><code>def encode(string, probabilities):
    getcontext().prec = 28
    start = 0.0
    width = 1.0
    for ch in string:
        d_start, d_width = probabilities[ch]
        start += d_start*width
        width *= d_width  
    return random.uniform(start, start + width)
</code></pre>
<p>As I've read in the python documentation getcontext().prec should set the precision I'm willing to work with. After some iterations, d_start and d_with is very small ( ~ e^-20 ) and the variables start and width stay with the same valor from that moment on. </p>
<p>If further information is needed please don't hesistate asking for it.</p>
<p>Thanks in advance</p>
<p>Edit 1: Proper indentation of the code</p>
<p>Edit 2: I've made a print of d_start after each sum to show what I mean by saying "and the variables start and width stay with the same valor from that moment on. "</p>
<p>Here you have the results:</p>
<pre><code>0.0
0.16
0.224
0.224
0.22784
0.22784
0.2280448
0.22812672
0.22812672
0.2281316352
0.2281316352
0.228131897344
0.228132002202
0.228132002202
0.228132008493
0.228132008493
0.228132008829
0.228132008963
0.228132008963
0.228132008971
0.228132008971
0.228132008971
0.228132008971
0.228132008971
0.228132008971
0.228132008971
0.228132008971
0.228132008971
0.228132008971
0.228132008971
0.228132008971
0.228132008971
0.228132008971
0.228132008971
0.228132008971
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>The problem is that <code>getcontext().prec</code> is only used for <code>decimal.Decimal</code> variables... and you define <code>start</code> and <code>width</code> as float.</p>
<p>You should force usage of Decimal, for example that way (assuming a <code>from decimal import *</code>)</p>
<pre><code>def encode(string, probabilities):
    getcontext().prec = 28
    start = Decimal('0.0')
    width = Decimal('1.0')
    for ch in string:
        d_start, d_width = probabilities[ch]
        start += Decimal(d_start)*width
        width *= Decimal(d_width)
    return random.uniform(float(start), float(start + width))
</code></pre>
</div>
<span class="comment-copy">What is getcontext? Also, indent your code properly please</span>
<span class="comment-copy">Hi there, thanks for the fast reply. Sorry for the stupid question I am about to ask but I've just started coding with python. What do you mean what is getcontext? I thought getcontext was the entire context of the program ( based on this <a href="https://docs.python.org/3/library/decimal.html" rel="nofollow noreferrer">docs.python.org/3/library/decimal.html</a> ). Probably I am wrong so please, make your point. Also, Identation is now correct!</span>
<span class="comment-copy">All of your start and width variables need to be <i>Decimal</i> instances, for the precision to take effect.</span>
<span class="comment-copy">@tknbr What is your input &amp; desired output?</span>
<span class="comment-copy">@guidot I think my variables start and width are, right now, floats, I'll try to convert them to deciaml and post the results.</span>
