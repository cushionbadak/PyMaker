<div class="post-text" itemprop="text">
<p>When I run my below query and there is no data in the values such as <code>["VT","NCR","N","DT","RD"],</code>  the query fails.</p>
<p>With the error message of </p>
<pre><code>ValueError: dict contains fields not in fieldnames: ‘VT’
</code></pre>
<p>Is there a way to say if there is no data in any of the values still carry on running the query to grab data for the values that have data in python?<br/>
For example: the ‘TRY’, ‘CATCH’, or ’PASS’ method?</p>
<p>I have been struggling on this for days, could someone show me how to do this?</p>
<p>My Code:</p>
<pre><code>from datetime import datetime
from elasticsearch import Elasticsearch
import csv

es = Elasticsearch(["9200"])


res = es.search(index="search", body=
                {
                    "_source": ["VT","NCR","N","DT","RD"],
                    "query": {

                        "bool": {
                            "must": [{"range": {"VT": {
                                            "gte": "now/d",
                                            "lte": "now+1d/d"}}},

                                {"wildcard": {"user": "mike*"}}]}}},size=10)


csv_file = 'File_' + str(datetime.now().strftime('%Y_%m_%d - %H.%M.%S')) + '.csv'


header_names = { 'VT': 'Date', 'NCR': 'ExTime', 'N': 'Name', 'DT': 'Party', ' RD ': 'Period'}



with open(csv_file, 'w', newline='') as f:
    header_present  = False
    for doc in res['hits']['hits']:
        my_dict = doc['_source']
        if not header_present:
            w = csv.DictWriter(f, my_dict.keys())
            w.writerow(header_names,) 
            header_present = True
             w.writerow(my_dict)
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>I'd like to point out a flaw in your comment </p>
<pre><code> # will write DATE, TIME, ... in correct place
 w.writerow(header_names,)
</code></pre>
<p>Actually, it writes out the values of the the dictionary under the headers of the keys... Therefore you're writing two headers, basically. </p>
<p>Regarding the error, <a href="https://docs.python.org/3/library/csv.html#csv.DictWriter" rel="nofollow noreferrer">according to the documentation</a> , you can ignore missing fields and set default values when they don't exist</p>
<blockquote>
<p>The optional <code>restval</code> parameter specifies the value to be written if the dictionary is missing a key in <code>fieldnames</code>. If the dictionary passed to the writerow() method contains a key not found in fieldnames, the optional <code>extrasaction</code> parameter indicates what action to take. If it is set to 'raise', the default value, a ValueError is raised. If it is set to 'ignore', extra values in the dictionary are ignored.</p>
</blockquote>
<p>For example </p>
<pre><code>with open(csv_file, 'w', newline='') as f:
    # Open one csv for all the results 
    w = csv.DictWriter(f, fieldnames=header_names.keys(), restval='', extrasaction='ignore') 
    # There's only one header, don't need a boolean flag 
    w.writeheader()  
    # proceed to write results 
    for doc in res['hits']['hits']:
        my_dict = doc['_source']
        # Parse this dictionary however you need to write a valid CSV row 
        w.writerow(my_dict)
</code></pre>
<p>Otherwise, don't use a DictWriter and form the CSV row yourself. You can use <code>dict.get()</code> to extract values, but set default values that don't exist in the data </p>
</div>
<span class="comment-copy">Look up <code>dict.get()</code></span>
<span class="comment-copy">you able to show me how to use this with my code?</span>
<span class="comment-copy">Where's that error? Show the full traceback please</span>
<span class="comment-copy">You never assigned a variable named <code>VT</code> or <code>DT</code> here. Or you're missing some code</span>
<span class="comment-copy">@ cricket - Traceback (most recent call last):   File "C:/Users/Rich/.PyCharmCE2017.2/config/scratches/TRY.py", line 57, in &lt;module&gt;     w.writerow(header_names,)  # will write DATE, TIME, ... in correct place   File "C:\Users\Rich\AppData\Local\Programs\Python\Python36-32\lib\csv.py", line 155, in writerow     return self.writer.writerow(self._dict_to_list(rowdict))   File "C:\Users\Rich\AppData\Local\Programs\Python\Python36-32\lib\csv.py", line 151, in _dict_to_list     + ", ".join([repr(x) for x in wrong_fields])) ValueError: dict contains fields not in fieldnames: 'VT'</span>
<span class="comment-copy">you able to show me how? honestly im struggling on it</span>
<span class="comment-copy">How to do what exactly? I've given two options here... I might suggest stepping back, generating fake data, and learn the ins and outs of DictWriter, and determine if you really need it. I will point out that <code>w.writerow(header_names,)</code> looks unnecessary unless you do want "double" headers</span>
<span class="comment-copy">from your suggestions it sounds like dict.get() will be good to use because you said 'You can use dict.get() to extract values, but set default values that don't exist in the data' but i am not sure how to use dict.get(). unless you are willing to show me how to use it with my above code</span>
<span class="comment-copy">i just tried your code above and i am getting a error on fieldnames=my_dict.keys</span>
<span class="comment-copy">I'm sure you can find plenty of examples elsewhere, but for example <code>vt = my_dict.get('VT', 'default VT')</code></span>
