<div class="post-text" itemprop="text">
<p>When I run my query below, it creates a file called ‘mycsvfile’. However is there a way to add the current date and timestamp when the CSV file is created? For example if I run this query now the file should be named mycsvfile20171012 – 10:00:00 (something like that).</p>
<p>Could someone edit my code and show me how to do this please?</p>
<p>My code:</p>
<pre><code>from elasticsearch import Elasticsearch
import csv

es = Elasticsearch(["9200"])

# Replace the following Query with your own Elastic Search Query
res = es.search(index="search", body=
                {
                    "_source": ["DTDT", "TRDT", "SPLE", "RPLE"],
                    "query": {
                        "bool": {
                            "should": [
                                {"wildcard": {"CN": "TEST1"}}

                            ]
                        }
                    }
}, size=10)



header_names = { 'DTDT': 'DATE', 'TRDT': 'TIME', ...}

with open('mycsvfile.csv', 'w') as f:  # Just use 'w' mode in 3.x
    header_present  = False
    for doc in res['hits']['hits']:
        my_dict = doc['_source'] 
        if not header_present:
            w = csv.DictWriter(f, my_dict.keys())
            w.writerow(header_names)  # will write DATE, TIME, ... in correct place
            header_present = True


        w.writerow(my_dict)
</code></pre>
<p>Thank you in advance!</p>
</div>
<div class="post-text" itemprop="text">
<p>It is better to use underscore in filename than any other special character since it widely accepted
Therefore constructing file name as below :</p>
<pre><code>csv_file = 'myfile_' + str(datetime.now().strftime('%Y_%m_%d_%H_%M_%S')) + '.csv'
</code></pre>
<p>Use datetime as below :</p>
<pre><code>from elasticsearch import Elasticsearch
import csv

es = Elasticsearch(["9200"])

# Replace the following Query with your own Elastic Search Query
res = es.search(index="search", body=
                {
                    "_source": ["DTDT", "TRDT", "SPLE", "RPLE"],
                    "query": {
                        "bool": {
                            "should": [
                                {"wildcard": {"CN": "TEST1"}}

                            ]
                        }
                    }
}, size=10)

from datetime import datetime
import os

file_path = &lt;PASS YOUR FILE HERE&gt;

csv_file = 'myfile_' + str(datetime.now().strftime('%Y_%m_%d_%H_%M_%S')) + '.csv'

csv_file_full = os.path.join(file_path, os.sep, csv_file)

header_names = { 'DTDT': 'DATE', 'TRDT': 'TIME', ...}

with open(csv_file_full, 'w') as f:  # Just use 'w' mode in 3.x
    header_present  = False
    for doc in res['hits']['hits']:
        my_dict = doc['_source']
        if not header_present:
            w = csv.DictWriter(f, my_dict.keys())
            w.writerow(header_names)  # will write DATE, TIME, ... in correct place
            header_present = True


        w.writerow(my_dict)
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>Yes, you can do like this:
However ":" is not supported in filenames so 20171010–10.00.00</p>
<pre><code>&gt;&gt;&gt; import time
&gt;&gt;&gt; fname = lambda : "mycsvfile{}.csv".format(time.strftime("%Y%m%d-%H.%M.%S"))
&gt;&gt;&gt; 
&gt;&gt;&gt; fname()
'mycsvfile20171012-17.24.59.csv'

&gt;&gt;&gt; with open(fname()) as f:
&gt;&gt;&gt;    pass    
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>Have a variable for file name as <code>file_name</code> and use <code>datetime.now()</code></p>
<pre><code>from datetime import datetime
file_name = 'mycsvfile' + str(datetime.now()) + '.csv'
</code></pre>
</div>
<span class="comment-copy">Take a look at the <a href="https://docs.python.org/3/library/datetime.html#module-datetime" rel="nofollow noreferrer"><code>datetime</code></a> module, specifically functions <a href="https://docs.python.org/3/library/datetime.html#datetime.datetime.now" rel="nofollow noreferrer"><code>datetime.now()</code></a> and <a href="https://docs.python.org/3/library/datetime.html#datetime.datetime.strftime" rel="nofollow noreferrer"><code>datetime.strftime()</code></a>.</span>
<span class="comment-copy">Hi Dinesh, i am getting the below error when i use your method - Traceback (most recent call last):   File "C:/Users/.PyCharmCE2017.2/config/scratches/test1.py", line 28, in &lt;module&gt;     with open(csv_file, 'w') as f:  # Just use 'w' mode in 3.x OSError: [Errno 22] Invalid argument: 'myfile_2017-10-12_10:31:12.csv'</span>
<span class="comment-copy">i didn't downvote it,</span>
<span class="comment-copy">thank you dinesh! that worked but im just wondering is there is another way to format the name of the file. for example right now the format is - mycsvfile2017-10-12_10_35_13. Is there a way to  have mycsvfile2017-10-12_10:35:13</span>
<span class="comment-copy">@DineshPundkar: down vote was for the invalid filename and lack of explanation, but you've fixed the former, so down vote removed.</span>
<span class="comment-copy">@mhawke - Oh ok. Thanks anyways !!! Will keep it in mind next time !!!</span>
<span class="comment-copy">where would i put this in my code? code you show me please</span>
<span class="comment-copy">you put it where you open the file</span>
<span class="comment-copy">@Silencer you should add .csv to the format and show him an example.</span>
<span class="comment-copy">Ok, I have modified it.</span>
