<div class="post-text" itemprop="text">
<p>This script was supposed to be a quick Clearcase supporting script, it's my first go at Python as I decided to dump Perl.</p>
<p>subprocess.Popen/communicate is called to run a Clearcase command that returns an empty string, however I am completely unable to accurately test for this returned value:</p>
<pre><code>import subprocess
import sys

# cleartool descr -fmt "%Sn" foo.c
# returns the version number of the file if it's under CC control:
#        b'"\\main\\hb_clearcase\\oint_uas_umac_03\\25"'
# or nothing if it's hijacked.
std_out = subprocess.Popen(['c:/rational/clearcase/bin/cleartool', 'desc',
                 '-fmt', '"%Sn"', 'foo.c'], stdout=subprocess.PIPE).communicate()
std_out = std_out.decode("utf-8")

print(std_out)
# prints:  ""

# Here it goes wrong, I have tried many options in the if...  
# The file IS hijacked, the std_out string IS empty.
if std_out == "":
    print('File is hijacked')
else
    print('File is not hijacked')
</code></pre>
<p>The wonder is the difference in the <code>if std_dev == ""</code> comparison's behaviour between running the script directly in a DOS box or in PyDev in Eclipse.  They seem to always return the opposite result.  As it is above this works as expected (ie. hijacked) on PyDev, fails in the command prompt.  Make the comparison <code>if std_dev == '""'</code> and PyDev delivers the expected result, but not the command prompt.</p>
<p>This is the latest Python 3.3 on Win7 and I expected to have nailed this script hours ago.</p>
<p>What on earth am I doing wrong?</p>
</div>
<div class="post-text" itemprop="text">
<p>First of all, good choice to stick to Python (see <a href="http://xkcd.com/353/" rel="nofollow">this</a>, especially the "Alt" text when you mouse-over the cartoon).</p>
<p>Maybe you could try:</p>
<pre><code>if std_out.strip("\"").strip() == "":
</code></pre>
<p>This will make strings like <code>'""'</code> and <code>'    ""'</code> all be like "".</p>
<p>Anyway, it sounds strange to me that PyDev gives a different result.</p>
</div>
<div class="post-text" itemprop="text">
<p>As ever with these things the answer is usually 'fish'...  Here for the sake of completion is the answer:</p>
<p>Running a command in the Windows command prompt it seems enough to just give the name of the command, however if the the same run is repeated inside Eclipse then the extension must be given.  In my example above I use <code>'c:/rational/clearcase/bin/cleartool'</code> where to be totally correct it is <code>'c:/rational/clearcase/bin/cleartool.exe'</code>, ie. with extension.</p>
<p>Eclipse has a more 'UNIX' like environment that is fussy about these things.  This means that my run was failing in Eclipse as the command was not found, the resulting empty string was similar to what I expected so hard to spot the difference.</p>
</div>
<span class="comment-copy">The full command line is:  std_out = subprocess.Popen(['c:/rational/clearcase/bin/cleartool', 'desc', '-fmt', '"%Sn"', 'foo.c'], stdout=subprocess.PIPE).communicate()  Sorry for the bad formatting there</span>
<span class="comment-copy">I have no idea why you bother with the subprocess internals instead of just calling <a href="http://docs.python.org/3/library/subprocess.html#subprocess.check_output" rel="nofollow noreferrer"><code>subprocess.check_output</code></a>. Apart from that, your problem seems to be that the resulting <code>std_out</code> is an empty string in PyDev, but the string with repr <code>'""'</code> in the DOS console. Is that correct? If that's the case, everything after <code>print(std_out)</code> is irrelevant to the question. Also, <code>'"%Sn"'</code> looks highly suspect. Why do you need to quote a string twice in the first place?</span>
<span class="comment-copy">it may be difference in running strings in DOS and Eclipse. try to compare Eclipse run string and DOS string.</span>
<span class="comment-copy">phihag: subprocess.check_output looks interesting, thanks for that.  The Clearcase command expects a parameter "%Sn", with the quotes, so if there's a better way to do that then do let me know.  I have no explanation for the difference between PyDev and the command prompt...</span>
<span class="comment-copy">Zagorulkin Dmitry: as far as I can see they're identical, however the printed value on the console is <code>""</code> and in PyDev/Eclipse it's an empty line.  This may be a difference in representation, or it may be that they're different.  Hard to tell.</span>
<span class="comment-copy">Many thanks for that, your suggestion now delivers consistent results in PyDev and in the command prompt, but I have absolutely no clue why, ie. what the difference was that your code now resolves.  Coming from Perl I'm used to searching for minor, mind bending, inconsistencies but as far as I can see the returned string from Popen.communicate is identical in both cases.  Utterly bizarre.</span>
<span class="comment-copy">string comparison is always a little tricky. Especially cases like empty strings, only whitespaces, leading/trailing whitespaces and such stuff. In .NET 4, there are nice helper functions, like String.IsNullOrWhitespace(s), which can help here. Please don't forget to mark your problem as solved so it doesn't appear anymore in the "unanswered" section.</span>
