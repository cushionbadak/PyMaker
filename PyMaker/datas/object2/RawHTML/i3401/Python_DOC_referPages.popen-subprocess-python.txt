<div class="post-text" itemprop="text">
<p>I am using Popen to remote call script</p>
<pre><code>s = Popen(['ssh' , ssh_argument0 , ssh_argument1 , '/tmp/remote/dude_rc_admsvr.sh %s %s' %(DomainHome , ACTIVITY)]) 
</code></pre>
<p>stdout = s.communicate()</p>
<p>print stdout</p>
<p>The script is not exiting with the status mentioned under shell script , instead it only prints success or failure status only ..</p>
<p>i want to exit with the status codes as per shell script.
here is shell script</p>
<pre><code>tail -Fn0 ${ADM_DOMAIN_LOG} | \
while read LOG_LINE;
do
 echo ${LOG_LINE} | grep -q "${PASS_MSG}"
 if [ $? = 0 ]
 then
   echo "${STATUS_SUCCESS}"
   exit 0
 elif echo ${LOG_LINE} | grep -q "${FAIL_MSG}"
 then
   echo "${STATUS_FAILURE}"
   exit 1
 elif echo  ${LOG_LINE} | grep -q "${FAIL_MSG2}"
 then
    echo "${STATUS_FAILURE}"
    exit 1
 fi
done
exit 
</code></pre>
<p>How to get the status code returned ?</p>
</div>
<div class="post-text" itemprop="text">
<p>From <a href="https://docs.python.org/2/library/subprocess.html#subprocess.check_call" rel="nofollow noreferrer"><code>subprocess.check_call</code>'s documentation</a>:</p>
<blockquote>
<p>If the return code was zero then return, otherwise raise
  <code>CalledProcessError</code>. The <code>CalledProcessError</code> object will have the return
  code in the <code>returncode</code> attribute.</p>
</blockquote>
<p>Therefore, to get the status code, you need to catch the exception and retrieve the <code>returncode</code> attribute.</p>
<pre><code>try:
    check_call(['ssh' , ssh_argument0 , ssh_argument1 , '/tmp/remote/dude_rc_admsvr.sh %s %s' %(DomainHome , ACTIVITY)]) 
except subprocess.CalledProcessError as e:
    print('status code = %s' % e.returncode)
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>Adding a new answer since you changed your code in question from using <code>check_call</code> to using <code>Popen</code> and <code>communicate</code>.</p>
<p>From <a href="https://docs.python.org/3/library/subprocess.html#subprocess.Popen.communicate" rel="nofollow noreferrer"><code>subprocess.communicate</code>'s documentation</a>:</p>
<blockquote>
<p>Note that if you want to send data to the process’s <code>stdin</code>, you need to
  create the <code>Popen</code> object with <code>stdin=PIPE</code>. Similarly, to get anything
  other than <code>None</code> in the result tuple, you need to give <code>stdout=PIPE</code>
  and/or <code>stderr=PIPE</code> too.</p>
</blockquote>
<p>In other words, you need to add <code>stdout=PIPE</code> to your call to <code>Popen</code>'s constructor in order to use <code>communicate</code>.</p>
<pre><code>s = Popen(['ssh' , ssh_argument0 , ssh_argument1 , '/tmp/remote/dude_rc_admsvr.sh %s %s' %(DomainHome , ACTIVITY)], stdout=PIPE)
stdout = s.communicate()
returncode = s.returncode
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>Found Issue :</p>
<p>The tail statement in shell script was holding the SSH session which is why Popen couldn't able to exit the subshell , Adding kill -9 <code>ps -eaf |grep tail</code> resolved the issue.</p>
</div>
<span class="comment-copy">Have a look at  <a href="https://stackoverflow.com/questions/5631624/how-to-get-exit-code-when-using-python-subprocess-communicate-method" title="how to get exit code when using python subprocess communicate method">stackoverflow.com/questions/5631624/…</a></span>
<span class="comment-copy">but my shell script is exiting with the status code , how come its not working when used in Popen</span>
<span class="comment-copy">And the script is not even exiting atleast it should exit</span>
<span class="comment-copy">In that case I would say write the status to a file and then read it from there , I know this is not the best way but it works</span>
<span class="comment-copy">But the script is not even exiting the Popen command...</span>
<span class="comment-copy">But why its not taking the exit code from shell script , i have already added exit 0 , exit 1 to shell code</span>
<span class="comment-copy">@user2900860 Did you try the code in my answer?</span>
<span class="comment-copy">Yeah , Same issue its not exiting + echo '&lt;Jun' 26, 2018 11:17:05 PM 'PDT&gt;' '&lt;Notice&gt;' '&lt;WebLogicServer&gt;' '&lt;BEA-000365&gt;' '&lt;Server' state changed to 'RUNNING&gt;' + grep -q 'Server state changed to RUNNING' + [ 0 = 0 ] + echo P + exit 0</span>
<span class="comment-copy">@user2900860 In what you just posted, the script appears to exit with 0, meaning success, so naturally <code>check_call</code> returns without raising an exception, and therefore won't go into the except block to print the status code. Did you try a scenario where the script returns 1 instead?</span>
<span class="comment-copy">Its not even exiting with exit 1 grep -q 'Server state changed to RUNNING' + [ 0 = 0 ] + echo P + exit 1</span>
<span class="comment-copy">the shell script is not exiting from popen ssh code , i dont care about the return code i just want to exit from the console/function</span>
<span class="comment-copy">@user2900860 Try adding <code>input=PIPE</code> to the arguments as well. By the way you did stress that you want get the status code in your question (you said "How to get the status code returned ?"). Saying that you don't care about it now just contradicts yourself.</span>
<span class="comment-copy">The script is not exiting with the status mentioned under shell script , instead it "only prints success or failure status only ."  thats what i mentioned above i need shell script exit status instead of popen ..</span>
<span class="comment-copy">@user2900860 Did adding <code>input=PIPE</code> help?</span>
<span class="comment-copy">resolved tail was holding ssh session which was reolved by adding kill -9 |<code>ps -eaf |grep tail</code>..</span>
