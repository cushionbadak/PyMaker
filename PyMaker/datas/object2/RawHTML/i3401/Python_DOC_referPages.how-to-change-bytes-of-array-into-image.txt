<div class="post-text" itemprop="text">
<p>I have a csv file, which was extracted from MS SQL database with image column included. My task is to convert the contents of each row in image column into image and save it as image file. </p>
<p>Here is the content of a row-</p>
<p><a href="https://drive.google.com/open?id=1J_jz5vN8ATxJ5Qw_c8l0qqKFrIee8kHF" rel="nofollow noreferrer">https://drive.google.com/open?id=1J_jz5vN8ATxJ5Qw_c8l0qqKFrIee8kHF</a></p>
<p>As the contents length exceeds the limited word count, I uploaded it to google drive.</p>
<p>I changed it to bytearray and try to write it to new file and read it as an image but I haven't got the image.</p>
<p><a href="https://drive.google.com/open?id=1h-7cRiTWErZzmMJYmc6XmLmeLK982WZR" rel="nofollow noreferrer">https://drive.google.com/open?id=1h-7cRiTWErZzmMJYmc6XmLmeLK982WZR</a></p>
<p>How could I convert that bytearray to the image?? I have tried writing it to new file and reading it with io. I have spent 8+ hours on this and have tried every solutions found on stackoverflow. Please help me find the solution.</p>
<p>Here is my code -</p>
<pre><code>    df = (pd.Series(df['image']))
df = df.dropna()

x = df[3]
print (x)
bytes = base64.b64decode(x)
print (bytes)
image = open("new.jpeg","wb")
image.write(bytearray(bytes))
image.close()
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>The row is in hexadecimal format. You can strip the leading <code>0x</code> and then convert to bytes with</p>
<pre><code>import codecs
data = codecs.decode(x[2:], 'hex')
</code></pre>
<p>Or, equivalently, with</p>
<pre><code>data = bytes.fromhex(x[2:])
</code></pre>
<p>(Hexadecimal is such a common format that <code>bytes</code> has an alternate constructor for it.)</p>
<p>Then <code>imghdr</code> reports it's a jpeg.</p>
<pre><code>import imghdr
print(imghdr.what(None, h=data))
</code></pre>
<p>If you save those bytes in a <code>.jpeg</code> file you should be able to open it.</p>
<pre><code>with open('foo.jpg', 'wb') as foo:
    foo.write(data)
</code></pre>
<p><a href="https://i.stack.imgur.com/Cwkiu.jpg" rel="nofollow noreferrer"><img alt="enter image description here" src="https://i.stack.imgur.com/Cwkiu.jpg"/></a></p>
</div>
<span class="comment-copy">.jpeg is a compressed format. Try .bmp. You'll still need to write the proper headers so your viewer knows its dimensions.</span>
<span class="comment-copy">just tried .bmp. Still haven't got the image. I tried it creating new image with "RGB"(width,height) but didn't work.</span>
<span class="comment-copy">The headers for .bmp <a href="http://www.dragonwins.com/domains/GetTechEd/bmp/bmpfileformat.htm" rel="nofollow noreferrer">are more complex than that</a>. Do you know the binary format used by the database? If it already includes headers the <a href="https://docs.python.org/3/library/imghdr.html" rel="nofollow noreferrer">imghdr</a> module might be able to tell you what it is.</span>
<span class="comment-copy">I am not sure about the binary format but the first file provided in the link is the contents of the first row in image column, which is an image string. After some googling, I assumed that it is encoded with base 64 and decoded it. Then I got the second byte file. I believe the header is included in it but still don't know how to fully convert it to an image.</span>
<span class="comment-copy">Thank you so much sir, you just saved my life.</span>
