<div class="post-text" itemprop="text">
<p>I'm trying to implement a Python script that takes a folder from the user (can be zipped or unzipped), and search through all the files in the folder to output the specific lines that my regular expression matches. My code below works for regular unzipped folders, but I can't figure out how to do the same with zipped folders that are inputted to function. Below are my code, thanks in advance! </p>
<pre><code>def myFunction(folder_name):


path = folder_name


for (path, subdirs, files) in os.walk(path): 
    files = [f for f in os.listdir(path) if f.endswith('.txt') or f.endswith('.log') or f.endswith('-release') or f.endswith('.out') or f.endswith('messages') or f.endswith('.zip')] # Specify here the format of files you hope to search from (ex: ".txt" or ".log")
    files.sort() # file is sorted list

    files = [os.path.join(path, name) for name in files] # Joins the path and the name, so the files can be opened and scanned by the open() function

    # The following for loop searches all files with the selected format
    for filename in files:


            #print('start parsing... ' + str(datetime.datetime.now()))
            matched_line = []
            try:         
                 with open(filename, 'r', encoding = 'utf-8') as f:
                        f = f.readlines()
            except:      
                 with open(filename, 'r') as f:
                        f = f.readlines()                     

            # print('Finished parsing... ' + str(datetime.datetime.now()))

             for line in f:
                #0strip out \x00 from read content, in case it's encoded differently
                line = line.replace('\x00', '')

                RE2 = r'^Version: \d.+\d.+\d.\w\d.+'
                RE3 = r'^.+version.(\d+.\d+.\d+.\d+)' 
                pattern2 = re.compile('('+RE2+'|'+RE3+')', re.IGNORECASE)
                for match2 in pattern2.finditer(line):
                    matched_line.append(line)
                    print(line)


#Calling the function to use it

myFunction(r"SampleZippedFolder.zip")
</code></pre>
<p>The try and except block of my code was my attempt to open the zipped folder and read it. I'm still not very clear with how to open the zipped folder or how it works. Please let me know how I can modify my code to make it work, much appreciated! </p>
</div>
<div class="post-text" itemprop="text">
<p>One possibility is first determine what object type <code>folder_name</code> is using <a href="https://docs.python.org/3/library/zipfile.html" rel="nofollow noreferrer">zipfile</a> and <code>os.isdir()</code> and whichever one succeeds, get the list of files and proceed. Maybe something like this:</p>
<pre><code>import zipfile, os, re

def myFunction(folder_name):

    files = None # nothing yet

    path = folder_name

    if zipfile.is_zipfile(path):
        print('ZipFile: {}'.format(path))
        f = zipfile.ZipFile(path)
        files = f.namelist()
        # for name in f.namelist(): # debugging
            # print('file: {}'.format(name))

    elif os.path.isdir(path):
        print('Folder: {}'.format(path))
        files = os.listdir(path)
        # for name in os.listdir(path): # debugging
        #     print('file: {}'.format(name))

    # should now have a list of files
    # proceed processing the files 
    for filename in files:
        ...
</code></pre>
</div>
<span class="comment-copy">Have you tried using <a href="https://docs.python.org/3/library/zipfile.html" rel="nofollow noreferrer">ZipFile</a>? Something like <code>myzip = zipfile.ZipFile(folder_name)      print myzip.namelist()</code> will get you the filenames in a zip file archive.</span>
<span class="comment-copy">Hi thanks for the response. I've tried your suggestion but ended up getting the error "TypeError: a bytes-like object is required, not 'str'." Do you know why that is? Thanks!</span>
<span class="comment-copy">Sorry, maybe I completely misunderstood. are you using compressed <code>"SampleZippedFolder.zip"</code> file, or <code>"SampleZippedFolder"</code> folder? <code>ZipFile</code> expects the <code>zip</code> file archive, not the folder of files. Maybe you are passing the folder and not the <code>zip</code>? Compare to this demo: <a href="https://repl.it/repls/TidyPointlessGenre" rel="nofollow noreferrer">repl.it/repls/TidyPointlessGenre</a></span>
<span class="comment-copy">Thanks for clarifying, I am indeed passing through a folder.</span>
<span class="comment-copy">Okay, but why are you still passing the folder? I thought you wanted to use the zipped file? "can't figure out how to do the same with zipped folders that are inputted to function."</span>
