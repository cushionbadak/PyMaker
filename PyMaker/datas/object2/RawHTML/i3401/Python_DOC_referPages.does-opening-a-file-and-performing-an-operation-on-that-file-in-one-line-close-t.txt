<div class="post-text" itemprop="text">
<p>Is opening a file and subsequently performing an operation on that file in the same line safe to do without closing the file afterwards?</p>
<p>For example, if I were using the <code>zipfile</code> module and wanted to obtain a list of files inside of a zip called <code>file_list</code>, would it be safe to do the following:</p>
<pre><code>import zipfile
import os
zip_path = os.path(...)

file_list = zipfile.ZipFile(zip_path).namelist()
</code></pre>
<p>Of course, I know this code would accomplish the same thing safely, albeit in 2 lines:</p>
<pre><code>import zipfile
import os
zip_path = os.path(...)

with zipfile.ZipFile(zip_path) as my_zip:
    file_list = my_zip.namelist()
</code></pre>
<p>Which is better?</p>
</div>
<div class="post-text" itemprop="text">
<p><a href="https://github.com/python/cpython/blob/master/Lib/zipfile.py#L1765" rel="nofollow noreferrer">It will close the file when it's garbage collected</a></p>
<pre><code># ZipFile in zipfile.py
def __del__(self):
    """Call the "close()" method in case the user forgot."""
    self.close()
</code></pre>
<p>If you use that one liner it doesn't create a ref so it should get disposed and in turn closed. But you're relying on an implementation detail of when the GC runs which isn't the best idea, you're better off using <code>with</code>.</p>
<p>For instance the <a href="https://pypy.org/compat.html" rel="nofollow noreferrer">one liner wouldn't behave the same way with <code>pypy</code></a></p>
</div>
<div class="post-text" itemprop="text">
<p>From the <a href="https://docs.python.org/3/library/zipfile.html#zipfile.ZipFile.close" rel="nofollow noreferrer">docs</a>:</p>
<blockquote>
<p><strong><code>ZipFile.close()</code></strong></p>
<p>Close the archive file. You must call <code>close()</code> before exiting your program or essential records will not be written.</p>
</blockquote>
<p>Generally speaking, it's almost always better to use a context manager. It is considered neater and safer.</p>
</div>
<span class="comment-copy">using a context manger <i>is always better</i>. But unless you <i>dont'</i> want to guarantee that the resource will be freed. Yes, file-objects will close themselves when the object is reclaimed... but what if there is an error? Do you have a dearth of lines available for some reason?</span>
<span class="comment-copy">@juanpa.arrivillaga I'm just trying to write easier to read code- I have been using a context manager but my code has become very deeply nested because I also have to branch and loop in the same code block.</span>
<span class="comment-copy">Use functions to create easier to read code. Don't cram stuff onto a single line.</span>
