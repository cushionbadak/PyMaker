<div class="post-text" itemprop="text">
<p>I have the follwoing problem. I have a 3D array like 
<code>matrix = np.zeros((30,30,100))</code> where every entry is a coordinate and gets a value. So <code>matrix [0][0][0]</code> is the coordinate x=0,y0,z=0 and has a value of 0. Now i want to store all the values in a csv like this where the first 3 rows are the coordinates and the 4th the corresponding value:</p>
<p><a href="https://i.stack.imgur.com/om8ms.png" rel="nofollow noreferrer"><img alt="enter image description here" src="https://i.stack.imgur.com/om8ms.png"/></a> </p>
<p>Is there a fast way with numpy to do this?</p>
</div>
<div class="post-text" itemprop="text">
<p>You could use pandas, it can both reshape the array and save it as csv.</p>
<pre><code>import numpy as np
import pandas as pd
# create an example array
a = np.arange(24).reshape([2,3,4])
# convert it to stacked format using Pandas
stacked = pd.Panel(a.swapaxes(1,2)).to_frame().stack().reset_index()
stacked.columns = ['x', 'y', 'z', 'value']
# save to disk
stacked.to_csv('stacked.csv', index=False)
</code></pre>
<p>Otherwise, you can apply </p>
<pre><code>np.ravel()
</code></pre>
<p>to your array and then restore indices using one of the recipes <a href="https://stackoverflow.com/questions/46134827/">in this question</a>.</p>
</div>
<div class="post-text" itemprop="text">
<p>I imagine you get the coordinates with the indices:</p>
<pre><code>def iter_3D(matrix):
    for i in range(matrix.shape[0]):
        for j in range(matrix.shape[1]):
            for k in range(matrix.shape[2]):
                yield i, j, k

l = []

for i, j, k in iter_3D(matrix):
    l.append('%d %d %d %d' %(str(indices_x(i, j, k)), str(indices_y(i, j, k)), str(indices_z(i, j, k)), str(matrix[i, j, k]))

with open('file.csv', 'w') as f:
    f.write("\n".join(l))
</code></pre>
<p>More sophisticated solutions are possible, but this should be the core. Have a look at: <a href="https://docs.python.org/3/library/csv.html#module-csv" rel="nofollow noreferrer">csv io</a> in the python docs or <a href="https://docs.scipy.org/doc/numpy-1.13.0/reference/arrays.nditer.html" rel="nofollow noreferrer">nditer</a> if you want a more sophisticated iteration method or use <a href="http://pandas.pydata.org/" rel="nofollow noreferrer">pandas</a> (takes a little time to get the hang out of it).</p>
</div>
<span class="comment-copy">where does your corresponding value come from?</span>
<span class="comment-copy">They are stored in another process, but for this example it's also ok to store only zeros.</span>
<span class="comment-copy">Does it have to be a csv file? I have found that np.save is more useful for saving ND arrays in numpy.</span>
<span class="comment-copy">I think numpy.savetxt do the same. As long it has the structure like above, it's ok</span>
