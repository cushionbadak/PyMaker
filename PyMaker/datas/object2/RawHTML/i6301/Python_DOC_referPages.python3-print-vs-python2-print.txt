<div class="post-text" itemprop="text">
<p>While working on a buffer overflow exploit I found something really strange. I have successfully found that I need to provide 32 characters before the proper address I want to jump to and that the proper address is <code>0x08048a37</code>. When I executed</p>
<pre><code>python -c "print '-'*32+'\x37\x8a\x04\x08'" | ./MyExecutable
</code></pre>
<p>the exploit resulted in a success. But, when I tried:</p>
<pre><code>python3 -c "print('-'*32+'\x37\x8a\x04\x08')" | ./MyExecutable
</code></pre>
<p>it didn't. The executable simply resulted in a Segmentation Fault without jumping to the desired address. In fact, executing</p>
<pre><code>python -c "print '-'*32+'\x37\x8a\x04\x08'"
</code></pre>
<p>and</p>
<pre><code>python3 -c "print('-'*32+'\x37\x8a\x04\x08')" 
</code></pre>
<p>results in two different output on the console. The characters are, of course, not readable but they're visually different.</p>
<p>I wonder why is this happening? </p>
</div>
<div class="post-text" itemprop="text">
<p>The Python 2 code writes <em>bytes</em>, the Python 3 code writes <em>text</em> that is then encoded to bytes. The latter will thus not write the same output; it depends on the codec configured for your pipe.</p>
<p>In Python 3, write bytes to the <code>sys.stdout.buffer</code> object instead:</p>
<pre><code>python3 -c "import sys; sys.stdout.buffer.write(b'-'*32+b'\x37\x8a\x04\x08')"
</code></pre>
<p>You may want to manually add the <code>\n</code> newline that <code>print</code> would add.</p>
<p><code>sys.stdout</code> is a <a href="https://docs.python.org/3/library/io.html#io.TextIOBase" rel="noreferrer"><code>io.TextIOBase</code> object</a>, encoding data written to it to a given codec (usually based on your locale, but when using a pipe, often defaulting to ASCII), before passing it on to the underlying buffer object. The <a href="https://docs.python.org/3/library/io.html#io.TextIOBase.buffer" rel="noreferrer"><code>TextIOBase.buffer</code> attribute</a> gives you direct access to the underlying <a href="https://docs.python.org/3/library/io.html#io.BufferedIOBase" rel="noreferrer"><code>BufferedIOBase</code> object</a>.</p>
</div>
