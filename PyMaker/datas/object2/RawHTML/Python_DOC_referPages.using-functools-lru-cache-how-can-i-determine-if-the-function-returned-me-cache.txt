<div class="post-text" itemprop="text">
<p>I have a simple implementation using the wrapper lru_cache around a function that fetches data from a remote database. I want to be able to tell if the result might be "stale" (i.e., it was fetched from the cache vs from the database). How can I figure that out?</p>
<p>Code is simple, just:</p>
<pre><code>@lru_cache(maxsize=2048)
def fetch_cached_data(query, *args, **kwargs):
    return fetch_data(query, *args, **kwargs)
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>A poor solution, valid only in a <strong>single-threaded</strong> program, could be to monitor the <code>cache_info</code> of the function to see if the statistics are changing:</p>
<pre><code>hits = f.cache_info().hits
result = f(some_arg)
if f.cache_info().hits &gt; hits:
    # this result was retrieved from cache
    ...
</code></pre>
<p>A better solution might be to think more about what you consider <em>stale</em> ... all the values have ultimately come from the database ... what makes one that you queried in a past function call stale ... the time since it was last queried, a version stamp on the rows returned etc</p>
</div>
