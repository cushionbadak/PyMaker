<div class="post-text" itemprop="text">
<p>I have a VERY large CSV file with 250,000+ records that takes a while to do any analyses on in Excel, so I wanted to splice it into multiple worksheets based on a specific calculated column that I created in pandas.</p>
<p>The specific column is called "Period" and is a string variable in my dataframe in the form of MMM_YYYY (e.g., Jan_2016, Feb_2016, etc.)</p>
<p>I am trying to make something that would have a workbook (let's call it data_by_month.xlsx) have a worksheet for every unique period in the dataframe column "Period," with all matching rows written into the respective worksheet.</p>
<p>This is the logic that I tried:</p>
<pre><code>for row in df:
    for period in unique_periods:
        if row[38] == period:
            with pd.ExcelWriter("data_by_month.xslx") as writer:
                df.to_excel(writer, sheet_name = period)
</code></pre>
<p>The idea behind this is for every row in the dataframe, go through every period in a list of unique periods, and if the row[38] -- which is the index of Period -- is equal to a period, write it into the data_by_month.xlsx workbook into a specific worksheet.</p>
<p>I know that my code is completely incorrect right now, but it's the general logic that I've been trying to implement. I'm pretty sure I'm referring to the location of the "Period" column in the dataframe incorrectly, since it keeps saying it's out of range. Any advice would be welcome!</p>
<p>Thank you so much!</p>
</div>
<div class="post-text" itemprop="text">
<p>You should be able to achieve this using a <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.groupby.html" rel="nofollow noreferrer">groupby</a> in pandas. For example ...</p>
<pre><code>with pd.ExcelWriter("data_by_month.xlsx") as writer:
    for period, data in df.groupby('Period'):
        data.to_excel(writer, sheet_name = period)
</code></pre>
</div>
<span class="comment-copy">Could you post few lines of your CSV. No screenshot, plain text copy paste.</span>
<span class="comment-copy">This raised a KeyError: 'period' -- oh wait it's because it's capital, P, trying again!</span>
<span class="comment-copy">Something is happening, but not sure what -- the workbook was created, but I see the file size is fluctuating like mad (goes up and down, up and down--almost like it's overwriting the same spreadsheet over and over). The script is still running; will update as soon as it finishes. It's a big file!</span>
<span class="comment-copy">Okay just as I typed that, it finished. It looks like it really was just overwriting each period. Is there a way to get it to keep each spreadsheet created for each period?</span>
<span class="comment-copy">Yes, the <code>with</code> statement should be outside the loop, I'll update my answer</span>
<span class="comment-copy">Hurray! Happy to help</span>
