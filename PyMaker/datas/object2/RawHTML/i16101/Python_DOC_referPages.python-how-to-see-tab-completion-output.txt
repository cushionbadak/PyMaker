<div class="post-text" itemprop="text">
<p>How can i see what tab completion returns? </p>
<p>Ill clarify :</p>
<p>Lets say im opening a bash shell, typing <code>l</code> and clicking TAB.
Ill get all commands containing the <code>l</code> char.</p>
<p>Now, i know how to programatically enter a full command to the shell and parse the output,</p>
<p>for example:</p>
<pre><code>def shell_output()
    p = subprocess.Popen(command,
                         stdout=subprocess.PIPE,
                         stderr=subprocess.PIPE)
    print iter(p.stdout.readline, '')
</code></pre>
<p>but how can i see what TAB completion shows?</p>
</div>
<div class="post-text" itemprop="text">
<p>Tab completion is part of readline mode. You only get readline mode if you're both in interactive mode, and on a TTY. So, when you <code>Popen</code> it, so its stdin is a pipe, you cannot get tab completion.</p>
<p>You can see this by testing without Python in the way:</p>
<pre><code>$ socat TCP-LISTEN:12345 EXEC:bash &amp;
$ nc localhost 12345
l&lt;TAB&gt;
</code></pre>
<p>Nothing happens. You may see <code>^I</code> after the <code>L</code>, or 7 spaces, or nothing at all, but you're not going to get anything completed.</p>
<p>Of course you can force interactive mode, but then it'll just open <code>/dev/tty</code> and ignore your stdin pipe, which doesn't help.</p>
<p>So, what you need to do is use the <a href="https://docs.python.org/3/library/pty.html" rel="nofollow"><code>pty</code></a> module or the <a href="https://docs.python.org/3/library/os.html#os.openpty" rel="nofollow"><code>openpty</code></a> or <a href="https://docs.python.org/3/library/os.html#os.forkpty" rel="nofollow"><code>forkpty</code></a> function instead of <code>subprocess</code>. It's not nearly as nice and high-level, but it will actually work.</p>
<p>Of course once you start reading bash's TTY output, you're going to start getting terminal beeps and cursor movement characters too; I hope you're prepared to deal with that.</p>
<p>A much better solution is to not try to send tabs at bash, just use <a href="http://www.gnu.org/software/bash/manual/bashref.html#Programmable-Completion-Builtins" rel="nofollow"><code>compgen</code></a> to complete things for you programmatically:</p>
<pre><code>completions = subprocess.check_output('compgen -c l', shell=True).splitlines()
</code></pre>
<p>That <code>-c</code> means you only want command names. You can complete a whole slew of thingsâ€”directories, filenames, env variables, etc., anything that can be completed in any context on the interactive prompt. If you want exactly the same things that are completed at the start of an empty command line, I believe that's <code>-abc -A function</code> (aliases, builtins, commands, and functions), but read the docs for full details.</p>
</div>
<span class="comment-copy">Thank you...... :)</span>
