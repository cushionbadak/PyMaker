<div class="post-text" itemprop="text">
<p>I embed Python into my GUI application, when the script throws syntax errors, I want to redirect the error message into a textbox, so I can know where the error is.</p>
<p>My codes is very simple:</p>
<pre><code>Py_Initialize()
PyRun_SimpleString( "execfile('my.py')" );
Py_Finalize();
</code></pre>
<p>If the file contains syntax error, it may looks like:</p>
<pre><code>Traceback (most recent call last):
  File "&lt;string&gt;", line 1, in &lt;module&gt;
  File "my.py", line 3, in &lt;module&gt;
    app=everedit.Ap
AttributeError: 'module' object has no attribute 'Ap'
</code></pre>
<p>The above messages can be seen in a console window, but now I want to cache these messages in a GUI window.
A GUI window don't have a console. I want to output such messages into a text box.</p>
<p>Please note that I embed Python into C++, I want to cache Python's Syntax Error in C++.</p>
</div>
<div class="post-text" itemprop="text">
<p>As the documentation for <a href="https://docs.python.org/3/c-api/veryhigh.html#c.PyRun_SimpleStringFlags" rel="nofollow"><code>PyRun_SimpleString</code></a> clearly says:</p>
<blockquote>
<p>Returns 0 on success or -1 if an exception was raised. <strong>If there was an error, there is no way to get the exception information.</strong></p>
</blockquote>
<p>So, if you want to get the exception information, you have to use slightly lower-level functions.</p>
<p>Meanwhile, once you're using the right function, and it returns <code>NULL</code> or <code>-1</code> to tell you an exception occurred, how do you get the exception information (and distinguish <code>SyntaxError</code> from other exceptions, for whatever reason you want to do that)?</p>
<p>There's a whole chapter in the C-API docs on <a href="https://docs.python.org/3/c-api/exceptions.html" rel="nofollow">Exception Handling</a>. But briefly: You call <code>PyErr_Occurred</code> to get the type of the exception. Then you call <code>PyErr_ExceptionMatches</code> to check whether it's the type you want. If so, use <code>PyErr_Fetch</code> to get the value and traceback so you can format them yourself, or <code>PyErr_Format</code> to get a simple formatted string, or whatever else you want. Then you just extract the Unicode or ASCII bytes from the string and put them in your GUI window.</p>
</div>
<div class="post-text" itemprop="text">
<p>Use a try/catch block and the <code>traceback</code> module (<a href="https://docs.python.org/2/library/traceback.html" rel="nofollow">docs</a>).</p>
<pre><code>import traceback

try:
    PyParser_SimpleParseString(input())
except SyntaxError as e:
    # There will always be one line, but we're better off still looping over the list
    # To be extra safe!
    for line in traceback.format_exception_only(e.__class__, str(e)):
        print(line) # Replace this with what write to the GUI
</code></pre>
<p>This will only give you the <code>SyntaxError: x</code> part, if you also want the traceback, use <a href="https://docs.python.org/2/library/traceback.html#traceback.format_exception" rel="nofollow"><code>traceback.format_exception</code></a>.</p>
</div>
<span class="comment-copy">Show us what you tried. And explain what you're actually trying to do. <code>PyParse_SimpleParseString</code> is just going to parse the code, without running, or even compiling, anything. Is that really what you want? If so, it will return you a <code>struct _node *</code> for the head of the parse tree on success, or NULL on failure. Did you fail to write a check for NULL?</span>
<span class="comment-copy">Also, you really want only <code>SyntaxError</code>? If the script throws some other unhandled exception, what do you want to do about that?</span>
<span class="comment-copy">My codes is very simple:  Py_Initialize() PyRun_SimpleString( "execfile('my.py')" ); Py_Finalize();  If the file contains syntax error, it may looks like:  Traceback (most recent call last):   File "&lt;string&gt;", line 1, in &lt;module&gt;   File "my.py", line 3, in &lt;module&gt;     app=everedit.Ap AttributeError: 'module' object has no attribute 'Ap'  The above messages can be seen in a console window, but now I want to cache these messages in a GUI window. A GUI window don't have a console. I want to output such messages into a text box.</span>
<span class="comment-copy">Edit the question to include that information; don't leave a vague and unanswerable question that tricks people into wasting their time leaving irrelevant answers, and then try to explain more in comments.</span>
<span class="comment-copy">Thanks, I updated!</span>
<span class="comment-copy">Thanks for you guidance, now I know what should I do.</span>
<span class="comment-copy">Thanks. PyParser_SimpleParseString is a C API of python, can I use the above codes? It throws errors: NameError: name 'PyParser_SimpleParseString' is not defined</span>
