<div class="post-text" itemprop="text">
<p>In my program I use shutil to copy files to several computers in a list.  I am wondering what's the best way to give an error and move onto next computer if one of the computers happens to be turned off.</p>
<p>My original code: </p>
<pre><code>def copyfiles(servername):
    # copy config to remote server
    source = os.listdir("C:/Users/myname/Desktop/PythonUpdate/") # directory where original configs are located
    destination = '//' + servername + '/c$/test/' # destination server directory
    for files in source:
        if files.endswith(".config"):
            shutil.copy(files,destination)

os.system('cls' if os.name == 'nt' else 'clear')
array = []
with open("C:/Users/myname/Desktop/PythonUpdate/serverlist.txt", "r") as f:
    for servername in f:


        copyfiles(servername.strip())
</code></pre>
<p>What I am trying to do:</p>
<pre><code>def copyfiles(servername):
    # copy config to remote server
    source = os.listdir("C:/Users/myname/Desktop/PythonUpdate/") # directory where original configs are located
    destination = '//' + servername + '/c$/test/' # destination server directory
    for files in source:
        if files.endswith(".config"):
            try:
                shutil.copy(files,destination)
            except:
                print (" //////////////////////////////////////////")
                print (" Cannot connect to " + servername + ".")
                print (" //////////////////////////////////////////")

os.system('cls' if os.name == 'nt' else 'clear')
array = []
with open("C:/Users/myname/Desktop/PythonUpdate/serverlist.txt", "r") as f:
    for servername in f:


        copyfiles(servername.strip())
</code></pre>
<p>Does this seem like it is implemented well?</p>
</div>
<div class="post-text" itemprop="text">
<p>While your idea of using a try-catch block is correct, you should definitely be much more precise about which conditions you consider to be forgivable. For example, you would not want to continue if you somehow got a <a href="https://docs.python.org/3/library/exceptions.html#MemoryError" rel="nofollow noreferrer"><code>MemoryError</code></a> or <a href="https://docs.python.org/3/library/exceptions.html#KeyboardInterrupt" rel="nofollow noreferrer"><code>KeyboardInterrupt</code></a>.</p>
<p>As a first step, you should trap only <a href="https://docs.python.org/3/library/exceptions.html#OSError" rel="nofollow noreferrer"><code>OSError</code></a>, as this is what <a href="https://docs.python.org/3/library/shutil.html#shutil.copy" rel="nofollow noreferrer"><code>shutil.copy</code></a> uses to indicate all sorts of read/write errors (at least
that is what the documentation for <a href="https://docs.python.org/3/library/shutil.html#shutil.copyfile" rel="nofollow noreferrer"><code>shutil.copyfile</code></a> says). According to <a href="https://stackoverflow.com/q/22027508/2988730">this post</a>, your error is most likely to be a <a href="https://docs.python.org/3/library/exceptions.html#WindowsError" rel="nofollow noreferrer"><code>WindowsError</code></a> (which is a subclass of <code>OSError</code>):</p>
<pre><code>try:
    shutil.copy(files, destination)
except WindowsError:
    print('...')
</code></pre>
<p>If there are likely to be other causes for the exception, you can further narrow down the exact cause by testing the error object itself using the extended form of the else clause. For example, <code>WindowsError</code>, has an attribute <a href="https://docs.python.org/3/library/exceptions.html#OSError.winerror" rel="nofollow noreferrer"><code>winerror</code></a>, that contains the system-level error code for the exception. Likely candidates that you might want to forgive:</p>
<ul>
<li><a href="https://msdn.microsoft.com/en-us/library/windows/desktop/ms681382(v=vs.85).aspx#ERROR_BAD_NETPATH" rel="nofollow noreferrer"><code>ERROR_BAD_NETPATH</code></a> (53)</li>
<li><a href="https://msdn.microsoft.com/en-us/library/windows/desktop/ms681382(v=vs.85).aspx#ERROR_NETWORK_BUSY" rel="nofollow noreferrer"><code>ERROR_NETWORK_BUSY</code></a> (54)</li>
<li><a href="https://msdn.microsoft.com/en-us/library/windows/desktop/ms681382(v=vs.85).aspx#ERROR_DEV_NOT_EXIST" rel="nofollow noreferrer"><code>ERROR_DEV_NOT_EXIST</code></a> (55)</li>
<li><a href="https://msdn.microsoft.com/en-us/library/windows/desktop/ms681382(v=vs.85).aspx#ERROR_ADAP_HDW_ERR" rel="nofollow noreferrer"><code>ERROR_ADAP_HDW_ERR</code></a> (57)</li>
<li><a href="https://msdn.microsoft.com/en-us/library/windows/desktop/ms681382(v=vs.85).aspx#ERROR_UNEXP_NET_ERR" rel="nofollow noreferrer"><code>ERROR_UNEXP_NET_ERR</code></a> (59)</li>
<li><a href="https://msdn.microsoft.com/en-us/library/windows/desktop/ms681382(v=vs.85).aspx#ERROR_NETNAME_DELETED" rel="nofollow noreferrer"><code>ERROR_NETNAME_DELETED</code></a> (64)</li>
<li><a href="https://msdn.microsoft.com/en-us/library/windows/desktop/ms681382(v=vs.85).aspx#ERROR_SHARING_PAUSED" rel="nofollow noreferrer"><code>ERROR_SHARING_PAUSED</code></a> (70)</li>
<li><a href="https://msdn.microsoft.com/en-us/library/windows/desktop/ms681382(v=vs.85).aspx#ERROR_NET_WRITE_FAULT" rel="nofollow noreferrer"><code>ERROR_NET_WRITE_FAULT</code></a> (88)</li>
</ul>
<p>Your code could then look something like this:</p>
<pre><code>try:
    shutil.copy(files, destination)
except WindowsError as ex:
    if ex.winerror in (53, 54, 55, 57, 59, 64, 70, 88):
        print('...')
    else:
        raise
</code></pre>
<p>You may also want to check the <a href="https://docs.python.org/3/library/exceptions.html#OSError.filename2" rel="nofollow noreferrer"><code>filename2</code></a> attribute of the exception. This will tell you if the file you were expecting caused this exception. This check is not related to the one on <code>winerror</code> and can be done along with or in exclusion to the one shown above:</p>
<pre><code>try:
    shutil.copy(files, destination)
except WindowsError as ex:
    if ex.filename2.startswith('//' + filename2):
        print('...')
    else:
        raise
</code></pre>
</div>
<span class="comment-copy">Your function handles copying only to a single network destination, so there is nothing to move on to if <code>shutil</code> fails.</span>
<span class="comment-copy">sorry, I forgot to post additional code.  I fixed it.</span>
<span class="comment-copy">Using bare <code>except:</code> statements like that is a poor programming practice because it can hide all kinds of unrelated exceptions. Be more specific.</span>
<span class="comment-copy">@martineau. I think that that is exactly what OP is asking about. An answer perhaps?</span>
<span class="comment-copy">Yeah, I'm trying to get ideas on how I can improve.</span>
