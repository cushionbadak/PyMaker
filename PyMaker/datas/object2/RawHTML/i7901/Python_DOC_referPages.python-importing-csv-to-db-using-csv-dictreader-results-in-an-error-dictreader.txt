<div class="post-text" itemprop="text">
<p>I was trying for importing data from the csv file to the sqlite db using python script.</p>
<p>I have a DB table with the name NSETCS:</p>
<pre><code>import sqlite3
import csv

with open (r'F:\mypractise_python\day11\NSE-TCS.csv','r') as infile:
    content = [csv.DictReader(infile, delimiter=',')]  # read the whole file at once

try:
    db = sqlite3.connect('NSETCS')
    cursor = db.cursor()

    for line in content:
        date = line['Date']
        open_stock = float(line['Open'])
        high = float(line['High'])
        low = float(line['Low'])
        last= float(line['Last'])
        close= float(line['Close'])
        tot_trade_qt= float(line['TotTrQt'])
        turnover= float(line['Turnover (Lacs)'])
        cursor.execute('''insert into  NSETCS values (:date, :open_stock, :high, :low, :last, :close, :tot_trade_qt, :turnover)''',\
                       {'date':date, 'open_stock':open_stock, 'high':high, 'low':low, 'last':last, 'close':close,\
                     'tot_trade_qt':tot_trade_qt, 'turnover':turnover})

except Exception as E:
    print "Error:", E
else:
    db.commit()

db.close()
</code></pre>
<p>On running the code, I get an error: 
 Error: DictReader instance has no attribute <code>__getitem__</code></p>
</div>
<div class="post-text" itemprop="text">
<p>You are not reading the contents into a list here:</p>
<pre><code>content = [csv.DictReader(infile, delimiter=',')]  # read the whole file at once
</code></pre>
<p>That only puts the reader into a list. Use <code>list()</code> instead:</p>
<pre><code>content = list(csv.DictReader(infile, delimiter=','))
</code></pre>
<p>Not that you need to do this; you could just loop over the object directly:</p>
<pre><code>reader = csv.DictReader(infile, delimiter=',')
</code></pre>
<p>then</p>
<pre><code>for line in reader:
</code></pre>
<p>Do indent the code that loops to be part of the <code>with</code> statement, because you need to keep the file open to read until the loop is done:</p>
<pre><code>with open (r'F:\mypractise_python\day11\NSE-TCS.csv','r') as infile:
    reader = csv.DictReader(infile, delimiter=',')

    try:
        db = sqlite3.connect('NSETCS')
        cursor = db.cursor()

        for line in reader:
            # ...
</code></pre>
<p>I'd not catch exceptions; just <a href="https://docs.python.org/3/library/sqlite3.html#using-the-connection-as-a-context-manager" rel="nofollow noreferrer">use the connection as a <em>context manager</em></a> (just like you do for the file) so that your inserts are committed only if no exceptions took place:</p>
<pre><code>import sqlite3
import csv

db = sqlite3.connect('NSETCS')
# use both file and database connection as context managers
with open (r'F:\mypractise_python\day11\NSE-TCS.csv','r') as infile, db:
    reader = csv.DictReader(infile, delimiter=',')
    cursor = db.cursor()
    for line in reader:
        line['turnover'] = line['Turnover (Lacs)']
        cursor.execute('''
            insert into  NSETCS values (
                :Date, :Open, :High, :Low, :Last, :Close, 
                :TotTrQt, :turnover)
            ''', line)
</code></pre>
<p><code>sqlite</code> doesn't really care if you pass in <code>float()</code> objects, or <code>str()</code>; the database is happy to accept either for numeric columns. You can use your <code>line</code> dictionaries directly if you don't convert to <code>float()</code>, except for the <code>Turnover (Lacs)</code> column (I used an alias in the dictionary for that one). This simplifies your loop somewhat.</p>
</div>
<span class="comment-copy">martijn, it's working good when i converted to content = list(csv.DictReader(infile, delimiter=','))......I didn't understood the next part where you said I could just loop over the object.....wts that?</span>
<span class="comment-copy">isn't the same i am doing in the 'for line in content' ?</span>
<span class="comment-copy">@FarhanPatel: My apologies; I wrote this in a bit of a rush and forgot to remove the <code>list()</code> call. Looping can be done over the <code>csv.DictReader()</code> object without reading all contents into a list first.</span>
<span class="comment-copy">removing the list() is not working in my case.....it's giving me I/O error</span>
<span class="comment-copy">@FarhanPatel: ah, yes, because you need to indent the rest of your code to be part of the <code>while</code> statement. If you don't the file is already closed by the time you loop.</span>
