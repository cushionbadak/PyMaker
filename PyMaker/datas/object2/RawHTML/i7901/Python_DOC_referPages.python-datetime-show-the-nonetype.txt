<div class="post-text" itemprop="text">
<p>I use pymysql to connect mysql</p>
<pre><code>from datetime import datetime
from datetime import timedelta
import pymysql
conn = pymysql.connect()#I simplified the connecting details

print("date:  {}".format(db.fetchone()[0]))
print("the type of the date: {}".format(type(db.fetchone()[0])))
print("one row : {}".format(db.fetchone()))
print("one row of the type: {}".format(type(db.fetchone())))
print("the recent time:　{}".format(datetime.now()))
print("the recent time of the type:　{}".format(type(datetime.now())))
</code></pre>
<blockquote>
<p>date:  2017-06-01 10:00:00</p>
<p>the type of the date:  one row :</p>
<p>(datetime.datetime(2017, 5, 31, 17, 0), None, 31.5, 88.7, None) </p>
<p>one row of the type:  </p>
<p>the recent time:　2017-06-01 18:31:04.097299</p>
<p>the recent time of the type:　</p>
</blockquote>
<p>But </p>
<pre><code>while ((time - conn.cursor().fetchone()[0] != timedelta(minutes=15))):
    pass
while ((time - datetime.now() != timedelta(minutes=15))):
    pass
</code></pre>
<p>The former showed up:</p>
<blockquote>
<p>TypeError: 'NoneType' object is not subscriptable</p>
</blockquote>
<p>Why are't they the same type???</p>
<p><em>Update</em></p>
<p>MY table:</p>
<pre><code>create table weather ( 
                time timestamp default current_timestamp on update current_timestamp,
                id smallint,
                tpr float(3,1),
                wet float(3,1),
                uv tinyint(2),
                foreign key (id) references chatbot.station(pk));
</code></pre>
</div>
<div class="post-text" itemprop="text">
<h1>Problem</h1>
<p>When we use <a href="https://dev.mysql.com/doc/connector-python/en/connector-python-api-mysqlcursor-fetchone.html" rel="nofollow noreferrer"><code>fetchone</code></a> method and no records left to read it returns <a href="https://docs.python.org/3/library/constants.html#None" rel="nofollow noreferrer"><code>None</code></a> which is not <a href="https://stackoverflow.com/a/216980/5997596">subscriptable</a>.</p>
<h1>Example</h1>
<p>Assuming that we want to process <a href="https://dev.mysql.com/doc/refman/5.7/en/comparison-operators.html#operator_is-not-null" rel="nofollow noreferrer">non-null</a> <code>time</code> values for all records using query</p>
<pre><code>SELECT time FROM weather WHERE time IS NOT NULL
</code></pre>
<p>and <code>time</code> object is <a href="https://docs.python.org/3/library/datetime.html#datetime.datetime.now" rel="nofollow noreferrer">current datetime</a></p>
<pre><code>time = datetime.now()
</code></pre>
<p>then we can write it using <a href="https://docs.python.org/3/glossary.html#term-eafp" rel="nofollow noreferrer">EAFP</a> coding style like</p>
<pre><code># or any other `datetime` object
time = datetime.now()
with conn.cursor() as cursor:
    query = "SELECT time FROM weather WHERE time IS NOT NULL"
    cursor.execute(query)
    record = cursor.fetchone()
    try:
        recorded_time = record[0]
    except TypeError:
        # no records found in table for given query,
        # reporting
        print('No records found for query: "{query}"'
              .format(query=query))
    else:
        while time - recorded_time != timedelta(minutes=15):
            record = cursor.fetchone()
            try:
                recorded_time = record[0]
            except TypeError:
                # no more records found, leaving loop
                break
</code></pre>
<p>or with checking records for <code>None</code>'ness</p>
<pre><code># or any other `datetime` object
time = datetime.now()
with conn.cursor() as cursor:
    query = "SELECT time FROM weather WHERE time IS NOT NULL"
    cursor.execute(query)
    record = cursor.fetchone()
    if record is not None:
        recorded_time = record[0]
        while time - recorded_time != timedelta(minutes=15):
            record = cursor.fetchone()
            if record is None:
                # no record found, leaving loop
                break
            recorded_time = record[0]
    else:
        # no records found in table for given query,
        # reporting
        print('No records found for query: "{query}"'
              .format(query=query))
</code></pre>
<h1>WARNING</h1>
<p>Without adding <code>time IS NOT NULL</code> filtration we theoretically can get record with <code>recorded_time</code> equal to <code>None</code>, then difference</p>
<pre><code>time - recorded_time
</code></pre>
<p>will raise <code>TypeError</code> since we cannot subtract <code>None</code> from <code>datetime</code> object.</p>
</div>
<div class="post-text" itemprop="text">
<p>It seems like <code>db.fetchone()</code> returned <code>None</code> instead of a datetime object.<br/>
Is it possible your loop reached the end of your table?</p>
</div>
<div class="post-text" itemprop="text">
<p>Check your returned value for <code>db.fetchone()</code>, it seems that is returning a None, you can print it above for example</p>
<pre><code>print(db.fetchone()[0])
</code></pre>
<p>make a print inside the while loop (is just a quick way, not always the best way is doing this), some of your values must be None, if only one is, the code breaks.</p>
<blockquote>
<p>Solution</p>
</blockquote>
<p>You can ask before do the minus math operation if your value is none or not, If it's not, do the maths, if it is do nothing</p>
</div>
<span class="comment-copy">can you give us more info about where <code>db</code> object comes from?</span>
<span class="comment-copy">thank you if fixed.</span>
<span class="comment-copy">@JonathanCheng: completed answer accordingly to your table definition, tell me if it can be improved</span>
<span class="comment-copy">How can I identify the empty table and the none row?thx.Because I want to insert the value if the table is empty and stop insert the value if the time of the row  is None.</span>
<span class="comment-copy">hahaha shai you are faaaaast as the wind! plus one for quick answer</span>
<span class="comment-copy">instead of a tuple, i guess</span>
<span class="comment-copy"><code>db.fetchone()</code> return <code>tuple</code>and <code>db.fetchone()[0]</code> return <code>datetim.datetime</code></span>
<span class="comment-copy">@JonathanCheng you call it in a loop. does all iterations of the loop behave the same?</span>
<span class="comment-copy">sometimes,so i add the <code>if db.fetchone() is not None</code> to fix the exceptioin</span>
<span class="comment-copy">it returned <code>datetime.datetime</code></span>
<span class="comment-copy">than you,it fixed</span>
<span class="comment-copy">@JonathanCheng Don't forget to accept the answer if was useful :) with the ✓</span>
<span class="comment-copy">@JonathanCheng remember you can only mark one answer</span>
<span class="comment-copy">@JonathanCheng you accepted mine and then another, that's because you can't accept  two :/</span>
