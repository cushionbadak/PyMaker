<div class="post-text" itemprop="text">
<p>I’m struggling with urllib.request and unicode. I have a script that gets a list of city names, builds geonames.org API-request URLs from them and parses the output XML Data to display geonames information exactly in the way I need it. The script works fine as long as the cities names don’t contain any non-ASCII character like ö in Köln (I have to use german city names).</p>
<pre><code># -*- coding: utf-8 -*-
import urllib.request
from xml.etree import ElementTree as ET

urllist = []
citylist = ['Hamburg', 'Bremen']

for city in citylist:
    requestURL = 'http://api.geonames.org/search?name=' + city + '&amp;maxRows=1&amp;lang=de&amp;username=demo'
    urllist.append(requestURL)

for url in urllist:
    root = ET.parse(urllib.request.urlopen(url)).getroot()
    items = root.findall('geoname')
    for item in items:
        print(item.find('name').text + ', ' + item.find('countryName').text + ' [' + item.find('lat').text + ',' + item.find('lng').text + '] [id:' + item.find('geonameId').text + ']')
</code></pre>
<p>When I switch <code>Hamburg</code> with <code>Köln</code> the Script exits with the error message <code>UnicodeEncodeError: 'ascii' codec can't encode character '\xf6' in position 18: ordinal not in range(128)</code>. </p>
<p>One other thing that does not work is city names with blanks in it like <code>Bad Godesberg</code>. Am I using the wrong method to request the XML or is it that I have to decode my city names before building the URL (which is nearly definitely the case for two-word cities as when I use <code>Bad%20Godesberg</code> it works)?</p>
<p>Thanks for your help! </p>
</div>
<div class="post-text" itemprop="text">
<p>You have to use <code>urlencode</code>, for instance</p>
<blockquote>
<p>Python » Documentation <a href="https://docs.python.org/3/library/urllib.parse.html#url-quoting" rel="nofollow noreferrer">21.8.4. URL Quoting</a> </p>
<p>Here is an example session that uses the GET method to retrieve a URL containing parameters:<br/>
<a href="https://docs.python.org/3/library/urllib.request.html#urllib-examples" rel="nofollow noreferrer">urllib-examples</a></p>
<pre><code>   &gt;&gt;&gt; import urllib.request
   &gt;&gt;&gt; import urllib.parse
   &gt;&gt;&gt; params = urllib.parse.urlencode({'spam': 1, 'eggs': 2, 'bacon': 0})
   &gt;&gt;&gt; url = "http://www.musi-cal.com/cgi-bin/query?%s" % params
   &gt;&gt;&gt; with urllib.request.urlopen(url) as f:
           print(f.read().decode('utf-8'))
</code></pre>
</blockquote>
</div>
<span class="comment-copy">Thanks for this, I’m going to look into urlencode! In the meantime I tried to run my code in Juypter Notebooks and it magically works without any changes which I can’t explain but which is perfect for now.</span>
