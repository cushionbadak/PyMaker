<div class="post-text" itemprop="text">
<p>I'm trying to retrieve and print a list of secrets from an azure keyvault use the python sdk.</p>
<p>The following returns an paged.SecretItemPaged object:</p>
<pre><code>from azure.keyvault import KeyVaultClient, KeyVaultAuthentication
from azure.common.credentials import ServicePrincipalCredentials


az_client_id = '*****'
az_secret = '*****'
az_tenant = '*****'
credentials = None


def auth_callback(server, resource, scope):
    credentials = ServicePrincipalCredentials(
        client_id=az_client_id,
        secret=az_secret,
        tenant=az_tenant,
        resource="https://vault.azure.net"
    )
    token = credentials.token
    return token['token_type'], token['access_token']


client = KeyVaultClient(KeyVaultAuthentication(auth_callback))

secrets = client.get_secrets('https://thevault.vault.azure.net/')

print('vault secrets:\n{}'.format(secrets))
</code></pre>
<p>e.g:</p>
<pre><code>vault secrets:
&lt;azure.keyvault.models.secret_item_paged.SecretItemPaged object at 0x7fc494c78b38&gt;
</code></pre>
<p>I'm not sure how to handle this object. The documentation isn't giving me any hints, unless I've just missed something. </p>
</div>
<div class="post-text" itemprop="text">
<p>SecretItemPaged page is an <a href="https://docs.python.org/3/glossary.html#term-iterator" rel="nofollow noreferrer">iterator</a> object, meaning you can use it inside a for loop directly if you want:</p>
<pre><code>for item in secrets:
    print_my_secret(item)
</code></pre>
<p>or change it to a list</p>
<pre><code>secrets_as_list = list(secrets)
</code></pre>
<p>No magic here, it's just the iterator protocol of Python. You can also use <code>next</code>, and catch the <code>StopIteration</code> exception, etc.</p>
<p>Looking at the <code>get_secrets</code> method, the doc tells you what kind if object it conveys:
<a href="https://docs.microsoft.com/en-us/python/api/azure-keyvault/azure.keyvault.key_vault_client.keyvaultclient?view=azure-python#get-secrets" rel="nofollow noreferrer">https://docs.microsoft.com/en-us/python/api/azure-keyvault/azure.keyvault.key_vault_client.keyvaultclient?view=azure-python#get-secrets</a></p>
<p><a href="https://i.stack.imgur.com/jWDbz.png" rel="nofollow noreferrer"><img alt="enter image description here" src="https://i.stack.imgur.com/jWDbz.png"/></a></p>
<p>And <code>SecretItem</code> is documented here:
<a href="https://docs.microsoft.com/en-us/python/api/azure-keyvault/azure.keyvault.models.secret_item_py3.secretitem?view=azure-python" rel="nofollow noreferrer">https://docs.microsoft.com/en-us/python/api/azure-keyvault/azure.keyvault.models.secret_item_py3.secretitem?view=azure-python</a></p>
<p>Note that all SDK object have a <code>as_dict</code> method if you prefer to work on it as a dict, and not an object with attributes.</p>
<p>Do NOT use the <code>current_page</code> attribute. The iterator protocol implementation hides for you fetching multiple pages from Azure if you have more secrets than the default JSON can handle it. When doing <code>list(secrets)</code>, you might fetch 10 pages and do 10 calls to Azure, you don't know, you don't care :). <code>current_page</code> is the state of the last page. It is NOT the entire list of elements.</p>
<p>(I work at MS in this SDK team)</p>
</div>
<span class="comment-copy">Ok, i have it working. Thanks for the detailed response, I understand what's going on now.</span>
<span class="comment-copy">FYI, the documentation for the <code>SecretItem</code> class has apparently moved, the current version is here: <a href="https://docs.microsoft.com/en-us/python/api/azure-keyvault/azure.keyvault.v7_0.models.secret_item_py3.secretitem?view=azure-python" rel="nofollow noreferrer">https://docs.microsoft.com/en-us/python/api/azure-keyvault/azure.keyvault.v7_0.models.secret_item_py3.secretitem?view=azure-python</a></span>
