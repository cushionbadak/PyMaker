<div class="post-text" itemprop="text">
<p>I am trying to harden a Ubuntu system and doing the 2 steps:</p>
<ol>
<li>Running the following command and verifying no output is returned </li>
</ol>
<blockquote>
<p>grep '^+:' /etc/passwd</p>
</blockquote>
<ol start="2">
<li>If there is a output being returned then 
Remove any legacy '+' entries from /etc/passwd if they exist.</li>
</ol>
<p>I have written the following python function :</p>
<pre><code>def passwd_safe():
    file = "/etc/passwd"
    for line in fileinput.input(file,inplace=1):
        if '+' in line:
            line = line.replace('+','')
        else:
            pass
</code></pre>
<p>But it seems like this doesn't work as expected , infact it overwrites the whole /etc/passwd file and leaves the system broken. </p>
</div>
<div class="post-text" itemprop="text">
<p>You should print the line to standard output:</p>
<pre><code>def passwd_safe():
    file = "/etc/passwd"
    for line in fileinput.input(file,inplace=1):
        if not line.startswith('+'):
            print(line, end='')
</code></pre>
<p>Excerpt from <a href="https://docs.python.org/3/library/fileinput.html" rel="nofollow noreferrer"><code>fileinput</code>'s documentation</a>:</p>
<blockquote>
<p>Optional in-place filtering: if the keyword argument <code>inplace=True</code> is
  passed to <code>fileinput.input()</code> or to the <code>FileInput</code> constructor, the file
  is moved to a backup file and standard output is directed to the input
  file (if a file of the same name as the backup file already exists, it
  will be replaced silently).</p>
</blockquote>
</div>
<span class="comment-copy">Are you adding sudo before running the file/function?</span>
<span class="comment-copy">You should use <code>setpwent</code> instead. Check the <a href="https://docs.python.org/2/library/pwd.html" rel="nofollow noreferrer">pwd module</a></span>
<span class="comment-copy">File "script.py", line 24     print(line, end='')                    ^ SyntaxError: invalid syntax</span>
<span class="comment-copy">If you're using Python 2.7, add <code>from __future__ import print_function</code> on top of your script.</span>
<span class="comment-copy"><code>if not line.startswith('+'):</code> , but  i am confused about this , if i replace '+' with 'x' , it should replace it with '' right ? , but it doesn't</span>
<span class="comment-copy">I wrote <code>if not line.startswith('+'):</code> because you said you want to "remove any legacy <code>'+'</code> entries from <code>/etc/passwd</code>", so in my code I print the line only if the line does not start with <code>'+'</code>. If you are only looking to remove <code>'+'</code> characters from those lines, you can use your original code but simply add <code>print(line, end='')</code> after your <code>if</code> block.</span>
