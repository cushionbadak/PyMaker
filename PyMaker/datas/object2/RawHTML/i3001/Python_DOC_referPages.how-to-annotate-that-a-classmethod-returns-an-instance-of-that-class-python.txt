<div class="post-text" itemprop="text">
<p>Using <a href="https://www.python.org/dev/peps/pep-0484/" rel="nofollow noreferrer">PEP 484</a>, is there a way to annotate that a classmethod returns an instance of that class?</p>
<p>e.g.</p>
<pre><code>@dataclass
class Bar:

    foo: str

    @classmethod
    def new_from_foo(cls, foo) -&gt; Bar
        ...
</code></pre>
<p>or </p>
<pre><code>    @classmethod
    def new_from_foo(cls, foo) -&gt; cls
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>The trick is to use a <a href="https://docs.python.org/3/library/typing.html#typing.TypeVar" rel="nofollow noreferrer"><code>TypeVar</code></a> to connect the <code>cls</code> parameter to the return annotation:</p>
<pre><code>from typing import TypeVar, Type

T = TypeVar('T')

class Bar:
    @classmethod
    def new_from_foo(cls: Type[T], foo) -&gt; T:
        ...
</code></pre>
</div>
<span class="comment-copy">Doesn't it work? It should work in Python3.7: <a href="https://docs.python.org/3/whatsnew/3.7.html#pep-563-postponed-evaluation-of-annotations" rel="nofollow noreferrer">docs.python.org/3/whatsnew/â€¦</a></span>
<span class="comment-copy">@Sraw  I was trying with 3.6. Thanks for pointing that out.</span>
<span class="comment-copy">But there isn't <code>dataclass</code> in Python3.6...</span>
<span class="comment-copy">I'm using the backport. <a href="https://pypi.org/project/dataclasses/" rel="nofollow noreferrer">pypi.org/project/dataclasses</a></span>
<span class="comment-copy">Don't use <code>Bar</code> as the return annotation. A proper classmethod should also support subclassing. You don't want <code>BarSubclass.new_from_foo()</code> to return a <code>Bar</code> instance, do you?</span>
<span class="comment-copy">This works, but somehow dose not work with dataclasses. I will investigate to try understand why.</span>
<span class="comment-copy">@GaryvanderMerwe Huh, you're right. I didn't realize. I'll investigate that.</span>
<span class="comment-copy">Looks like a bug in mypy to me, honestly. As far as I can tell, it only happens in classmethods - and only in dataclasses. Edit: Found the relevant <a href="https://github.com/python/mypy/issues/5263" rel="nofollow noreferrer">github issue</a>.</span>
<span class="comment-copy">Thanks. I'm using the work arround from that issue.</span>
