<div class="post-text" itemprop="text">
<p>I found the following example in the <a href="https://docs.python.org/3/library/urllib.request.html#examples" rel="nofollow">Python <code>urllib.request</code> documentation</a>:</p>
<pre><code>from urllib.request import urlopen
with urlopen('http://tycho.usno.navy.mil/cgi-bin/timer.pl') as response:
    for line in response:
        line = line.decode('utf-8')
        if 'EST' in line or 'EDT' in line:
             print(line)
</code></pre>
<p>This outputs</p>
<pre><code>Nov. 25, 09:43:32 PM EST
</code></pre>
<p>I tried to copy that code for use with a Chinese site:</p>
<pre><code>import urllib.request

url = 'http://www.zhihu.com'
response = urllib.request.urlopen(url).read().decode("utf-8")
print(response) 
</code></pre>
<p>but I get an error:</p>
<pre><code>UnicodeDecodeError: 'utf-8' codec can't decode byte 0x8b in position 1: invalid start byte. 
</code></pre>
<p>How can I solve this?</p>
</div>
<div class="post-text" itemprop="text">
<p>The site returns a gzipped response, even though you did not request one:</p>
<pre><code>&gt;&gt;&gt; from urllib.request import urlopen
&gt;&gt;&gt; url = 'http://www.zhihu.com'
&gt;&gt;&gt; response = urlopen(url)
&gt;&gt;&gt; response.info().get('Content-Encoding')
'gzip'
</code></pre>
<p>This is a violation of the HTTP RFCs, the site does this even when you specifically disallow it:</p>
<pre><code>&gt;&gt;&gt; from urllib.request import Request
&gt;&gt;&gt; response = urlopen(Request(url, headers={'Accept-Encoding': 'identity,gzip;q=0'}))
&gt;&gt;&gt; response.info().get('Content-Encoding')
'gzip'
</code></pre>
<p>You'll have to decompress the response data first, only then can you decode the resulting bytes as UTF-8:</p>
<pre><code>&gt;&gt;&gt; import zlib
&gt;&gt;&gt; decompressed_data = zlib.decompress(response.read(), 16+zlib.MAX_WBITS)
&gt;&gt;&gt; print(*decompressed_data.decode('utf8').splitlines(True)[:10])
&lt;!DOCTYPE html&gt;
 &lt;html lang="zh-CN"&gt;
 &lt;head&gt;
 &lt;meta charset="utf-8"&gt;
 &lt;meta name="apple-itunes-app" content="app-id=432274380"&gt;
 &lt;meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /&gt;
 &lt;meta name="renderer" content="webkit" /&gt;
 &lt;meta name="description" content="一个真实的网络问答社区，帮助你寻找答案，分享知识。"/&gt;
 &lt;meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1.0, maximum-scale=1.0"/&gt;
 &lt;title&gt;知乎 - 与世界分享你的知识、经验和见解&lt;/title&gt;
</code></pre>
</div>
