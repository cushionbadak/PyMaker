<div class="post-text" itemprop="text">
<p>I have the following function written to find the most recent date in my dataset prior to the year I am calculating for. I am having trouble understanding why it will not work in a for loop, but it will outside of one. If I write it with a hardcoded value as the year, it will run just fine. However, when I try to put it in a loop, it will give the following error:</p>
<blockquote>
<p>'ValueError: max() arg is an empty sequence'</p>
</blockquote>
<p>Thank you for any insight on why this is error is thrown, and what I can do to fix it.</p>
<pre><code>def max_date_prior_to_year(dates, yr):
     return max(dates[dates&lt;pd.to_datetime(str(yr)+'-01-01')])

print(max_date_prior_to_year(df['Date'], 2014))
2013-10-15 00:00:00

for yr in [2011,2012,2013,2014]:
    print(max_date_prior_to_year(df['Date'], yr))
ValueError: max() arg is an empty sequence
</code></pre>
</div>
<div class="post-text" itemprop="text">
<h3>You are comparing apples and oranges</h3>
<p><code>max_date_prior_to_year(df['Date'], 2014)</code> feeds <code>2014</code> as the <code>yr</code> argument. But your <code>for</code> loop starts with <code>2011</code>. If <code>df['Date']</code> has no dates  before 1st January 2011, <code>dates[dates&lt;pd.to_datetime(str(yr)+'-01-01')]</code> will return an empty series, so you are effectively calculating:</p>
<pre><code>max(pd.Series())  # ValueError: max() arg is an empty sequence
</code></pre>
<p>As per the <a href="https://docs.python.org/3/library/functions.html#max" rel="nofollow noreferrer">docs</a>:</p>
<blockquote>
<p>If the iterable is empty and default is not provided, a <code>ValueError</code>
  is raised.</p>
</blockquote>
<h3>Use <code>pd.Series.max</code> instead of built-in <code>max</code></h3>
<p>One way you can avoid <code>ValueError</code> and increase efficiency is to use <a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.Series.max.html" rel="nofollow noreferrer"><code>pd.Series.max</code></a> instead of Python's built-in <a href="https://docs.python.org/3/library/functions.html#max" rel="nofollow noreferrer"><code>max</code></a>.<sup>1</sup> This is will return <code>NaN</code> if the series is empty after Boolean indexing. So change your function to:</p>
<pre><code>def max_date_prior_to_year(dates, yr):
     return dates[dates&lt;pd.to_datetime(str(yr)+'-01-01')].max()
</code></pre>
<hr/>
<p><sup>1</sup> In fact, as a rule you should prefer Pandas numeric methods to applying built-in functions on pandas series.</p>
</div>
<span class="comment-copy">Welcome to StackOverflow.  Please read and follow the posting guidelines in the help documentation, as suggested when you created this account.  <a href="http://stackoverflow.com/help/mcve">Minimal, complete, verifiable example</a> applies here.  We cannot effectively help you until you post your MCVE code and accurately describe the problem. We should be able to paste your posted code into a text file and reproduce the problem you described. Your code fails where <code>df</code> is undefined.</span>
<span class="comment-copy">Thank you for your help. I will use this in the future.</span>
<span class="comment-copy">Sorry. I just signed up as a user on here, and this was my first question. I clocked the green check mark, and will remember this for the future. Thanks again for your help!</span>
