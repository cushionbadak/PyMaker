<div class="post-text" itemprop="text">
<p>I´m using scrapy to crawl some information, but im stunned with the handle of the data. At <code>for</code> loop, first step is locate a "root" xpath called <code>selectors</code>, then is looped. My mind says, if is the first selector, is the first selector of <code>ul</code>, then I can crawl all the data of the first selector! Instead, scrapy returns an array of all elements. I´m using selector varible as 'THIS' </p>
<pre><code>import Scrapy

class SecccionAmarillaSpider( scrapy.spider ):
 name="seccion_amarilla"
 start_urls = ['https://www.seccionamarilla.com.mx/resultados/hospitales/1']
 data = {}

  def parse( self, result ):
    selectors = result.xpath('//ul[@class="list"]/li')
    for selector in selectors:
     name = selector.xpath('//span[itemprop="name"]/text()').extract()
     phone = selector.xpath('//span[itemprop="telephone"]/text()').extract()
     #These data is stored in MySQL
</code></pre>
<p><a href="https://i.stack.imgur.com/5qKaW.png" rel="nofollow noreferrer"><img alt="Example" src="https://i.stack.imgur.com/5qKaW.png"/></a>
For example, on the first loop I expect</p>
<pre><code>name = 'Z'
phone = '( 81)8333 4662'
sql = "INSERT INTO TABLE VALUES('"+name+"','"+phone+"')"
</code></pre>
<p>Instead, I recived in the first loop</p>
<pre><code>name = ['Z','Z-GAS']
phone = ['( 81)8333 4662', '(33)3668 3800']
</code></pre>
<p>All the loops the same data, is not respecting current selector?</p>
<p><strong>WHY?</strong></p>
<p>I can´t make a relation between arrays because sometimes the selector has not name and/or phone and Scrapy doesnt return None or null or empty.</p>
<p>How can I solve it?</p>
</div>
<div class="post-text" itemprop="text">
<p>There are some issues in your code:</p>
<ol>
<li>In XPath, you should refer to attributes with the <code>@</code> prefix: <code>//span[@itemprop="name"]/text()</code></li>
<li>You should use relative XPath in your for loop: <code>.//span[@itemprop="name"]/text()</code></li>
<li>You should use the <code>.extract_first()</code> method instead of <code>.extract()</code> (which returns a list)</li>
</ol>
<p>So, your code should be something along these lines:</p>
<pre><code>for selector in selectors:
    name = selector.xpath('.//span[@itemprop="name"]/text()').extract_first()
    phone = selector.xpath('.//span[@itemprop="telephone"]/text()').extract_first()
    ...
</code></pre>
</div>
<span class="comment-copy">Read about <a href="https://docs.python.org/3/library/xml.etree.elementtree.html#supported-xpath-syntax" rel="nofollow noreferrer">supported-xpath-syntax</a> the meaning of <code>//</code>.</span>
