<div class="post-text" itemprop="text">
<p>I am implementing SHA1-HMAC generation for python (v 3.7) to be able to create HMAC code.</p>
<p>I have used an <a href="https://www.freeformatter.com/hmac-generator.html" rel="nofollow noreferrer">online generator to create SHA1-HMAC</a> with the following data:</p>
<ul>
<li>string: <code>'123'</code> </li>
<li>Secret Key: <code>'secret'</code></li>
<li>Digest algorithm: <code>SHA1</code></li>
</ul>
<p>I am getting this result:</p>
<pre><code>b14e92eb17f6b78ec5a205ee0e1ab220fb7f86d7
</code></pre>
<p>However when I try to do this same with Python I am getting different results which are wrong.</p>
<pre><code>import hashlib
import hmac
import base64

def make_digest(message, key):
    key = bytes(key, 'UTF-8')
    message = bytes(message, 'UTF-8')

    digester = hmac.new(key, message, hashlib.sha1)
    signature1 = digester.digest()

    signature2 = base64.urlsafe_b64encode(signature1)    
    return str(signature2, 'UTF-8')


result = make_digest('123', 'secret')
print(result)
</code></pre>
<p>This code gives result:</p>
<pre><code>sU6S6xf2t47FogXuDhqyIPt_htc=
</code></pre>
<p>What could be wrong with this code?</p>
</div>
<div class="post-text" itemprop="text">
<p>You should not use Base64 here. The site you link to gives you the <em>hex values</em> of the digest bytes. Use the <a href="https://docs.python.org/3/library/hmac.html#hmac.HMAC.hexdigest" rel="nofollow noreferrer"><code>HMAC.hexdigest()</code> method</a> to get the same value in hex in Python:</p>
<pre><code>&gt;&gt;&gt; key = b'secret'
&gt;&gt;&gt; message = b'123'
&gt;&gt;&gt; digester = hmac.new(key, message, hashlib.sha1)
&gt;&gt;&gt; digester.hexdigest()
'b14e92eb17f6b78ec5a205ee0e1ab220fb7f86d7'
</code></pre>
<p>put differently, your code outputs the correct value, but as Base64-encoded data:</p>
<pre><code>&gt;&gt;&gt; digester.digest()
b'\xb1N\x92\xeb\x17\xf6\xb7\x8e\xc5\xa2\x05\xee\x0e\x1a\xb2 \xfb\x7f\x86\xd7'
&gt;&gt;&gt; base64.urlsafe_b64encode(digester.digest())
b'sU6S6xf2t47FogXuDhqyIPt_htc='
</code></pre>
<p>and the value you generated online contains the exact same bytes as the hex digest, so we can generate the same base64 output for that:</p>
<pre><code>&gt;&gt;&gt; bytes.fromhex('b14e92eb17f6b78ec5a205ee0e1ab220fb7f86d7')
b'\xb1N\x92\xeb\x17\xf6\xb7\x8e\xc5\xa2\x05\xee\x0e\x1a\xb2 \xfb\x7f\x86\xd7'
&gt;&gt;&gt; base64.urlsafe_b64encode(bytes.fromhex('b14e92eb17f6b78ec5a205ee0e1ab220fb7f86d7'))
b'sU6S6xf2t47FogXuDhqyIPt_htc='
</code></pre>
</div>
<span class="comment-copy">Thank you for explanation. It was really helpful.</span>
