<div class="post-text" itemprop="text">
<p>I am trying to check if I have an entry in my database using this code:</p>
<pre><code>def device_update(request):
    json_data = json.loads(request.body)
    email = json_data['email']
    imei = json_data['imei']
    sdk_version = json_data['sdk_version']
    date = json_data['updateDate']
    rule = json_data['ruleName']
    group_name = json_data['group']
    if Group.objects.filter(group=group_name).exists():
        print("group does exists")
    else:
        print("group doesn't exists")
    return HttpResponse("Successful")
</code></pre>
<p>However, when the code reaches the if statement to check if the group exists, it returns error 500.</p>
<p>I tried to check with two groups one that exists and another one that doesn't, in both cases I got error 500.</p>
<p>How can I fix this and why is this happening?</p>
</div>
<div class="post-text" itemprop="text">
<p>The logic for checking if a <code>Group</code> exists, i.e. the line:</p>
<pre><code>if Group.objects.filter(group=group_name).exists()
</code></pre>
<p>is not throwing the error here. It is likely that <code>json_data</code> is missing one of the keys you expect it to have, for example, <code>'group'</code>. </p>
<p>I'd recommend using the <a href="https://docs.python.org/3/library/stdtypes.html#dict.get" rel="nofollow noreferrer"><code>get</code> method that dictionaries</a> have. This provides default values when the specified key is not present in the dictionary. You should also have error handling for when the request body is not in valid JSON format.</p>
<p>Here's an example:</p>
<pre><code>def device_update(request):
    try:
        json_data = json.loads(request.body)
    except json.JSONDecodeError:
        return HttpResponse('Request body must be in valid JSON format')
    email = json_data.get('email', '')
    imei = json_data.get('imei', '')
    sdk_version = json_data.get('sdk_version', '')
    date = json_data.get('updateDate', '')
    rule = json_data.get('ruleName', '')
    group_name = json_data.get('group', '')
    if Group.objects.filter(group=group_name).exists():
        print("group does exists")
    else:
        print("group doesn't exists")
    return HttpResponse("Successful")
</code></pre>
<p>I set the defaults to the empty string <code>''</code>, but you may want to change that.</p>
</div>
<div class="post-text" itemprop="text">
<p>Your view doesn't have any error handling. Looking at it quickly, at least two things could go wrong. The request body might not be valid json, and if it is valid json, it might not contain the required keys.</p>
<pre><code>def device_update(request):
    try:
        json_data = json.loads(request.body)
    except ValueError:
        return HttpResponse("Invalid json")
    try:
        email = json_data['email']
        imei = json_data['imei']
        sdk_version = json_data['sdk_version']
        date = json_data['updateDate']
        rule = json_data['ruleName']
        group_name = json_data['group']
    except KeyError as e:
        return HttpResponse("Missing Key %s" % e[0])
    ...
</code></pre>
<p>Writing your own validation for a single view like this is ok. As it gets more complicated, you might want to look at django rest framework. It has serializers which will help you manage validation.</p>
</div>
<div class="post-text" itemprop="text">
<p>Alasdair/Keselme, looks that your view is correct.
Try to put the ipdb into your code in order to debug your code, and than you can print the request.data and see what is comming in the request.</p>
</div>
<span class="comment-copy">Step 1: Go into your <code>settings.py</code> and change <code>DEBUG=False</code> to <code>DEBUG=True</code>. Step 2: Get your error message by trying to go to that page again, and post it here.</span>
<span class="comment-copy">try running <code>Group.objects.filter(group=group_name).exists()</code> in <code>python manage.py shell</code> and look at that error message</span>
<span class="comment-copy">Why do you think the error occurs when it reaches the if statement and not before? If you have the traceback, please include it in the question.</span>
