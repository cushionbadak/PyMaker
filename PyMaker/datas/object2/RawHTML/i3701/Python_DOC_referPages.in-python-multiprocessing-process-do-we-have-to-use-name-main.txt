<div class="post-text" itemprop="text">
<p>I am writing a class that supports easy-to-use API to add different settings to run a given program (<code>class.add(args)</code>) and to benchmark all settings with multiprocessing (<code>class.benchmark(num_processes=5)</code>). </p>
<p>From the documentation of multiprocessing.Process, it seems all cases using <code>if __name__ == '__main__'</code>.  Is it safe to skip using it ?</p>
<p>For example, the class method <code>benchmark(num_processes=5)</code> starts and joins processes, and another python file <code>file.py</code> creates a class and simply call <code>class.benchmark(num_processes=5)</code>. Will it work as usual ?</p>
</div>
<div class="post-text" itemprop="text">
<p>As described in the <a href="https://docs.python.org/3.7/library/multiprocessing.html#the-spawn-and-forkserver-start-methods" rel="nofollow noreferrer">multiprocessing guidelines</a> under the heading "Safe importing of main module", some forms of multiprocessing need to import your main module and thus your program may run amok in a <a href="https://en.wikipedia.org/wiki/Fork_bomb" rel="nofollow noreferrer">fork bomb</a> if the <code>__name__ == '__main__'</code> check is missing. In particular, this is the case on Windows where CPython cannot <a href="https://docs.python.org/3/library/os.html#os.fork" rel="nofollow noreferrer">fork</a>. So it is not safe to skip it. The test belongs at the top (global) level of your module, not inside some class. Its purpose is to stop the module from automatically running tasks (as opposed to defining classes, functions etc) when it is imported, as opposed to run directly. </p>
</div>
<div class="post-text" itemprop="text">
<p><code>if __name__ == '__main__':</code> is used to indicate which code to run when the module is loaded. Basically, it is loaded either when you run it as a script or when you import it as a library. In the first case, one usually writes it so that all of the written code executes so it is not necessary to include it. But when you are writing a library, there might by some code which you don't wont to run when other people import it, such as a short example or tests. So in the later case, you definitely want to include it.</p>
<p>To answer you question from the comments above, I don't think it makes sense to include it in a class method, as it is top-level construct and so it loads always.</p>
</div>
<span class="comment-copy">Which documentation are you referring to (could you link to it)? In any case, <code>if __name__ == '__main__'</code> is used so that the code wont execute when importing your library.</span>
<span class="comment-copy">Xingdong, make sure you're familiar with everything explained here: <a href="https://stackoverflow.com/questions/419163/what-does-if-name-main-do" title="what does if name main do">stackoverflow.com/questions/419163/what-does-if-name-main-do</a></span>
<span class="comment-copy">@EcirHana In this <a href="https://docs.python.org/3.7/library/multiprocessing.html" rel="nofollow noreferrer">official documentation</a>, it shows all examples with <code>if __name__ == '__main__'</code>. Do you mean it is okay to put <code>if __name__ == '__main__'</code> within a class method and even though we run a python script (e.g. <code>python file1.py --num_processes 5</code>) which internally create the class and call this method ?</span>
