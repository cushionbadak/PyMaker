<div class="post-text" itemprop="text">
<p>I have the following code:</p>
<pre><code>try:
    tn = Telnet(host, str(port))
except Exception as e:
    print("Connection cannot be established", e)
    traceback.print_exc()
print("You are connected")
tn.write('command?'+'\r\n')
while True:
    line = tn.read_until("\n")
</code></pre>
<p>When I run this code on machine X everything is working just fine, but when when I try to run the same code on a different machine I end up with the following error:</p>
<pre class="lang-none prettyprint-override"><code> Traceback (most recent call last):
 File
 "C:/Users/admin/Documents/Projects/terminalManager/terminalManager.py", line 50, in &lt;module&gt;
 terminalManager()
 File
"C:/Users/admin/Documents/Projects/terminalManager/terminalManager.py", line 16, in __init__
self.connect(terminalBganIp, terminalBganPort)
File "C:/Users/admin/Documents/Projects/terminalManager/terminalManager.py", line 34, in connect
tn.write('AT_IGPS?'+'\r\n')
File "C:\Program Files (x86)\Python\Python3.6.1\lib\telnetlib.py", line 287, in write
if IAC in buffer:
TypeError: 'in &lt;string&gt;' requires string as left operand, not bytes
</code></pre>
<p>Am I doing something wrong or is the second machine messing with me?</p>
<p><strong>EDIT:</strong></p>
<p>When i used IDLE debugger on my second machine everything is working. it seems it is not working when running it normally, is there anything i can do to resolve this?</p>
</div>
<div class="post-text" itemprop="text">
<p>I can't believe that the same code is working for you on another machine with the same python version.</p>
<p>Your issue is exactly what the Exception says it is <code>TypeError: 'in &lt;string&gt;' requires string as left operand, not bytes</code>. You need to provide <code>bytes</code> to <code>tn.write</code> instead of a <code>string</code>.</p>
<p>You can convert your string into bytes via <code>encode</code>:</p>
<pre><code>command = "command?" + "\r\n"
tn.write(command.encode("ascii"))
</code></pre>
<p>Edit: Well, someone beat me to it :D</p>
</div>
<div class="post-text" itemprop="text">
<p>Try to do:</p>
<pre><code>tn.write(('command?'+'\r\n').encode())
</code></pre>
<p>Usually sockets work over bytes not strings, the error could be related to that, hope this can help.</p>
</div>
<span class="comment-copy">As the <a href="https://docs.python.org/3/library/telnetlib.html#telnetlib.Telnet.write" rel="nofollow noreferrer">documentation</a> indicates, the <code>Telnet.write()</code> function expects to be passed an argument that is a byte string, not a stringâ€”so you need to convert the <code>'AT_IGPS?'+'\r\n'</code> string, which isn't shown in your code, into one. Are both machines running the same version of Python (this likely changed between Python 2 and 3)?</span>
<span class="comment-copy">Tied it, the problem is still the same... i get to the "you are connected" and than everything freeze</span>
<span class="comment-copy">I find this very strange running the idle debugger step by step i get everything working...</span>
<span class="comment-copy">Does this behavior occur every time? Maybe it is a problem with the telnet server executing your command. Try <code>for _ in range(max_tries)</code> instead of <code>while True</code> to abort your program at some point.</span>
<span class="comment-copy"><a href="http://imgur.com/a/QNm5i" rel="nofollow noreferrer">Working</a>  , <a href="http://imgur.com/a/XrBTO" rel="nofollow noreferrer">Not Working</a> - just to show that it works on machine 1 and not on machine 2 while both connected to the same device.</span>
<span class="comment-copy">Does the connection eventually close? If so you could use <code>read_all</code> which would basically do the same thing.  Have you tried a system telnet client to check whether it works from the machine where it's not working with python?   Which python version are you using? In your error message it's 3.6, but in your screenshot it's 2.7. Don't mix the same code with different python versions (at least not across 2 and 3).  Try using <code>read_some</code> and printing throughout to check whether you get any data at all. As suggested by martineau, python2: string, python3: byte-string. That's prob the issue</span>
<span class="comment-copy">Tried that also... not working as it should. it was working fine the other day... today everything broke and i did not change a single line of code.</span>
