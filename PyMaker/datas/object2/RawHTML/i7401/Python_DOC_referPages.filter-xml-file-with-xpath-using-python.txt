<div class="post-text" itemprop="text">
<p>I'm trying to grab some data from a XML file that I generated after I did a network scan in my test environment. The XML file that I got back gave me an enormous amount of information which I want to filter.</p>
<p>The only systems I'm interested in are the systems with the state "up" </p>
<pre><code>from xml.etree.ElementTree import ElementTree
mydoc = ElementTree(file='nmap_output.xml')
for e in mydoc.findall("./nmaprun/host/state[@state='up']"):
print (e.get('title').text )
</code></pre>
<p>Below I posted a part of the XML file that I'm using, it's far too large to post it entirely.</p>
<pre><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE nmaprun&gt;
&lt;?xml-stylesheet href="file:///C:/Program Files (x86)/Nmap/nmap.xsl" type="text/xsl"?&gt;
&lt;!-- Nmap 7.40 scan initiated Mon Jul 10 18:24:16 2017 as: nmap -sS -O -vv -oX c:\\drv\\1921689024.xml 192.168.9.0/24 --&gt;
&lt;nmaprun scanner="nmap" args="nmap -sS -O -vv -oX c:\\drv\\1921689024.xml 192.168.9.0/24" start="1499703856" startstr="Mon Jul 10 18:24:16 2017" version="7.40" xmloutputversion="1.04"&gt;
&lt;taskbegin task="Ping Scan" time="1499703857"/&gt;
&lt;taskend task="Ping Scan" time="1499703860" extrainfo="256 total hosts"/&gt;
&lt;taskbegin task="Parallel DNS resolution of 256 hosts." time="1499703860"/&gt;
&lt;taskend task="Parallel DNS resolution of 256 hosts." time="1499703860"/&gt;
&lt;host&gt;&lt;status state="down" reason="no-response" reason_ttl="0"/&gt;
&lt;address addr="192.168.9.0" addrtype="ipv4"/&gt;
&lt;/host&gt;
&lt;host&gt;&lt;status state="down" reason="no-response" reason_ttl="0"/&gt;
&lt;address addr="192.168.9.2" addrtype="ipv4"/&gt;
&lt;/host&gt;
&lt;host&gt;&lt;status state="down" reason="no-response" reason_ttl="0"/&gt;
&lt;address addr="192.168.9.3" addrtype="ipv4"/&gt;
&lt;/host&gt;
&lt;host&gt;&lt;status state="down" reason="no-response" reason_ttl="0"/&gt;
&lt;address addr="192.168.9.4" addrtype="ipv4"/&gt;
&lt;/host&gt;
&lt;host&gt;&lt;status state="down" reason="no-response" reason_ttl="0"/&gt;
&lt;address addr="192.168.9.5" addrtype="ipv4"/&gt;
&lt;/host&gt;
&lt;host&gt;&lt;status state="down" reason="no-response" reason_ttl="0"/&gt;
&lt;address addr="192.168.9.6" addrtype="ipv4"/&gt;
&lt;/host&gt;
&lt;host&gt;&lt;status state="down" reason="no-response" reason_ttl="0"/&gt;
&lt;address addr="192.168.9.9" addrtype="ipv4"/&gt;
&lt;/host&gt;
&lt;host&gt;&lt;status state="down" reason="no-response" reason_ttl="0"/&gt;
&lt;address addr="192.168.9.10" addrtype="ipv4"/&gt;
&lt;/host&gt;
&lt;host starttime="1499703857" endtime="1499704025"&gt;&lt;status state="up" reason="echo-reply" reason_ttl="249"/&gt;
&lt;address addr="192.168.9.1" addrtype="ipv4"/&gt;
&lt;hostnames&gt;
&lt;hostname name="man-nas-01.man.eu.cascorp.biz" type="PTR"/&gt;
&lt;/hostnames&gt;
&lt;ports&gt;&lt;extraports state="closed" count="991"&gt;
&lt;extrareasons reason="resets" count="991"/&gt;
&lt;/extraports&gt;
&lt;/host&gt;
&lt;host starttime="1499703857" endtime="1499704025"&gt;&lt;status state="up" 
reason="echo-reply" reason_ttl="249"/&gt;
&lt;address addr="192.168.9.7" addrtype="ipv4"/&gt;
&lt;hostnames&gt;
&lt;/hostnames&gt;
&lt;/nmaprun&gt;
</code></pre>
<p>Could anyone help me show how I can get only the hosts with the state "up"?</p>
</div>
<div class="post-text" itemprop="text">
<p>It looks like you should be able to get the hosts with the following xpath</p>
<pre><code>mydoc.findall('.//host/status[@state="up"]/..')
</code></pre>
<p>If you want to get the addresses you could use</p>
<pre><code>addresses = mydoc.findall('.//host/status[@state="up"]/../address')

for address in addresses:
    print(address.get('addr'))
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>This finds all <code>&lt;host&gt;</code> tags which have a <code>&lt;status state="up"&gt;</code> child.</p>
<pre><code>import xml.etree.ElementTree as ET
tree = ET.parse('nmap_output.xml')
root = tree.getroot()
print(root.findall(".//status[@state='up']/.."))
</code></pre>
<p>(found examples on <a href="https://docs.python.org/3/library/xml.etree.elementtree.html#example" rel="nofollow noreferrer">Python docs</a>)</p>
</div>
<div class="post-text" itemprop="text">
<blockquote>
<p><strong>Question</strong>: ... how I can get only the hosts with the state "up"?  </p>
</blockquote>
<hr/>
<blockquote>
<p><strong>Note</strong>: Your Example XML is invalid for the following Reasons:  </p>
<p>Additonal <code>&lt;!DOCTYPE nmaprun&gt;</code> could be only <strong>one</strong>!<br/>
  Missing closing <code>&lt;/ports&gt;</code><br/>
  Missing closing <code>&lt;/host&gt;</code> </p>
</blockquote>
<pre><code>from xml.etree.ElementTree import ElementTree

mydoc = ElementTree(file='nmap_output.xml')

# Find all &lt;host&gt; Elements with &lt;status state="up" ...&gt;
for host in mydoc.findall('.//host/status[@state="up"]/..'):

    # Get the Attributes Dict from &lt;host&gt; &lt;status ...&gt; and &lt;address ...&gt;
    status = host.find('.//status').attrib
    address = host.find('.//address').attrib

    print ('host: addr={a[addr]}, status: {s[state]} reason={s[reason]}'.
             format(a=address, s=status))
</code></pre>
<blockquote>
<p><strong>Qutput</strong>:  </p>
<pre><code>host: addr=192.168.9.1, status: up reason=echo-reply
host: addr=192.168.9.7, status: up reason=echo-reply
</code></pre>
</blockquote>
<p><strong><em>Tested with Python: 3.4.2</em></strong></p>
</div>
<span class="comment-copy">When I run  mydoc.findall('.//host/status[@state="up"]/..')  It gives me a NoneType error, also when I add /nmaprun/ before host I only get a blanc answer. No error, just nothing.</span>
<span class="comment-copy">That's strange. I got it working in the console using the xml sample you provided and Python 3.6. Did you use <code>'.//host/status[@state="up"]/..'</code> or <code>'.//host/state[@state="up"]/..'</code>? I notice in your question above you used the latter.</span>
<span class="comment-copy">Yes I also found this one on the python docs, but when I run it I only get a blanc output. I don't get any error, just nothing.  <a href="http://i66.tinypic.com/j5woi0.png" rel="nofollow noreferrer">screenshot</a></span>
<span class="comment-copy">@killerdoomc of course, it doesn't print anything :) Edited.</span>
<span class="comment-copy">Oh of course, I did not realise that the print was missing, stupid of me!  My current output is       "[&lt;Element 'host' at 0x0000023600602CC8&gt;, &lt;Element 'host' at      0x000002360060DD18&gt;, &lt;Element 'host' at 0x0000023600617818&gt;,"</span>
<span class="comment-copy">Thank you very much! This worked and the format is nice. It could indeed be that I missed 1 or 2 closing, because I removed the sensitive information from the XML.</span>
<span class="comment-copy">@killerdoomc: <a href="http://stackoverflow.com/help/someone-answers">What should I do when someone answers my question?</a></span>
