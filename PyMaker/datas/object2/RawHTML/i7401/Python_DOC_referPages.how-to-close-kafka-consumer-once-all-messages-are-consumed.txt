<div class="post-text" itemprop="text">
<p>I have following program to consume all the messages coming to Kafka.</p>
<pre><code>from kafka import KafkaConsumer

consumer = KafkaConsumer('my_test_topic',
                         group_id='my-group',
                         bootstrap_servers=['my_kafka:9092'])
for message in consumer:
    consumer.commit()
    print ("%s key=%s value=%s" % (message.topic,message.key,
                                          message.value))
KafkaConsumer.close()
</code></pre>
<p>Using above program i am able to consume all the messages coming to Kafka. But once all messages are consumed, i want to close the kafka consumer which is not happening. I need help in same.</p>
</div>
<div class="post-text" itemprop="text">
<p>I am able to close kafka consumer now if i provide <strong>consumer_timeout_ms argument to KafkaConsumer object</strong>. It accepts timeout value in millisecond.
Below is the code snippet.</p>
<pre><code>from kafka import KafkaConsumer

consumer = KafkaConsumer('my_test_topic',
                         group_id='my-group',
                         bootstrap_servers=['my_kafka:9092'],
                         consumer_timeout_ms=1000)
for message in consumer:
    consumer.commit()
    print ("%s key=%s value=%s" % (message.topic,message.key,
                                          message.value))
KafkaConsumer.close()
</code></pre>
<p>In above code if consumer doesn't see any message for 1 second it will close the session.</p>
</div>
<div class="post-text" itemprop="text">
<p>It looks like you want consumer.close() instead of KafkaConsumer.close(). It's not documented as a static method.</p>
</div>
<div class="post-text" itemprop="text">
<p>I'm able to close the Kafka stream with code like this</p>
<pre><code>import sys 
from kafka import KafkaConsumer
consumer = KafkaConsumer('topic', bootstrap_servers='www.myserver.com:9000', auto_offset_reset='earliest')

count = 0 
for msg in consumer:
    count += 1
    print (msg.value.decode('ascii'))
    if count == 100:
        break

consumer.close()
</code></pre>
<p>The above code will print first 100 messages of the topic.</p>
</div>
<span class="comment-copy">i tried using consumer.close() as well but it seems it is not coming out of the for loop itself to execute close(). May be i am missing something not sure what.</span>
<span class="comment-copy">I think your loop is just going to wait for more messages indefinitely. You'll have to give it an exit condition to reach the close.</span>
<span class="comment-copy"><code>to consume all the messages</code>, not just the first 100 ones (you should look into <a href="https://docs.python.org/3/library/functions.html#enumerate" rel="nofollow noreferrer"><code>enumerate</code></a> which will give you an index with the value, so you don't have to use a manual counter.</span>
