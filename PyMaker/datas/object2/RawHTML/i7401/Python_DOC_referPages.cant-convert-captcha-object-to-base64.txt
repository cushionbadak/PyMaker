<div class="post-text" itemprop="text">
<p>I'm currently working with python3, and my project requires captcha generation. my goal is to generate the captcha then return it as base64 so it can be served in JSON to the client.</p>
<p>However i'm having trouble converting it to a base64 string :</p>
<pre><code>    captcha=image.generate(captchatext)
    assert isinstance(captcha, BytesIO)
    captcha=base64.b64encode(captcha)
</code></pre>
<p>returns the error: </p>
<pre><code>  captcha=base64.b64encode(captcha)
  File "/usr/lib/python3.6/base64.py", line 58, in b64encode
  encoded = binascii.b2a_base64(s, newline=False)
TypeError: a bytes-like object is required, not '_io.BytesIO'
</code></pre>
<p>I'm not entirely sure why ? could someone help me understand why it won't convert ? </p>
<p>Thanks for any help :)</p>
</div>
<div class="post-text" itemprop="text">
<p>Convert <code>BytesIO</code> object to <code>bytes</code> type:</p>
<pre><code>captcha = base64.b64encode(image.generate(captchatext).getvalue())
</code></pre>
<p>These types aren't interchangeable, <code>BytesIO</code> is a file-like object, and <code>bytes</code> just stores immutable value like <code>str</code></p>
</div>
<span class="comment-copy"><code>BytesIO</code> is not a buffer, but it is a file-like which uses a buffer as its backend. A buffer is an object implementing the <a href="https://docs.python.org/3/c-api/buffer.html" rel="nofollow noreferrer">Buffer Protocol</a> and can be obtained with for example <code>bytearray()</code>. (If BytesIO <i>was</i> in fact a buffer, <code>b64encode</code> would work as can be confirmed with <code>base64.b64encode(bytearray())</code> or even <code>base64.b64encode(numpy.zeros(20))</code> (yes, numpy arrays implement the buffer protocol and are thus buffers).) The general spirit of your answer is correct though, so have a +1.</span>
