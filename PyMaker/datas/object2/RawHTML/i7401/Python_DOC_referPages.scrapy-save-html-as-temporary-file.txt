<div class="post-text" itemprop="text">
<p>I'm writing a scrapy web crawler that saves the html from the pages that I visit and I'm uploading them to S3. Since they are uploading to S3, there's no point in keeping a local copy</p>
<p><strong>Spider class</strong></p>
<pre><code>class MySpider(CrawlSpider):
    name = 'my name'  
    start_urls = ['my url']
    allowed_domains = ['my domain']
    rules = (Rule (LinkExtractor(allow=()), callback="parse_item", follow= True),
  )

    def parse_item(self,response): 
        item = MyItem()
        item['url'] = response.url
        item['html'] = response.body
        return item
</code></pre>
<p><strong>pipelines.py</strong></p>
<pre><code>save_path = 'My path'

if not os.path.exists(save_path):
    os.makedirs(save_path)

class HtmlFilePipeline(object):
    def process_item(self, item, spider):
        page = item['url'].split('/')[-1]
        filename = '%s.html' % page
        with open(os.path.join(save_path, filename), 'wb') as f:
            f.write(item['html'])
        self.UploadtoS3(filename)

    def UploadtoS3(self, filename):
    ...
</code></pre>
<p>I read in the python docs that I can create a NamedTemporaryFile: <a href="https://docs.python.org/3/library/tempfile.html#tempfile.NamedTemporaryFile" rel="nofollow noreferrer">https://docs.python.org/3/library/tempfile.html#tempfile.NamedTemporaryFile</a></p>
<p>I'm a little fuzzy on when it gets deleted. If I were to use a NamedTemporaryFile how could I delete the file after successful upload to S3?</p>
</div>
<div class="post-text" itemprop="text">
<p>Extending on my comment:</p>
<p>You could use the io.StringIO method to create a text buffer instead of saving/reading/deleting a file.</p>
<p>It would be something like this:</p>
<pre><code>import io

if not os.path.exists(save_path):
    os.makedirs(save_path)

class HtmlFilePipeline(object):
    def process_item(self, item, spider):
        page = item['url'].split('/')[-1]
        filename = '%s.html' % page
        file = io.StringIO()
        file.write(item['html'])
        self.UploadtoS3(filename, file)

    def UploadtoS3(self, filename, file):
        # here instead of reading the file to upload to S3, use the file passed to the method
</code></pre>
<p>Documentation: <a href="https://docs.python.org/3/library/io.html" rel="nofollow noreferrer">https://docs.python.org/3/library/io.html</a></p>
</div>
<span class="comment-copy">Do you really need to create this file here? why not just use io.StringIO? <a href="https://docs.python.org/3/library/io.html" rel="nofollow noreferrer">docs.python.org/3/library/io.html</a></span>
<span class="comment-copy">Oh, interesting! So I could just use io.StringIO and save as an html file on the S3 side?</span>
<span class="comment-copy">Yes, I have given a answer that should suffice your needs.</span>
<span class="comment-copy">Awesome, thank you!</span>
<span class="comment-copy">@Bhetzie whould you share your UploadtoS3 function please?</span>
