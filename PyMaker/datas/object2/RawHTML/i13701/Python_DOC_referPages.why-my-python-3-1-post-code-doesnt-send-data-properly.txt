<div class="post-text" itemprop="text">
<p>I'd like to make a post like this, using Python 3.1 (I just used the "Copy as cURL" on firefox): </p>
<pre><code>curl 'http://some.example.test/formulario.php?current_date=31%2F08%2F2015&amp;Button_Insert=Include&amp;ccsForm=apropriacao' -H 'Host: some.example.test' -H 'User-Agent: Mozilla/5.0 (Windows NT 5.1; rv:39.0) Gecko/20100101 Firefox/39.0' -H 'Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8' -H 'Accept-Language: pt-BR,pt;q=0.8,en-US;q=0.5,en;q=0.3' -H 'Accept-Encoding: gzip, deflate' -H 'DNT: 1' -H 'Referer: http://some.example.test/formulario.php?current_date=31%2F08%2F2015&amp;Button_Insert=Confirm&amp;Button_Insert=Include' -H 'Cookie: PHPSESSID=ctbsuli3i6f6mivof2dv9mb036; SERVERID=X' -H 'Connection: keep-alive' -H 'Content-Type: application/x-www-form-urlencoded' --data 'TextBox3=OK&amp;idservice=14&amp;idactivity=16&amp;idsistem=1&amp;TextBox1=&amp;idproject=9&amp;TextBox2=100&amp;Button_Insert=Include&amp;current_date=31%2F08%2F2015'
</code></pre>
<p>I've made many searches on stackoverflow, and I make this code (only the necessary parts shown):</p>
<pre><code>dataPostJson = {'TextBox3': 'OK', 'idservice': '14' etc}
params = json.dumps(dataPostJson).encode('utf8')

req = urllib.request.Request(url, data=params)

req.add_header('Host', 'some.example.test')
req.add_header('User-Agent', 'Mozilla/5.0 (Windows NT 5.1; rv:39.0) Gecko/20100101 Firefox/39.0')
...
req.add_header('Accept', 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8')

response = urllib.request.urlopen(req)
</code></pre>
<p>Even with response.getcode() == 200, the POST doesn't change values on the Host. If I try to execute this cURL command, the POST occurs properly, so the problem isn't the Host. The problem is with my code.</p>
<p>Can someone give me a clue?</p>
<p>EDIT:</p>
<p>What I'm trying to do is:
1) log in a server with my credentials
2) get PHPSESSID and SERVERID returned
3) add data to the server with HTTP POST</p>
<p>Things to consider: when I do a get to login.php, the server already gives me a PHPSESSID and SERVERID. When I POST my credentials {'login': '...', 'password': '...', 'sendButton': 'buttonValue'}, I don't know how to check if user/password was sent correctly.</p>
<p>I can see that, if I do a login via browser, take PHPSESSID and SERVERID, and replace them into the cURL command, I can send data to the server. But, using python, I'm not getting the same sucess.</p>
</div>
<div class="post-text" itemprop="text">
<p>I'm not sure that I properly "translated" everything from <code>cUrl</code> request to <code>python requests</code>, but try following (after installing <code>requests</code> package) and let me know result:</p>
<pre><code>import requests

url = 'http://some.example.test /formulario.php?current_date=31%2F08%2F2015&amp;Button_Insert=Include&amp;ccsForm=apropriacao'
headers = {
    'Host':'some.example.test',
    'User-Agent': 'Mozilla/5.0 (Windows NT 5.1; rv:39.0) Gecko/20100101 Firefox/39.0',
    'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',
    'Accept-Language': 'pt-BR,pt;q=0.8,en-US;q=0.5,en;q=0.3',
    'Accept-Encoding': 'gzip, deflate',
    'DNT': '1',
    'Referer': 'http://some.example.test/formulario.php?current_date=31%2F08%2F2015&amp;Button_Insert=Confirm&amp;Button_Insert=Include',
    'Cookie': 'PHPSESSID=ctbsuli3i6f6mivof2dv9mb036; SERVERID=X',
    'Connection': 'keep-alive',
    'Content-Type': 'application/x-www-form-urlencoded',
            }

payload = {
    'TextBox3': 'OK',
    'idservice': '14',
    'idactivity': '16',
    'idsistem': '1',
    'TextBox1': '',
    'idproject': '9',
    'TextBox2': '100',
    'Button_Insert': 'Include',
    'current_date': '31%2F08%2F2015'
    }

r = requests.post(url, data=payload, headers=headers)
</code></pre>
</div>
<span class="comment-copy">your trying to send a json body as application/x-www-form-urlencoded. use <a href="https://docs.python.org/3/library/urllib.parse.html#urllib.parse.urlencode" rel="nofollow noreferrer"><code>urlencode</code></a> instead of json to encode your data.</span>
<span class="comment-copy">you mean params = urllib.parse.urlencode(dataPostJson)? it doesn't work.</span>
<span class="comment-copy">you need to encode it to bytes, see the <a href="https://docs.python.org/3/library/urllib.request.html#urllib-examples" rel="nofollow noreferrer">examples</a> for reference. or use the <a href="http://requests.readthedocs.org" rel="nofollow noreferrer">requests</a> library, which offers a much easier to use api.</span>
<span class="comment-copy">I changed params = json.dumps(dataPostJson).encode('utf8') to params = urllib.parse.urlencode(dataPostJson).encode('utf8');  I changed req = urllib.request.Request(url, data=params) to req = urllib.request.Request(url)   The last change: from response = urllib.request.urlopen(req) to response = urllib.request.urlopen(req, params)    I don't want to use requests because it doesn't work on Python 3.1 and I don't like to "downgrade" the application.</span>
<span class="comment-copy">@Paulinho Are you sure about <code>requests</code>? I found that Requests currently supports the following versions of Python:      Python 2.6,     Python 2.7,     Python 3.1,     Python 3.2,     Python 3.3. Have you already tried <code>requests</code>?</span>
<span class="comment-copy">Still not working. One doubt: in current_date, do I need to use %2F instead of slash? Another one: the field "Button_Insert" that must has the value "Include" is not exactly "Include". The correct value is "Include Something" (can you see the space?). When I get the cURL command, the space is replaced by a plus sign. On python code, do I have to keep the + sign or can I use the space character?</span>
<span class="comment-copy">1) Well, I don't know exactly how your web app expect to receive date, but yes, in fact <code>'31%2F08%2F2015' == '31/08/2015'</code> so yo should try. 2) No, I'm afraid I see no spaces...</span>
<span class="comment-copy">I see that there is a GET request used in another GET request as URI. Maybe you should try to use <code>url = 'http://some.example.test /formulario.php'</code> and add one more key-value pair to <code>payload</code> - <code>'ccsForm': 'apropriacao'</code> ? just assumption</span>
