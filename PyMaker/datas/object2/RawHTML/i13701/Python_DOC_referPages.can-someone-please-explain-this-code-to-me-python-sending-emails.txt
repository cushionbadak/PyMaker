<div class="post-text" itemprop="text">
<p>I have found the following code below from a website explaining how to send emails (Hotmail/live) using python. I can understand some of the code but most of it is totally confusing. For example what does, <strong>s.starttls()</strong> mean/do and also <strong>msg.as_string()</strong>; was that defined earlier or what does it do? Please help me out because i want to understand this code (i want to make a gui application version of this soon).</p>
<p>Guide me through this please.... 
<br/><br/>P.S --&gt; I'm only 16 so please make it sound as understandable as possible.</p>
<p><strong><em>The Code:</em></strong></p>
<pre><code>import email
import smtplib

msg = email.message_from_string('warning')
msg['From'] = "example@hotmail.fr"
msg['To'] = "example@hotmail.fr"
msg['Subject'] = "helOoooOo"
s = smtplib.SMTP("smtp.live.com",587)
s.ehlo()
s.starttls() 
s.ehlo()
s.login('example@hotmail.fr', 'pass')
s.sendmail("example@hotmail.fr", "example@hotmail.fr", msg.as_string())
s.quit()
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>I'm sorry to tell you, but this is not exactly the place to get a coding lesson. This is a place to ask for precise coding questions. So it's very likely that your question will get flagged and I will be amongst those who will ask for closing it. But…</p>
<p>…I've been there, learning to code at your age at a time when Internet was just a small portion of what it is today. So let me give you some insight and pointers.</p>
<p>The code you pasted is <em>very</em> straightforward, given you know a bit of programming and understand the SMTP protocol.</p>
<p>When you send a mail, you're doing a TCP connection to a server on ­— usually — the port 25 (but 587 in your case). There you have to follow a precise protocol to have the server understand what you want to do. This protocol has been defined by the <a href="https://www.ietf.org/rfc/rfc2821.txt" rel="noreferrer">RFC821</a>.</p>
<p>The same way you follow a protocol when you meet someone (which is like "hi!", then shake hands, then say "how're you doing?") before asking a question, the server does the same:</p>
<pre><code>EHLO example.org
MAIL FROM alice@example.org
RCPT TO bob@example.org
DATA
Date: Fri, 21 Aug 2015 23:12:29 +0000
From: Alice &lt;alice@example.org&gt;
To: Bob &lt;bob@example.org&gt;

Go RTFM!

-- 
Bob
.
</code></pre>
<p>Where you say to the server:</p>
<ul>
<li><em>Hi! I'm Alice!</em></li>
<li><em>I Want to send a message to Bob!</em></li>
<li><em>Can you tell him to go RTFM?</em></li>
</ul>
<p>Which is what you're actually doing in your code.</p>
<p>Now let's get more on the programming side of things. First of all, you import <em>modules</em>, one for handling an email the other one for the smtp connection:</p>
<pre><code>import email
import smtplib
</code></pre>
<p>to understand how to use it, you can launch the python REPL on the command line and do <code>dir(email)</code> to show its objects, and <code>help(email)</code> to get the integrated help:</p>
<pre><code>python
&gt;&gt;&gt; import email
&gt;&gt;&gt; dir(email)
['Charset', 'Encoders', 'Errors', 'FeedParser', 'Generator', 'Header', 'Iterators', 'LazyImporter', 'MIMEAudio', 'MIMEBase', 'MIMEImage', 'MIMEMessage', 'MIMEMultipart', 'MIMENonMultipart', 'MIMEText', 'Message', 'Parser', 'Utils', '_LOWERNAMES', '_MIMENAMES', '__all__', '__builtins__', '__doc__', '__file__', '__name__', '__package__', '__path__', '__version__', '_name', 'base64MIME', 'email', 'importer', 'message_from_file', 'message_from_string', 'mime', 'quopriMIME', 'sys']
&gt;&gt;&gt; help(email)
Help on package email:

NAME
    email - A package for parsing, handling, and generating email messages.

FILE
    /System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/email/__init__.py

MODULE DOCS
    http://docs.python.org/library/email
…
</code></pre>
<p>the objects are all the actions and objects being developed by the community that you can use. And the help is giving a bit more insight, as well as the URL you want to visit to know more about what you can do with it, along with examples.</p>
<p>Then, you create a mail message:</p>
<pre><code>msg = email.message_from_string('warning')
msg['From'] = "example@hotmail.fr"
msg['To'] = "example@hotmail.fr"
msg['Subject'] = "helOoooOo"
</code></pre>
<p>on which you setup the <code>Subject</code>, <code>From</code> and <code>To</code> lines, as well as the body, in the SMTP protocol that would look like:</p>
<pre><code>From: example@hotmail.fr
To: example@hotmail.fr
Subject: helOoooOo

warning
.
</code></pre>
<p>Then you open a connection to the SMTP server of Live.com:</p>
<pre><code>s = smtplib.SMTP("smtp.live.com",587)
</code></pre>
<p>that connection gives an object knowing the details of where you're connecting to, and offers methods you can apply on that connection. The methods are actions you can do on it, i.e.:</p>
<p>You say "hi!"</p>
<pre><code>s.ehlo()
</code></pre>
<p>Then, you start encrypting the communication:</p>
<pre><code>s.starttls()
</code></pre>
<p>it is doing the "encryption handshake" protocol on your smtp connection, so that further communication is now "secure", i.e. nobody can read your password by looking at the packets between your computer and the server.</p>
<p>You can read more about it there:</p>
<blockquote>
<p><a href="https://docs.python.org/3/library/smtplib.html#smtplib.SMTP.starttls" rel="noreferrer">https://docs.python.org/3/library/smtplib.html#smtplib.SMTP.starttls</a></p>
</blockquote>
<p>And you can read its source code here:</p>
<blockquote>
<p><a href="https://hg.python.org/cpython/file/3.4/Lib/smtplib.py#l654" rel="noreferrer">https://hg.python.org/cpython/file/3.4/Lib/smtplib.py#l654</a></p>
</blockquote>
<p>You say "hi!" again, not only because you're very polite, but because you switched from unencrypted to encrypted, your mail server is expecting you to say hi again:</p>
<pre><code>s.ehlo()
</code></pre>
<p>You identify yourself, so that live.com knows that you're who you're prentending to be:</p>
<pre><code>s.login('example@hotmail.fr', 'pass')
</code></pre>
<p>so there you want to change for your actual account's email address and password</p>
<p>Then, you send your mail to/from example@hotmail.fr:</p>
<pre><code>s.sendmail("example@hotmail.fr", "example@hotmail.fr", msg.as_string())
</code></pre>
<p>In the first part of my answer, I told you about the "SMTP" protocol, where you have to say who you are and who you want to talk to? well this is what you're doing here. This method will translate into:</p>
<pre><code>MAIL FROM example@hotmail.fr
RCPT TO example@hotmail.fr
</code></pre>
<p>And then, your mail object is a python "instance" that has no sense for your smtp server. You have to have it translated from the form that your mail server can understand, which is full text. You can have a look at what it is by doing in the python REPL:</p>
<pre><code>python
&gt;&gt;&gt; import email
&gt;&gt;&gt; msg = email.message_from_string('warning')
&gt;&gt;&gt; msg['From'] = "example@hotmail.fr"
&gt;&gt;&gt; msg['To'] = "example@hotmail.fr"
&gt;&gt;&gt; msg['Subject'] = "helOoooOo"
&gt;&gt;&gt; print(msg)
&lt;email.message.Message instance at 0x10dcb1560&gt;
</code></pre>
<p>which means "python knows about an object called msg, which is made thanks to the class email.message.Message and lives at the memory address 0x10dcb1560".</p>
<p>But if you do the following, then you'll get the mail you'll send:</p>
<pre><code>&gt;&gt;&gt; print(msg.as_string())
From: example@hotmail.fr
To: example@hotmail.fr
Subject: helOoooOo

warning
</code></pre>
<p>Which is what actually you give to the SMTP handler instance that takes care of sending it properly.</p>
<p>And because you're polite, you're telling the server you're leaving by saying "bye", instead of leaving silently.</p>
<pre><code>s.quit()
</code></pre>
<p>All that being said, I can only advice you to open a few books, take some online courses and most importantly do practice, starting from the simple stupid and boring examples to stuff way more complex. Start first by doing textual interfaces before doing graphical ones which are a bit more complex.</p>
<p>Here are a few pointers:</p>
<ul>
<li>Official python tutorial: <a href="https://docs.python.org/3.5/tutorial/" rel="noreferrer">https://docs.python.org/3.5/tutorial/</a></li>
<li>Another tutorial: <a href="http://sthurlow.com/python/" rel="noreferrer">http://sthurlow.com/python/</a></li>
</ul>
<p>You might want to follow online courses as well:</p>
<ul>
<li><a href="https://www.coursera.org/course/programming1" rel="noreferrer">https://www.coursera.org/course/programming1</a></li>
<li><a href="https://www.coursera.org/course/interactivepython1" rel="noreferrer">https://www.coursera.org/course/interactivepython1</a></li>
<li><a href="https://www.udemy.com/python-for-beginners/" rel="noreferrer">https://www.udemy.com/python-for-beginners/</a></li>
<li><a href="https://www.codecademy.com/tracks/python" rel="noreferrer">https://www.codecademy.com/tracks/python</a></li>
</ul>
<p>just to give a few ones.</p>
<p>As your code suggests, it looks like you might be french, then I can only advice you to read the excellent book on algorithmic written by a former teacher I had, which is teaching programming principles and thinking without being tied to a programming language:</p>
<ul>
<li><a href="https://books.google.fr/books/about/Passeport_pour_l_algorithmique_objet.html?id=GIfBGAAACAAJ" rel="noreferrer">Passeport pour l'argorithmique object, Jean-Pierre Fournier</a></li>
</ul>
<p>HTH</p>
</div>
<div class="post-text" itemprop="text">
<p>So <code>message_from_string('warning')</code> takes in a string and puts into a message object structure. Then you set the <code>From</code>, <code>To</code>, <code>Subject</code>. You then define the <code>SMTP</code> address and port it uses. <code>ehlo()</code> just tells the server that you're going to be sending a message through it. <code>starttls()</code> says that from now on, all the data sent will be sent through TLS, so all your passwords will be safe and encrypted. You login, send the mail to and get the message you previously set the first line, back as a string to send off. Then you close the SMTP connection.</p>
</div>
<div class="post-text" itemprop="text">
<p>All of the resources you need can be found at the Python Standard Library: <a href="https://docs.python.org/2/library/email.html#module-email" rel="nofollow">18.1 Email</a> and <a href="https://docs.python.org/2/library/smtplib.html" rel="nofollow">20.12 smtplib</a>.</p>
<p>I will do a line by line explanation focusing on the two lines you mentioned. (<em>Skipping the imports</em>)</p>
<pre><code>msg = email.message_from_string('warning') 
</code></pre>
<p>Creating a message object with value "warning"</p>
<pre><code>msg['From'] = "example@hotmail.fr"
msg['To'] = "example@hotmail.fr"   
msg['Subject'] = "helOoooOo"       
</code></pre>
<p>Designates Sender, Reciever, and Subject of message</p>
<pre><code>s = smtplib.SMTP("smtp.live.com",587) 
</code></pre>
<p>This sets up a mail client (specifically an SMTP client session object) that can send mail to any internet machine with an an SMTP or ESMTP listener daemon. <br/>(This includes all big emails like gmail, yahoo, aol, etc.)</p>
<pre><code>s.ehlo()
</code></pre>
<p>This identifies you as a server using EHLO and sets up a lot of default attributes needed to send your message.</p>
<pre><code>s.starttls()
</code></pre>
<p>Put the SMTP connection in TLS (Transport Layer Security) mode. All SMTP commands that follow will be encrypted. </p>
<pre><code>s.ehlo()
</code></pre>
<p>Good practice to put after the previous command because the information is now encrypted.</p>
<pre><code>s.login('example@hotmail.fr', 'pass')
</code></pre>
<p>Logs in with (username, password)</p>
<pre><code>s.sendmail("example@hotmail.fr", "example@hotmail.fr", msg.as_string())
</code></pre>
<p>Sends the message (From, To, Msg). The msg.as_string() simply means you want the message format to be a string.</p>
<pre><code>s.quit()
</code></pre>
<p>Terminates session.</p>
</div>
<span class="comment-copy">To find out about s.starttls, note that s is defined as smtplib.SMTP() so I googled 'smtplib.SMTP' and in the first hit (<a href="https://docs.python.org/2/library/smtplib.html" rel="nofollow noreferrer">docs.python.org/2/library/smtplib.html</a>) searched for 'starttls' until found its definition at <a href="https://docs.python.org/2/library/smtplib.html#smtplib.SMTP.starttls" rel="nofollow noreferrer">docs.python.org/2/library/smtplib.html#smtplib.SMTP.starttls</a> and which says 'Put the SMTP connection in TLS (Transport Layer Security) mode. All SMTP commands that follow will be encrypted.' The same process can find out about 'email.message_from_string' - just google it, take the first or second hit and search it for that function.</span>
<span class="comment-copy">Thanks that was very informative! I understand enough of the code to write a GUI application now. Also i'm not french i'm English (Canadian). But thanks anyways!</span>
<span class="comment-copy">The <code>MAIL FROM</code> and <code>RCPT TO</code> arguments should properly be in <code>&lt;brokets&gt;</code>.</span>
