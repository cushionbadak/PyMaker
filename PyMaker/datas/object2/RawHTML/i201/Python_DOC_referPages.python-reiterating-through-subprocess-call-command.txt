<div class="post-text" itemprop="text">
<p>I have the following code to re-iterate through a IP address list to find the SNMP string:</p>
<p><strong>INPUT:</strong></p>
<pre><code>import os
import subprocess
ip_list = ['10.10.10.10','10.10.10.11']
snmp = "snmpget -v1 -c public "

for x in ip_list:
     command = os.system(str(snmp + x))
</code></pre>
<p><strong>OUTPUT:</strong> ... = STRING: "11/15/2017"</p>
<p>This code works fine, but I need to replace os.system with subprocess.call as os.system is very limited and can not be stored in a variable.</p>
<p>I tried to plug in subprocess.call in but i keep getting the error: </p>
<pre><code>results = subprocess.call(os.system(str(snmp + r + static_oid + z)), shell=True)

TypeError: 'int' object is not iterable
</code></pre>
<p>Any help would be much appreciated, thanks!</p>
</div>
<div class="post-text" itemprop="text">
<p>erm, you're <em>chaining</em> <code>os.system</code> call with <code>subprocess.call</code> call. This is completely wrong. And the cryptic message root cause is that you're passing the return code of <code>os.system</code> which is an integer, when <code>subprocess.call</code> tries to iterate on the argument.</p>
<p>Switching to <code>subprocess</code> is a great idea because <code>os.system</code> is deprecated and is prone to security issues. That is, if you consider dropping <code>shell=True</code>.</p>
<p>And to drop <code>shell=True</code>, you have to pass a <em>list</em> of arguments, not composing your arg string yourself.</p>
<p>My proposal:</p>
<pre><code>import os
import subprocess
ip_list = ['10.10.10.10','10.10.10.11']
snmp = ["snmpget","-v1","-c","public"]   # list of arguments

outputs = []
for x in ip_list:
     cp = subprocess.run(snmp + [x],check=False)
     outputs.append(cp.stdout.decode())
</code></pre>
<p>this runs your command in a safe, simple way, gets the output and puts each output line in a list of strings (trying to assign the output didn't work either with <code>call</code> or <code>os.system</code> since it returns the <em>exit code</em>, not the program output. 
Since your command can return a nonzero return code you cannot use <a href="https://docs.python.org/3/library/subprocess.html#subprocess.check_output" rel="nofollow noreferrer"><code>check_output</code></a> but you can use <a href="https://docs.python.org/3/library/subprocess.html#subprocess.run" rel="nofollow noreferrer"><code>run</code></a> is what you need (but you need python 3.5, else you'll have to use a <code>Popen</code> solution, described here: <a href="https://stackoverflow.com/questions/4760215/running-shell-command-and-capturing-the-output">Running shell command and capturing the output</a>):</p>
<pre><code> p = subprocess.Popen(snmp + [x])
 result = p.communicate()[0]
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>import os
import subprocess
ip_list = ['10.10.10.10','10.10.10.11']
snmp = ["snmpget","-v1","-c","public"]   # list of arguments</p>
<p>outputs = []
for x in ip_list:
     cp = subprocess.run(snmp + [x],check=False)
     outputs.append(cp.stdout.decode())</p>
</div>
<span class="comment-copy">can you show the subprocess code you've used? also show the value/type of the variables. ATM it's unanswerable.</span>
<span class="comment-copy">woops, sorry. updated with variable examples</span>
<span class="comment-copy">Hi, thanks for the quick reply. When i tried snmp + [x], i am getting the TypeError: cannot concatenate 'str' and 'list' objects. any ideas how i can string up snmp and variable x?</span>
<span class="comment-copy">that's because you didn't change <code>snmp</code> to list. Check my answer again</span>
<span class="comment-copy">i see, my bad. Updated snmp variable to: snmp = ["snmpget -v1 -c public "] as it is one argument but now i get this error.   OSError: [Errno 2] No such file or directory</span>
<span class="comment-copy">check my answer <i>again</i>. Paste from here. you're just putting your string in a list, which isn't correct.</span>
<span class="comment-copy">hmm, i get the error message: subprocess.CalledProcessError: Command '['snmpget', '-v1', '-c', 'public', '10.10.10.10']' returned non-zero exit status 1  again thanks for the support!</span>
