<div class="post-text" itemprop="text">
<p>I want to read a table from a query script in my computer.<br/>
I found the command to be simple: </p>
<pre><code>with open(sql_file, 'r') as opened:
  query = alq.text(opened.read())
</code></pre>
<p>The first issue, has to do with encoding: </p>
<pre><code>UnicodeDecodeError: 'charmap' codec can't decode byte 0x81 
in position 7963: character maps to &lt;undefined&gt;
</code></pre>
<p>So we do what we do, search for an answer to add argument into command <code>open(sql_file, encoding='utf8')</code> and execute the query. </p>
<pre><code>engine.execute(query)
</code></pre>
<p>And now the error is more tricky:</p>
<pre><code>ProgrammingError: (pyodbc.ProgrammingError) ('42000', "[42000] 
[Microsoft][ODBC Driver 11 for SQL Server][SQL Server]
Incorrect syntax near '\ufeff'. (102) (SQLExecDirectW)") 
[SQL: "\ufeffWITH\n-- Some comment about the query\nQC_SCORE AS 
(\n  SELECT some_table.id\n  , other_table.column\n 
</code></pre>
<p>That is to not be reading the file correctly.  Upon inspection I found that there is <code>\ufeff</code> at the beginning of the file and that the line breaks <code>\n</code> are not being translated.  </p>
<p>Does anyone know how to go about it? </p>
</div>
<div class="post-text" itemprop="text">
<p>I had a similar issue while trying to parse an XML file that had special unicode characters.  What I found as a viable workaround was just reading the file as a string, then using the string.replace() method.  Something along this line:</p>
<p>text_query = r"\ufeff + "actual SQL code"
text_query = text_query.replace(r'\ufeff', '').replace(r'\n', '')</p>
</div>
<span class="comment-copy">Can you execute the entire raw query with engine.execute? You have to manually handle the unicode chars like <code>ufeffWITH</code> here</span>
<span class="comment-copy">FEFF at the beginning of a file looks like BOM, or byte order mark. UTF-8 with BOM is a Microsoft bastardisation, since UTF-8 is an 8-bit codec and does not need BOM. Try using the utf-8-sig codec: <a href="https://stackoverflow.com/questions/13590749/reading-unicode-file-data-with-bom-chars-in-python/13591421" title="reading unicode file data with bom chars in python">stackoverflow.com/questions/13590749/…</a>, <a href="https://docs.python.org/3/library/codecs.html#encodings-and-unicode" rel="nofollow noreferrer">docs.python.org/3/library/codecs.html#encodings-and-unicode</a></span>
<span class="comment-copy">¡¡¡Ahhh!!!    Yes. Thanks @IljaEverilä. I spent hours trying to figure it out.</span>
