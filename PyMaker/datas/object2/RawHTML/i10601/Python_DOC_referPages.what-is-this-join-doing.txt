<div class="post-text" itemprop="text">
<p>I just installed retext via pip. I have to download icons for it but I realise it doesn't work (no icons on the menu) unless i run "retext" in the folder of retext.</p>
<p>I tried to fix it but my python skills are not very strong.</p>
<p>At the moment, I force the icon_path to have the path I want.</p>
<pre><code>#icon_path = 'icons/'
icon_path = '/usr/local/lib/python3.5/site-packages/retext/icons/'
</code></pre>
<p>Can someone enlighten me how this line works?</p>
<pre><code>datadirs = [join(d, 'retext') for d in datadirs]
</code></pre>
<p>Thanks.</p>
<pre><code>import sys
import markups
import markups.common
from os.path import dirname, exists, join

from PyQt5.QtCore import QByteArray, QLocale, QSettings, QStandardPaths
from PyQt5.QtGui import QFont

app_version = "6.0.1"

settings = QSettings('ReText project', 'ReText')

if not str(settings.fileName()).endswith('.conf'):
        # We are on Windows probably
        settings = QSettings(QSettings.IniFormat, QSettings.UserScope,
                'ReText project', 'ReText')

datadirs = QStandardPaths.standardLocations(QStandardPaths.GenericDataLocation)
datadirs = [join(d, 'retext') for d in datadirs]

if sys.platform == "win32":
        # Windows compatibility: Add "PythonXXX\share\" path
        datadirs.append(join(dirname(sys.executable), 'share', 'retext'))

if '__file__' in locals():
        datadirs = [dirname(dirname(__file__))] + datadirs

#icon_path = 'icons/'
icon_path = '/usr/local/lib/python3.5/site-packages/retext/icons/'
for dir in datadirs:
        if exists(join(dir, 'icons')):
                icon_path = join(dir, 'icons/')
                break
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>This is <a href="https://docs.python.org/3/library/os.path.html#os.path.join" rel="nofollow noreferrer"><code>os.path.join()</code></a>:</p>
<blockquote>
<p><code>os.path.join(path, *paths)</code></p>
<p>Join one or more path components intelligently. The return value is the concatenation of path and any members of <code>*paths</code> with exactly one directory separator (<code>os.sep</code>) following each non-empty part except the last, meaning that the result will only end in a separator if the last part is empty. If a component is an absolute path, all previous components are thrown away and joining continues from the absolute path component.</p>
</blockquote>
<p>It is imported here:</p>
<pre><code>from os.path import dirname, exists, join
</code></pre>
<p>So, the line in question:</p>
<pre><code>datadirs = [join(d, 'retext') for d in datadirs]
</code></pre>
<p>The <code>[</code>...<code>]</code> is a List Comprehension that builds a list of the results of <code>join(d, 'retext')</code> applied to each directory in the <code>datadirs</code> list.</p>
<p>So, if <code>datadirs</code> contained:</p>
<pre><code>['/usr/local/test', '/usr/local/testing', '/usr/local/tester']
</code></pre>
<p>Then:</p>
<pre><code>[join(d, 'retext') for d in datadirs]
</code></pre>
<p>Would produce:</p>
<pre><code>['/usr/local/test/retext', '/usr/local/testing/retext', '/usr/local/tester/retext']
</code></pre>
<p>The problem with setting:</p>
<pre><code>icon_path = '/usr/local/lib/python3.5/site-packages/retext/icons/'
</code></pre>
<p>Is that it's being overwritten in the <code>for</code> loop, so unless a proper path is not found, it will be overwritten.</p>
</div>
<span class="comment-copy"><code>join</code> comes from your final import statement: <code>from os.path import dirname, exists, join</code>. It is used for combining path segments. Read the official python docs on os.path for more info. <code>datadirs = [join(d, 'retext') for d in datadirs]</code> is a <a href="https://docs.python.org/2/tutorial/datastructures.html#list-comprehensions" rel="nofollow noreferrer">list comprehension</a> that combines every directory path in <code>datadirs</code> with the path segment <code>'retext'</code>. You're essentially getting the retext subfolder of every directory path in <code>datadirs</code>.</span>
