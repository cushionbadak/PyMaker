<div class="post-text" itemprop="text">
<p>Please help me to write simple console application in python. It should redirect all input to system shell (bash or windows cmd or powershell) and give all their output to the screen. 
Simply I can say run terminal from python application.</p>
<p>The next code works with some strange behavior: first 3 times after any key pressed it outputs (executes?) some previous commands (may be from cache)</p>
<pre><code>#!/bin/python3

import subprocess
import sys

proc = subprocess.Popen(['bash'])
while True:
    buff = sys.stdin.readline()
    stdoutdata, stderrdata = proc.communicate(buff)
    if( stdoutdata ):
        print( stdoutdata )
    else:
        print('n')
        break
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>I think you need</p>
<p><code>proc = subprocess.Popen(['bash'], stdout=subprocess.PIPE, stderr=subprocess.PIPE)</code></p>
<p>From the <a href="https://docs.python.org/3/library/subprocess.html#subprocess.Popen" rel="nofollow">docs</a>:</p>
<blockquote>
<p>PIPE indicates that a new pipe to the child should be created.
  DEVNULL indicates that the special file os.devnull will be used. With
  the default settings of None, no redirection will occur; the childâ€™s
  file handles will be inherited from the parent.</p>
</blockquote>
<p>I don't think you want your bash to be connected to your parent process's stdin directly.  That would explain wierdness.</p>
</div>
<span class="comment-copy">That code i wrote after post the question. I understand that questions without code look bare. I had not ideas at the time when had question. @grael, forgive me if that was rude.</span>
<span class="comment-copy">@kyb It's ok, I removed that comment now that you added the code :)</span>
<span class="comment-copy">When I run this script from Windows PowerShell with <code>subprocess.Popen(['cmd])</code> it works fine as expected. Sublime Text when run with <code>Ctrl+B</code> shows black dead console under Linux and under Windows.</span>
<span class="comment-copy">Works with <a href="https://github.com/wuub/SublimeREPL" rel="nofollow noreferrer">SublimeREPL</a> without <code>PIPE</code>s</span>
<span class="comment-copy">I tried. This produce on first input an error: <code>Traceback (most recent call last):   File "./devel/python/terminal/terminal2.py", line 11, in &lt;module&gt;     stdoutdata, stderrdata = proc.communicate(buff)   File "/usr/lib/python3.5/subprocess.py", line 1072, in communicate     stdout, stderr = self._communicate(input, endtime, timeout)   File "/usr/lib/python3.5/subprocess.py", line 1700, in _communicate     input_view = memoryview(self._input) TypeError: memoryview: a bytes-like object is required, not 'str' </code></span>
<span class="comment-copy">Something wierd going on - different results from different environments (it works for me)</span>
