<div class="post-text" itemprop="text">
<p>According to Consumer Surveys docs, the <code>questions[].images[].data</code> field takes a bytes datatype.</p>
<p>I'm using Python 3 for implementation, but the API is giving errors like <code>Invalid ByteString</code> or bytes type <code>is not JSON serializable.</code></p>
<p>I'm using the following code:</p>
<pre><code>    import base64
    import urllib
    url = 'http://example.com/image.png'
    raw_img = urllib.request.urlopen(url).read()

    # is not JSON serializable due to json serializer not being able to serialize raw bytes
    img_data = raw_img

    # next errors: Invalid ByteString, when tried with base64 encoding as followings:
    img_data = base64.b64encode(raw_img)
    # Also tried decoding it to UTF.8 `.decode('utf-8')`
</code></pre>
<p><code>img_data</code> is part of the JSON payload that is being sent to the API.</p>
<p>Am I missing something? what's the correct way to handle image data upload for questions? I looked into <code>https://github.com/google/consumer-surveys/tree/master/python/src</code> but there is not example of this part.</p>
<p>Thanks</p>
</div>
<div class="post-text" itemprop="text">
<p>You need to use web-safe/URL-safe encoding. Here's some documentation on doing this in Python: <a href="https://pymotw.com/2/base64/#url-safe-variations" rel="nofollow">https://pymotw.com/2/base64/#url-safe-variations</a></p>
<p>In your case, this would look like</p>
<pre><code>img_data = base64.urlsafe_b64encode(raw_img)
</code></pre>
<p><strong>ETA:</strong> In Python 3, the API expects the image data to be of type <code>str</code> so it can be JSON serialized, but the <code>base64.urlsafe_b64encode</code> method returns the data in the form of UTF-8 <code>bytes</code>. You can fix this by  converting the bytes to Unicode:</p>
<pre><code>img_data = base64.urlsafe_b64encode(raw_img)
img_data = img_data.decode('utf-8')
</code></pre>
</div>
<span class="comment-copy">Possible duplicate of <a href="http://stackoverflow.com/questions/38575967/what-is-the-correct-format-for-the-api-surveyquestionimage-data-field">What is the correct format for the API SurveyQuestionImage.Data field?</a></span>
<span class="comment-copy">@MaiaWerbos Sure, I just didn't have enough rep to comment there and still had the issue, so I thought about asking myself.</span>
<span class="comment-copy">Thanks Maia, but problem persists, I had tried that also: googleapiclient.errors.HttpError: &lt;HttpError 400 when requesting <a href="https://www.googleapis.com/consumersurveys/v2/surveys?alt=json" rel="nofollow noreferrer">googleapis.com/consumersurveys/v2/surveys?alt=json</a> returned "Invalid value for ByteString:..</span>
<span class="comment-copy">It actually throws a <code>is not JSON serializable</code> error. After decoding it to utf-8 GCS API just throws a Backend error: &lt;HttpError 500 when requesting <a href="https://www.googleapis.com/consumersurveys/v2/surveys?alt=json" rel="nofollow noreferrer">googleapis.com/consumersurveys/v2/surveys?alt=json</a> returned "Backend Error"&gt; without RequestId or further information</span>
<span class="comment-copy">I am using python 3, forgot to mention it in the question.</span>
<span class="comment-copy">Can you make your request without the "?alt=json" parameter?</span>
<span class="comment-copy">I had to modify <code>googleapiclient</code> pypi package to supress the alt param for this test, but it still gives a 500 Backend Error. I also tried quoting the data values: <a href="https://docs.python.org/3/library/urllib.parse.html" rel="nofollow noreferrer">docs.python.org/3/library/urllib.parse.html</a></span>
