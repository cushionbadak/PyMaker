<div class="post-text" itemprop="text">
<p><strong>Hi,
I ran into an encoding error with Python Django.
In my views.py, I have the following:</strong></p>
<pre><code>from django.shortcuts import render
from django.http import HttpResponse
from django.template.loader import get_template
from django.template import Context
# Create your views here.

def hello(request):
    name = 'Mike'
    html = '&lt;html&gt;&lt;body&gt;Hi %s, this seems to have !!!!worked!&lt;/body&gt;&lt;/html&gt;' % name
    return HttpResponse(html)

def hello2(request):
    name = 'Andrew'
    html = '&lt;html&gt;&lt;body&gt;Hi %s, this seems to have !!!!worked!&lt;/body&gt;&lt;/html&gt;' % name
    return HttpResponse(html)

# -*- coding: utf-8 -*-
def hello3_template(request):
    name = u'哈哈'
    t = get_template('hello3.html')
    html = t.render(Context({'name' : name}))
    return HttpResponse(html)
</code></pre>
<p><strong>I got the following error:</strong></p>
<p><h1>SyntaxError at /hello3_template/</h1>
  Non-ASCII character '\xe5' in file D:\WinPython-32bit-2.7.5.3\django_test\article\views.py on line 19, but no encoding declared; see <a href="http://www.python.org/peps/pep-0263.html" rel="noreferrer">http://www.python.org/peps/pep-0263.html</a> for details (views.py, line 19)</p>
<p>I look up that link, but I am still puzzled on how to resolve it.</p>
<p>Could you help?
Thanks,
smallbee</p>
<p><strong>As lalo points out, the following line has to be on the top</strong></p>
<pre><code># -*- coding: utf-8 -*-
</code></pre>
<p><strong>Thank you, all.</strong></p>
</div>
<div class="post-text" itemprop="text">
<p>Well, here you are:</p>
<p>Put <code># -*- coding: utf-8 -*-</code> at top of file, it define de encoding. </p>
<p>The <a href="http://www.python.org/dev/peps/pep-0263/" rel="noreferrer">docs</a> says:</p>
<blockquote>
<p>Python will default to ASCII as standard encoding if no other
      encoding hints are given.</p>
<pre><code>To define a source code encoding, a magic comment must
be placed into the source files either as first or second
line in the file, such as:
</code></pre>
</blockquote>
<p>So, you code must begin:</p>
<pre><code># -*- coding: utf-8 -*-
from django.shortcuts import render
from django.http import HttpResponse
from django.template.loader import get_template
...
</code></pre>
<p>Hope helps</p>
</div>
<div class="post-text" itemprop="text">
<p>If you read <a href="http://www.python.org/dev/peps/pep-0263/" rel="nofollow">PEP 263</a>, it clearly says:</p>
<blockquote>
<p>To define a source code encoding, a magic comment must be placed into the source files either as first or second line in the file…</p>
</blockquote>
<p>(The original proposal said that it had to be the first line after the #!, if any, but presumably it turned out to be easier to implement with the "first or second line" rule.)</p>
<p>The actual reference docs describe the same thing, in a less friendly but more rigorous way, for <a href="http://docs.python.org/3/reference/lexical_analysis.html#encoding-declarations" rel="nofollow">3.3</a> and <a href="http://docs.python.org/2.7/reference/lexical_analysis.html#encoding-declaration" rel="nofollow">2.7</a>.</p>
<p>A "magic comment" that appears later in the file is not magic, it's just a comment to mislead your readers without affecting the Python compiler.</p>
<p>UTF-8 for <code>u'哈哈'</code> is <code>'\xe5\x93\x88\xe5\x93\x88'</code>, so those are the bytes in the file. In recent Python versions (including 2.7 and all 3.x), the default encoding is always ASCII unless the file starts with a UTF BOM (as some Microsoft editors like to do); even in 2.3-2.6 it's usually ASCII; in earlier versions it's Latin-1. Trying to interpret <code>'\xe5\x93\x88\xe5\x93\x88'</code> will fail with the exact exception you saw.</p>
</div>
<span class="comment-copy">shouldn't <code># -*- coding: utf-8 -*-</code> be at top of file?</span>
<span class="comment-copy">Hi lalo, you are right. It works after I put that line on the top. Thank you.</span>
<span class="comment-copy">@lalo: Write that as an answer; if you link to the docs and explain it, that is almost certainly his problem.</span>
<span class="comment-copy">Meanwhile, are you sure the source file was actually saved as UTF-8 text as opposed to, say, Shift-JIS? Because lying to Python (e.g., taking a Shift-JIS file and putting a UTF-8 coding declaration at the head) doesn't make it magically guess what you want. (In this case, I'm 99% sure that isn't relevant, but you should always put that information into questions so we don't have to guess.)</span>
<span class="comment-copy">Not working for me. I get the same error.</span>
<span class="comment-copy">Thank you for pointing that out, abarnert</span>
