<div class="post-text" itemprop="text">
<p>I have this script:</p>
<pre><code>#!/usr/bin/env python
#import needed modules
import telnetlib
import time
#define variables
HOST = "xxxxxx"
user = "xxxxxx"
password = "xxxxxx"
#open telnet connection
tn = telnetlib.Telnet(HOST, 10800)
time.sleep(2)
#check for initial screen and press enter to go to login
tn.read_until("Device")
tn.write("\r\n")
time.sleep(2)
#Wait for username prompt and enter user/pass
try:
  tn.read_until("User Name:",5)
except:
  #Timeout looking for Username prompt
  print "CRITICAL: User Name prompt never arrived"
  exit(2)
tn.write(user + "\r\n")
tn.read_until("Password :")
tn.write(password + "\r\n")
time.sleep(2)
#wait for logout prompt
try:
  tn.read_until("7&lt;Logout               &gt;",5)
except:
  #Timeout looking for successful login
  print "CRITICAL: Did not login successfully"
  exit(2)

#Logout and close connection
tn.write("7\r")
tn.close()

#Exit with success
print "OK: Test login to MWA Succeeded"
exit(0)
</code></pre>
<p>No matter what I do, no exceptions are caught.  I changed the read_until looking for "User Name:" to just some garbage characters and it still just gets to the end of the code.  I'm hoping I'm just doing something very stupid and not an issue with telnetlib.</p>
<p>Thanks!</p>
</div>
<div class="post-text" itemprop="text">
<p><a href="https://docs.python.org/3/library/telnetlib.html#telnetlib.Telnet.read_until" rel="nofollow noreferrer">Per the docs</a>:</p>
<blockquote>
<p>Read until a given string, expected, is encountered or until timeout
  seconds have passed.</p>
<p>When no match is found, return whatever is available instead, possibly
  the empty string. Raise EOFError if the connection is closed and no
  cooked data is available.</p>
</blockquote>
<p>Check the return value in the <code>try</code> block, and if this value does not match your expectations, <code>raise</code> on your own to trigger the <code>except</code> case.</p>
</div>
<span class="comment-copy">Are you certain exceptions are being raised?</span>
<span class="comment-copy">Why do you think an exception should be raised? The documentation says that if a timeout occurs, it returns whatever it has read so far.</span>
<span class="comment-copy">Ok, so it was me not understanding!  I thought it was saying it'd throw an exception if the timeout was hit.  Doing what you said now, thanks!</span>
<span class="comment-copy">yeah it only "dies" if the connection is closed outright (or lack of cookies). Happy to help!</span>
