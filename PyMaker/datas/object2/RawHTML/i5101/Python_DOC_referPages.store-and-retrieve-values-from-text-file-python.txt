<div class="post-text" itemprop="text">
<p>Environment :Unix
Python version : 2.7</p>
<p>I have a scenario where I am fetching some amount of data from an API and then storing it in a text file.
I am running the python script with scheduled cron jobs of interval 30 minutes.
while running it if the value of count is increased by 1 the previous value is changed to recent increased/decreased count if not then it runs same.
what I am trying to implement is if the count is increased on first run it I will store the value temporarily then again on next run after 30 minutes comparison should happen with the previous value not the recent increased/decreased count, and then if the count is still increased/decreased then store it permanently and proceed further.</p>
<p>code</p>
<pre><code>def app_counts():

    while True:
        try:
            url_node = os.popen("ApiURL").read()
            node_data = json.loads(url_node)
        except BaseException as exp:
            continue
        break
    process_num = (node_data[0]["proc"])
    node_count = len(process_num)
    print ("...........................................")
    f_check = file("/home/user/app_check/file.txt",'r')
    f_data = f_check.read()
    chk_data = int(f_data)
############################write increased count to file######################################################
    f1 = open("file.txt", "w")
    n1 = f1.write(str(node_count) + "\n")
    f1.close() #Here I want to store the current increased count temporarily(for example if count is increased/decreased store it temporarily and from next run compare it from previous one still if it is increased then store permanently)

def app_acc():
    comp_n = recent_node_counts()
    f2 = file("/home/user/app_check/file.txt",'r') ## reads last value of count
    r_data = f2.read()
    cmp_n = int(r_data)
    if(comp_n &lt; cmp_n ):

          sys.exit(1) ### fail the build forcefully
    else:
          print ('OK ')
          print 'recent count = ', comp_n
</code></pre>
<p>I am new to python can anybody help to acheive this ,what should I use in order to achieve this.</p>
</div>
<div class="post-text" itemprop="text">
<p>Your json file will look something like this</p>
<pre><code>{
    "latest": 5,
    "history": [1, 2, 3, 4]
}
</code></pre>
<p>Basically, I am storing the recent node counts value as <code>latest</code> and maintaining the <code>history</code> (recent ones get appended at the end of it).</p>
<pre><code>import json


def get_data():
    # read json file data from previous run
    with open("/home/user/app_check/file.txt") as f_check:
        data = json.load(f_check)
    return data


def app_counts():
    ...
    node_count = len(process_num)
    ...
    data = get_data()
    # if value is increased from last, store it permanently
    if data['latest'] &lt; node_count:
        data['history'].append(node_count)
    # update latest temporary count
    data['latest'] = node_count
    # write to json file
    with open("file.txt", "w") as f1:
        json.dump(data, f1)


def app_acc():
    comp_n = recent_node_counts()
    data = get_data()
    if(comp_n &lt; data['latest']):
        sys.exit(1) ### fail the build forcefully
    else:
        print ('OK ')
        print 'recent count = ', comp_n
</code></pre>
</div>
<span class="comment-copy">You could instead write a <a href="https://docs.python.org/3/library/json.html" rel="nofollow noreferrer"><code>json</code></a> object to the file, which will help you to retrieve the appropriate value since you can store an object like <code>{'latest_count': 5, 'previous_count': 4}</code>. For writing to file, you'd need <code>json.dump</code> and for reading you'll need <code>json.load</code></span>
<span class="comment-copy">Thanks , But when should I call that , I am really not getting where to put this , even in txt file also I can do the same ? or JSON will be a better idea  keeping in mind , I don't want to consume much space too</span>
<span class="comment-copy">You basically want to do <code>json.dump</code> instead of <code>file.write</code>, so place it where you have the latter statements. And you shouldn't really worry about space unless you are writing 100s of lines every minute. Anyway space won't matter if your object structure doesn't deviate much from what I suggested in previous comment (unless you use store lists).</span>
<span class="comment-copy">According to my current logic of code, If there is an decrease in number which is read from the text file then the program exits forcefully and if the count is increased it replaces the current value in text file . But here I am trying to implement that even though there is a decrease/increase in count (read from text file) the program should run successfully and wait for the next build to happen and if it is found in next build also that the count is decreased/increased then only there should be some actions taken. I am not sure if counter can be implemented here to track the same.</span>
<span class="comment-copy">@AshishNitinPatil Can you help here please ! I am not sure how to proceed on this again.  Thanks in advance !!</span>
