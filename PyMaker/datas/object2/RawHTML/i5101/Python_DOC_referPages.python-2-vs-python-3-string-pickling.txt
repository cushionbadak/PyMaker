<div class="post-text" itemprop="text">
<p>I'm getting different outputs pickling a string when using Python 2 and Python 3 (due to different <code>str</code> types I suppose).</p>
<p>Python 2:</p>
<pre><code>Python 2.7.12 (default, Dec  4 2017, 14:50:18) 
[GCC 5.4.0 20160609]
&gt;&gt;&gt; import pickle, base64
&gt;&gt;&gt; a = pickle.dumps('test')
&gt;&gt;&gt; base64.b64encode(a)
'Uyd0ZXN0JwpwMAou'
</code></pre>
<p>Python 3:</p>
<pre><code>Python 3.5.2 (default, Nov 23 2017, 16:37:01) 
[GCC 5.4.0 20160609]
&gt;&gt;&gt; import pickle, base64
&gt;&gt;&gt; a = pickle.dumps('test')
&gt;&gt;&gt; base64.b64encode(a)
b'gANYBAAAAHRlc3RxAC4='
</code></pre>
<p>How can I modify the code to get the same results when pickling a string?</p>
<p><strong>EDIT:</strong></p>
<p>When using <code>protocol=2</code> still getting different pickles:</p>
<pre><code># Python 2
&gt;&gt;&gt; base64.b64encode(pickle.dumps('test', protocol=2))
'gAJVBHRlc3RxAC4='

# Python 3
&gt;&gt;&gt; base64.b64encode(pickle.dumps('test', protocol=2))
b'gAJYBAAAAHRlc3RxAC4='
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>Python can use <a href="https://docs.python.org/3/library/pickle.html#data-stream-format" rel="nofollow noreferrer">different stream versions</a> when pickling. Default versions differ between Python 2 and Python 3.</p>
<p>Pass the protocol version explicitly. Use <code>pickle.dumps('test', protocol=2)</code> to get consistent results across versions. </p>
<p><em>Note:</em> The exact output may change, but the unpickling result remains the same, modulo "unicode" vs "ascii" in Python 2:</p>
<pre><code># Python 2.7 output:
&gt;&gt;&gt; base64.b64encode(pickle.dumps('test', protocol=2))
'gAJVBHRlc3RxAC4='
# Decode output from Python 3:
&gt;&gt;&gt; pickle.loads(base64.b64decode('gAJYBAAAAHRlc3RxAC4='))
u'test'

# Python 3.6 output:
&gt;&gt;&gt; base64.b64encode(pickle.dumps('test', protocol=2))
b'gAJYBAAAAHRlc3RxAC4='
# Decoding Python 2's output:
&gt;&gt;&gt; pickle.loads(base64.b64decode('gAJVBHRlc3RxAC4='))
'test'  # Note, not u'test'.
</code></pre>
</div>
<span class="comment-copy">Change <a href="https://docs.python.org/3/library/pickle.html#data-stream-format" rel="nofollow noreferrer">the protocol</a> in your <code>pickle.dumps()</code> call. <a href="https://stackoverflow.com/questions/23582489/python-pickle-protocol-choice">Possibly related question</a></span>
<span class="comment-copy">Try adding <code>protocol=2, fix_imports=True</code> to the dumps statement in version 3</span>
<span class="comment-copy">Do you want identical output, or data compatibility? Either pickled variant works correctly with <code>pickle.loads()</code>, in both Python 2 and Python 3. I suppose something like data padding may differ a little bit, leading to variations in serialization. I suspect the difference is in the unicode vs byte string.</span>
<span class="comment-copy">Added Edit with <code>protocol=2</code> output</span>
