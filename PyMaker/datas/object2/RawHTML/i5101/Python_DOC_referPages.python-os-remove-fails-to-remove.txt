<div class="post-text" itemprop="text">
<p>I want to remove files as follows:</p>
<pre><code>path = "username/hw/01/"
file_list = ["main.cc", "makefile"]
files = os.listdir(path)
del_files = list(set(files) - set(file_list))
for del_file in del_files:
  try:
    os.remove(path + del_file)
  except FileNotFoundError as e:
    print("\t" + e.strerror)
  except OSError as e:
    print("\t" + e.strerror)
</code></pre>
<p>Which is not working. If I try running</p>
<pre><code>....
try:
  os.remove(path + del_file)
  os.remove(path + del_file)
except ...
</code></pre>
<p>the exception fires. However, if checked after with ls or nautilus, for example, the files are still there.</p>
<p>What works is</p>
<pre><code>files = os.listdir(path)
del_files = list(set(files) - set(file_list))
while (del_files):
  for del_file in del_files:
    try:
      os.remove(path + del_file)
      time.sleep(0.5)
      print("\t\tRemoving " + path + del_file)
    except FileNotFoundError as e:
      print("\t" + e.strerror)
    except OSError as e:
      print("\t" + e.strerror)
  files = os.listdir(path)
  del_files = list(set(files) - set(file_list))
</code></pre>
<p>This is incredibly ugly. When print statements are included, it will run more than once to get all of the requested files. What am I missing?</p>
<p>If it matters,</p>
<pre><code>$ python3 --version
Python 3.4.3
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>You might need to use <code>os.remove(os.path.join(path, del_file))</code> instead of <code>os.remove(path + del_file)</code> if path doesn't end with a path separator. Docs: <a href="https://docs.python.org/3/library/os.path.html#os.path.join" rel="nofollow noreferrer" title="Docs">os.path.join()</a></p>
</div>
<span class="comment-copy">You haven't shown us what <code>path</code> is, but it sounds like you're trying to remove <code>folderfile</code> instead of <code>folder/file</code>.</span>
<span class="comment-copy">Are there other threads or processes creating these files as you work? Is <code>file_list</code> being mutated at any point? Is this an NFS file system, or otherwise something non-local with weird behaviors? Is antivirus running?</span>
<span class="comment-copy">A <a href="https://stackoverflow.com/help/mcve">Minimal, Complete, and Verifiable example</a> with the shortest possible code that someone else can use to see the same problem would do a lot of good here. If you don't need <code>time.sleep()</code>, don't sleep. If you don't need <code>os.listdir()</code> to create the problem, don't use it. (If you <i>think</i> you need <code>os.listdir()</code> to create the problem, then your real problem is probably with how you're creating the name, not how you're deleting it, so it's probably time to add some more logging to track down the details).</span>
<span class="comment-copy">@ShadowRanger Good thoughts. No other threads running. Everything is still serial. file_list is constant from the beginning of the script.</span>
<span class="comment-copy">Given that repeated removal works, it seems unlikely this is the cause of the problem.</span>
