<div class="post-text" itemprop="text">
<p>I have a series of city name in pandas dataframe. For that I need to find out the address of particular city and store them at separate column in the same dataframe. City column contain  NaN values too. I am getting address for a given location / city name separately. But it is not working in a pandas dataframe </p>
<pre><code>data = [['madurai',10],['NaN',12],['hosur',13]]
df = pd.DataFrame(data,columns=['Name','Age'])
from geopy.geocoders import Nominatim
geolocator = Nominatim()
for i in df.Name:
    if i == "NaN":
       continue
    loc = geolocator.geocode(i)
address = loc.address
print(address)
</code></pre>
<p>It is working for the data frame but returns the last address alone and not for the  entire 3 cities. If we change the order like below, </p>
<pre><code>data = [['Nan',10],['Madurai',12],['hosur',13]]
df = pd.DataFrame(data,columns=['Name','Age'])
</code></pre>
<p>I am getting the error : GeocoderTimedOut: Service timed out</p>
<p>Query:
 1. I want the results (address) to be saved in a column
 2. How to process Nan values</p>
</div>
<div class="post-text" itemprop="text">
<p>You can add a column with the addresses in this way:</p>
<pre><code>import pandas as pd
data = [['madurai',10],['NaN',12],['hosur',13]]
df = pd.DataFrame(data,columns=['Name','Age'])
from geopy.geocoders import Nominatim
geolocator = Nominatim()
for i in df.Name:
    if i == "NaN":
        continue
    df.loc[df.Name == i, 'Address'] = geolocator.geocode(i)

print(df)
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>You only get the last values because you keep replacing <code>loc</code>each time in the loop.
The <code>GeocoderTimedOut: Service timed out</code> error arises because you are making to many requests to the server. You should include a <code>sleep</code> between the requests. If you still get this error take a look at this: <a href="https://gis.stackexchange.com/questions/173569/avoid-time-out-error-nominatim-geopy-open-street-maps">Link - Avoid time out</a></p>
<p>Try:</p>
<pre><code>import pandas as pd
from geopy.geocoders import Nominatim
import time

data = [['madurai',10],['NaN',12],['hosur',13]]
df = pd.DataFrame(data,columns=['Name','Age'])
geolocator = Nominatim(user_agent='test')
address = []
for i in df.Name:
    time.sleep(3)
    if i == "NaN":
       address.append('NaN')
       continue    
    address.append(geolocator.geocode(i))

df['address'] = address
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>I introduced timedelay between requests as below and few lines to view progress bar </p>
<pre><code>from geopy.geocoders import Nominatim
geolocator = Nominatim()
from geopy.extra.rate_limiter import RateLimiter
geocode = RateLimiter(geolocator.geocode, min_delay_seconds=1)
final['Geolocation'] = final['city'].apply(geocode)
from tqdm import tqdm
tqdm.pandas()
final['Geolocation'] = final['city'].progress_apply(geocode)
</code></pre>
<p>It works now.</p>
</div>
<span class="comment-copy">getting an error : ValueError: setting an array element with a sequence</span>
<span class="comment-copy">The problem is that <code>geolocator.geocode(i)</code> returns a sequence instead of a value. What does <code>print(geolocator.geocode(i))</code> returns? I don't have your data so I cannot reproduce, but if you put a generic string in <code>df.loc[df.Name == i, 'Address'] = 'address_string'</code> the code works as expected, so try to fix that part. Maybe <code>geolocator.geocode(i)[0]</code> is enough...</span>
