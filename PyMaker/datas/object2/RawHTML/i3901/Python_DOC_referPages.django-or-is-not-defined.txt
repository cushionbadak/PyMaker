<div class="post-text" itemprop="text">
<p>I have a query I am making in a django view.py file. I want to use 'or' and 'and' statements in the query. I am getting a message that says 'or_' is not defined and I was wondering what the import statement is for that because I can not find it anywhere.</p>
<p>Here is the query:</p>
<pre><code>@login_required(login_url='/login/')
def user_profile(request, username):
    user = request.user
    view = User.objects.filter(username = username).first()
    view_profile = Profile.objects.filter(user = view).first()
    friends = Friends.objects.filter(or_(
                                        and_(user = user.username, friends = view),
                                        and_(user = view.username, friends = user)
                                    ))
    print(friends)
    parameters = {
        'user':user,
        'view':view,
        'view_profile':view_profile,
        'friends':friends,

    }
    return render(request, 'users/view_profile.html', parameters)
</code></pre>
<p>Here is the error:</p>
<pre><code>Internal Server Error: /assad/
Traceback (most recent call last):
  File "/Users/omarjandali/anaconda3/envs/MySplit/lib/python3.6/site-packages/django/core/handlers/exception.py", line 35, in inner
    response = get_response(request)
  File "/Users/omarjandali/anaconda3/envs/MySplit/lib/python3.6/site-packages/django/core/handlers/base.py", line 128, in _get_response
    response = self.process_exception_by_middleware(e, request)
  File "/Users/omarjandali/anaconda3/envs/MySplit/lib/python3.6/site-packages/django/core/handlers/base.py", line 126, in _get_response
    response = wrapped_callback(request, *callback_args, **callback_kwargs)
  File "/Users/omarjandali/anaconda3/envs/MySplit/lib/python3.6/site-packages/django/contrib/auth/decorators.py", line 21, in _wrapped_view
    return view_func(request, *args, **kwargs)
  File "/Users/omarjandali/Desktop/demo/mysplit/users/views.py", line 174, in user_profile
    friends = Friends.objects.filter(or_(
NameError: name 'or_' is not defined
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>At a guess, the import is likely intended from stdlib <a href="https://docs.python.org/3/library/operator.html" rel="nofollow noreferrer"><code>operator</code></a> module.  But the code is missing the necessary <a href="https://docs.djangoproject.com/en/2.0/ref/models/querysets/#django.db.models.Q" rel="nofollow noreferrer"><code>Q</code> objects</a> to use the operator functions in such a fashion.</p>
<p>This looks more to me like code written by someone who doesn't know how to use Django ORM very well.  Rewrite it like this, no <code>Q</code> nor <code>operator</code> functions are necessary for such a simple query:</p>
<pre><code>friends  = Friends.objects.filter(user=user.username, friends=view) 
friends |= Friends.objects.filter(user=view.username, friends=user)
</code></pre>
</div>
<span class="comment-copy">Did you forget to import it?</span>
<span class="comment-copy">Your query doesn't need to use <code>Or</code> or <code>And</code> at all! anyway, you should import <code>Q</code> from <code>django.db.models</code> to use them</span>
