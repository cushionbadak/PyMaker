<div class="post-text" itemprop="text">
<p>I have a python script where I am extracting values from a dataframe and trying to send them to a batch file. However, the values of the variables are not sent - the batch file is receiving them as variable names. </p>
<p>Assuming all imports are in place.</p>
<pre><code>for i,row in ftp_df.iterrows():
                if row['client_name']==client_name:
                    a_ftp_host=row['ftp_host']
                    a_ftp_user=row['ftp_username']
                    a_ftp_pass=row['ftp_password']
                    print(a_ftp_host)
                    print(a_ftp_user)
                    print(a_ftp_pass)
                    os.system("C:\\Temp\\ftp_test.bat a_ftp_user a_ftp_pass filename")
</code></pre>
<p>the batch file ftp_test.bat is as follows. </p>
<pre><code>Echo "****----****----****"
Echo "Uploading test.txt"
Echo "****----****----****"
Echo %1%
Echo %2%
Echo %3%
user="%1%"
pass="%2%"
file="%file%"

"WinSCP.com" ^
 /log="C:\temp\WinSCP.log" /ini=nul ^
 /command ^
"open sftp://%user%:%pass%@xx.xx.xxx/ -hostkey=""ssh- 
 xxxxxxxxxxxxxxxxxxxxxxxxxx""" ^
"put -nopermissions -nopreservetime %file%" ^
"exit"
</code></pre>
<p>When executing this, it fails with error:
   C:&gt;Searching for host...
   Host does not exist
   No session.
   Host does not exist
   No session.</p>
<p>it looks like the username and password being sent are handles not the values.
 independently, when executing the batch file with hard-coded credentials, it works.</p>
<p>what am i doing wrong?</p>
</div>
<div class="post-text" itemprop="text">
<p>You are passing literal strings of <code>a_ftp_user</code>, <code>a_ftp_pass</code>
and <code>filename</code>.</p>
<p>Examples below will double quote the arguments even if not needed
as I do not know if spaces exist in the arguments.</p>
<p>You can concatenate the variables with the string parts of the command.</p>
<pre><code>os.system('"C:\\Temp\\ftp_test.bat" "' + a_ftp_user + '" "' + a_ftp_pass + '" "' + filename + '"')
</code></pre>
<p>Or, you could format the string to avoid <code>+</code> concatenation and
use <code>{}</code> placeholders instead.</p>
<pre><code>os.system('"C:\\Temp\\ftp_test.bat" "{}" "{}" "{}"'.format(a_ftp_user, a_ftp_pass, filename))
</code></pre>
<p>Or if you are using Python 3.6+, you can use f-strings to replace
variable names in a string with the values. Note the <code>f</code> before the string.</p>
<pre><code>os.system(f'"C:\\Temp\\ftp_test.bat" "a_ftp_user" "a_ftp_pass" "filename"')
</code></pre>
<p>View <a href="https://docs.python.org/3/library/string.html" rel="nofollow noreferrer">string - Common string operations</a> about string formatting.</p>
<p>Finally, your batch syntax require the <code>set</code> to be altered i.e.:</p>
<pre><code>set "user=%~1"
</code></pre>
<p>which gets the 1st argument.</p>
</div>
<span class="comment-copy">Metavariables take the form of <code>%0</code>, <code>%1</code>, <code>%2</code>, <code>%3</code> etc. Local and global variables, take the form <code>%VariableName%</code> or if delayed expansion is enabled, <code>!VariableName!</code>. You need to change your metavariables! When you want to assign a value to a variable, you use the command <code>Set</code>, in the case of your above script you'd use the following syntax, <code>Set "user=%1"</code> and <code>Set "pass=%2"</code>.</span>
<span class="comment-copy">thank you compo for your response. this is in my batch script correct?</span>
<span class="comment-copy">Yes! ...and <code>Set "file=%3"</code>. As a side note, there really is no reason to set them at all, you could just use, <code>%1</code>, <code>%2</code> and <code>%3</code> directly in your <code>winscp</code> command.</span>
<span class="comment-copy">Either options did not work. It is still taking in ftp_a_user as the username and fails with an access denied.</span>
<span class="comment-copy">To start with, I have no idea if or how your passed metavariables are quoted so cannot provide advice on whether you should be using <code>%3</code>, <code>"%~3"</code> or <code>""%~3""</code>. Also I usually expect to see a <code>cd</code> and/or <code>lcd</code> command in there so maybe you need to provide the working directory.</span>
<span class="comment-copy">Thank you @michael_heath -- the username is being passed correctly now. However, there seems to be an issue with the password having special characters. if the password is: H2=tbX7g.  I did re.escape(ftp_pass), but when receiving it, its only passing H2.</span>
<span class="comment-copy">CMD treats <code>=</code> as a separator. You may need to escape it i.e <code>^=</code>. See <a href="http://www.robvanderwoude.com/escapechars.php" rel="nofollow noreferrer">Escape Characters</a> table. <code>re.escape</code> works with <code>re</code> to make a string literal for a <code>re</code> pattern which does not apply here. You could use <code>re</code> and use a set <code>[...]</code> or use str.replace method to escape special characters. Else you could use os.environ to pass the values as environ vars to the batch script which may have less issues. Or use Python instead of CMD to avoid these issues.</span>
