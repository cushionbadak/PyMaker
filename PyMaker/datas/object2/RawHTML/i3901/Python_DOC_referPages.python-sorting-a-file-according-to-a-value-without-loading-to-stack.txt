<div class="post-text" itemprop="text">
<p>as part of my homework. we are suppose to sort a file according to a column, we are not allowed to use list, or load the whole file into the stack, but only 1 line at a time.
we are allowed to create new files and delete them latter</p>
<p>the problem is in the "create" function. what i want to do is take line by line from "source_file" and then put them inside my "self" file, but as i enter them into "self" i want them to be in order.</p>
<p>but for some reason i get weird letters inside the text file...
hope someone can help me, thanks.</p>
<p>this is the function i run</p>
<pre><code>sf = SortedFile('SortedFile.txt', 'currency')
sf.create('kiva.txt')
</code></pre>
<p>this is kiva txt file</p>
<pre><code>lid,loan_amount,currency,sector
653051,300.0,PKR,Food
653053,575.0,PKR,Trns
653068,150.0,INR,Trns
653063,200.0,PKR,Arts
653084,400.0,PKR,Food
653067,200.0,INR,Agri
653078,400.0,PKR,Serv
653082,475.0,PKR,Manu
653048,625.0,PKR,Food
653060,200.0,PKR,Trns
653088,400.0,PKR,Sale
653089,400.0,PKR,Reta
653062,400.0,PKR,Clth
653075,225.0,INR,Agri
653054,300.0,PKR,Trns
653091,400.0,PKR,Reta
653052,875.0,PKR,Serv
653066,250.0,INR,Serv
653080,475.0,PKR,Serv
653065,250.0,PKR,Food
653055,350.0,PKR,Food
653050,575.0,PKR,Clth
653079,350.0,PKR,Arts
653061,250.0,PKR,Food
653074,250.0,INR,Agri
653069,250.0,INR,Cons
653056,475.0,PKR,Trns
653071,125.0,INR,Agri
653073,250.0,INR,Agri
653059,250.0,PKR,Clth
653087,400.0,PKR,Manu
653076,450.0,PKR,Reta
653072,250.0,INR,Agri
653086,400.0,PKR,Food
653058,400.0,PKR,Serv
653083,475.0,PKR,Serv
653057,350.0,PKR,Reta
653090,475.0,PKR,Reta
653064,250.0,PKR,Heal
653077,475.0,PKR,Food
653081,200.0,PKR,Educ
</code></pre>
<p>and this is the code</p>
<pre><code>def __init__(self, file_name, col_name):
    self.name = file_name # create new file
    self.sort = col_name  # get name of col to compare
    f = open(self.name, "w+")  # create the file on pc
    f.close()  # close file
    """
    :param file_name: the name of the sorted file to create. example: kiva_sorted.txt
    :param col_name: the name of the column to sort by. example: 'lid'
    """

# return if heap is empty
def is_empty(self):
    heapfile = open(self.name, "r")  # open file in read mode
    if heapfile.readline() == '':  # if empty
        heapfile.close()  # close and return 0
        return 0
    else:
        heapfile.close()  # close and return 1 if not empty
        return 1
    """
    :return if the heap is empty or not (depanding if size is 0)
    """

# find what column we are in
def findIndex(self, col_name):
    if self.is_empty() == 0:  # check if col doesnt exist
        return -1
    elif col_name == 'lid':
        return 0
    elif col_name == 'loan_amount':
        return 1
    elif col_name == "currency":
        return 2
    elif col_name == "sector":
        return 3

def create(self, source_file):
    f = open(source_file, "r")
    heapfile = open(self.name, "w+")
    i = self.findIndex(self.sort)  # get what column we want to compare
    while True:
        line = f.readline()  # read sourcefile line
        if line == '':  # if line is empty, we are done
            break
        if self.is_empty() == 0: # if file is empty
            heapfile.write(line) # write the 1st line
            line = f.readline() # read next line
        sourceCompare = line.split(',')[i]  # get compare value of source
        for lineSort in heapfile: # now go over new file, and start puting them inside file in order
            if line == '':  # if line is empty, we are done
                heapfile.write(lineSort)
                break
            newFileCompare = lineSort.split(',')[i]  # get compare value of heap
            if newFileCompare &gt; sourceCompare:
                heapfile.write(line)
            # heapfile.write(lineSort)
    f.close()
    heapfile.close()
    """
    The function create sorted file from source file.
    :param source_file: the name of file to create from. example: kiva.txt
    """
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>I think the error is here:</p>
<pre><code>           if newFileCompare &gt; sourceCompare:
            heapfile.write(line)
</code></pre>
<p>You expect line will be <strong>inserted</strong> in the correct position, however it will be always <strong>appended</strong> to the end.</p>
<p>The other problem may be that you don't return to the top of heapfile every time you are going to iterate over it. Use <code>seek(0)</code> to get back to the top of the file if necessary. </p>
</div>
<span class="comment-copy">Are you allowed to use <a href="https://docs.python.org/3/library/mmap.html" rel="nofollow noreferrer"><code>mmap</code></a>? Mind you, it will be loading most of your file to the memory in the background but there is no easy and safe way to edit files in place (check <a href="https://stackoverflow.com/a/49734119/7553525">this answer</a> if you insist) without loading them in memory (directly, or effectively through the system buffer) and without that you'll need to do <code>O(nÂ²)</code> jump/skip operations on the input file which is, arguably, insane to do for such a task.</span>
<span class="comment-copy">we are not allowed to load the file to memory sadly, i know the running time will be long. that's what they asked us to do =\. thanks for that post. il'l read it now since its long. so i guess i need to work with seek and not as i did above...</span>
