<div class="post-text" itemprop="text">
<p>I have a complicated command that I want to run with subprocess. It contains single and double quotes and I want to drop in some variables.</p>
<p>This is the string:</p>
<pre><code>gitlab create_merge_request 5 "{} - New merge request - {}" "{source_branch: '{}', target_branch: 'dev', assignee_id: 1}"  --json
</code></pre>
<p>I want to maintain the quotes around the 'New merge request' section (it contains two variables and around the 'source_branch' variable. The curly braces in the 'source_branch' section are also causing problems.</p>
<p>When I format the string like this:</p>
<pre><code>gitLabCreateMerge = ('/usr/local/bin/gitlab create_merge_request 5 ', str(committerUser), ' requested - Automated Merge Request- ', str(reviewerUser), "'{source_branch:", str(branchName), " target_branch: 'dev', assignee_id: 1}' --json")
</code></pre>
<p>It looks like this:</p>
<pre><code>('/usr/local/bin/gitlab create_merge_request 5 ', 'alice', ' requested - Automated merge request - joe ', "'{source_branch:", 'testdevbranch', " target_branch: 'dev', assignee_id: 1}' --json")
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>With subprocess, you're better off passing a list of strings rather than a string to be evaluated by the shell. This way you don't need to worry about balancing your double quotes (and escaping potentially executable values).</p>
<p>The curly braces can be <a href="https://docs.python.org/3/library/string.html#format-string-syntax" rel="nofollow noreferrer">escaped from string formatting</a> by doubling them.</p>
<p>With those two notes in mind, here's what I might do:</p>
<pre><code>committerUser = 'alice'
reviewerUser = 'joe'
branchName = 'testdevbranch'
cmd = ["gitlab",
    "create_merge_request",
    "5",
    f"{committerUser} - New merge request - {reviewerUser}",
    f"{{source_branch: '{branchName}', target_branch: 'dev', assignee_id: 1}}",
    "--json"]
subprocess.Popen(cmd, â€¦)
</code></pre>
<p>I'm using Python 3.6's <a href="https://docs.python.org/3.6/whatsnew/3.6.html#whatsnew36-pep498" rel="nofollow noreferrer">f-strings</a> here, but it could also be done with the <code>str.format()</code> method</p>
<pre><code>"{} - New merge request - {}".format(committerUser, reviewerUser),
"{{source_branch: '{}', target_branch: 'dev', assignee_id: 1}}".format(branchName),
</code></pre>
<p>Or explicitly by concatenation, which might be more readable than trying to remember what the double curly braces are for.</p>
<pre><code>committerUser + " - New merge request - " + reviewerUser,
"{source_branch: '" + branchName + "', target_branch: 'dev', assignee_id: 1}",
</code></pre>
</div>
<span class="comment-copy">Can you please use more distinctive values than asdfasd, it will make the question easier to read. Write <code>committerUser = 'alice'</code> in the question, for example.</span>
<span class="comment-copy">Fair enough. I've modified the last blob.</span>
<span class="comment-copy">Thanks for the response. I'm getting an error for one of the lines(sorry about the formatting):    f"'{committerUser} - New merge request - {reviewerUser}'",                                                             ^ SyntaxError: invalid syntax</span>
<span class="comment-copy">Subbing out the two f-string lines for your str.format() lines did the trick. Thank you!</span>
