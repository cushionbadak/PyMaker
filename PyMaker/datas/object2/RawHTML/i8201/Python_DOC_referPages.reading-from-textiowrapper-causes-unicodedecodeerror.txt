<div class="post-text" itemprop="text">
<p>I try to read subprocess line by line:</p>
<pre><code>proc = subprocess.Popen(self.monitor_logcat_cmd, shell=True, stdout=subprocess.PIPE,
                        bufsize=1, universal_newlines=True)

while proc.poll() is None:
    line = proc.stdout.readline()
    print("Process line: " + str(line))
</code></pre>
<p>It works, yet at some point I get error:</p>
<pre><code>Exception in thread Thread-14:
Traceback (most recent call last):
  File "/Users/F1sherKK/anaconda3/lib/python3.6/threading.py", line 916, in _bootstrap_inner
    self.run()
  File "/Users/F1sherKK/Dev/Python/AutomationTestSupervisor/session/SessionThreads.py", line 46, in run
    line = proc.stdout.readline()
  File "/Users/F1sherKK/anaconda3/lib/python3.6/codecs.py", line 321, in decode
    (result, consumed) = self._buffer_decode(data, self.errors, final)
UnicodeDecodeError: 'utf-8' codec can't decode byte 0xc0 in position 89: invalid start byte
</code></pre>
<p>Is there any way to add/specify encoding for stdout of subprocess? I would like to add error "ignoring".</p>
<p>Is there any other way to fix this?</p>
</div>
<div class="post-text" itemprop="text">
<p>You <em>could</em> just set the <code>errors</code> keyword argument to <code>Popen()</code> to <code>'ignore'</code>. From the <a href="https://docs.python.org/3/library/subprocess.html#frequently-used-arguments" rel="nofollow noreferrer">documentation</a>:</p>
<blockquote>
<p>If <em>encoding</em> or <em>errors</em> are specified, or <em>universal_newlines</em> is true, the file objects <em>stdin</em>, <em>stdout</em> and <em>stderr</em> will be opened in text mode using the <em>encoding</em> and <em>errors</em> specified in the call or the defaults for <code>io.TextIOWrapper</code>.</p>
</blockquote>
<p>However, it is clear your process doesn't use UTF-8 to encode its output. You may want to figure out if a) it can be configured to produce a different encoding, or b) what encoding is used and configure that instead (using the <code>encoding</code> keyword argument to <code>Popen()</code>).</p>
</div>
<span class="comment-copy">So what bytes does the process produce, switching off <code>universal_newlines</code>? Do you know what encoding the process produces?</span>
<span class="comment-copy">What exactly does <code>monitor_logcat_cmd</code> contain? What command is run in the shell? Are you setting an <code>LANG</code> or <code>LC_CTYPE</code> environment variables?</span>
<span class="comment-copy">monitor_logcat_cmd is <code>adb -s 5554 logcat</code> it is reading log from Android Device in real time. It can consist of various encodings there I guess. For example there can be Emoji in logs. I didn't set any env variables.</span>
<span class="comment-copy">Thanks. I got temporary solution with <code>errors="ignore"</code>. I didn't try this before because PyCharm was giving "Unexpected argument" error when I tried to use that. Yet it works. I think it might be hard to set single encoding for this log. I think it SHOULD be UTF-8 yet there are sometimes single elements which aren't UTF-8. I am not encoding expert but that's how I understand this. In my case I need to save like 20k lines of log from my device, so  if few of them will have "ignored errors" I don't think that will cause me any problems. I fill experiment with various encodings though. Thanks.</span>
