<div class="post-text" itemprop="text">
<p>I am trying to execute a KNN algorithm from scratch, but I am getting a really strange error saying "KeyError: 0"</p>
<p>I assume this implying I have an empty dictionary somewhere, but I don't understand how that can be. I might just add for the sake of clarity that the data works fine in the black box KNN algorithm, so it definitely has to be something in the code...</p>
<p>This is my code:</p>
<pre><code>import numpy as np
import pandas as pd
import csv
import scipy.stats as stats
import math
from collections import Counter
import operator
from operator import itemgetter


"""Training features dataset"""
filenametrain_data = 'training_data.csv'
training_feature_set = pd.read_csv(filenametrain_data, header=None, usecols=range(1,13627))

"""Training labels dataset"""
filenametrain_label = 'training_labels.csv'
training_feature_label = pd.read_csv(filenametrain_label, header=None, usecols=[1], names=['Category'])

"""Split into training and testing datasets 90%/10%"""
from sklearn.cross_validation import train_test_split
X_train, X_test, y_train, y_test = train_test_split(training_feature_set, training_feature_label, test_size = 0.1, random_state=42)


"""KNN Model"""
def distance(X_train, y_train):
    dist = 0.0
    for i in range(len(X_train)):
        dist += pow((X_train[i] - y_train[i]), 2)
    return math.sqrt(dist)

def getNeighbors(X_train, y_train, X_test, k):
    distances = []
    for i in range(len(X_train)):
        dist = distance(X_test, X_train[i])
        distances.append((X_train[i], dist, y_train[i]))
    distances.sort(key=operator.itemgetter(1))
    neighbor = []
    for elem in range(k):
        neighbor.append((distances[elem][0], distances[elem][2]))
    return neighbor

def getResponse(neighbors):
    classVotes = {}
    for x in range(len(neighbors)):
        response = int(neighbors[x][-1])
        if response in classVotes:
            classVotes[response] += 1
        else:
            classVotes[response] = 1
    sortedVotes = sorted(classVotes.items(), key=operator.itemgetter(1), reverse = True)
    return sortedVotes[0][0]

"""Prediction"""    
predictions = []
k = 4
for x in range(len(X_test)):
    neighbors = getNeighbors(X_train, y_train, y_test[x], k)
    result = getResponse(neighbors)
    predictions.append(result)   
</code></pre>
<p>The error returned is:</p>
<blockquote>
<p>Traceback (most recent call last):</p>
<p>File "", line 2, in 
      neighbors = getNeighbors(X_train, y_train, y_test[x], k)</p>
<p>File "C:\ANACONDA\lib\site-packages\pandas\core\frame.py", line
  1797, in <strong>getitem</strong>
      return self._getitem_column(key)</p>
<p>File "C:\ANACONDA\lib\site-packages\pandas\core\frame.py", line
  1804, in _getitem_column
      return self._get_item_cache(key)</p>
<p>File "C:\ANACONDA\lib\site-packages\pandas\core\generic.py", line
  1084, in _get_item_cache
      values = self._data.get(item)</p>
<p>File "C:\ANACONDA\lib\site-packages\pandas\core\internals.py", line
  2851, in get
      loc = self.items.get_loc(item)</p>
<p>File "C:\ANACONDA\lib\site-packages\pandas\core\index.py", line
  1572, in get_loc
      return self._engine.get_loc(_values_from_object(key))</p>
<p>File "pandas\index.pyx", line 134, in
  pandas.index.IndexEngine.get_loc (pandas\index.c:3824)</p>
<p>File "pandas\index.pyx", line 154, in
  pandas.index.IndexEngine.get_loc (pandas\index.c:3704)</p>
<p>File "pandas\hashtable.pyx", line 686, in
  pandas.hashtable.PyObjectHashTable.get_item (pandas\hashtable.c:12280)</p>
<p>File "pandas\hashtable.pyx", line 694, in
  pandas.hashtable.PyObjectHashTable.get_item (pandas\hashtable.c:12231)</p>
<p>KeyError: 0</p>
</blockquote>
<p>The datasets can be accessed <a href="https://www.dropbox.com/sh/686pironeq4bfia/AABAiZyVhQ2dOZ6pf_SDij3Ba?dl=0" rel="nofollow noreferrer">here</a></p>
</div>
<div class="post-text" itemprop="text">
<p>EDIT: You may have an extra character at the beginning of your csv files. Try specifying the encoding in the read_csv() calls. See "encoding" in <a href="http://pandas.pydata.org/pandas-docs/stable/generated/pandas.read_csv.html" rel="nofollow noreferrer">http://pandas.pydata.org/pandas-docs/stable/generated/pandas.read_csv.html</a></p>
<blockquote>
<p>encoding : str, default None Encoding to use for UTF when
  reading/writing (ex. ‘utf-8’). List of Python standard encodings:
  <a href="https://docs.python.org/3/library/codecs.html#standard-encodings" rel="nofollow noreferrer">https://docs.python.org/3/library/codecs.html#standard-encodings</a></p>
</blockquote>
<p>You're using a dot when you don't need a dot (in two places i can see right off the bat):</p>
<pre><code>operator.itemgetter(1)
</code></pre>
<p>You've done an import of itemgetter specifically:</p>
<pre><code>from operator import itemgetter
</code></pre>
<p>So when you call itemgetter, just call it without dot notation:</p>
<pre><code>itemgetter(1)
</code></pre>
</div>
<span class="comment-copy">Ok sure, so you're saying it should be: key=itemgetter(1) instead of key=operator.itemgetter(1)?</span>
<span class="comment-copy">Yep. Both times. And any other time you might have used it that I missed because I am not good at reading.  Any time you import a specific method, attribute, or other object from a module (e.g., from operator import itemgetter), you use that object as if it was created right there in the file you're working on.</span>
<span class="comment-copy">Thanks @<a href="http://stackoverflow.com/users/7936744/dan-hall">stackoverflow.com/users/7936744/dan-hall</a> I made those changes, but still returning the same error so there must be a more serious error somewhere I'm guessing</span>
<span class="comment-copy">I've just done a bit more testing and I'm wondering if it is due to the way I have loaded the data? But it looks ok to me and they all print out...   Could it be a local PC thing as lots of code I am executing is returning the same error? Python 2.7</span>
<span class="comment-copy">Just edited it re: you may have an extra character. Try specifying encoding in your read_csv() calls, e.g.: <code>pd.read_csv(filenametrain_data, header=None, usecols=range(1,13627), encoding="utf-8-sig")</code></span>
