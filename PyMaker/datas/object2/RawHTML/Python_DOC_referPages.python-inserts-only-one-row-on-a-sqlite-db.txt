<div class="post-text" itemprop="text">
<p>Why my code only inserts one line?</p>
<pre><code>thewholeenchilada = ("SELECT SUBSTR(email, (SELECT INSTR(email,'@'))) AS org, SUM(count) as count FROM Em GROUP BY org ORDER BY count DESC")

for salida in cur.execute(thewholeenchilada):
    cur.execute('''INSERT INTO Counts (org, count)
                VALUES (?, ?)''', (salida[0],row[1]))

    print((str(salida[0]), salida[1]))
    conn.commit()
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>Avoid the loop and run one <code>INSERT INTO ... SELECT</code> query. Right now you re-use same cursor outside and inside loop causing issues with processing. Either use two different cursors or efficiently combine and have database engine run action query:</p>
<pre><code>sql = '''INSERT INTO Counts (org, [count])
         SELECT SUBSTR(email, INSTR(email, '@')+1) AS org, 
                SUM(count) as [count]
         FROM Em 
         GROUP BY org 
         ORDER BY count DESC
      '''

cur.execute(sql)
conn.commit()
</code></pre>
</div>
<span class="comment-copy">The one who knows...knows!...Thank you so much</span>
