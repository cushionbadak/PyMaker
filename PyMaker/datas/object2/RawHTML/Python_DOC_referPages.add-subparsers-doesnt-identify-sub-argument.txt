<div class="post-text" itemprop="text">
<p>I'm trying to build a script that uses subparsers arguments. However, I can not pass any of the sub-arguments as a parameter. Resulting in "invalid choice:" for any input combination. </p>
<p>Example input:</p>
<pre><code>python3 preprocess.py -d ../data/acm/ tf -l en
</code></pre>
<p>Complete Output:</p>
<pre><code>usage: preprocess.py [-h] [-k FOLDS] -d DATASETDIR [DATASETDIR ...] {tf} ...
preprocess.py: error: invalid choice: 'en' (choose from 'tf')
</code></pre>
<p>The code is</p>
<pre><code>parser = argparse.ArgumentParser(description='Split input dataset into k folds of cross-validation.')

parser.add_argument('-k', '--folds', default=10, help='Number of folds for K fold cross-validation.', type=int)

required_args = parser.add_argument_group('required arguments')
required_args.add_argument('-d','--datasetdir', type=str, nargs='+', help='Dataset path (For more info: readme.txt)', required=True)

parser_subparsers = parser.add_subparsers(title="Representations", description="Choose the representations")
parser_tf = parser_subparsers.add_parser('tf', help='TF helper')
parser_tf.add_argument('-l', '--language', type=str, help='Language', default='en', choices=['en'])
parser_tf.add_argument('-s', '--stopword', type=bool, help='Skip stopwords', default=True)

args = parser.parse_args()
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>Since <code>--datasetdir</code> has <code>nargs="+"</code> the other argument(s) are being slurped up as additional dataset dir, rather than invoking the subparser.</p>
<p>CLI suggestion: change <code>datasetdir</code> into a plain old positional argument, with ability to separate paths using <code>os.pathsep</code>. It will be difficult to wrangle argparse into what you wanted to do, and using optional arguments with <code>required=True</code> is a code smell in the first place.</p>
<p>New interface will look something like this:</p>
<pre><code>python3 preprocess.py ../data/acm/:/dir2:/dir3 tf -l en
</code></pre>
</div>
