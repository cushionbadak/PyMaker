<div class="post-text" itemprop="text">
<p>After creating the virtual environment, If you have a shell script which calls:</p>
<pre><code>/home/user/venv/python3 &lt;scriptname&gt;
</code></pre>
<p>How does it know where the virtualenv's site-packages folder is without source activating into the virtualenv (thus changing the path)?</p>
</div>
<div class="post-text" itemprop="text">
<p>This magic happens with <a href="https://docs.python.org/3/library/sys.html#sys.prefix" rel="nofollow noreferrer"><code>sys.prefix</code></a>.  </p>
<blockquote>
<p>Note: If a virtual environment is in effect, this value will be changed in <code>site.py</code> to point to the virtual environment. The value for the Python installation will still be available, via <code>base_prefix</code>.</p>
</blockquote>
<p>The <code>site</code> module is imported (from system path!) at interpreter startup, and the <a href="https://github.com/python/cpython/blob/ee566fe526f3d069aa313578ee81ca6cbc25ff52/Lib/site.py#L484-L485" rel="nofollow noreferrer">site-packages dirs are appended to <code>sys.path</code> with the <code>sys.prefix</code></a>.  </p>
<p>You can verify this for yourself by executing the python REPL with the <code>-S</code> flag to disable importing the site module.  You'll find that packages installed in the virtualenv are no longer visible by import statements (assuming they aren't already installed in system site-packages).</p>
<p>Your next question is probably "But how does site itself know if we're in a venv or not?" and the answer is <a href="https://docs.python.org/3/library/venv.html#venv-def" rel="nofollow noreferrer">heuristic</a>:</p>
<blockquote>
<p>A virtual environment is a directory tree which contains Python executable files and other files which indicate that it is a virtual environment.</p>
</blockquote>
<p>If a file named "pyvenv.cfg" exists one directory above <code>sys.executable</code>,
<code>sys.prefix</code> and <code>sys.exec_prefix</code> are set to that directory.  Implemented <a href="https://github.com/python/cpython/blob/ee566fe526f3d069aa313578ee81ca6cbc25ff52/Lib/site.py#L446-L466" rel="nofollow noreferrer">here</a>.</p>
</div>
<div class="post-text" itemprop="text">
<p>Python looks through the values in <code>sys.path</code> for site-packages and these values are automatically set when you execute <code>python3</code> or <code>python</code> by the <code>site</code> package.  Which, is imported during initialization (unless suppressed via the <code>-S</code> flag) </p>
<p>You can refer to the <a href="https://docs.python.org/3.7/library/site.html" rel="nofollow noreferrer"><code>site</code></a> package documentation for more details about how exactly this is done.</p>
</div>
