<div class="post-text" itemprop="text">
<p>I'm writing unit tests in Python and I'd like to create a mock function that returns another mock (specified by me) when called.</p>
<p>Here's what I've tried:</p>
<pre><code>my_mock = Mock()
fn = Mock()
fn.__call__ = Mock()
fn.__call__.return_value = my_mock
</code></pre>
<p>But when I call <code>fn()</code>, it returns a different mock, probably a default of some description.</p>
<p>Any idea what I'm doing wrong? Also, is there a neater way to do this? I'd love to be able to write something like <code>fn = MockFunction(my_mock)</code>.</p>
</div>
<div class="post-text" itemprop="text">
<p>Use the <code>return_value</code> argument:</p>
<pre><code>mock_mock = Mock(return_value=my_mock)
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>From the <a href="https://docs.python.org/3/library/unittest.mock.html#magic-methods" rel="nofollow noreferrer">docs</a>, it's reasonable to expect your code to work. The docs do pretty much the same thing with the <code>__str__</code> method in an example, and it works:</p>
<pre><code>&gt;&gt;&gt; mock = Mock()
&gt;&gt;&gt; mock.__str__ = Mock()
&gt;&gt;&gt; mock.__str__.return_value = 'fooble'
&gt;&gt;&gt; str(mock)
'fooble'
</code></pre>
<p>However, this only works with <em>most</em> magic methods, and the exact list of which it works for is undocumented:</p>
<blockquote>
<p>Because magic methods are looked up differently from normal methods <a href="https://docs.python.org/3/library/unittest.mock.html#id8" rel="nofollow noreferrer">[2]</a>, this support has been specially implemented. This means that only specific magic methods are supported. The supported list includes <em>almost</em> all of them. If there are any missing that you need please let us know.</p>
</blockquote>
<p><code>__call__</code> happens to be one of the magic methods that isn't on the list. Instead, you need to use the <code>return_value</code> attribute of the mock itself, or provide a <code>return_value</code> argument to the constructor.</p>
<pre><code>fn = Mock()
fn.return_value = my_mock

# or

fn = Mock(return_value=my_mock)
</code></pre>
</div>
<span class="comment-copy">Wow, thanks. I spent over an hour trying to figure this out.</span>
<span class="comment-copy">@Pig <a href="https://docs.python.org/3/library/unittest.mock.html#the-mock-class" rel="nofollow noreferrer">docs.python.org/3/library/unittest.mock.html#the-mock-class</a></span>
<span class="comment-copy">Always check the docs first, saves time.</span>
<span class="comment-copy">Oh, I did, but guess I wasn't thorough enough!</span>
<span class="comment-copy">That must have been where my confusion came from, thanks.</span>
