<div class="post-text" itemprop="text">
<div class="question-status question-originals-of-duplicate">
<p>This question already has an answer here:</p>
<ul>
<li>
<a dir="ltr" href="/questions/33994158/how-to-pickle-a-ssl-sslcontext-object">How to pickle a ssl.SSLContext object</a>
<span class="question-originals-answer-count">
                    1 answer
                </span>
</li>
</ul>
</div>
<p>Running Python 3.4.3 on linux.</p>
<pre><code>import pickle
import ssl
context = ssl.SSLContext(ssl.PROTOCOL_TLSv1_2)
pickled = pickle.dumps(context)
unpickled = pickle.loads(pickled)
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in &lt;module&gt;
    unpickled = pickle.loads(pickled)
TypeError: __new__() missing 1 required positional argument: 'protocol'
</code></pre>
<p>I don't do much pickling, so forgive me if this is well know.</p>
<p>I had a bit of a look around the only I found <a href="https://docs.python.org/3/whatsnew/3.4.html#pickle" rel="nofollow">this</a> about <strong>pickle</strong> in the <a href="https://docs.python.org/3/whatsnew/3.4.html#what-s-new-in-python-3-4" rel="nofollow"><em>What's new In Python 3.4</em></a> which suggests this should work. Other than that just issues pickling between different python versions.</p>
<p>I also tried setting <code>pickle.HIGHEST_PROTOCOL</code> but this didn't help either.</p>
<p>(BTW I've already worked around this issue but I'm curious why it does not work.)</p>
</div>
<div class="post-text" itemprop="text">
<p>Classes that take extra arguments to <code>__new__</code> need to <a href="https://docs.python.org/3/library/pickle.html#object.__getnewargs__" rel="nofollow">provide a <code>__getnewargs__</code> method</a> to tell pickle what the extra arguments are.</p>
<p>You can monkey-patch <code>SSLProtocol</code> to add a <code>__getnewargs__</code> method:</p>
<pre><code>ssl.SSLContext.__getnewargs__ = lambda self: (self.protocol,)
</code></pre>
<p>The new feature of pickle in Python 3.4 is that it <a href="https://docs.python.org/3/library/pickle.html#object.__getnewargs_ex__" rel="nofollow">also supports a <code>__getnewargs_ex__</code> method</a> that can supply keyword arguments for <code>__new__</code>; but classes still need to provide <code>__getnewargs__</code> and/or <code>__getnewargs_ex__</code> themselves.</p>
</div>
<span class="comment-copy">You say you've already solved the issue, so why not share the solution? Maybe it could shed some light.</span>
<span class="comment-copy">It does not work because <code>SSLContext</code> currently lacks pickle support.</span>
<span class="comment-copy">The linked change mentioning <code>pickle</code> only says the new protocol now supports "classes whose __new__() method takes <i>keyword-only arguments</i>". The error message says "missing 1 required <i>positional argument</i>". (emphasis mine,)</span>
<span class="comment-copy">@ForceBru, oh I just worked around it by making the ssl context not be part of the object that gets pickled. Looks like this is a pretty well known issue though (and proper solutions exist, I just don't know my pickle)</span>
