<div class="post-text" itemprop="text">
<p>Werkzeug v0.11
I stduy the source code of Werkzeug ,the class ClosingIterator in file wsgi.py,decorted by function  implements_iterator:</p>
<p>wsgi.py</p>
<pre><code>@implements_iterator
class ClosingIterator(object):

    """The WSGI specification requires that all middlewares and gateways
    respect the `close` callback of an iterator.  Because it is useful to add
    another close action to a returned iterator and adding a custom iterator
    is a boring task this class can be used for that::

        return ClosingIterator(app(environ, start_response), [cleanup_session,
                                                              cleanup_locals])

    If there is just one close function it can be passed instead of the list.

    A closing iterator is not needed if the application uses response objects
    and finishes the processing if the response is started::

        try:
            return response(environ, start_response)
        finally:
            cleanup_session()
            cleanup_locals()
    """
</code></pre>
<p>I find the define of implements_iterator in  file _compat.py:</p>
<pre><code>implements_iterator = _identity

_identity = lambda x: x
</code></pre>
<p>the question is :
what is the function of implements_iterator ?</p>
</div>
<div class="post-text" itemprop="text">
<p>Werkzeug targets both Python 2 and Python 3. If you scroll up in <code>compat.py</code>, you can see that <code>implements_iterator</code> is defined for Python 2 as follows:</p>
<pre><code>def implements_iterator(cls):
    cls.next = cls.__next__
    del cls.__next__
    return cls
</code></pre>
<p>This allows a class to implement a <a href="https://docs.python.org/3/library/stdtypes.html#iterator.__next__" rel="nofollow noreferrer"><code>__next__</code></a> method (called just <a href="https://docs.python.org/2/library/stdtypes.html#iterator.next" rel="nofollow noreferrer"><code>next</code></a> in Python 2) and work for both Python 2 and 3 without any modifications.</p>
</div>
