<div class="post-text" itemprop="text">
<p>A file handle in my syntax references a folder which includes a version number in YYYYDDMM format. For example, the <strong>"v20170215"</strong> referenced below:</p>
<pre><code>file handle WORKING/name='ROOT\Uploads\20141001_20150930 v20170215'.
</code></pre>
<p>The version part of the file handle is routinely updated based on new data that needs to be processed. The file handle <em>always</em> ends with a "v" followed by a YYYYMMDD date.</p>
<p>How can I automatically extract the last "YYYYMMDD" string from the file handle (e.g., "20170215") and create a date variable out of it? </p>
<p>If the date were a string variable in the data, I could use something like below:</p>
<pre><code>* Extract data, month, and year.
compute day = number(char.substr(...),F2.0).
compute month = number(char.substr(...),F2.0).
compute year = number(char.substr(...),F4.0).

* Compute date variable.
compute Version = date.mdy(month,day,year).
formats Version (adate10).
execute.
</code></pre>
<p>But given it's a line of <em>syntax</em> I need to parse, I suspect I should look to Python, but I'm stumped how to tackle this.</p>
</div>
<div class="post-text" itemprop="text">
<p>I'll assume you can't get the updated reference as data from the same source that creates the updated syntax (might have been an easier solution).<br/>
Once the handle is defined, you can extract that definition into data this way:</p>
<pre><code>dataset declare  myhandle.
oms/select tables/if commands=['Show'] subtypes=['File Handles']/destination format=SAV outfile='myhandle'.
show handles.
omsend.
dataset activate myhandle.
</code></pre>
<p>This will open a dataset called <code>myhandle</code> in which variable <code>Directory</code> will contain the full path for your file as defined in the handle. From that you have to extract only the string you need - see if this can work for you:</p>
<pre><code>compute Directory=char.substr(Directory,char.index(Directory," v")+2,10).
</code></pre>
<p>Now you have the string you needed, you can continue and turn it into a date and match it into your data.</p>
</div>
<div class="post-text" itemprop="text">
<p>Assuming that the syntax comes from a file that you can open and process with Python, you can split the line on whitespace, grab the date part of the last field using slicing, then feed that into <a href="https://docs.python.org/3/library/datetime.html#datetime.datetime.strptime" rel="nofollow noreferrer"><code>datetime.strptime()</code></a> to parse the string into a <a href="https://docs.python.org/3/library/datetime.html#date-objects" rel="nofollow noreferrer"><code>datetime.date</code></a> object.</p>
<pre><code>&gt;&gt;&gt; from datetime import datetime    
&gt;&gt;&gt; s = r"file handle WORKING/name='ROOT\Uploads\20141001_20150930 v20170215'."
&gt;&gt;&gt; date_string = s.split()[-1][1:-2]
&gt;&gt;&gt; datetime.strptime(date_string, '%Y%m%d').date()
datetime.date(2017, 2, 15)
</code></pre>
</div>
<span class="comment-copy">Where is this "syntax". Is it contained in a file that you can read with a Python script?</span>
<span class="comment-copy">It's contained in the same SPSS syntax file where I need to create the date variable (and then run lots of additional code).</span>
<span class="comment-copy">Works great! After I extracted it as a string, I broke it up into month,day,year parts:  <code>compute month = number(char.substr(Directory,5),F2.0). compute day = number(char.substr(Directory,7),F2.0). compute year = number(char.substr(Directory,1),F4.0).</code>  I then converted these to a date: <code>compute MyDate = date.mdy(month,day,year)</code></span>
