<div class="post-text" itemprop="text">
<p>Python version: 3.7<br/>
OS: Server 2008 r2 - functioning as AD server<br/></p>
<p>I am running a python script to do a <strong>dsquery</strong> lookup via cmd using the following code:</p>
<pre><code>import subprocess
instruction = "dsquery user domainroot -samid 18129"
output = subprocess.run(instruction, stdout=subprocess.PIPE, shell=True)
</code></pre>
<p>Then to get my results I run:</p>
<pre><code>result = str(output.stdout.decode('ISO-8859-1'))
</code></pre>
<p>or</p>
<pre><code>result = str(output.stdout.decode('utf-8'))
</code></pre>
<p>I've tried both. Generally speaking this works beautifully and I have no issue. I usually get a result looking like</p>
<pre><code>"CN=Joe Soap,OU=Students,dc=khs,dc=edu"
</code></pre>
<p>But in the few cases in my network where users have unusual characters in their name like <strong>é</strong> or <strong>ë</strong>, I'm running into errors. Assuming the name Joé Soap</p>
<p>When decoding with UTF-8 I get</p>
<pre><code>"CN=Jo\x82 Soap,OU=Students,dc=khs,dc=edu"
</code></pre>
<p>And with ISO-8859-1 I get</p>
<pre><code>"CN=Jo? Soap,OU=Students,dc=khs,dc=edu"
</code></pre>
<p>Finally if I run the cmd command directly I get the correct response:</p>
<pre><code>"CN=Joé Soap,OU=Students,dc=khs,dc=edu"
</code></pre>
<p>What am I missing here? is there a particular encoding I should use other than the two mentioned above, (I've tried out several others without success) or am I missing something in the process here?</p>
</div>
<div class="post-text" itemprop="text">
<p>this is more of a workaround i think but why not use Popen instead of run?</p>
<pre><code>def start_process(command=''):
     return subprocess.Popen(command.split(' '), stdout=subprocess.PIPE, shell=False, creationflags = 0x08000000)

command = start_process('string that you would normally put in cmd window')

result_string = str(command.communicate()[0])
</code></pre>
<p>it's a little more long winded but in the end it may be easier to use</p>
</div>
<div class="post-text" itemprop="text">
<p>Thanks to the comments by @lit and @vencaslac I've figured out the answer:</p>
<pre><code>result = str(output.stdout.decode('CP437'))
</code></pre>
<p>CP437 is the encoding used by cmd and when applied to my script it successfully returns the <strong>é</strong> or whichever</p>
</div>
<span class="comment-copy">0x82 is the codepoint of <code>LATIN SMALL LETTER E WITH ACUTE</code> in codepage 437, the traditional English DOS codepage. Do you have different output for the same SAMID?</span>
<span class="comment-copy">@lit No - if I repeat the command directly into cmd I get the expected result: <code>"CN=Joé Soap,OU=Students,dc=khs,dc=edu"</code></span>
<span class="comment-copy">The question says that, "I usually get a result looking like..." Does <code>Joe</code> and <code>Joé</code> appear for the same SAMID?</span>
<span class="comment-copy">No, the SAMID refers to a specific user DN, which in this case contains <code>Joé</code></span>
<span class="comment-copy">Let me give it a try, thanks</span>
<span class="comment-copy">This method works in terms of replicating my results. I still get the <code>Jo?</code> or <code>Jo\x82</code> outlined above</span>
<span class="comment-copy">it's possible that you'll need to do a little more digging, i see what you mean better now, check out these encoding docs <code>https://docs.python.org/3/howto/unicode.html</code></span>
