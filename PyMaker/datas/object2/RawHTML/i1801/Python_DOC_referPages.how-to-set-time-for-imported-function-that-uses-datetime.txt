<div class="post-text" itemprop="text">
<p>I'm trying to make a test for this function from my code:</p>
<pre><code>def name_of_file(filepath, url):
    first = url.netloc.replace('www.', '').replace('.com', '')
    second = url.path.split('/')[-1].replace('.html', '')[:40]
    filenamepath = "{}.csv".format(filepath + '/' + first + second + time)
    return filenamepath
</code></pre>
<p>Where <code>time</code> is a string created from <code>datetime.datetime.today()</code>:</p>
<pre><code>now = datetime.today()
sep = "-"
time = str(now.day) + sep + str(now.month) + "_" + str(now.hour) + sep + str(now.minute)
</code></pre>
<p>The problem is I cannot assert equality between the result of <code>name_of_file</code> and a string because everytime my test (using the <code>unittest</code> framework) calls the <code>name_of_file</code> function, the time variable changes so the strings aren't equal.</p>
<p>How can I pass or set up a particular <code>datetime</code> inside my test so when the name_of_file function is called, I can know the final string I'll get (and so pass the test)?</p>
</div>
<div class="post-text" itemprop="text">
<p>The fact that the <code>name_of_file()</code> function is getting the value from a global variable named <code>time</code> in the code is what's making this difficult to solve. You ought to be able to avoid the issue by redefining the function to accept an additional parameter with this value and then passing it to it as an argument whenever it's called.</p>
<p>If you can't change the <code>name_of_file()</code> function and/or how it's used, then the value of the <code>datetime.today</code> function returns could be turned into a constant by using the <a href="https://docs.python.org/3/library/unittest.mock.html#module-unittest.mock" rel="nofollow noreferrer"><code>unittest.mock</code></a> library, as @wowserx suggested in a comment.</p>
</div>
<span class="comment-copy">You can mock the datetime.today function with <code>unittest.mock</code>, so that it always returns a single date.</span>
<span class="comment-copy">The fact that the <code>name_of_file(()</code> function is using a global variable (named <code>time</code>) makes this difficult to solve. Would it be possible to pass the value as an argument to the function? (Also: naming a variable <code>time</code> is considered a poor Python programming practice because it's the same as the built-in <a href="https://docs.python.org/3/library/time.html#module-time" rel="nofollow noreferrer"><code>time</code></a> module.)</span>
<span class="comment-copy">I changed the names of the variables here, from Spanish to English, just to make it more clear what they are supposed to do.</span>
<span class="comment-copy">@martineau you were right. I only had  to move the global variable inside the function. Thanks.</span>
