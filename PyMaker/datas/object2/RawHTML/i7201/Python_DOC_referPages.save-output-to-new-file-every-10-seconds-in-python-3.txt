<div class="post-text" itemprop="text">
<p>I have an output flow from COM-port and I want to save it to files, at that every 10 second new file.</p>
<p>I can read COM-port like this:</p>
<pre><code>import sys
import datetime, threading


for line in sys.stdin:
    print(line)
    my_writing_function(line)
</code></pre>
<p>I need change filename every 10 seconds, so, probably I need something like this:</p>
<pre><code>def filename():
    # if already opened -&gt; close.
    filename='{0:%Y-%m-%d_%H:%M:%S}'.format(datetime.datetime.now())
    fh = open(filename, "a+")   
    threading.Timer(10, filename).start()
</code></pre>
<p>But in this case fh should be global..
May be I need to make some flag and check it before writing?</p>
<p>Thanks.</p>
</div>
<div class="post-text" itemprop="text">
<pre><code>import sys
import logging
import time
import datetime
from logging.handlers import TimedRotatingFileHandler

#----------------------------------------------------------------------
def create_timed_rotating_log(path):
    logger = logging.getLogger("Rotating Log")
    logger.setLevel(logging.INFO)

    handler = TimedRotatingFileHandler(path, when="s", interval=2, backupCount=0)
    logger.addHandler(handler)
    while True:
        try:
            print('WHILE LOOP START')
            for line in sys.stdin:
                logger.info(line)
                # raise Exception
        except Exception as e:
            print(str(datetime.datetime.now().strftime('%Y-%m-%d %H:%M:%S')) + '\n' +str(e))

#----------------------------------------------------------------------
if __name__ == "__main__":
    log_file = "log"
    create_timed_rotating_log(log_file)
</code></pre>
</div>
<span class="comment-copy">If <code>fh</code> should be global then <code>global fh</code> will make it global. What's the reason  that you're not able to use <code>global</code>?</span>
<span class="comment-copy">you could use a <a href="https://docs.python.org/3/library/logging.handlers.html#logging.handlers.TimedRotatingFileHandler" rel="nofollow noreferrer">TimedRotatingFileHandler</a> from logging</span>
<span class="comment-copy">Thank you! Works fine</span>
