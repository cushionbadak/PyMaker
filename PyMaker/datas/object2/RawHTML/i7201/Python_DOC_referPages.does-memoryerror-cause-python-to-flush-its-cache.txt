<div class="post-text" itemprop="text">
<p>I just saw a <code>MemoryError</code> happen on a machine and I noticed the available cache on the server increased drastically after this. Is there some kind of way that Python triggers a memory-management task when the error gets thrown? Or is this potentially managed by the server (Linux / CentOs)?</p>
</div>
<div class="post-text" itemprop="text">
<p><code>MemoryError</code> isn't handled specially in a way that should cause this to occur for it, and no other exception, but:</p>
<ol>
<li>Exceptions do unwind the stack, and objects referenced solely along the stack between the exception being raised and when it is caught will generally be released when the exception handling is complete (during handling, the exception traceback tends to create cyclic references that prevent cleanup from occurring)</li>
<li><code>MemoryError</code> inherits from <code>BaseException</code>, not <code>Exception</code>, so it's less likely to be handled by "generic" <code>except Exception:</code> blocks, meaning more stack layers are unwound and eventually released</li>
<li>The CPython cyclic garbage collector <a href="https://docs.python.org/3/library/gc.html#gc.set_threshold" rel="nofollow noreferrer">determines when to run collections based on the number of allocations and deallocations that have occurred</a>; if the large stack unwind frees a lot of objects, even more might be freed if it's enough to trigger a collection</li>
</ol>
<p>All of this increases the odds that memory will be released, but none of it is specific to <code>MemoryError</code>; the same behavior could be observed if you hit <code>Ctrl-C</code> and triggered a <code>KeyboardInterrupt</code>. More likely, you're seeing Python exit, or Linux is responding to the extreme memory request by dumping its cache; the <code>MemoryError</code> would come <em>after</em> the cache is dumped to try to satisfy the large memory request, particularly if the request is made in several sequential requests for blocks of memory instead of a single huge request.</p>
</div>
<span class="comment-copy">Fantastic explanation, thanks so much!</span>
