<div class="post-text" itemprop="text">
<p>I have an image in memory that I've created (using numpy and PIL), and I'd like to attach it to a created email programatically. I know I could save it to the filesystem, and then reload/attach it, but it seems in-efficient: is there a way to just pipe it to the mime attachment without saving?</p>
<p>The save/reload version:</p>
<pre><code>from PIL import Image
from email.mime.image import MIMEImage
from email.mime.multipart import MIMEMultipart

...some img creation steps...

msg = MIMEMultipart()
img_fname = '/tmp/temp_image.jpg'
img.save( img_fname)
with open( img_fname, 'rb') as fp:
    img_file = MIMEImage( fp.read() )
    img_file.add_header('Content-Disposition', 'attachment', filename=img_fname )
    msg.attach( img_file)

...add other attachments and main body of email text...
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p><a href="https://docs.python.org/3/library/email.mime.html#email.mime.image.MIMEImage" rel="nofollow noreferrer"><code>MIMEImage</code> says</a> that the first argument is just "a string containing the raw image data", so you don't have to <code>open()</code> then <code>.read()</code> it from a file.</p>
<p>If you're making it in PIL and there isn't a way to serialize it directly (there might not be, I can't recall), you can use a <a href="https://docs.python.org/3/library/io.html" rel="nofollow noreferrer"><code>io.StringIO</code></a> (or <code>BytesIO</code>...whichever works with what <code>MIMEImage</code> really wants) file-like buffer to save the file, then read it out as a string. <a href="https://stackoverflow.com/questions/646286/python-pil-how-to-write-png-image-to-string">Related question.</a> Modernized adapted excerpt:</p>
<pre><code>import io
from email.mime.image import MIMEImage

# ... make some image

outbuf = io.StringIO()
image.save(outbuf, format="PNG")
my_mime_image = MIMEImage(outbuf.getvalue())
outbuf.close()
</code></pre>
</div>
<span class="comment-copy">possible duplicate of <a href="http://stackoverflow.com/questions/8547625/converting-pil-image-to-mimeimage">Converting PIL image to MIMEImage</a></span>
