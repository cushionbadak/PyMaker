<div class="post-text" itemprop="text">
<p>Hi I am quite new to python and struggling with creating a for loop within a for loop. I want the bottom 3 lines to loop. Many thanks!  </p>
<pre><code>for restaurant in sorted_list:
    wks_res.append_row([
        restaurant["name"],
        restaurant["rating"],
        restaurant["user_ratings_total"],
        restaurant['reviews'][0]['text'],
        restaurant['reviews'][1]['text'],
        restaurant['reviews'][2]['text'],
])
</code></pre>
<p>The way I tried it is as follows: </p>
<pre><code>for restaurant in sorted_list:
   wks_res.append_row([
       restaurant["name"],
       restaurant["rating"],
       restaurant["user_ratings_total"],
       for reviews in restaurant['reviews']:
          reviews['text'],

])
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>This should work. Watch out for those brackets, they are rearranged on purpose. Check out list comprehension on Internet for more info about this.</p>
<pre><code>for restaurant in sorted_list:
   wks_res.append_row([
       restaurant["name"],
       restaurant["rating"],
       restaurant["user_ratings_total"]] +
       [rev["text"] for rev in restaurant["reviews"]]

)
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>you can't use a for loop inside an expression.</p>
<p>This should works :</p>
<pre><code>for restaurant in sorted_list:
   # create the list to append
   row = [
       restaurant["name"],
       restaurant["rating"],
       restaurant["user_ratings_total"]
   ]
   # expend this list with 'reviews'
   for review in restaurant['reviews']:
          row.append(review['text'])
   # append the list to wks_res
   wks_res.append_row(row)
</code></pre>
<p>alternatively you can use <a href="https://docs.python.org/3/tutorial/datastructures.html#list-comprehensions" rel="nofollow noreferrer">list comprehension</a></p>
<pre><code>row = [
   restaurant["name"],
   restaurant["rating"],
   restaurant["user_ratings_total"]
] + [review['text'] for review in restaurant['reviews']]
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>Thanks! This indeed worked: </p>
<pre><code>for restaurant in sorted_list:
   wks_res.append_row([
      restaurant["name"],
      restaurant["rating"],
      restaurant["user_ratings_total"]] +
      [rev["text"] for rev in restaurant["reviews"]]
</code></pre>
<p>)</p>
</div>
<span class="comment-copy">Does <code>append_row</code> specifically need a <i>list</i>, or can it be an arbitrary iterable?</span>
<span class="comment-copy">I think what you mean is that "you can't use a for loop inside an expression".  Also, note that in Python 3, you can do this: <code>row = [restaurant['name'], restaurant['rating'], restaurant['user_ratings_total'], *[review['text'] for review in restaurant['reviews']]</code>.  I'm not sure it's great from a readability point of view, but it's possible. :-)</span>
<span class="comment-copy">I'd use <code>operator.itemgetter</code> here. Define <code>get_stuff = itemgetter("name", "rating", "user_ratings_total"</code> before the loop, then <code>row = list(get_stuff(restaurant))</code> inside the loop. The nested loop can be replaced with <code>row.extend(r['text'] for r in restaurant['reviews'])</code>.</span>
<span class="comment-copy">If you <i>really</i> want to go crazy, <code>row = list(chain(get_stuff(restaurant), (r['text'] for r in restaurant['reviews'])))</code>. (<code>chain</code> comes from the <code>itertools</code> module.)</span>
