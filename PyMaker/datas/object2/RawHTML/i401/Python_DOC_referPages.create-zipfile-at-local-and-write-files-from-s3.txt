<div class="post-text" itemprop="text">
<p>I am creating a zipfile on my local machine and would like to write files from s3. So far I'm unable to do it. Here's what I have in the mean time.</p>
<pre><code>import os
import zipfile
from fs import open_fs

fs = open_fs(os.getenv('s3_sample_folder'))
file_names = file_names() #list of file names

with zipfile.ZipFile('zipfile.zip', mode='w') as zf:
   for file in file_names:
       with fs.open('/'+file, 'rb') as remote_file:
           content = remote_file.read()
           zf.write(content, basename(content))
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>The <code>ZipFile.write</code> method accepts a file name, not file content. You should use the <code>ZipFile.writestr</code> method instead to write file content to the zip file:</p>
<pre><code>zf.writestr(file, content)
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>Since you are using PyFilesystem, you can open a S3 filesystem and a Zip filesystem, then use <a href="https://docs.pyfilesystem.org/en/latest/reference/copy.html#fs.copy.copy_file" rel="nofollow noreferrer">copy_file</a> to copy between them.</p>
<p>Something like the following should work: </p>
<pre><code>import os
from fs import open_fs
from fs.copy import copy_file

with open_fs(os.getenv('s3_sample_folder')) as s3_fs:
    with open_fs('zip://zipfile.zip', create=True) as zip_fs:
        for filename in file_names():
            copy_file(s3_fs, filename, zip_fs, filename)
</code></pre>
</div>
<span class="comment-copy">Is it possible to use the <code>write</code> method so I can retain the filename?</span>
<span class="comment-copy">The first parameter of <code>writestr</code> is filename. Please refer to the <a href="https://docs.python.org/3/library/zipfile.html#zipfile.ZipFile.writestr" rel="nofollow noreferrer">documentation</a> for details.</span>
<span class="comment-copy">You should not use the <code>write</code> method because it expects an actual file on the disk, and you only have the file content in the memory.</span>
<span class="comment-copy">Will try this. Thank you. I'm overwhelmed by the docs but will read further coming from your answer.</span>
