<div class="post-text" itemprop="text">
<p>I installed the python <a href="https://github.com/zachwill/fred/blob/master/fred/core.py" rel="nofollow">package</a> <code>fred</code>, using <code>pip install fred</code>, to obtain real time data from the FRED / ALFRED API.  </p>
<p>My task now is to match an <em>assessment</em> date to the data -- so to extract values associated with the greatest <code>realtime_date</code> that's less than or equal to what i'm calling the assessment date (<code>aDate</code>).  </p>
<p>The data itself is returned in a python dictionary, which contains lists, with each observation stored in a dictionary along with some meta-data -- each observation dict contains: a reference date (<code>date</code>), the realtime period that the request covered (<code>realtime_end</code>, <code>realtime_start</code>) and the value (<code>value</code>). </p>
<p>I can see how to match the data to an assessment date when there is an exact match, but in the real world these are the exception.  I am looking for help to generalise this to an inequality. </p>
<p>(note below i am using a variable <code>fredKey</code> -- whereas you must supply your own FRED API key to access FRED). </p>
<pre><code>import fred
fred.key(fredKey)
CPIobvs = fred.observations('CPIAUCSL', realtime_start = "1990-01-01")
aDate == "2008-02-15"

for i in range(1, len(CPIobvs['observations']['observation'])):
    if CPIobvs['observations']['observation'][i]['realtime_start'] == aDate:
        print (CPIobvs['observations']['observation'][i]['date'], 
                CPIobvs['observations']['observation'][i]['value']
               )
</code></pre>
<p>For this example, I chose an annual benchmark revision date, to be sure to get something back.  In practice, I am usually going to be updating the simulation on dates where noting happened -- in which case my method returns nothing.  </p>
<p>The solution seems to be to match to the greatest date (a <code>realtime_start</code> value) that's less than or equal to the assessment date (say <code>aDate == "2008-02-14"</code>).  How might i match to the greatest <code>realtime_date</code> that's less than or equal to <code>aDate</code>? </p>
<p>thanks</p>
</div>
<div class="post-text" itemprop="text">
<p>One way would be to identify the candidates by filtering out all items in <code>CPIobvs['observations']['observation']</code> where <code>'realtime_start'</code> <code>&gt;</code> <code>aDate</code>.</p>
<p>I would do this as a <a href="http://docs.python.org/3/reference/expressions.html#generator-expressions" rel="nofollow"><em>generator expression</em></a>:</p>
<pre><code>candidates = (ob for ob in CPIobvs['observations']['observation'] if
    ob['realtime_start'] &lt;= aDate)
</code></pre>
<p>If you want to see the details, you could form a <a href="http://docs.python.org/3/tutorial/datastructures.html#list-comprehensions" rel="nofollow"><em>list comprehension</em></a> in your interpreter:</p>
<pre><code>[ob for ob in CPIobvs['observations']['observation'] if
    ob['realtime_start'] &lt;= aDate]
</code></pre>
<p>Once these candidates are identified, then use the in-built <a href="http://docs.python.org/2/library/functions.html#max" rel="nofollow"><code>max()</code></a> function, providing a lambda for the <code>key</code>, which uses the value of <code>'realtime_start'</code> to sort the candidate <code>dict</code>s:</p>
<pre><code>last_ob = max(candidates, key=lambda ob: ob['realtime_start'])
</code></pre>
<p>The details you require are now in <code>last_ob['date']</code> and <code>last_ob['value']</code>.</p>
</div>
<span class="comment-copy">Might I suggest whatever you do have something like <code>obs = CPIobvs['observations']['observation']</code>  outside the for loop; to save possible typos and readability.</span>
<span class="comment-copy">+1, thanks. I don't fully understand what's going on: i have checked the type of the candidates object, and it's a <code>generator</code> - not fully sure what that is.  The reason i ask is that each element of the list <code>obsList = CPIobvs['observations']['observation']</code> is a <code>dict</code> of the following form: <code>{'date': '2013-01-01', 'realtime_end': '9999-12-31', 'realtime_start': '2013-02-21', 'value': '231.198'}</code>. My aim is to print the <code>obsList['date'], obsList['value']</code> pairs, subject to the condition that it's the largest <code>obsList['realtime_start']</code> date associated with the date.</span>
<span class="comment-copy">i realised that my comment was really another <a href="http://stackoverflow.com/questions/15180767/subset-list-based-on-value-of-dictionary-element">question</a>, so i accepted and posted another. thanks</span>
<span class="comment-copy">@ricardo: I hope my updated answer clarifies the details.</span>
<span class="comment-copy">yes thanks, that helps me more.</span>
