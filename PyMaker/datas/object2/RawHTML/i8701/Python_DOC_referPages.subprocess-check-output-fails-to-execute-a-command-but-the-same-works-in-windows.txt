<div class="post-text" itemprop="text">
<p>I am trying to connect two devices to my pc and run some commands on them using python and adb.
when I run the command from the command prompt, it goes through fine, but when i put those in the python script, they give me errors.
this is causing the errors all the time:</p>
<pre><code>from subprocess import check_output, CalledProcessError
try:
    adb_ouput = check_output(["adb","devices","-l","|", "grep", "\"model\""])
    print adb_ouput
except CalledProcessError as e:
    print e
</code></pre>
<p>The error message I get is this:</p>
<pre><code>Usage: adb devices [-l]
Command '['adb', 'devices', '-l', '|', 'grep', '"model"']' returned non-zero exit status 1
</code></pre>
<p>When I try the same code without the grep command, it works</p>
<pre><code>adb_ouput = check_output(["adb","devices","-l"])
</code></pre>
<p>It gives me the right output.</p>
<p>When I try the same in windows command prompt, It works fine (I am replacing grep with FINDSTR  because i'm using it in windows, and I have tried doing the same in the python script as well, with 'shell = True' and also without.)</p>
<p>eg:</p>
<pre><code>adb devices -l | FINDSTR "model"
</code></pre>
<p>This gives me an ouptut without any problems.
The output I get is </p>
<blockquote>
<p>123ab6ef               device product:xxxxxxxxx model:xxxxxxxxx device:xxxxxxxxx</p>
<p>bd00051a4     device product:yyyyyyyyyy model:yyyyyyyyyy device:yyyyyyyyy</p>
</blockquote>
<p>I am trying to understand where I am going wrong here, but can't figure it out.
So far I have checked the docs: <a href="https://docs.python.org/3/library/subprocess.html" rel="nofollow noreferrer">https://docs.python.org/3/library/subprocess.html</a>
<a href="https://docs.python.org/3/library/subprocess.html#subprocess.CalledProcessError" rel="nofollow noreferrer">https://docs.python.org/3/library/subprocess.html#subprocess.CalledProcessError</a>
These just give me the error codes.</p>
<p>I have also looked at these answers:
<a href="https://stackoverflow.com/questions/27603586/python-adb-and-shell-execution-query">Python, adb and shell execution query</a>
I took some error checking from here and added to my code.</p>
<p><a href="https://stackoverflow.com/questions/28450572/python-subprocess-check-outputargs-fails-while-args-executed-via-windows-comm/28460506#28460506">Python subprocess.check_output(args) fails, while args executed via Windows command line work OK</a>
<a href="https://stackoverflow.com/questions/28675138/python-check-output-fails-with-exit-status-1-but-popen-works-for-same-command">python check_output fails with exit status 1 but Popen works for same command</a></p>
<p>I think i am close but just can't put my finger on it.
Any help would be appreciated.</p>
</div>
<div class="post-text" itemprop="text">
<p>First</p>
<pre><code>adb_ouput = check_output(["adb","devices","-l","|", "grep", "\"model\""])
</code></pre>
<p>certainly requires <code>shell=True</code>, but even with that it's not equivalent to </p>
<pre><code>adb devices -l | FINDSTR "model"
</code></pre>
<p>When using <code>check_output</code>, you're passing <code>"model"</code> as <code>grep</code> argument literally but you should pass just <code>model</code>. <code>"model"</code> is not in your output (with quotes) so <code>grep</code> fails to find it, and returns exitcode <code>1</code> which is not really an error for <code>grep</code> but makes <code>check_output</code> trigger an exception because it expects <code>0</code>.</p>
<p>So I would to this as a quickfix:</p>
<pre><code>adb_ouput = check_output(["adb","devices","-l","|", "grep", "model"],shell=True)
</code></pre>
<p>And as a longfix I'd perform the <code>grep</code> command directly with python.</p>
<pre><code>adb_output = check_output(["adb","devices","-l"])
for l in adb_output.splitlines():
     if "model" in l:
         print(l)
</code></pre>
</div>
<span class="comment-copy">I did try it without the quotes as well, but it fails. I am sticking to filtering my output in python instead of using grep. Thanks for the answer.</span>
<span class="comment-copy">I don't understand why it doesn't work, but the second solution is better anyway. You could even imagine putting that on a machine that doesn't have <code>grep</code>.</span>
