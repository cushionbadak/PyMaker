<div class="post-text" itemprop="text">
<p>Im dealing with the output from the Nmap scripting engine and I'm having trouble with string conversions.</p>
<p>The result from nmap places it in a dictionary, that I convert to a string:</p>
<pre><code>nm = nmap.PortScanner()
sslNmapOutput = nm.scan(hosts='192.168.2.50', arguments='--script ssl-enum-ciphers -p443')

sslOutput = ', '.join("%s=%s" % (key,val) for (key,val) in sslNmapOutput.iteritems())

resultString = re.search("warnings:(.*)SHA1\n", sslOutput)
resultString = result.group(1)
print sslOutput.strip()
</code></pre>
<p>This prints the following:</p>
<pre><code>nmap={'scanstats': {'uphosts': '1', 'timestr': 'Wed Mar 15 17:59:42 2017', 'downhosts': '0', 'totalhosts': '1', 'elapsed': '18.85'}, 'scaninfo': {'tcp': {'services': '443', 'method': 'syn'}}, 'command_line': 'nmap -oX - --script ssl-enum-ciphers -p443
192.168.2.50'}, scan={'192.168.2.50': {'status': {'state': 'up', 'reason': 'reset'}, 'hostnames': [{'type': '', 'name': ''}], 'vendor': {}, 'addresses': {'ipv4': '192.168.2.50'}, 'tcp': {443: {'product': '', 'state': 'open', 'version': '', 'name': 'https', 'conf': '3', 'script': {'ssl-enum-ciphers': '\n  SSLv3: \n    ciphers: \n      TLS_ECDHE_RSA_WITH_RC4_128_SHA (secp256r1) - C\n      TLS_RSA_WITH_RC4_128_SHA (rsa 2048) - C\n      TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA (secp256r1) - A\n      TLS_DHE_RSA_WITH_AES_256_CBC_SHA (dh 2048) - A\n      TLS_RSA_WITH_AES_256_CBC_SHA (rsa 2048) - A\n      TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA (secp256r1) - A\n      TLS_DHE_RSA_WITH_AES_128_CBC_SHA (dh 2048) - A\n      TLS_RSA_WITH_AES_128_CBC_SHA (rsa 2048) - A\n      TLS_ECDHE_RSA_WITH_3DES_EDE_CBC_SHA (secp256r1) - C\n      TLS_DHE_RSA_WITH_3DES_EDE_CBC_SHA (dh 2048) - C\n      TLS_RSA_WITH_3DES_EDE_CBC_SHA (rsa 2048) - C\n    compressors: \n      NULL\n    cipher preference: server\n    warnings: \n      64-bit block cipher 3DES vulnerable to SWEET32 attack\n      Broken cipher RC4 is deprecated by RFC 7465\n      CBC-mode cipher in SSLv3 (CVE-2014-3566)\n      Weak certificate signature: SHA1\n }, 'extrainfo': '', 'reason': 'syn-ack', 'cpe': ''}}}}
</code></pre>
<p><strong>I want to get all the information between <code>warnings:</code> and <code>SHA1\n</code>. However, when I then print the result of the regular expression, I get the following:</strong></p>
<pre><code>\n      64-bit block cipher 3DES vulnerable to SWEET32 attack\n      Broken cipher RC4 is deprecated by RFC 7465\n      CBC-mode cipher in SSLv3 (CVE-2014-3566)\n      Weak certificate signature:
</code></pre>
<p><strong>What I want is for the value to be printed as it would appear with the correct indentation of whitespace and newlines, like the following:</strong></p>
<pre><code>test =  "\n      64-bit block cipher 3DES vulnerable to SWEET32 attack\n      Broken cipher RC4 is deprecated by RFC 7465\n      CBC-mode cipher in SSLv3 (CVE-2014-3566)\n      Weak certificate signature: "
print test.strip()
</code></pre>
<p>Output:</p>
<pre><code>64-bit block cipher 3DES vulnerable to SWEET32 attack
Broken cipher RC4 is deprecated by RFC 7465
CBC-mode cipher in SSLv3 (CVE-2014-3566)
Weak certificate signature:
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>Here's a demo of what's happened:</p>
<pre><code>&gt;&gt;&gt; s = 'a\nb'
&gt;&gt;&gt; print s
a
b
&gt;&gt;&gt; print {'key': s}
{'key': 'a\nb'}
</code></pre>
<p><code>sslNmapOutput</code> is a dictionary with a value deep down in the tree that contains actual newline characters. Calling <code>str</code> (via the <code>%s</code>) on the immediate values which are themselves dictionaries creates a string representation where the newline characters in inner values get replaced by the two characters <code>\n</code>. Don't apply the regex to <code>sslOutput</code>. Rather apply it to the original string contained in <code>sslNmapOutput</code>, which in this case is available as:</p>
<pre><code>sslNmapOutput['scan']['192.168.2.50']['tcp'][443]['script']['ssl-enum-ciphers']
</code></pre>
</div>
<span class="comment-copy">Look at the <a href="https://docs.python.org/3/library/pprint.html" rel="nofollow noreferrer">pprint</a> module.</span>
<span class="comment-copy">Use <code>json.dumps</code> to convert dictionary to string and then use <code>pprint</code>.</span>
<span class="comment-copy">I've tried applying the regex to <code>sslNmapOutput</code> with <code>result = re.search("warnings:(.*)SHA1\n", str(sslNmapOutput))</code>. However, that still comes back with the newline char's when printing. How would I specify, the `['ssl-enum-ciphers'] part of it?</span>
<span class="comment-copy">@Papantonia <code>re.search("warnings:(.*)SHA1\n", sslNmapOutput['scan']['192.168.2.50']['tcp'][443]['script']['ssl-enum-ciphers'])</code>.</span>
