<div class="post-text" itemprop="text">
<p>I'm trying to take what's in the stdin and read it 1022 bytes at a time. This code runs fine for text files. But when inputting a binary file it gives me the UnicodeDecodeError. Where data below is sys.stdin.</p>
<pre><code>def sendStdIn(conn, cipher, data):
    while True:
        chunk = data.read(1022)
        if len(chunk)==1022:
            EOFAndChunk = b'F' + chunk.encode("utf-8")
            conn.send(encryptAndPad(cipher,EOFAndChunk))
        else:
            EOFAndChunk = b'T' + chunk.encode("utf-8")
            conn.send(encryptAndPad(cipher,EOFAndChunk))
            break
    return True
</code></pre>
<p>The binary file was made by calling <code>dd if=/dev/urandom bs=1K iflag=fullblock count=1K &gt; 1MB.bin</code></p>
<p>I run the file with essentially <code>python A3C.py &lt; 1MB.bin</code>
Then I end up with below.</p>
<pre><code>Traceback (most recent call last):
  File "A3C.py", line 163, in &lt;module&gt;
    main()
  File "A3C.py", line 121, in main
    EasyCrypto.sendStdIn(soc, cipher, sys.stdin)
  File "EasyCrypto.py", line 63, in sendStdIn
    chunk = data.read(1022)
  File "/usr/lib64/python3.5/codecs.py", line 321, in decode
    (result, consumed) = self._buffer_decode(data, self.errors, final)
UnicodeDecodeError: 'utf-8' codec can't decode byte 0xe8 in position 0: invalid continuation byte
</code></pre>
<p>Any idea how I can make this so it can read sections of the binary file because I need to send them from this client side to the server side piece at a time. Thanks!</p>
</div>
<div class="post-text" itemprop="text">
<p><code>sys.stdin</code> is a text wrapper that decodes binary data. Use <code>sys.stdin.buffer</code> instead:</p>
<pre><code>EasyCrypto.sendStdIn(soc, cipher, sys.stdin.buffer)
</code></pre>
<p>The <a href="https://docs.python.org/3/library/io.html#io.TextIOBase.buffer" rel="nofollow noreferrer"><code>TextIOBase.buffer</code> attribute</a> points to the binary buffered I/O object underneath.</p>
</div>
<span class="comment-copy">The fix is to code in <code>main()</code>, not in <code>sendStdIn</code>. Good thing you included the full traceback! :-)</span>
<span class="comment-copy">Thank you so much! This worked perfectly. It's been driving me mad.</span>
