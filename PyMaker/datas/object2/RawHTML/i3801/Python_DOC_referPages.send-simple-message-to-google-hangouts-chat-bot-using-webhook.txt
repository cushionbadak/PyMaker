<div class="post-text" itemprop="text">
<p>I've set up a webhook in a chat room in my <a href="https://get.google.com/chat" rel="nofollow noreferrer">Google Hangouts Chat</a>.</p>
<p>I can successfully run their <a href="https://developers.google.com/hangouts/chat/quickstart/incoming-bot-python" rel="nofollow noreferrer">example code</a>, which generates a message from the bot associated with the webhook in the chat:</p>
<pre><code>from httplib2 import Http
from json import dumps

#
# Hangouts Chat incoming webhook quickstart
#
def main():
    url = '&lt;INCOMING-WEBHOOK-URL&gt;'
    bot_message = {
        'text' : 'Hello from Python script!'}

    message_headers = { 'Content-Type': 'application/json; charset=UTF-8'}

    http_obj = Http()

    response = http_obj.request(
        uri=url,
        method='POST',
        headers=message_headers,
        body=dumps(bot_message),
    )

    print(response)

if __name__ == '__main__':
    main()
</code></pre>
<p>However, I wish to send this message using standard library packages, such as <a href="https://docs.python.org/3/library/urllib.html" rel="nofollow noreferrer">urllib</a>.</p>
<p>But when I use <code>urllib</code> and run the below code, I get an <code>urllib.error.HTTPError: HTTP Error 400: Bad Request</code>. Why am I getting this error?</p>
<pre><code>import json
import urllib.parse
import urllib.request


def main():
    # python 3.6

    url = '&lt;INCOMING-WEBHOOK-URL&gt;'
    bot_message = {'text': 'Hello from Python script!'}
    message_headers = {'Content-Type': 'application/json; charset=UTF-8'}

    url_encoded = urllib.parse.urlencode(bot_message)
    byte_encoded = url_encoded.encode('utf-8')
    req = urllib.request.Request(url=url, data=byte_encoded, headers=message_headers)
    response = urllib.request.urlopen(req)
    print(response.read())


if __name__ == '__main__':
    main()
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>The difference is in the body format. In the first version, you dump into json, while in the second you urlencode it.</p>
<p>replace </p>
<pre><code>url_encoded = urllib.parse.urlencode(bot_message)
byte_encoded = url_encoded.encode('utf-8')
</code></pre>
<p>with </p>
<pre><code>byte_encoded = json.dumps(bot_message).encode('utf-8')
</code></pre>
</div>
