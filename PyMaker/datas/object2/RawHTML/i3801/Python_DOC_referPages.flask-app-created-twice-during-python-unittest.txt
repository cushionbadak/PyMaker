<div class="post-text" itemprop="text">
<p>I have an app.py file which creates an flask app</p>
<pre><code>def create_app():
       app = Flask(__name__)
       return app
</code></pre>
<p>I am trying to write an unittest for my module and below is the file</p>
<pre><code>from app import create_app
class TestCase(unittest.TestCase):
    def setUp(self):
        self.app = create_app()
        self.client = self.app.test_client()
        ctx = self.app.app_context()
        ctx.push()

    def test_healthcheck(self):
        res = self.client.get("/")
        self.assertEqual(res.status_code, 200)

    def test_tenant_creation(self):
        res = self.client.post("/tenants")
        self.assertEqual(res.status_code, 200)
</code></pre>
<p>When i run individual test methods it is working fine. But when i run the entire test case , the create app is called again which causes issues since my create app has dependencies which needs to be called only once.</p>
<p>Is it possible to create app only once ?</p>
</div>
<div class="post-text" itemprop="text">
<p><a href="https://docs.python.org/3/library/unittest.html#unittest.TestCase.setUp" rel="nofollow noreferrer">setUp</a> gets called before <em>each</em> test method. Therefore, if you run the whole test case, it will be called twice (one for each test method).</p>
<p>To run something only once for the <code>TestCase</code>, you could try overriding the <code>__init__</code> method (see <a href="https://stackoverflow.com/questions/17353213/init-for-unittest-testcase">this SO question</a>), or <a href="https://docs.python.org/3/library/unittest.html#setupclass-and-teardownclass" rel="nofollow noreferrer">setUpClass or setUpModule</a>. YMMV depending on which python version and test runners you are using.</p>
</div>
<div class="post-text" itemprop="text">
<p>IMO, the problem may related with context. You should create a <code>tearDown()</code> method to destroy the application context you created in <code>setUp()</code>:</p>
<pre><code>class TestCase(unittest.TestCase):
    def setUp(self):
        self.app = create_app()
        self.client = self.app.test_client()
        self.ctx = self.app.app_context()
        self.ctx.push()

    def tearDown(self):
        self.ctx.pop()
</code></pre>
</div>
<span class="comment-copy">Say more about the problematic dependencies. Why only once?</span>
