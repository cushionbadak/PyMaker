<div class="post-text" itemprop="text">
<p>I am looking for a way to replace the SRC attribute in all IMG tags not using Regular expressions. (Would like to use any out-of-the box HTML parser included with default Python install) I need to reduce the source from what ever it may be to:</p>
<pre><code>&lt;img src="cid:imagename"&gt;
</code></pre>
<p>I am trying to replace all src tags to point to the cid of an attachment for an HTML email so I will also need to change whatever the source is so it's simply the file name without the path or extension.</p>
</div>
<div class="post-text" itemprop="text">
<p>There is a HTML parser in the Python standard library, but it’s not very useful and it’s deprecated since Python 2.6. Doing this kind of things with <a href="http://www.crummy.com/software/BeautifulSoup/" rel="noreferrer">BeautifulSoup</a> is really easy:</p>
<pre><code>from BeautifulSoup import BeautifulSoup
from os.path import basename, splitext
soup = BeautifulSoup(my_html_string)
for img in soup.findAll('img'):
    img['src'] = 'cid:' + splitext(basename(img['src']))[0]
my_html_string = str(soup)
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>Here is a pyparsing approach to your problem.  You'll need to do your own code to transform the http src attribute.</p>
<pre><code>from pyparsing import *
import urllib2

imgtag = makeHTMLTags("img")[0]

page = urllib2.urlopen("http://www.yahoo.com")
html = page.read()
page.close()

# print html

def modifySrcRef(tokens):
    ret = "&lt;img"
    for k,i in tokens.items():
        if k in ("startImg","empty"): continue
        if k.lower() == "src":
            # or do whatever with this
            i = i.upper() 
        ret += ' %s="%s"' % (k,i)
    return ret + " /&gt;"

imgtag.setParseAction(modifySrcRef)

print imgtag.transformString(html)
</code></pre>
<p>The  tags convert to:</p>
<pre><code>&lt;img src="HTTP://L.YIMG.COM/A/I/WW/BETA/Y3.GIF" title="Yahoo" height="44" width="232" alt="Yahoo!" /&gt;
&lt;a href="r/xy"&gt;&lt;img src="HTTP://L.YIMG.COM/A/I/WW/TBL/ALLYS.GIF" height="20" width="138" alt="All Yahoo! Services" border="0" /&gt;&lt;/a&gt;
</code></pre>
</div>
<span class="comment-copy">I'll recommend lxml for this, but since you explicitly says it has to be included with Python, it's a comment, not an answer. ;)</span>
<span class="comment-copy">Thanks. I won't rule that out of other solutions and appreciate the suggestion!</span>
<span class="comment-copy">Thanks for this example. I appreciate it greatly!</span>
<span class="comment-copy">the HTMLParser in the stdlib isn't deprecated?  where does that come from?  here's the docs from the python 3 version: <a href="http://docs.python.org/3/library/html.parser.html" rel="nofollow noreferrer">docs.python.org/3/library/html.parser.html</a></span>
<span class="comment-copy">Thanks so much for this. I will try it out. I appreciate your time and help!</span>
