<div class="post-text" itemprop="text">
<p>I am not a pro and I have been scratching my head over understanding what exactly StringIO is used for. I have been looking around the internet for some examples. However, almost all of the examples are very abstract. And they just show "how" to use it. But none of them show "why" and "in which circumstances" one should/will use it?
Thanks in advance</p>
<p>p.s. not to be confused with this question on stackoverflow: <a href="https://stackoverflow.com/questions/4733693/python-stringio-usage">StringIO Usage</a> which compares string and StringIo.</p>
</div>
<div class="post-text" itemprop="text">
<p>It's used when you have some API that only takes files, but you need to use a string. For example, to compress a string using the <a href="http://docs.python.org/library/gzip.html" rel="noreferrer">gzip</a> module in Python 2:</p>
<pre><code>import gzip
import StringIO

stringio = StringIO.StringIO()
gzip_file = gzip.GzipFile(fileobj=stringio, mode='w')
gzip_file.write('Hello World')
gzip_file.close()

stringio.getvalue()
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>StringIO gives you file-like access to strings, so you can use an existing module that deals with a file and change almost nothing and make it work with strings.</p>
<p>For example, say you have a logger that writes things to a file and you want to instead send the log output over the network. You can read the file and write its contents to the network, or you can write the log to a StringIO object and ship it off to its network destination without touching the filesystem. StringIO makes it easy to do it the first way then switch to the second way.</p>
</div>
<div class="post-text" itemprop="text">
<p>In cases where you want a file-like object that ACTS like a file, but is writing to an in-memory string buffer: StringIO is the tool.  If you're building large strings, such as plain-text documents, and doing a lot of string concatenation, you might find it easier to just use StringIO instead of a bunch of <code>mystr += 'more stuff\n'</code> type of operations.</p>
</div>
<div class="post-text" itemprop="text">
<p>I've just used StringIO in practice for two things:</p>
<ul>
<li>To unit-test a script that does a lot of <code>print</code>ing, by redirecting <code>sys.stdout</code> to a <code>StringIO</code> instance for easy analysis;</li>
<li>To create a guaranteed well-formed XML document (a custom API request) using <code>ElementTree</code> and then <code>write</code> it for sending via a HTTP connection.</li>
</ul>
<p>Not that you need <code>StringIO</code> <em>often</em>, but sometimes it's pretty useful.</p>
</div>
<div class="post-text" itemprop="text">
<p>Couple of things I personally have used it for:</p>
<ol>
<li><p>Whole-file caching. I have a script that reads PDFs and does validation of various things about them. The PDF library I'm using takes an open file in its document constructor. I originally just opened the PDF I was interested in reading, however when I changed it to read the entire file at once into memory then pass a StringIO object to the PDF library, the running time of my script was cut in half.</p></li>
<li><p>Deferred printing. Same script prints a header before every PDF it reads. However, I can specify on the command line whether to ignore certain tests that are in its configuration file, or to only include certain ones. If I ignore <em>all</em> tests for a given PDF I don't want the header printed, but I won't know how many tests I ran until I'm done running the tests (the tests can be defined dynamically as well). So I capture the header into a StringIO object by changing <code>sys.stdout</code> to point to it, and each time I run a test I check to see whether that object has anything in it. If so, I print it then and reset it to empty. Voila, only PDFs that have tests have headers printed.</p></li>
</ol>
</div>
<div class="post-text" itemprop="text">
<p>Django has a function <code>call_command</code> which is used to call management commands. This function prints output to stdout and doesn't return any value. If you want to know whether the command ran successfully or not, you have to look into output and decide.</p>
<p>Using StringIO, you can capture output and check if it is desired output or not.</p>
<pre><code>with io.StringIO() as output:
    call_command('custom_command', stdout=output)
    if 'Success' not in output.getvalue():
        print('Custom command failed...')
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>I've used it in place of text files for unit-testing. </p>
<p>For example, to make a csv 'file' for testing with pandas (Python 3):</p>
<pre><code>import io
f = io.StringIO("id,name\n1,brian\n2,amanda\n3,zoey\n")
df = pd.read_csv(f) # pandas takes a file path or a file-like object
</code></pre>
<p>From the documentation <a href="https://docs.python.org/3/library/io.html#io.StringIO" rel="nofollow noreferrer">here</a>:</p>
<blockquote>
<p>An in-memory stream for text I/O. The text buffer is discarded when the close() method is called.</p>
<p>The initial value of the buffer can be set by providing initial_value.</p>
<p>method getvalue(): Return a str containing the entire contents of the buffer. </p>
</blockquote>
</div>
<span class="comment-copy">in other words: <code>duck typing</code> :D</span>
<span class="comment-copy">Since Python 3.2, the gzip module has functions compress data directly. (But any well-known open-source library that currently needs StringIO will probably grow such functions after some time, so rather than search for a new example I'll leave gzip here.)</span>
<span class="comment-copy">I've also found <code>StringIO</code> to be considerably faster if you are dealing with multiple megabytes of character-data when compared to expressions like <code>mystr += "more stuff\n"</code> within a loop, especially if you can use <code>cStringIO.StringIO</code> instead of just <code>io.StringIO</code>.</span>
