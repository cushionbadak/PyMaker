<div class="post-text" itemprop="text">
<p>How can I in python (3) create a file what others users can write as well.
I've so far this but it changes the </p>
<pre><code>os.chmod("/home/pi/test/relaxbank1.txt", 777)
with open("/home/pi/test/relaxbank1.txt", "w") as fh:
    fh.write(p1)  
</code></pre>
<p>what I get </p>
<blockquote>
<p>---sr-S--t  1 root root    12 Apr 20 13:21 relaxbank1.txt</p>
</blockquote>
<p>expected (after doing in commandline $ sudo chmod 777 relaxbank1.txt
)</p>
<blockquote>
<p>-rwxrwxrwx  1 root root    12 Apr 20 13:21 relaxbank1.txt</p>
</blockquote>
</div>
<div class="post-text" itemprop="text">
<p>The problem is your call to <code>open()</code> recreates the call. Either you need to move the <code>chmod()</code> to after you close the file, OR change the file mode to <code>w+</code>.</p>
<p>Option1:</p>
<pre><code>with open("/home/pi/test/relaxbank1.txt", "w+") as fh:
    fh.write(p1)
os.chmod("/home/pi/test/relaxbank1.txt", 0o777)
</code></pre>
<p>Option2:</p>
<pre><code>os.chmod("/home/pi/test/relaxbank1.txt", 0o777)
with open("/home/pi/test/relaxbank1.txt", "w+") as fh:
    fh.write(p1)
</code></pre>
<p>Comment: Option1 is slightly better as it handles the condition where the file may not already exist (in which case the <code>os.chmod()</code> will throw an exception).</p>
</div>
<div class="post-text" itemprop="text">
<p>If you don't want to use <code>os.chmod</code> and prefer to have the file created with appropriate permissions, then you may use <a href="https://docs.python.org/3/library/os.html#os.open" rel="nofollow noreferrer"><code>os.open</code></a> to create the appropriate file descriptor and then <code>open</code> the descriptor:</p>
<pre><code>import os
# The default umask is 0o22 which turns off write permission of group and others
os.umask(0)
with open(os.open('filepath', os.O_CREAT | os.O_WRONLY, 0o777), 'w') as fh:
  fh.write(...)
</code></pre>
<p><strong>Python 2 Note:</strong></p>
<p>The built-in <a href="https://docs.python.org/2/library/functions.html#open" rel="nofollow noreferrer">open()</a> in Python 2.x doesn't support opening by file descriptor. Use <a href="https://docs.python.org/2/library/os.html#os.fdopen" rel="nofollow noreferrer"><code>os.fdopen</code></a> instead; otherwise you'll get:</p>
<pre><code>TypeError: coercing to Unicode: need string or buffer, int found.
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>This is a robust method</p>
<pre><code>#!/usr/bin/env python3
import stat
import os
path = 'outfile.txt'
with open(path, 'w') as fh:
    fh.write('blabla\n')
st = os.stat(path)
os.chmod(path, st.st_mode | stat.S_IWOTH)
</code></pre>
<p>See how:</p>
<ul>
<li><code>stat.S_IWOTH</code> is used instead of the raw binary constant, which is more semantic</li>
<li>we add just a single <code>+o</code> to the file, and use the <code>umask</code> by default, see also: <a href="https://stackoverflow.com/questions/12791997/how-do-you-do-a-simple-chmod-x-from-within-python">How do you do a simple "chmod +x" from within python?</a></li>
</ul>
<p>See also: <a href="https://stackoverflow.com/questions/5624359/write-file-with-specific-permissions-in-python/15015748">Write file with specific permissions in Python</a></p>
</div>
<span class="comment-copy">What happens if you put the <code>chmod</code> after the <code>with</code> block?</span>
<span class="comment-copy">The permission number is octal, try <code>0777</code>!</span>
<span class="comment-copy">os.chmod("/home/pi/test/relaxbank1.txt", 0777)                                                                   ^ SyntaxError: invalid token   0777 gives an error</span>
<span class="comment-copy">Klaus D. still lives in the last century. The correct synthax is 0o777. But you could also write 511, 0x1ff or 0b111111111, as all these literals resolve to the same integer. An integer object is the pure representation of a value, having no special format as long as you don't write it.</span>
<span class="comment-copy">The suggested  "0777"  gives an error:      os.chmod("/home/pi/test richard/relaxbank1.txt",0777)    Error message: SyntaxError: invalid token    However "777" don't give an error but change the permission in -r----x--t  1 root root    12 Apr 20 15:37 relaxbank1.txt                                                          ^</span>
<span class="comment-copy">My bad -- correct octal notation is <code>0o777</code> (zero, letter 'o', 777)</span>
<span class="comment-copy">what does the <code>0o</code> in the <code>0o777</code> do/mean?</span>
<span class="comment-copy">ah, I see,  for those who are wondering about the leading  <code>0o</code> in the <code>0o777</code>  it is to make the number octal see <a href="https://stackoverflow.com/questions/15607903/python-module-os-chmodfile-664-does-not-change-the-permission-to-rw-rw-r-bu">this post</a></span>
<span class="comment-copy">This is a better approach than the accepted answer. When you need to create a file with more restrictive permissions than the default umask, updating permissions after the file is created is a security bug.</span>
<span class="comment-copy">ERROR: "TypeError: coercing to Unicode: need string or buffer, int found"</span>
<span class="comment-copy">Peter Krauss: That's a python2 issue. Answer updated. Thanks to @alexdelisle for suggesting the fix.</span>
