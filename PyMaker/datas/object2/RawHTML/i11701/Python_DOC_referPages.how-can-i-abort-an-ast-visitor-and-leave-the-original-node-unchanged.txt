<div class="post-text" itemprop="text">
<p>Using the <code>ast</code> and <code>astor</code> libraries, I've written a simple script that traverses an AST using <code>ast.NodeTransformer</code> and replaces all empty lists with <code>None</code>:</p>
<pre><code>import ast
import astor


class ListChanger(ast.NodeTransformer):
    def visit_List(self, node):
        if len(node.elts) &gt; 0:
            return ast.copy_location(node, node)
        return ast.copy_location(ast.NameConstant(value=None), node)

x = ast.parse("""["A"]""")
ListChanger().visit(x)
print(astor.to_source(x))

y = ast.parse("""[]""")
ListChanger().visit(y)
print(astor.to_source(y))
</code></pre>
<p>This works correctly, and outputs:</p>
<pre><code>["A"]
None
</code></pre>
<p>However, I'm unsure of the line that I've used to pull out of the function if the list is empty:</p>
<pre><code>return ast.copy_location(node, none)
</code></pre>
<p>If I replace this with <code>return</code>, making the script return <code>None</code> if the condition is not met, the node is destroyed rather than being left unchanged, making the first test case print a blank string because the <code>ast.List</code> node has been destroyed.</p>
<p>I don't want this to happen, but I also think that using <code>ast.copy_location(node, node)</code> seems wrong. Is there a dedicated function to leave the node unchanged and exit the function, or a way to configure <code>ast.NodeTransformer</code> so that, if a <code>visit</code> function returns <code>None</code>, the node remains unchanged?</p>
</div>
<div class="post-text" itemprop="text">
<p>From the <a href="https://docs.python.org/3/library/ast.html#ast.NodeTransformer" rel="nofollow">documentation</a>:</p>
<blockquote>
<p>The return value may be the original node in which case no replacement takes place.</p>
</blockquote>
<p>So instead of:</p>
<pre><code>return ast.copy_location(node, none)
</code></pre>
<p>just:</p>
<pre><code>return node
</code></pre>
</div>
<span class="comment-copy">Brilliant - didn't think to look in the docs. Thank you!</span>
