<div class="post-text" itemprop="text">
<p>I have a little server running on my Raspberry Pi which listens at a specific port. However, whenever an exception occurs during a connection and the connection is terminated, it seems that the assignment to the port is not "unbound".</p>
<p>This is an example code:</p>
<pre><code>import socket

with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:
    s.bind(('', 5005))
    s.listen(1)
    with s.accept()[0] as c:
        raise Exception() # Act as if anything goes wrong
</code></pre>
<p>When I run it for the first time and do a <code>telnet localhost 5005</code> on another terminal, the connection is made and the server raises the Exception as expected.
However, when I try to run it for a second time, I get this error:</p>
<pre><code>Traceback (most recent call last):
  File "testsocketexception.py", line 4, in &lt;module&gt;
    s.bind(('', 5005))
OSError: [Errno 98] Address already in use
</code></pre>
<p>How can I make sure that the socket is unbound even if an exception is raised on the server?
(By the way, this doesn't seem to happen in Windows.)</p>
</div>
<div class="post-text" itemprop="text">
<p>Set <code>SO_REUSEADDR</code> socket option before binding the socket.</p>
<blockquote>
<p>the <code>SO_REUSEADDR</code> flag tells the kernel to reuse a local socket in
  <code>TIME_WAIT</code> state, without waiting for its natural timeout to expire.</p>
<p><a href="https://docs.python.org/3/library/socket.html" rel="nofollow">from <code>socket</code> documentation</a></p>
</blockquote>
<hr/>
<pre><code>with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:
    s.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)
    s.bind(('', 5005))
    ...
</code></pre>
<p>NOTE: You will get an error even if you apply this, if there's <code>TIME_WAIT</code> socket is remained from the previous run (without the <code>SO_REUSEADDR</code> option).</p>
</div>
<span class="comment-copy">Yes, it's working now, thank you!</span>
