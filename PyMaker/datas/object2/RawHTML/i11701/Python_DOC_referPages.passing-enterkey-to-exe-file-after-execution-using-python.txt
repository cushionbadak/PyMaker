<div class="post-text" itemprop="text">
<p>I need to run a external exe file inside a python script. I need two things out of this. </p>
<ol>
<li>Get whatever the exe outputs to the stdout (stderr). </li>
<li>exe stops executing only after I press the enter Key. I can't change this behavior. I need the script the pass the enter Key input after it gets the output from the previous step.</li>
</ol>
<p>This is what I have done so far and I am not sure how to go after this.</p>
<pre><code>import subprocess

first = subprocess.Popen(["myexe.exe"],shell=True,stdout=subprocess.PIPE)
</code></pre>
</div>
<div class="post-text" itemprop="text">
<pre><code>from subprocess import Popen, PIPE, STDOUT
first = Popen(['myexe.exe'], stdout=PIPE, stderr=STDOUT, stdin=PIPE) 
while first.poll() is None:
    data = first.stdout.read()
    if b'press enter to' in data:
        first.stdin.write(b'\n')
first.stdin.close()
first.stdout.close()
</code></pre>
<p>This pipes <code>stdin</code> as well, do <strong>not</strong> forget to close your open file handles (stdin and stdout are also file handles in a sense). </p>
<p>Also avoid <code>shell=True</code> if at all possible, I use it a lot my self but <a href="https://security.openstack.org/guidelines/dg_avoid-shell-true.html" rel="nofollow noreferrer">best practices say you shouldn't</a>. </p>
<p>I assumed python 3 here and <code>stdin</code> and <code>stdout</code> assumes bytes data as input and output.</p>
<p><code>first.poll()</code> will poll for a exit code of your exe, if none is given it means it's still running. </p>
<h2>Some other tips</h2>
<p>one tedious thing to do can be to pass arguments to Popen, one neat thing to do is:</p>
<pre><code>import shlex
Popen(shlex.split(cmd_str), shell=False) 
</code></pre>
<p>It preserves space separated inputs with quotes around them, for instance <code>python myscript.py debug "pass this parameter somewhere"</code> would result in three parameters from <code>sys.argv</code>, <code>['myscript.py', 'debug', 'pass this parameter somewhere']</code> - might be useful in the future when working with <code>Popen</code></p>
<p>Another thing that would be good is to check if there's output in <code>stdout</code> before reading from it, otherwise it might hang the application. To do this you could use <a href="https://docs.python.org/3/library/select.html" rel="nofollow noreferrer">select</a>.<br/>
Or you could use <a href="http://pexpect.readthedocs.org/en/stable/" rel="nofollow noreferrer">pexpect</a> which is often used with SSH since it lives in another user space than your application when it asks for input, you need to either fork your exe manually and read from that specific pid with <code>os.read()</code> or use <code>pexpect</code>. </p>
</div>
