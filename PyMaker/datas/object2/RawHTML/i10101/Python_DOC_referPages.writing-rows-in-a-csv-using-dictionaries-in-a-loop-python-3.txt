<div class="post-text" itemprop="text">
<p>I´m writing on a csv file by adding each row in a loop and using dictionaries. The following is the code:</p>
<pre><code>fieldnames = ['id', 'variable1', 'variable2']
f = open('file.csv', 'w')   
my_writer = csv.DictWriter(f, fieldnames)
my_writer.writeheader()
f.close()   

for i in something:

    something where I get data for mydict      

    with open('file.csv', 'a+b') as f:
    header = next(csv.reader(f))
    dict_writer = csv.DictWriter(f, header)
    dict_writer.writerow(mydict)
</code></pre>
<p>I was sure this code worked for me some years ago but probably I was using python2. Now I´m using python 3 and it shows the following error:</p>
<pre><code>header = next(csv.reader(f))

StopIteration
</code></pre>
<p>What may be the problem? Thanks</p>
</div>
<div class="post-text" itemprop="text">
<p>My solution was:</p>
<pre><code>fieldnames = ['id', 'variable1', 'variable2']

f= open('file.csv', 'w', newline='')
my_writer = csv.DictWriter(f, fieldnames)
my_writer.writeheader()

for i in something:

   something where I get data for mydict   

    writer.writerow(mydict)

f.close()
</code></pre>
</div>
<span class="comment-copy">Aside: since you're using Python 3, you shouldn't be using binary mode for files.  See (e.g.) <a href="https://docs.python.org/3/library/csv.html#csv.reader" rel="nofollow noreferrer">here</a>.</span>
<span class="comment-copy">Why are you constantly reopening/rewrapping the file instead of creating it once and using it over and over? The header shouldn't be changing for every line. Even if it was, just rewrapping would make more sense than reopening for append over and over.</span>
<span class="comment-copy">Here the design makes even less sense. Your fieldnames never change; open the file <i>once</i>, wrap it in <code>DictWriter</code> <i>once</i>, then do all your processing. It's going to be much more efficient that repeatedly opening and closing files and repeatedly wrapping them in a fresh <code>DictWriter</code>. Just have a <code>with</code> block that covers all of the writing, and when the loop finishes, it's closed once automatically.</span>
<span class="comment-copy">Within the same loop I´m also creating another separate csv file, would there be a problem if I open once and do all the processing?</span>
<span class="comment-copy">You can have multiple files open at the same time. Only problem would be if you had two file handles open to write the same file (possibly one open for read and one for write would also cause problems, depending on use pattern). But it's totally fine to have two different files open at once.</span>
<span class="comment-copy">Thank you, I edited my answer. Is this what you suggested?</span>
<span class="comment-copy">Aside from not using a <code>with</code> statement to avoid the risk of bypassing the <code>close</code> call, yeah, basically.</span>
