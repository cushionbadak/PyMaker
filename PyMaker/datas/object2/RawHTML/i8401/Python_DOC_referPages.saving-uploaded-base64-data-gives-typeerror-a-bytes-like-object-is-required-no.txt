<div class="post-text" itemprop="text">
<p>I am using a JavaScript library to upload an image. It places the image data in a form field that is a JSON encoded object with the file name and base64 encoded data.</p>
<p>When I try to save the image in Flask, I get this error: </p>
<pre><code>builtins.TypeError TypeError: a bytes-like object is required, not 'str'
</code></pre>
<p>The image file is created with the correct name, but the data is corrupt, I can't open it. How do I save the uploaded data?</p>
<pre><code>app = Flask(__name__)
UPLOAD_FOLDER = app.root_path + '/images/'

@app.route('/', methods=['GET', 'POST'])
def index():
    if request.method == 'POST':
        image_base = json.loads(request.form['file'])['output']['image']
        image_base = image_base[image_base.find(',')+1:]
        file_data = io.StringIO(image_base)
        file = FileStorage(file_data, filename=json.loads(from_form)['output']['name'])
        filename = secure_filename(file.filename)
        file.save(os.path.join(app.config['UPLOAD_FOLDER'], filename))
        return redirect(url_for('uploaded_file', filename=filename))

    return render_template('index.html', methods=['GET', 'POST'])
</code></pre>
<pre><code>  File "/usr/local/lib/python3.5/site-packages/flask/app.py", line 1836, in __call__
    return self.wsgi_app(environ, start_response)
  File "/usr/local/lib/python3.5/site-packages/flask/app.py", line 1820, in wsgi_app
    response = self.make_response(self.handle_exception(e))
  File "/usr/local/lib/python3.5/site-packages/flask/app.py", line 1403, in handle_exception
    reraise(exc_type, exc_value, tb)
  File "/usr/local/lib/python3.5/site-packages/flask/_compat.py", line 33, in reraise
    raise value
  File "/usr/local/lib/python3.5/site-packages/flask/app.py", line 1817, in wsgi_app
    response = self.full_dispatch_request()
  File "/usr/local/lib/python3.5/site-packages/flask/app.py", line 1477, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/usr/local/lib/python3.5/site-packages/flask/app.py", line 1381, in handle_user_exception
    reraise(exc_type, exc_value, tb)
  File "/usr/local/lib/python3.5/site-packages/flask/_compat.py", line 33, in reraise
    raise value
  File "/usr/local/lib/python3.5/site-packages/flask/app.py", line 1475, in full_dispatch_request
    rv = self.dispatch_request()
  File "/usr/local/lib/python3.5/site-packages/flask/app.py", line 1461, in dispatch_request
    return self.view_functions[rule.endpoint](**req.view_args)
  File "/Users/kr/PycharmProjects/instaup/instaup.py", line 32, in index
    file.save(os.path.join(app.config['UPLOAD_FOLDER'], filename))
  File "/usr/local/lib/python3.5/site-packages/werkzeug/datastructures.py", line 2656, in save
    copyfileobj(self.stream, dst, buffer_size)
  File "/usr/local/Cellar/python3/3.5.1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/shutil.py", line 76, in copyfileobj
    fdst.write(buf)
TypeError: a bytes-like object is required, not 'str'
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p><code>StringIO</code> represents a string, not bytes, you want <a href="https://docs.python.org/3/library/io.html#binary-i-o" rel="nofollow noreferrer"><code>BytesIO</code></a>. Base64 encoded data is not the actual image bytes, it needs to be decoded with <a href="https://docs.python.org/3/library/base64.html#base64.b64decode" rel="nofollow noreferrer"><code>b64decode</code></a>.</p>
<pre><code>file_data = io.BytesIO(b64decode(image_base))
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>You need to encode either <code>app.config['UPLOAD_FOLDER']</code> or , <code>filename</code> to be a byte-like object. Try the <code>.encode('utf-8')</code> method.</p>
</div>
<span class="comment-copy">If add for one of it, got this: TypeError: Can't mix strings and bytes in path components , if for both of if, got this: AttributeError: 'bytes' object has no attribute 'write'</span>
