<div class="post-text" itemprop="text">
<p>I am saving a numpy array using the following <code>export_vectors</code> defined below. In this function, I load string values separated by space and then store them as floats in an numpy array.  </p>
<pre><code>def export_vectors(vocab, input_filename, output_filename, dim):
    embeddings = np.zeros([len(vocab), dim])
    with open(input_filename) as f:
        for line in f:
            line = line.strip().split(' ')
            word = line[0]
            embedding = line[1:]
            if word in vocab:
                word_idx = vocab[word]
                embeddings[word_idx] = np.asarray(embedding).astype(float)

    np.savez_compressed(output_filename, embeddings=embeddings)
</code></pre>
<p>Here <code>embeddings</code> is an <code>ndarray</code> of <code>float64</code> type.</p>
<p>Although, then when trying to load the file, using:</p>
<pre><code>def get_vectors(filename):
    with open(filename) as f:
        return np.load(f)["embeddings"]
</code></pre>
<p>When trying to do the loading, I am getting the error:</p>
<blockquote>
<p>File "/usr/lib/python3.5/codecs.py", line 321, in decode
      (result, consumed) = self._buffer_decode(data, self.errors, final) UnicodeDecodeError: 'utf-8' codec can't decode byte 0x99 in position
  10: invalid start byte</p>
</blockquote>
<p>Why is this?</p>
</div>
<div class="post-text" itemprop="text">
<p>You are probably using <code>open</code> wrong.
I suspect, you need to give it a flag to use <strong>binary-mode</strong> like (<a href="https://docs.python.org/3/tutorial/inputoutput.html#reading-and-writing-files" rel="nofollow noreferrer">docs</a>):</p>
<pre><code>open(filename, 'rb')  # r: read-only; b: binary
</code></pre>
<p>The docs explain the default-behaviour: <code>Normally, files are opened in text mode, that means, you read and write strings from and to the file, which are encoded in a specific encoding.</code></p>
<p>But you can make it simple and just use the filepath itself (as <a href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.load.html#numpy.load" rel="nofollow noreferrer">np.load</a> is able to take <code>file-like object, string, or pathlib.Path</code>):</p>
<pre><code>np.load(filename)  # This would be more natural
                   # as it's kind of the direct inverse of your save-code;
                   # -&gt; no manual file-handling
</code></pre>
<p>(<em>A simplified rule</em>: everything which is using general-purpose compression is alway's working with binary-files; not text-files!)</p>
</div>
<span class="comment-copy">Especially since the file is a <code>z</code> compressed, use <code>np.load(filename)</code>.  In other words let <code>load</code> take care of opening the compressed archive in the right way.</span>
