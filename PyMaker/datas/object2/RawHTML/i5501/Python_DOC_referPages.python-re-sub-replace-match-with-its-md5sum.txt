<div class="post-text" itemprop="text">
<p>I'm trying to parse such a string:</p>
<p><code>&lt;@Something&gt; there is some regular text &lt;@something_else&gt; and even more &lt;@foo&gt; &lt;@bar&gt; text</code></p>
<p>And replace all <code>&lt;@tokens&gt;</code> with theirs md5 sums.</p>
<p>Is it possible with python re.sub? How can I pass <code>@token</code> to a function and the function's output to <code>re.sub</code>?</p>
<p>So far I've tried the simplest approach with:</p>
<pre><code>import re

def fun(str):
    return str.replace('@', '!')

pattern = r'(&lt;@\w+&gt;)'
string = '&lt;@AAAA&gt; some text and more text &lt;@BBBBB&gt;'

print fun('&lt;@AAAA&gt;')
print string
print re.sub(pattern, fun(r'\1'), string)
</code></pre>
<p>Without success. The fun function works as expected outside re.sub(), but not within it.</p>
</div>
<div class="post-text" itemprop="text">
<p>With <code>hashlib</code> library:</p>
<pre><code>import hashlib, re

s = '&lt;@Something&gt; there is some regular text &lt;@something_else&gt; and even more &lt;@foo&gt; &lt;@bar&gt; text'
result = re.sub(r'&lt;@[^&gt;]+&gt;', lambda m: hashlib.md5(m.group().encode()).hexdigest(), s)

print(result)
</code></pre>
<p>The output:</p>
<pre><code>eb6eae14fb79abc1339b7096ae00a5e9 there is some regular text 16960eadb21d27a1b52e5c71a5ae7357 and even more 281dc7c0420f8e6ef66e58ecb979d087 31c0c5b91906d520a4dec601241833a6 text
</code></pre>
<p><a href="https://docs.python.org/3/library/hashlib.html" rel="nofollow noreferrer">https://docs.python.org/3/library/hashlib.html</a></p>
</div>
<div class="post-text" itemprop="text">
<p>Yes, as <a href="https://docs.python.org/3/library/re.html#re.sub" rel="nofollow noreferrer">the documentation</a> shows, the "replacement" parameter to <code>re.sub()</code> can be a function which takes a match object and returns the replacement.</p>
</div>
<span class="comment-copy">What happens if you use <code>re.sub(pattern, fun, str)</code>?</span>
