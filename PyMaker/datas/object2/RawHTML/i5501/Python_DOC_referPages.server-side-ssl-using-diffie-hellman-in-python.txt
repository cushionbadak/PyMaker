<div class="post-text" itemprop="text">
<p>I'm trying to set up a socket using Diffie-Hellman SSL, but can't seem find any documentation on how to do this. I notice that SSLContext in Python 3.3+ supports load_dh_params and set_ecdh_curve which suggests that using DH is possible.</p>
<p>I'm fairly new to using SSL so perhaps missing something obvious, but here's the code I'm using:</p>
<pre><code>sock = socket.socket()
sock.bind((HOST, PORT))
sock.listen()
context = ssl.SSLContext(protocol=ssl.PROTOCOL_TLS)
context.set_ecdh_curve('prime256v1')
ssock, address = self._server.accept()
ssock= context.wrap_socket(ssock, server_side=True)
</code></pre>
<p>When using this code, I get the error:</p>
<p>ssl.SSLError: [SSL: NO_SHARED_CIPHER] no shared cipher</p>
<p>I've tried setting the ciphers like the following:</p>
<pre><code>context.set_ciphers('ECDHE-RSA-AES256-GCM-SHA384')
</code></pre>
<p>but all the ciphers I've tried still throw up the same exception.</p>
<p>If anyone could point out where I'm going wrong or provide a working example of using DH SSL, it'd be much appreciated!</p>
</div>
<div class="post-text" itemprop="text">
<p>A TLS cipher defines the key exchange, the authentication method, the symmetric encryption algorithm and the HMAC. The authentication method in the cipher you explicitly try to use is RSA, i.e. using a certificate with an RSA public key. If you instead use the default cipher set the authentication methods are either RSA or ECDSA. </p>
<p>Both of these authentication methods need an appropriate certificate on the server side, i.e. with RSA or ECC public key. Since you have not configured any certificates these ciphers can not be used. This means in essence that from the ciphers the client has offered (which commonly also require certificate based authentication) none can be used for the connection, ergo NO_SHARED_CIPHER.</p>
<p>What you need to do: </p>
<ul>
<li>The recommended way is to setup a certificate on the server which is trusted by the client. See <a href="https://docs.python.org/3/library/ssl.html#ssl.SSLContext.load_cert_chain" rel="nofollow noreferrer">SSLContext.load_cert_chain</a>.</li>
<li>Or you could use ciphers which don't require authentication, for example <code>ADH-AES256-GCM-SHA384</code>. Note that you would need to explicitly configure the cipher in the client too since by default TLS stacks don't use ciphers without authentication for security reasons since man in the middle attacks will not be detected this way.</li>
</ul>
</div>
<span class="comment-copy">I was under the impression that Diffie-Hellman didn't require a certificate to be specified?</span>
<span class="comment-copy">@tj_ush: Diffie-Hellman does not need a certificate <b>for the key exchange</b>. But a cipher which uses certificate based authentication needs a certificate <b>for server authentication</b>. Thus, <code>ADH-AES256-GCM-SHA384</code> does not need a certificate while <code>ECDHE-RSA-AES256-GCM-SHA384</code> does.</span>
