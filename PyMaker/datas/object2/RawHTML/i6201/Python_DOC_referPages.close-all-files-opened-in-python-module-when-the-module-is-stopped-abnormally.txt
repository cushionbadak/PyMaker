<div class="post-text" itemprop="text">
<p>In my module, one block is coded like this:</p>
<pre><code># open a text file to which results obtained in MAINBLOCK will be written
write2file = open('myResults.txt','w')
#    MAINBLOCK
write2file.close()
</code></pre>
<p>When running the module, I may interrupt the module in <code>IDLE</code> by <code>Ctrl+C</code> for program debugging or exceptions may be raised in <code>MAINBLOCK</code>, so the module is stopped abnormally. However, If I try to delete <code>myResults.txt</code> in Windows Explorer at the time, the message says:</p>
<pre><code>The action can't be completed because the file is open in pythonw.exe
</code></pre>
<p>I think if the module is stopped abnormally, the file is still opening, am I right? How can I close all those open file identifiers in <code>IDLE</code> or by other ways?</p>
</div>
<div class="post-text" itemprop="text">
<p>Use a <a href="http://docs.python.org/3/reference/compound_stmts.html#the-with-statement" rel="nofollow noreferrer"><code>with</code> statement</a> to ensure all files are closed even if an exception occurs:</p>
<pre><code>with open("myResults.txt", "w") as write2file:
    # do stuff
</code></pre>
<p>No need to close the file - it will be closed automatically as soon as your program exits from the <code>with</code> block.</p>
</div>
<div class="post-text" itemprop="text">
<p>As a last resort, I believe a file can always be closed from the prompt in the Python shell window:-</p>
<blockquote>
<blockquote>
<blockquote>
<p>file_name.close()</p>
</blockquote>
</blockquote>
</blockquote>
<p>That's worked for me whenever a program has aborted execution due to an exception. But it would be very useful if there was a 'catch-all' close method that closed all open files.</p>
</div>
<span class="comment-copy">Thanks. I know <code>with</code> is a better choice. But sometimes I will use <code>write2file = open('myResults.txt','w')</code> directly to avoid too many indentation levels. So I'm still interested in how to figure the open file problem if the program can't reach <code>write2file.close()</code>. Is there a module in python to close all open file in <code>IDLE</code></span>
<span class="comment-copy">You won't get around extra indentation if you want to introduce more control. The alternative would be wrapping the code that uses the opened file in a <code>try</code> block and put an <code>except</code> clause there to close the file and then re-<code>raise</code> the exception. But that's a lot more complicated.</span>
