<div class="post-text" itemprop="text">
<p>I'm just beginning to use python to automate sending emails through gmail. I have gotten the whole process to work just typing directly into the command line, but now I want to automate the process (i.e. send emails at regular intervals). I have gotten the first part to work, where I get a connection with the SMTP server.</p>
<pre><code>os.system("openssl s_client -starttls smtp -connect smtp.gmail.com:587 -crlf -ign_eof")
</code></pre>
<p>Now I want to get it so that it will type and run the following commands within that connection:</p>
<pre><code>os.write("HELO", os.linesep)
os.write("AUTH LOGIN", os.linesep) ... And so on
</code></pre>
<p>I have tried this using the write commands as well as the os.system command, but neither seems to actually insert the text into this window. Could someone with perhaps more linux and terminal skills be able to help with this? Also, it seems that the time.sleep doesn't work when all of these system processes are running. How can I get around that?</p>
</div>
<div class="post-text" itemprop="text">
<p>I would use the SMTP client implementation from the standard library: <a href="http://docs.python.org/3/library/smtplib" rel="nofollow">http://docs.python.org/3/library/smtplib</a></p>
<pre><code>import smtplib
smtp_client = smtplib.SMTP('smtp.gmail.com', 587)
smtp_client.starttls()
smtp_client.login(username, password)
</code></pre>
<p>If you are using 2-factor-authentication, you need to create an application specific password to use.</p>
</div>
<div class="post-text" itemprop="text">
<p>You should look at the subprocess module to do what you want. You cannot just "os.write", you need to "write" to the process's standard input and output.</p>
<pre><code>command = ['openssl', 's_client', '-starttls smtp', '-connect smtp.gmail.com:587', '-crlf', '-ign_eof']
p = subprocess.Popen(command, stdin=PIPE) # Success!
p.write("HELO", "MYNAME")
</code></pre>
<p>etc.</p>
</div>
<span class="comment-copy">Python does have a <a href="http://docs.python.org/3/library/smtplib.html#module-smtplib" rel="nofollow noreferrer"><code>smtplib</code></a> module to provide an SMTP client. It doesn't make sense to use <code>openssl</code> directly if your goal is to use Python.</span>
<span class="comment-copy">I have tried smtplib, but it has not worked with connections to gmail. If you can provide working code that will establish a connection, post it and I'll check it out. However, I have found that openssl is the only way I have even managed to get a connection.</span>
<span class="comment-copy">I think gmail is different from most SMTP servers in that you can't just follow the regular login steps. I think it's specially encoded, so the smtplib does not work. Does that code work for you?</span>
<span class="comment-copy">Yes, the code does work for me. You can't use your standard password if you do 2-factor-authentication, but that's it.</span>
<span class="comment-copy">Can you post any stacktraces or errors you get using smtplib?</span>
<span class="comment-copy">Sure! Here's the code I'm running (but modified to exclude encoded passwords and email addresses) import smtplib smtp_client = smtplib.SMTP('smtp.gmail.com', 587) smtp_client.starttls() smtp_client.login("encoded email here", "encoded password here") smtp_client.sendmail("email address","to"," message ")</span>
<span class="comment-copy">The error is as follows:   Traceback (most recent call last):   File "smtplibtest.py", line 1, in &lt;module&gt;     import smtplib   File "/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/smtplib.py", line 46, in &lt;module&gt;     import email.utils   File "/Users/Connor/Documents/BuildTech/email.py", line 15, in &lt;module&gt;     server = smtplib.SMTP(HOST) AttributeError: 'module' object has no attribute 'SMTP'</span>
<span class="comment-copy">For some reason, I had an issue with stdin=PIPE. Is there more to it than just this?</span>
<span class="comment-copy">try subprocess.PIPE instead of PIPE</span>
<span class="comment-copy">Appears to solve that problem. But the write function returns this error:   Traceback (most recent call last):   File "TestGmailConnection.py", line 9, in &lt;module&gt;     p.write("HELO", "MYNAME") AttributeError: 'Popen' object has no attribute 'write' unknown option -starttls smtp usage: s_client args</span>
<span class="comment-copy">ah Im sorry I've made another mistake :P You need to use p.communicate("HELO MYNAME") <a href="http://docs.python.org/2/library/subprocess.html" rel="nofollow noreferrer">docs.python.org/2/library/subprocess.html</a> also your command seems to have issues.</span>
