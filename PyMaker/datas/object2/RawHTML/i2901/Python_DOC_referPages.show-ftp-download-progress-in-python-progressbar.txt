<div class="post-text" itemprop="text">
<p>I am downloading files over FTP using the following Python script. What I wanted is to see the details of the progress while downloading. For that I used <code>ProgressBar</code> but it isn't showing anything.</p>
<p>Here's my code:</p>
<pre><code>import re
import os
import ftplib
import ntpath

import sys
import time

from progressbar import AnimatedMarker, Bar, BouncingBar, Counter, ETA, \
    AdaptiveETA, FileTransferSpeed, FormatLabel, Percentage, \
    ProgressBar, ReverseBar, RotatingMarker, \
    SimpleProgress, Timer, UnknownLength

ftp = ftplib.FTP("Your IP address")
ftp.login("Username", "password")
files = []

try:
    ftp.cwd("/feed_1")
    files = ftp.nlst()
    for fname in files:
        res = re.findall("2018-07-25", fname)
        if res:
            print 'Opening local file ' + ntpath.basename(fname)
            file = open(ntpath.basename(fname), 'wb')
            print 'Getting ' + ntpath.basename(fname)

            try:
                 widgets = ['Downloading: ', Percentage(), ' ',
                    Bar(marker='#',left='[',right=']'),
                    ' ', ETA(), ' ', FileTransferSpeed()]

                 pbar = ProgressBar(widgets=widgets, maxval=500)
                 pbar.start()
                 ftp.retrbinary('RETR ' + ntpath.basename(fname), file.write)

            except:
                pass

            print 'Closing file ' + ntpath.basename(fname)
            file.close() 
            print (fname)
            time.sleep(0.2)
            pbar.update()
            pbar.finish() 

        if not res:
            continue

except ftplib.error_perm , resp:
    if str(resp) == "550 No files found":
        print "No files in this directory"
        pass
    else:
        raise
</code></pre>
<p>Please help in understanding what's actually wrong here. Thanks :)</p>
</div>
<div class="post-text" itemprop="text">
<p>You never update the <code>ProgressBar</code>. What you need to do is to:</p>
<ul>
<li><p>Implement a function (or a class method) that you will pass to <a href="https://docs.python.org/3/library/ftplib.html#ftplib.FTP.retrbinary" rel="nofollow noreferrer"><code>FTP.retrbinary</code></a> as <code>callback</code> instead of <code>file.write</code>. The function should do <code>file.write</code> and also update the progress bar.</p></li>
<li><p>You also need to know size of the file/transfer for <code>maxval</code> argument of <code>ProgressBar</code>. For that you can use <a href="https://docs.python.org/3/library/ftplib.html#ftplib.FTP.size" rel="nofollow noreferrer"><code>FTP.size</code></a>.</p></li>
</ul>
<p>A trivial implementation is like:</p>
<pre><code>local_path = "archive.zip"
remote_path = "/remote/path/archive.zip"

file = open(local_path, 'wb')

size = ftp.size(remote_path)

pbar = ProgressBar(widgets = widgets, maxval = size)
pbar.start()

def file_write(data):
   file.write(data) 
   global pbar
   pbar += len(data)

ftp.retrbinary("RETR " + remote_path, file_write)
</code></pre>
<p>And now you get the progress bar you want:</p>
<pre class="lang-none prettyprint-override"><code>Downloading:  72% [###############################            ] ETA:   0:00:00 242.1 MiB/s
</code></pre>
</div>
<span class="comment-copy">Did my answer help?</span>
