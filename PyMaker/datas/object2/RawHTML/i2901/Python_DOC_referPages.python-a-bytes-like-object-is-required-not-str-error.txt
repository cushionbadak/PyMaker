<div class="post-text" itemprop="text">
<div class="question-status question-originals-of-duplicate">
<p>This question already has an answer here:</p>
<ul>
<li>
<a dir="ltr" href="/questions/40211408/python-3-typeerror-a-bytes-like-object-is-required-not-str">Python 3 - TypeError: a bytes-like object is required, not 'str'</a>
<span class="question-originals-answer-count">
                    1 answer
                </span>
</li>
</ul>
</div>
<p>I'm trying to write a basic python program that takes the price to book ratio from yahoo finance's website. However, i'm getting an error:</p>
<pre><code>failed in the main loop a bytes-like object is required, not 'str'
</code></pre>
<p>I've tried using encoding with this line:</p>
<pre><code>sourceCode.read().decode('utf-8')
</code></pre>
<p>However this leads to another error of:</p>
<pre><code>failed in the main loop 'bytes' object has no attribute 'read'
</code></pre>
<p>Any Help would be appreciated. The full code is below:</p>
<pre><code>import time
    import urllib.request
    from urllib.request import urlopen

stocks = ['aapl', 'fb', 'goog']

def keyStats(stock):
  try:
      sourceCode = urllib.request.urlopen('https://finance.yahoo.com/quote/' + stock + '/key-statistics?p=' + stock).read()
      ptb = sourceCode.split('Price/Book&lt;/span&gt;&lt;!-- react-text: 58 --&gt; &lt;!-- /react-text --&gt;&lt;!-- react-text: 59 --&gt;(mrq)&lt;!-- /react-text --&gt;&lt;sup aria-label="KS_HELP_SUP_undefined" data-reactid="60"&gt;&lt;/sup&gt;&lt;/td&gt;&lt;td class="Fz(s) Fw(500) Ta(end)" data-reactid="61"&gt;')[1].split('&lt;/td&gt;')[0]
      print ('Price to Book Ratio: ', stock, ptb)

  except (Exception) as e:
      print ('failed in the main loop', e)

for newStock in stocks:
  keyStats(newStock)
  time.sleep(1)
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p><a href="https://docs.python.org/3/library/urllib.request.html#urllib.request.urlopen" rel="nofollow noreferrer"><code>urlopen</code></a> returns a <a href="https://docs.python.org/3/library/http.client.html#httpresponse-objects" rel="nofollow noreferrer">response object</a> that, when read using <a href="https://docs.python.org/3/library/http.client.html#http.client.HTTPResponse.read" rel="nofollow noreferrer"><code>read()</code></a>, returns a <code>bytes</code> object. This is because thereâ€™s generally no guarantee about whether a HTTP request returns a binary response or some response that can be properly decoded into a string.</p>
<p>Instead, it is up to you to decode the response explicitly, for example if you know exactly that there is a response in UTF-8, or by explicitly checking the Content-Type header in the HTTP response.</p>
<p>So you need to do it like this:</p>
<pre><code>sourceCode = urllib.request.urlopen(url).read().decode()
</code></pre>
<p>That attempts to decode the <code>bytes</code> response into a string using UTF-8 (by default). And then <code>sourceCode</code> will be a string which you will be able to call <code>str.split()</code> on.</p>
</div>
<span class="comment-copy">Try <code>ptb = ptb.decode("utf-8")</code></span>
<span class="comment-copy">When using this I still get: failed in the main loop a bytes-like object is required, not 'str'</span>
<span class="comment-copy">You're saying that "urllib is not as easy to use as it could be". So use requests instead: <a href="https://pypi.org/project/requests/" rel="nofollow noreferrer">pypi.org/project/requests</a> . Also, at some point instead of <code>split()</code> you'll find it easier to use Beautiful Soup: <a href="https://www.crummy.com/software/BeautifulSoup/bs4/doc/" rel="nofollow noreferrer">crummy.com/software/BeautifulSoup/bs4/doc</a></span>
