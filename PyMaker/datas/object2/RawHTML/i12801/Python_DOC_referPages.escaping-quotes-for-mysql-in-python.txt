<div class="post-text" itemprop="text">
<p>Following the advice on <a href="https://stackoverflow.com/questions/6222381/the-best-way-to-store-a-python-list-to-a-database">this thread</a>, I am storing my <code>list</code> as <code>string</code> type in <code>MySQL database</code>, but, I'm facing this error: </p>
<pre><code>_mysql_exceptions.ProgrammingError: (1064, 'You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near \'foo_bar" but I can\\\'t bar.\', u\'high\', 0]]")\' at line 1')
</code></pre>
<p>on some list entries like this one:</p>
<pre><code>var1 = 'Name'
var2 = 'Surname'
var3 = 15
var4 = [u'The Meter', [[u'Black', u'foo foo bar bar "foo_bar" but I can\'t bar', u'high', 0]]]
</code></pre>
<p>I figured that's because there's a double quote at the beginning of <code>foo_bar</code> and I am using the following code to make entries in the database:</p>
<pre><code>SQL = 'INSERT INTO test_table (col1, col2, col3, col4) VALUES ("{}", "{}", "{}", "{}")'.format(var1, var2, var3, var4)
cursor.execute(SQL)
</code></pre>
<p>And the double quotes are not being escaped.
If i remove the double quotes from: <br/> <strong><code>("{}", "{}", "{}", "{}")</code></strong>, I get the same error,
I tried using a different string formatting, (using <code>%s</code>) but that didn't work either.<br>
Any ideas?</br></p>
</div>
<div class="post-text" itemprop="text">
<p>Do <em>not</em> use string formatting to interpolate SQL values. Use SQL parameters:</p>
<pre><code>SQL = 'INSERT INTO test_table (col1, col2, col3, col4) VALUES (%s, %s, %s, %s)'
cursor.execute(SQL, (var1, var2, var3, var4))
</code></pre>
<p>Here the <code>%s</code> are SQL parameters; the database then takes care of escaping the values (passed in as the 2nd argument to `cursor.execute) for you.</p>
<p>Exactly what syntax you need to use depends on your database adapter; some use <code>%s</code>, others use <code>?</code> for the placeholders.</p>
<p>You can't otherwise use Python containers, like a list, for these parameters. You'd have to serialise that to a string format first; you could use JSON for that, but then you'd also have to remember to decode the JSON into a Python string again when you query the database. That's what the answers to the other question tried to convey.</p>
<p>For example, if <code>var4</code> is the list, you could use:</p>
<pre><code>cursor.execute(SQL, (var1, var2, var3, json.dumps(var4)))
</code></pre>
</div>
<div class="post-text" itemprop="text">
<pre><code>SQL = 'INSERT INTO test_table (col1, col2, col3, col4) VALUES ("{!a}", "{!a}", "{!a}", "{!a}")'.format(var1, var2, var3, str(var4))
cursor.execute(SQL)
</code></pre>
<p><code>{!a}</code> applies <code>ascii()</code> and hence escapes non-ASCII characters like quotes and even emoticons.</p>
<p>Check out <a href="https://docs.python.org/3/library/string.html#format-string-syntax" rel="nofollow noreferrer">Python3 docs</a> </p>
</div>
<span class="comment-copy">Now I am getting this error: <code>TypeError: not all arguments converted during string formatting</code> :|</span>
<span class="comment-copy">@Azazelroman: did you check your database adapter documentation? Yours probably expected <code>%s</code> for the placeholders.</span>
<span class="comment-copy">@martijin Oh, but as i said in the question, i got the same error while using <code>%s</code>: <code>mysql_exceptions.ProgrammingError: (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MyS                                                                       QL server version for the right syntax to use near '))' at line 1")</code></span>
<span class="comment-copy">@Azazelroman: you didn't use them as SQL parameters then. I've swapped out the <code>?</code> placeholders with <code>%s</code> placeholders to illustrate.</span>
<span class="comment-copy"><code>(name)</code> is not a single-element tuple. Itâ€™s just a grouped expression. You need to add a comma: <code>(name,)</code>, or use a list: <code>[name]</code>.</span>
