<div class="post-text" itemprop="text">
<p>Apologies if this is a duplicate at all, but, I can't seem to get my head around some of the rules around mutability. I have a scenario which is similar to the one below:</p>
<pre><code>from multiprocessing import Pool;

class myObj:

    def __init__(self):
        self.results = [];

    def doThing(self):
        self.results.append(1);

def wrapDoThing(o):
    o.doThing();
    return o;

objList = [myObj(),myObj()];

map(wrapDoThing,objList);

print(len(objList[0].results)); #prints 1

tPool = Pool(2);

tPool.map(wrapDoThing,objList);

print(len(objList[0].results)); #prints 1 - why?
</code></pre>
<p>I have a class which has an instance field, and a method that updates that instance field, thereby updating the objects state.
if I use the builtin <code>map</code> (I'm using a function declared at the top level as a wrapper - clearer later) the method call happens for each object and updates the state, as the <code>results</code> field in the class has a length of 1.</p>
<p>When I use the <code>Pool.map</code> (which is why I used the wrapper, as I don't believe I can use a lambda, can I?), the method's effect doesn't seem to take hold, and I'm not sure as to why this is happening?</p>
</div>
<div class="post-text" itemprop="text">
<p>Using multiprocessing, you spawn different python processes.</p>
<p>The main Python process however, does not share it's state with the newly spawned processes (neither they share it to one another).</p>
<p>The objects that you passed through to map got serialized and sent to those processes but apart from map's results, they never got back to the main process. They did increase, but only on the other processes which later on died in vein :-(</p>
<p>If you do wish to share state, there are many shared variables, memory, and managed processes that are at your disposal.</p>
<p>For more information about that, please see <a href="https://docs.python.org/3/library/multiprocessing.html#sharing-state-between-processes" rel="nofollow noreferrer">multiprocessing's documentation</a>.</p>
</div>
<span class="comment-copy"><code>multiprocessing</code> doesn't share state.</span>
<span class="comment-copy">Thanks for replying, do you have any resources i can look at on how to deal with this?</span>
<span class="comment-copy">check out the <a href="https://docs.python.org/3.6/library/multiprocessing.html#sharing-state-between-processes" rel="nofollow noreferrer">documentation</a></span>
<span class="comment-copy">Depends on what you are doing. <code>Pool.map</code> can return values from the sub-processes, but not alter state of the parent process. The idea of <code>map</code> in general is for generating a congruent list ("mapping" values from one list to another), not simply iterating. So, something like <code>results = Pool.map(fn, obj_list)</code></span>
