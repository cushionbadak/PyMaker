<div class="post-text" itemprop="text">
<p>I have an application in which I need to parse timestamps of four different formats.</p>
<pre><code>HH:MM:SS
HH:MM:SS.mm
MM:SS
MM:SS.mm
</code></pre>
<p>How can I write a function to parse any of these formats into a <code>timedelta</code> object?</p>
<p>I have tried iterating through the characters one by one and <code>break</code>ing when I see the <code>:</code>, but my code is a mess, so I would rather not have it here as a baseline.</p>
</div>
<div class="post-text" itemprop="text">
<p>Here's a way to do it using <code>datetime.datetime.strptime()</code>:</p>
<p>If you don't know ahead of time which <a href="https://docs.python.org/2/library/datetime.html#strftime-and-strptime-behavior" rel="nofollow noreferrer">format</a> your input will be in, you can try all of them wrapped in a <code>try</code>/<code>catch</code> block.</p>
<p><code>strptime()</code> returns a <code>datetime</code> object, so call the <code>.time()</code> function to get only the time part. See <a href="https://stackoverflow.com/questions/16138744/extract-time-from-datetime-and-determine-if-time-not-date-falls-within-range">this post</a> for more details.</p>
<pre><code>import datetime

def parse_timestamp(ts):
    formats = [
        "%H:%M:%S", #HH:MM:SS
        "%H:%M:%S.%f", #HH:MM:SS.mm
        "%M:%S", #MM:SS
        "%M:%S.%f" #MM:SS.mm
    ]
    for f in formats:
        try:
            return datetime.datetime.strptime(ts, f).time()
        except ValueError:
            pass
    return None
</code></pre>
<p>Examples:</p>
<pre><code>timestamps = [
    "12:34:56",
    "12:34:56.78",
    "34:56",
    "34:56.78"
]
for ts in timestamps:
    print parse_timestamp(ts)
</code></pre>
<p>Output:</p>
<pre><code>12:34:56
12:34:56.780000
00:34:56
00:34:56.780000
</code></pre>
<p>Or if you know the specific format, you can use <code>datetime.datetime.strptime(ts, f).time()</code> directly.</p>
<p><strong>Update 1</strong> </p>
<p>If you want to convert to <code>timedelta</code>s, you can do so using the output of <code>parse_timestamp()</code> and the <a href="https://docs.python.org/3/library/datetime.html#datetime.timedelta" rel="nofollow noreferrer"><code>timedelta</code> constructor</a>:</p>
<pre><code>def time_to_timedelta(t):
    td = datetime.timedelta(
        seconds=t.second,
        microseconds=t.microsecond,
        minutes=t.minute,
        hours=t.hour
    )
    return td
</code></pre>
<p>Here is a <a href="https://stackoverflow.com/questions/35241643/convert-datetime-time-into-datetime-timedelta-in-python-3-4">related post</a> that you may also find useful.</p>
</div>
<span class="comment-copy">You could use <code>time.strptime()</code>.</span>
<span class="comment-copy">so clean! thank you</span>
<span class="comment-copy">@JamesEdwards np. Please also see the update about <code>timedelta</code> since that was in your OP.</span>
