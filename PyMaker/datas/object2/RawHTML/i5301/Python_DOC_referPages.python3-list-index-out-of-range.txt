<div class="post-text" itemprop="text">
<p>I am working on a character level Recurrent Neural Network. To train the net I copied a text corpus from the internet. Here is the chunk of code that has the error in it :</p>
<pre><code>X = np.zeros((int(len(data)/SEQ_LENGTH), SEQ_LENGTH, VOCAB_SIZE))
y = np.zeros((int(len(data)/SEQ_LENGTH), SEQ_LENGTH, VOCAB_SIZE))
for i in range(0, int(len(data)/SEQ_LENGTH)):
    X_sequence = data[i*SEQ_LENGTH:(i+1)*SEQ_LENGTH]
    X_sequence_ix = [char_to_ix[value] for value in X_sequence]
    input_sequence = np.zeros((SEQ_LENGTH, VOCAB_SIZE))
    for j in range(SEQ_LENGTH):
        input_sequence[j][X_sequence_ix[j]] = 1.
    X[i] = input_sequence

    y_sequence = data[i*SEQ_LENGTH+1:(i+1)*SEQ_LENGTH+1]
    y_sequence_ix = [char_to_ix[value] for value in y_sequence]
    target_sequence = np.zeros((SEQ_LENGTH, VOCAB_SIZE))
    for j in range(SEQ_LENGTH):

        target_sequence[j][y_sequence_ix[j]] = 1       
    y[i] = target_sequence
</code></pre>
<p>Basically all I am doing is converting characters to their ASCII equivalent. <code>y_sequence</code> is the character sequence and <code>y_sequence_ix</code> is its corresponding ASCII sequence. <code>VOCAB_SIZE</code> variable contains the number of unique character in the text corpus. The error occurs in this line :</p>
<pre><code>target_sequence[j][y_sequence_ix[j]] = 1  
</code></pre>
<p>Complete source code along with text corpus : <a href="https://github.com/tanmay-edgelord/charRNN" rel="nofollow noreferrer">https://github.com/tanmay-edgelord/charRNN</a></p>
<p>Please ask for any information that is required in order for you to answer the question.</p>
<p><strong>EDIT</strong></p>
<p>TRACEBACK upon calling function traceback.print_stack()</p>
<pre><code>File "/usr/lib/python3.5/runpy.py", line 184, in _run_module_as_main
    "__main__", mod_spec)
  File "/usr/lib/python3.5/runpy.py", line 85, in _run_code
    exec(code, run_globals)
  File "/usr/local/lib/python3.5/dist-packages/ipykernel_launcher.py", line 16, in &lt;module&gt;
    app.launch_new_instance()
  File "/usr/local/lib/python3.5/dist-packages/traitlets/config/application.py", line 658, in launch_instance
    app.start()
  File "/usr/local/lib/python3.5/dist-packages/ipykernel/kernelapp.py", line 478, in start
    self.io_loop.start()
  File "/usr/local/lib/python3.5/dist-packages/zmq/eventloop/ioloop.py", line 177, in start
    super(ZMQIOLoop, self).start()
  File "/usr/local/lib/python3.5/dist-packages/tornado/ioloop.py", line 888, in start
    handler_func(fd_obj, events)
  File "/usr/local/lib/python3.5/dist-packages/tornado/stack_context.py", line 277, in null_wrapper
    return fn(*args, **kwargs)
  File "/usr/local/lib/python3.5/dist-packages/zmq/eventloop/zmqstream.py", line 440, in _handle_events
    self._handle_recv()
  File "/usr/local/lib/python3.5/dist-packages/zmq/eventloop/zmqstream.py", line 472, in _handle_recv
    self._run_callback(callback, msg)
  File "/usr/local/lib/python3.5/dist-packages/zmq/eventloop/zmqstream.py", line 414, in _run_callback
    callback(*args, **kwargs)
  File "/usr/local/lib/python3.5/dist-packages/tornado/stack_context.py", line 277, in null_wrapper
    return fn(*args, **kwargs)
  File "/usr/local/lib/python3.5/dist-packages/ipykernel/kernelbase.py", line 283, in dispatcher
    return self.dispatch_shell(stream, msg)
  File "/usr/local/lib/python3.5/dist-packages/ipykernel/kernelbase.py", line 233, in dispatch_shell
    handler(stream, idents, msg)
  File "/usr/local/lib/python3.5/dist-packages/ipykernel/kernelbase.py", line 399, in execute_request
    user_expressions, allow_stdin)
  File "/usr/local/lib/python3.5/dist-packages/ipykernel/ipkernel.py", line 208, in do_execute
    res = shell.run_cell(code, store_history=store_history, silent=silent)
  File "/usr/local/lib/python3.5/dist-packages/ipykernel/zmqshell.py", line 537, in run_cell
    return super(ZMQInteractiveShell, self).run_cell(*args, **kwargs)
  File "/usr/local/lib/python3.5/dist-packages/IPython/core/interactiveshell.py", line 2728, in run_cell
    interactivity=interactivity, compiler=compiler, result=result)
  File "/usr/local/lib/python3.5/dist-packages/IPython/core/interactiveshell.py", line 2856, in run_ast_nodes
    if self.run_code(code, result):
  File "/usr/local/lib/python3.5/dist-packages/IPython/core/interactiveshell.py", line 2910, in run_code
    exec(code_obj, self.user_global_ns, self.user_ns)
  File "&lt;ipython-input-15-b47f6c9a5577&gt;", line 2, in &lt;module&gt;
    traceback.print_stack()
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>The issue is in <code>y_sequence_ix[j]</code> because your <code>j</code> range function is using SEQ_LENGTH+1.  This is what you want since you're predicting the <code>next</code> value in the list but it also creates an issue in that <code>y_sequence_ix</code> is 1 sample too short on the last iteration of <code>i</code> when <code>data</code> splits evenly with <code>SEQ_LENGTH</code>.  </p>
<pre><code>import string
import random
import numpy as np

ix_to_char = list(string.ascii_lowercase)
data = [random.choice(string.ascii_lowercase) for x in range(1000)]
char_to_ix = {v:i for i,v in enumerate(ix_to_char)}
VOCAB_SIZE  = len(char_to_ix)
SEQ_LENGTH = 5

usable_len = len(data)-1    #Note: don't try to use the last entry in data
X = np.zeros((int(usable_len/SEQ_LENGTH), SEQ_LENGTH, VOCAB_SIZE))
y = np.zeros((int(usable_len/SEQ_LENGTH), SEQ_LENGTH, VOCAB_SIZE))
for i in range(0, int(usable_len/SEQ_LENGTH)):       
    X_sequence = data[i*SEQ_LENGTH:(i+1)*SEQ_LENGTH]
    X_sequence_ix = [char_to_ix[value] for value in X_sequence]

    input_sequence = np.zeros((SEQ_LENGTH, VOCAB_SIZE))
    for j in range(SEQ_LENGTH):
        input_sequence[j][X_sequence_ix[j]] = 1.
    X[i] = input_sequence

    y_sequence = data[i*SEQ_LENGTH+1:(i+1)*SEQ_LENGTH+1]
    y_sequence_ix = [char_to_ix[value] for value in y_sequence]
    target_sequence = np.zeros((SEQ_LENGTH, VOCAB_SIZE))
    for j in range(SEQ_LENGTH):
        target_sequence[j][y_sequence_ix[j]] = 1
    y[i] = target_sequence
</code></pre>
<p>Other that the data creation at the top, the only thing modified here is use <code>len(data)-1</code> in the data creation instead of <code>len(data)</code>.  By truncating a single value, you assure you won't get an <code>index out of range</code> type error. This is the easiest thing to do, however you could also set SEQ_LENGTH to be a value that isn't an even multiple of len(data), ie.. <code>6</code> would work for the above example.</p>
</div>
<span class="comment-copy">Doublecheck the shape and size of <code>target_sequence</code>. If I am not mistaken, it should have two dimensions. As such, calling <code>target_sequence[j]</code> should return another list (which you index again with <code>[y_sequence[j]]</code> but if the result of <code>[y_sequence[j]]</code> is greater than <code>VOCAB_SIZE</code> you'll be out of bounds. Tracing back a bit as well, your <code>y_sequence</code> seems to be built off of <code>SEQ_LENGTH</code> and not <code>VOCAB_SIZE</code> so there's a good chance this is the root of the issue.</span>
<span class="comment-copy">Dimensions of <code>target_sequence</code> are 100x80. Moreover, the length of y_sequence cannot be an issue since I am interested in accessing the index corresponding to the ASCII code of the jth character in the y_sequence variable and setting <code>target_sequence[j][y_sequence_ix[j]</code> = 1</span>
<span class="comment-copy">Please post the complete Traceback.</span>
<span class="comment-copy">When you <a href="https://docs.python.org/3/tutorial/errors.html#handling-exceptions" rel="nofollow noreferrer">caught the error</a> and examined the data and variables, what did you find?</span>
<span class="comment-copy">The lengths of the variables were as expected an the ones that had to match were matching. That is why I got confused, plus I copied this code from this link : <a href="https://chunml.github.io/ChunML.github.io/project/Creating-Text-Generator-Using-Recurrent-Neural-Network/" rel="nofollow noreferrer">chunml.github.io/ChunML.github.io/project/â€¦</a> . It clearly worked for him</span>
<span class="comment-copy">I do not understand what you are trying to say with regards to the last case</span>
<span class="comment-copy">How do I pad the data with a 0 ?</span>
<span class="comment-copy">I rethought this a bit.  Padding would work but probably a bad idea to teach the net an incorrect value.  The above will work better and is a really simple mod.  Give it a try.   BTW.. this may have worked from someone originally because they had data that was a different length or the set SEQ_LENGTH differently.</span>
