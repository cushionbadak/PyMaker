<div class="post-text" itemprop="text">
<p>I want to create a simple log-in account program in Python using the "CSV" library. Here is the code:</p>
<pre><code>import csv

account_password = ""

with open("accounts.csv") as csvfile:
    reader = csv.reader(csvfile)    

    while True:
        username = input("\nEnter username: ")
        # Checks if username exists
        for row in reader:
            if row[0] == username:
                account_password = row[1] # Get user's password
                break

        password = input("Enter password: ")

        # Check if password is valid
        if password == account_password:
            break
        else:
            print("Username/password is incorrect. Try again.")


print("\nSuccessfully logged in!")
</code></pre>
<p>Here is how my CSV file looks like. The first column is the usernames and the second one is the passwords:</p>
<pre><code>Tim,myPassword
John,monkey32
Fred,WooHoo!    
</code></pre>
<hr/>
<p>When I tried to test my program in IDLE, I noticed an unusual log-in issue.</p>
<p>If I log in with the correct credentials, then the program works perfectly fine:</p>
<p><a href="https://i.stack.imgur.com/vRTAb.png" rel="nofollow noreferrer"><img alt="Image of code working under correct log in details." src="https://i.stack.imgur.com/vRTAb.png"/></a></p>
<p>If I log in with incorrect log in details, the program works as expected:</p>
<p><a href="https://i.stack.imgur.com/f6v9d.png" rel="nofollow noreferrer"><img alt="Image of code working under incorrect login details." src="https://i.stack.imgur.com/f6v9d.png"/></a></p>
<hr/>
<p><strong>But here is the issue.</strong> After entering incorrect log in details, the program asks the user to try again. This is done with a "while loop" in my code. Yet when I "try again", but with the correct details, the program thinks the log-in details are incorrect:</p>
<p><a href="https://i.stack.imgur.com/ulyoM.png" rel="nofollow noreferrer"><img alt="Image of code not working." src="https://i.stack.imgur.com/ulyoM.png"/></a></p>
<p>Here is the same issue with another user from the csv file:</p>
<p><a href="https://i.stack.imgur.com/8eMvv.png" rel="nofollow noreferrer"><img alt="Image of code not working again." src="https://i.stack.imgur.com/8eMvv.png"/></a></p>
<p>I would love it if anyone could let me know what is wrong with my code. </p>
<p>Please also show the full updated code along with an explanation for why the code in the answer is working and the difference between it and mine.</p>
<p>Thank you.</p>
</div>
<div class="post-text" itemprop="text">
<p>It looks like that <code>for row in reader</code> running only once<br/>
try change the order of your code<br/>
Try to open the file inside the <code>while True:</code> like this:</p>
<pre><code>while True:
    with open("accounts.csv") as csvfile:
        reader = csv.reader(csvfile)
</code></pre>
<p>should work fine because you close the file before each iteration</p>
</div>
<div class="post-text" itemprop="text">
<p><code>for row in csv.reader(csvfile)</code> goes through the file line by line, once.  After the file is exhausted, it doesn't do anything. You can instead load it into memory as a dictionary (provided it is not too large, otherwise you probably need a DB):</p>
<pre><code>import csv

account_passwords = dict()

with open("accounts.csv") as csvfile:
    reader = csv.reader(csvfile)    
    for row in reader:
        account_passwords[row[0]] = row[1]

while True:
    username = input("\nEnter username: ")
    password = input("Enter password: ")

    if username in account_passwords and \
            account_passwords[username] == password:
        print("\nSuccessfully logged in!")
        break
    else:
        print("Username/password is incorrect. Try again.")
</code></pre>
<p>If you're doing this for anything serious, consider hashing the passwords and using <a href="https://docs.python.org/3/library/getpass.html#getpass.getpass" rel="nofollow noreferrer"><code>getpass.getpass</code></a> instead of <code>input</code> for reading passwords.</p>
</div>
<div class="post-text" itemprop="text">
<p>csv.reader(%filename%) is generator. </p>
<p>Python generators can be processed only once. So when your enter incorrect details generator goes up to last row and found nothing. When your code return to "while True" reader will be empty and "for row in reader:" will not return any values.</p>
<p>Correct (or at least working) version should be something like this:</p>
<pre><code>import csv

account_password = ""


def get_pass_from_file(username):
    with open("accounts.csv") as csvfile:
        for item in csv.reader(csvfile):
            if item[0] == username:
                return item[1]


if __name__ == '__main__':
    while True:
        username = input("\nEnter username: ")
        account_password = get_pass_from_file(username)
        if account_password is None:
            print("Username not found. Try again.")
            continue

        password = input("Enter password: ")
        if password == account_password:
            break
        else:
            print("Username/password is incorrect. Try again.")

    print("\nSuccessfully logged in!")
</code></pre>
</div>
<span class="comment-copy"><code>for row in reader</code> runs through the file only once. If its size is not too large, you can store the entirety of it in memory. Also, hash your passwords.</span>
<span class="comment-copy">Hashing my passwords isn't as important of an issue as getting my log in to run successfully. Although, I will consider it at a later date. Thanks.</span>
<span class="comment-copy">Possible duplicate of <a href="https://stackoverflow.com/questions/10255273/iterating-on-a-file-using-python">Iterating on a file using Python</a></span>
<span class="comment-copy">I checked out the "duplicate" post and it mentions closing the file. However, in python "with open() as ..." opens and closes the file.</span>
