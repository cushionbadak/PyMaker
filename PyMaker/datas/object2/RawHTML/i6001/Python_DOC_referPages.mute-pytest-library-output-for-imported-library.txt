<div class="post-text" itemprop="text">
<p>I'm testing a function which uses <a href="https://pypi.python.org/pypi/Wand" rel="nofollow noreferrer">Python Wand</a>. When I test it with an invalid input it throws a BlobError which is a custom error from the Wand library. However, it seems that there's another TypeError happening within Wand at some point when I do so, which results in a big ugly <code>Exception ignored in...</code> error message under the Pytest results stdout.</p>
<p>I'm checking if Pytest raises the BlobError and that's fine, but I can't also check if it raises the TypeError, or just mute that message. So here's the Pytest test output:</p>
<pre><code>================================ test session starts =================================
platform linux -- Python 3.5.2, pytest-3.2.5, py-1.5.2, pluggy-0.4.0
rootdir: /path/to/my/project/tests, inifile:
collected 1 item                                                                                                                              

test_split.py .

============================== 1 passed in 0.14 seconds ==============================
Exception ignored in: &lt;bound method Resource.__del__ of &lt;wand.image.Image: (empty)&gt;&gt;
Traceback (most recent call last):
  File "/my/comp/.local/share/virtualenvs/project-BRze6wfl/lib/python3.5/site-packages/wand/resource.py", line 232, in __del__
    self.destroy()
  File "/my/comp/.local/share/virtualenvs/project-BRze6wfl/lib/python3.5/site-packages/wand/image.py", line 2767, in destroy
    for i in range(0, len(self.sequence)):
TypeError: object of type 'NoneType' has no len()
</code></pre>
<p>And my test is simply:</p>
<pre><code>with pytest.raises(wand.exceptions.BlobError):
        wand_split.split(PDF,TEMP, 260)
</code></pre>
<p>So the test is working the way I want, but how do I deal with the extra Wand TypeError?</p>
</div>
<div class="post-text" itemprop="text">
<p>That message indicates an exception raised inside <code>__del__</code>, <a href="https://docs.python.org/3/reference/datamodel.html#object.__del__" rel="nofollow noreferrer">doc says</a>:</p>
<blockquote>
<p>Due to the precarious circumstances under which <strong>del</strong>() methods are invoked, exceptions that occur during their execution are ignored, and a warning is printed to sys.stderr instead. ...</p>
</blockquote>
<p>most likely, this happened when the python interpreter is exiting, to my knowledge, there is no simple way to mute this message with pytest. </p>
<p>But with the line-no of traceback, I guess you are using a buggy version of wand, someone has <a href="https://github.com/dahlia/wand/issues/324" rel="nofollow noreferrer">reported a similar issue on github</a>, you could try an upgrade and report issue back there.</p>
</div>
<span class="comment-copy">I'm using the latest Wand version. Even tried a different version, same issue.</span>
<span class="comment-copy">take a look at the github issue I mentioned, the proposed  patch haven't merged, therefore you need to apply it manually.</span>
<span class="comment-copy">Yup that patch fixes the issue. I'll mark the answer as right</span>
