<div class="post-text" itemprop="text">
<p>Hi people of StackOverflow</p>
<p>I am relatively new to Tweepy/Twitter API and am having a few issues getting it to return the URL's for images.</p>
<p>Basically, I have written a snippet of code that searches for tweets against a particular hashtag, then returns image URL entities that exist in the tweets. I am hitting an issue however when a tweet is returned that does not have any media in it. Error shown below:</p>
<pre><code>Traceback (most recent call last):
File "./tweepyTest.py", line 18, in &lt;module&gt;
for image in  tweet.entities['media']:
KeyError: 'media'
</code></pre>
<p>Below is my code:</p>
<pre><code>for tweet in tweepy.Cursor(api.search,q="#hashtag",count=5,include_entities=True).items(5):
        #print tweet.text
        for image in  tweet.entities['media']:
            print image['media_url']
</code></pre>
<p>I am guessing I need to encase the for loop in some kind of if statement, however I am struggling to get my head around how.</p>
<p>Any help would be much appreciated.</p>
<p>EDIT:
I think I might have found a solution, however i'm not sure it is particularly elegant.....using a try/except.</p>
<pre><code>for tweet in tweepy.Cursor(api.search,q="#hashtag",count=5,include_entities=True).items(5):
    #print tweet.text
    try:
            for image in  tweet.entities['media']:
                    print image['media_url']
    except KeyError:
            pass
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>You could check for the existence of the key:</p>
<pre><code>for tweet in tweepy.Cursor(api.search,q="#hashtag",count=5,include_entities=True).items(5):
    #print tweet.text
    if 'media' in tweet.entities:
        for image in  tweet.entities['media']:
            print image['media_url']
</code></pre>
<p>Or get an empty list if there is no such key:</p>
<pre><code>for tweet in tweepy.Cursor(api.search,q="#hashtag",count=5,include_entities=True).items(5):
    #print tweet.text
    for image in  tweet.entities.get('media', []):
        print image['media_url']
</code></pre>
</div>
<span class="comment-copy">can you explain how  <code>tweet.entities.get('media', [])</code> works ?? little confused with it and <code>tweet.entities['media']</code></span>
<span class="comment-copy">@KrishanuKonar - <code>tweet.entities</code> is a dictionary. Dictionaries have <a href="https://docs.python.org/3/library/stdtypes.html#dict.get" rel="nofollow noreferrer">a get() method</a> which returns the value of the requested key if it exists, or the default value given if the key does not exist. So <code>tweet.entities.get('media', [])</code> returns the list of media items if it exists, or an empty list if it doesn't exist. <code>tweet.entities['media']</code> works fine if the <code>media</code> key exists, but will raise a <code>KeyError</code> exception if it doesn't.</span>
