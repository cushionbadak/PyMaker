<div class="post-text" itemprop="text">
<p>I want to find the cumulative product of returns. I have tried the following code:</p>
<pre><code>df['cumret'] = df.groupby(level=['date','id']).(1 + df.ret).cumprod() - 1
</code></pre>
<p>However, it returns an error message of </p>
<p>SyntaxError: invalid syntax</p>
<p>Any help would be greatly appreciated</p>
<pre><code>import pandas as pd

data = {'date': ['2014-05-01', '2014-05-01', '2014-05-01', '2014-05-01',
             '2014-05-02', '2014-05-02', '2014-05-02', '2014-05-02' 
             '2014-05-03', '2014-05-03', '2014-05-03', '2014-05-03']
    'id': [a, b, c, d, a, b, c, d, a, b, c, d],
    'sd': [0.05, 0.01, 0.03 , 0.05, 0.10, 0.04, 0.01, 0.03, 0.06, 0.07, 
           0.10, 0.20]
    'ret':[0.01, 0.05, -0.06, -0.10, 0.20, 0.08, 0.09, 0.10, 0.20,0.03,
           0.30, -0.15}

df = pd.DataFrame(data).set_index(['date', 'id']).sort_index(level='date')
</code></pre>
<p>df</p>
<pre><code>             id    sd   ret
date               
2014-05-01   a    0.05   0.01 
2014-05-01   b    0.01   0.05
2014-05-01   c    0.03  -0.06
2014-05-01   d    0.05  -0.10
2014-05-02   a    0.10   0.20
2014-05-02   b    0.04   0.08
2014-05-02   c    0.01   0.09
2014-05-02   d    0.03   0.10
2014-05-03   a    0.06   0.20
2014-05-03   b    0.07   0.03
2014-05-03   c    0.10   0.30
2014-05-03   d    0.20  -0.15
</code></pre>
<p>Desired output</p>
<pre><code>             id    sd   ret    cumret
date               
2014-05-01   a    0.05   0.01   1.01
2014-05-01   b    0.01   0.05   1.05
2014-05-01   c    0.03  -0.06   0.94
2014-05-01   d    0.05  -0.10   0.90
2014-05-02   a    0.10   0.20   1.21
2014-05-02   b    0.04   0.08   1.13
2014-05-02   c    0.01   0.09   1.03
2014-05-02   d    0.03   0.10   1.00
2014-05-03   a    0.06   0.20   1.41
2014-05-03   b    0.07   0.03   1.16
2014-05-03   c    0.10   0.30   1.33
2014-05-03   d    0.20  -0.15   0.85
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>I believe you need add <code>1</code> to <code>ret</code> column and groupbing by <code>id</code> column only:</p>
<pre><code>df['cumret'] = (df['ret'] + 1).groupby(level=['id']).cumprod()

print(df)
                 sd   ret   cumret
date       id                     
2014-05-01 a   0.05  0.01  1.01000
           b   0.01  0.05  1.05000
           c   0.03 -0.06  0.94000
           d   0.05 -0.10  0.90000
2014-05-02 a   0.10  0.20  1.21200
           b   0.04  0.08  1.13400
           c   0.01  0.09  1.02460
           d   0.03  0.10  0.99000
2014-05-03 a   0.06  0.20  1.45440
           b   0.07  0.03  1.16802
           c   0.10  0.30  1.33198
           d   0.20 -0.15  0.84150
</code></pre>
<p>If want grouping by both:</p>
<pre><code>df['cumret'] = (df['ret'] + 1).groupby(level=['date', 'id']).cumprod()

print(df)
                 sd   ret  cumret
date       id                    
2014-05-01 a   0.05  0.01    1.01
           b   0.01  0.05    1.05
           c   0.03 -0.06    0.94
           d   0.05 -0.10    0.90
2014-05-02 a   0.10  0.20    1.20
           b   0.04  0.08    1.08
           c   0.01  0.09    1.09
           d   0.03  0.10    1.10
2014-05-03 a   0.06  0.20    1.20
           b   0.07  0.03    1.03
           c   0.10  0.30    1.30
           d   0.20 -0.15    0.85
</code></pre>
</div>
<span class="comment-copy"><code>.(1 + df.ret)</code>?</span>
