<div class="post-text" itemprop="text">
<p>Thank you for reading,
I´m trying to compare two or more csv files to look if a address exists in more than one file. 
The csv files that I´m tryting to comapre look like this</p>
<p>test1.csv</p>
<pre><code>address
5A:BA:2A:83:AA:81
FB:AB:8E:74:3A:EB
</code></pre>
<p>test2.csv</p>
<pre><code>address
5A:BA:2A:83:AA:81
FB:AB:8E:74:3A:EB
</code></pre>
<p>The python script I use is the following (which is borrowed from a similar project here on stackoverflow)</p>
<pre><code>from itertools import dropwhile
from collections import defaultdict
import glob
import csv

fieldnames = ['address']
address = defaultdict(list)

for csv_filename in glob.glob('*.csv'):
with open(csv_filename, 'rb') as f_input:
    csv_reader = csv.DictReader(f_input, fieldnames=fieldnames,   skipinitialspace=False)
    next(dropwhile(lambda x: x['address'] != 'address', csv_reader))

    for row in csv_reader:
        address[row['address']].append(row)


with open('output.csv', 'wb') as f_output:
csv_writer = csv.DictWriter(f_output, fieldnames=fieldnames, extrasaction='ignore')
csv_writer.writeheader()

for address, rows in sorted(address.items()):
    if len(rows) &gt; 1:
        csv_writer.writerows(rows)
</code></pre>
<p>Expected outcome is a new .csv file with the the addresses that exists in more than one file.</p>
<p>However, I recieve the following error code:</p>
<pre><code>Traceback (most recent call last):
File "match.py", line 12, in &lt;module&gt;
next(dropwhile(lambda x: x['address'] != 'address', csv_reader))
StopIteration
</code></pre>
<p>Any help regarding this matter is much appreciated, and thank you again for taking your time to read this!</p>
</div>
<div class="post-text" itemprop="text">
<p>With <a href="https://docs.python.org/3/library/csv.html#csv.DictReader" rel="nofollow noreferrer"><code>DictReader</code></a>, the header row is automatically consumed and parsed as headers for you so you do not need to do anything to skip the header yourself. You code would work if you simply remove the line <code>next(dropwhile(lambda x: x['address'] != 'address', csv_reader))</code>.</p>
</div>
<span class="comment-copy">It means nothing matched "address" so the entire <code>csv_reader</code> was exhausted, you then call <code>next</code> on it and there's nothing to give you and no default value given so it raises <code>StopIteration</code>... Looks like you want to move that somewhere else or remove it altogether as your next step appears to be adding to your defaultdict...</span>
<span class="comment-copy">StopIteration means you're at the end of the iteration. In this case, it would seem the dropwhile returned an empty sequence.</span>
<span class="comment-copy">@JonClements Ok, thank you. Is it possible to see what causes the no match for 'address' since that obviously is in the file?</span>
<span class="comment-copy">@bhlsing, thank you! Would that also make the code more resilient  if there were to be any corrupt files, in terms of that address as header for example does not exist for some reason? Will it still try to do a match?</span>
<span class="comment-copy"><code>DictReader</code> will take whichever columns are in the first row as headers, the headers are absent for some reason, it will take the actual data as headers, which isn't what you want. So if you want your code to be flexible, you then have to use the regular <code>csv.reader</code>, read the first row, and if the first row appears to be headers, ditch it, or otherwise take it as the first entry of your data.</span>
