<div class="post-text" itemprop="text">
<p>I'm trying to parse input packets from network with python.</p>
<p>For do that i created simple class:</p>
<pre><code>class S2C_ChallengePacket(ctypes.Structure):
    _pack_ = 1
    _fields_ = [
    ("type", ctypes.c_byte),
    ("sessionid", ctypes.c_byte * 4),
    ("challenge", ctypes.c_wchar_p)]
</code></pre>
<p>Field "challenge" it's null-terminated string and it has a variable (changeable) size. So i added <em>pack</em> variable to my S2C_ChallengePacket class.</p>
<p><a href="http://docs.python.org/3/library/ctypes.html#ctypes.Structure._pack_" rel="nofollow">Python's documentation</a>:</p>
<blockquote>
<p><em>pack</em> An optional small integer that allows to override the alignment of structure fields in the instance. <em>pack</em> must already be defined when <em>fields</em> is assigned, otherwise it will have no effect.</p>
</blockquote>
<p>But, If i try refer to "challenge" field i get a "Segmentation fault" error.</p>
<pre><code>packet = QueryPacket.S2C_ChallengePacket.from_buffer_copy(data)
print packet.challenge &lt;--- "Segmentation fault" here
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>A <code>c_wchar_p</code> is a pointer, so that won't work. This would be easier using the struct module:</p>
<pre><code>&gt;&gt;&gt; base_size = struct.calcsize('&gt;BI')
&gt;&gt;&gt; response = b'\x09\x00\x00\x00\x019513307\x00'
&gt;&gt;&gt; response = response[:-1] # remove null
&gt;&gt;&gt; token_len = len(response) - base_size
&gt;&gt;&gt; struct.unpack('&gt;BI%ds' % token_len, response)
(9, 1, b'9513307')
</code></pre>
</div>
<span class="comment-copy">Are you sure pack is doing what you think it is doing?  Can you give an example of your data?</span>
<span class="comment-copy">Example here <a href="http://wiki.vg/Query#Response" rel="nofollow noreferrer">wiki.vg/Query#Response</a></span>
