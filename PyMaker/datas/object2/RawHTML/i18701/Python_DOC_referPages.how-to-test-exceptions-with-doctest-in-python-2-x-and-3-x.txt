<div class="post-text" itemprop="text">
<p>I defined an exception class <code>SpamException</code> in a module <code>spam</code>. Now I want to test a function <code>spam_function</code>, that raises this exception. So I wrote the following doctest.</p>
<pre><code>&gt;&gt;&gt; spam_function()
Traceback (most recent call last):
    ....
SpamException
</code></pre>
<p>The test succeeds on Python 2.x, but on Python 3.x the test fails. The following test works on Python 3.x.</p>
<pre><code>&gt;&gt;&gt; spam_function()
Traceback (most recent call last):
    ....
spam.SpamException
</code></pre>
<p>The notable difference here is the inclusion of the module name in the exception name. So how can I write a doctest that works on both Python 2.x and 3.x?</p>
</div>
<div class="post-text" itemprop="text">
<p>I would turn on the <a href="http://docs.python.org/3/library/doctest.html#doctest.IGNORE_EXCEPTION_DETAIL" rel="noreferrer"><code>doctest.IGNORE_EXCEPTION_DETAIL</code></a> directive, like this:</p>
<pre><code>&gt;&gt;&gt; spam_function() # doctest: +IGNORE_EXCEPTION_DETAIL
Traceback (most recent call last)
    ...
SpamException: 'lovely spam'
</code></pre>
<p>But note that <code>IGNORE_EXCEPTION_DETAIL</code> doesn't work for plain exception objects (with no associated arguments). In particular, the following example isn't portable to Python 3, because there's nothing following the exception name:</p>
<pre><code>&gt;&gt;&gt; spam_function() # doctest: +IGNORE_EXCEPTION_DETAIL
Traceback (most recent call last)
    ...
SpamException
</code></pre>
</div>
<span class="comment-copy">I did not notice any change when adding <code># doctest: +IGNORE_EXCEPTION_DETAIL</code>, i.e. it keeps failing with either Python version. Can you add a complete example?</span>
<span class="comment-copy">The <code>IGNORE_EXCEPTION_DETAIL</code> works as soon as the exception class in question has a <code>__str__</code> method that returns a non-empty string. Then and only then the final exception line has a colon, that is required for the directive to work.</span>
<span class="comment-copy">It seems that IGNORE_EXCEPTION_DETAIL ignores also the exception message, which removes a great part of the purpose of doctesting these behavior. But the exception type is still checked. ouf !</span>
