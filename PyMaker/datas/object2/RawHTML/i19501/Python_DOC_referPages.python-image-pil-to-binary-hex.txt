<div class="post-text" itemprop="text">
<pre><code>from PIL import Image
from PIL import ImageDraw
from PIL import ImageFont
import urllib.request
import io
import binascii

data = urllib.request.urlopen('http://pastebin.ca/raw/2311595').read()
r_data = binascii.unhexlify(data)
stream = io.BytesIO(r_data)
img = Image.open(stream)
draw = ImageDraw.Draw(img)
font = ImageFont.truetype("arial.ttf",14)
draw.text((0, 220),"This is a test11",(0,255,0),font=font)
draw = ImageDraw.Draw(img)

with open(img,'rb') as in_file: #error on here invalid file:
     hex_data = in_file.read()
# Unhexlify the data.
bin_data = binascii.unhexlify(bytes(hex_data))
print(bin_data)
</code></pre>
<h2>Question</h2>
<p>converting hex to image and draw a text on the image, after that convert image to binary hex,but having the problem at here <code>with open(img,'rb') as in_file:</code>, how to convert img to hex?</p>
</div>
<div class="post-text" itemprop="text">
<p>The <code>img</code> object needs to be saved again; write it to another <code>BytesIO</code> object:</p>
<pre><code>output = io.BytesIO()
img.save(output, format='JPEG')
</code></pre>
<p>then get the written data with the <a href="http://docs.python.org/3/library/io.html#io.BytesIO.getvalue"><code>.getvalue()</code> method</a>:</p>
<pre><code>hex_data = output.getvalue()
</code></pre>
<p>The PIL-for-python-3 landscape is rather muddled at the moment. The <a href="http://pypi.python.org/pypi/Pillow/">Pillow fork</a> looks to be the best, maintained version out there at the moment. It includes fixes that make saving to a <code>BytesIO</code> object work. If you run into a <code>io.UnsupportedOperation: fileno</code> exception using the above code, you have a version that was not yet fixed, in which case you'll have to resort to using a temporary file instead.</p>
</div>
<span class="comment-copy">What PIL variant are you using on Python 3? Pillow?</span>
<span class="comment-copy">@MartijnPieters i m using Aspell PIL python 3.3 <a href="http://www.lfd.uci.edu/~gohlke/pythonlibs/#pil" rel="nofollow noreferrer">lfd.uci.edu/~gohlke/pythonlibs/#pil</a></span>
<span class="comment-copy">Can I recommend you switch to <a href="http://pypi.python.org/pypi/Pillow/" rel="nofollow noreferrer">Pillow</a> instead? It is actively maintained and works great on Python 3.3, and it has important fixes included (such as handling writing to BytesIO).</span>
<span class="comment-copy">@MartijnPieters i don't see any Pillow support Python 3.3?<a href="http://pypi.python.org/pypi/Pillow/#downloads" rel="nofollow noreferrer">pypi.python.org/pypi/Pillow/#downloads</a></span>
<span class="comment-copy">You generally can build from source (it supports Python 3 just fine) unless you are on Windows.</span>
<span class="comment-copy">By saving a PIL.Image to an io.BytesIO(), I got the "UnsupportedOperation: fileno PIL" exception from CherryPy. I don't know if it's the same or something similar, but switching to Pillow worked as well, thanks.</span>
<span class="comment-copy">That'd be in Python 2, not 3... StringIO in Py3 would indicate you are using text mode and would gave to encode the data to get binary data, which could be corrupted because newline translation has been applied.</span>
<span class="comment-copy">Did you see my comments above on the question yet? :-)</span>
<span class="comment-copy">I using app engine and am stuck with a <code>PIL</code> version that throws <code>io.UnsupportedOperation: fileno</code> exception. However, I found that version of <code>PIL</code> is happy to write to a <code>StringIO</code> object, as described <a href="http://stackoverflow.com/a/15436293/4195568">here</a>.</span>
<span class="comment-copy">@YingXiong: this answer was specifically written for Python 3, not Python 2. The Google App Engine uses Python 2.7, not 3.</span>
