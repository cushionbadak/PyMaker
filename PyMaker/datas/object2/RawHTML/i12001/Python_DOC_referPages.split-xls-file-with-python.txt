<div class="post-text" itemprop="text">
<p>I have a large <code>.xls</code> file that I want to split into several files based on the first column. The data structure is kinda iffy which complicates it a lot. </p>
<p>Basically I need to create a separate file for every Row starting with "Question" (see below). The amount of options are variable so I cannot use chunk sizes. </p>
<p>Is there any way I can do this with Python? I have searched a lot on stackoverflow but I could not find an exact answer. Any help is very much appreciated.</p>
<pre class="lang-none prettyprint-override"><code>Column A     Column B    Column C
Question 1
Option 1     Info1       Info2
Option 2     Info3
Option 3
Question 2
Option 1
Option 2
Option 3
Option 4
Question 3
Option 1
Option 2
Option 3
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>For Python to use <code>.xls</code> files, you will need to use something like <code>xlrd</code> and <code>xlwt</code>. The following script should get you started:</p>
<pre><code>from itertools import groupby
import xlrd
import xlwt

workbook = xlrd.open_workbook(r"e:\python temp\input.xls")
sheet = workbook.sheet_by_index(0)
rows = [sheet.row_values(row, 0) for row in xrange(sheet.nrows)]

for k, g in groupby(rows, lambda x: x[0].startswith('Question')):
    if k:
        question = next(g)
    else:
        wb = xlwt.Workbook()
        ws = wb.add_sheet('Sheet 1')

        for colx, value in enumerate(question):
            ws.write(0, colx, value)

        for rowx, row in enumerate(g, start=1):
            for colx, value in enumerate(row):
                ws.write(rowx, colx, value)

        wb.save(question[0] + '.xls')
</code></pre>
<p>This opens your <code>input.xls</code> and reads all of the rows in. It then uses <code>groupby</code> to split it into questions and options. Each pair is then written to a new output Excel file based on the question, e.g. <code>Question 1.xls</code></p>
<p>You might need to add full paths to the input and output files.</p>
<p>The two libraries can be found at the <a href="http://www.python-excel.org/" rel="nofollow">python-excel</a> website.</p>
</div>
<div class="post-text" itemprop="text">
<p>The exact answer to your question would demand one to create the whole code, which is not SO's goal.</p>
<p>I would say, though, that this doesn't seem complicated to do using Python's <a href="https://docs.python.org/3/library/csv.html" rel="nofollow">csv module</a>. Please have a look at it and edit your question with further doubts and/or failed attempts of achieving the desired result.</p>
</div>
<span class="comment-copy">That worked perfectly! Thanks a lot for your help. Expanded my understanding of Python. Had to add the full paths indeed. Any suggestions on how to also output the contents of column B/C/etc based on this split?</span>
<span class="comment-copy">Glad it worked. Adding extra columns would be depend on what the full structure is, i.e. present on the question line or not? Different number per row?  You would need to edit the question to include a better sample.</span>
<span class="comment-copy">Column B contains percentages and Column C contains absolute numbers.  So for example:  Option 1            10%             55</span>
<span class="comment-copy">Essentially what I want to achieve is to split the entire xls file with all columns, based on the occurrence of 'Question' in Column A. Is that even possible?  Thanks in advance!</span>
<span class="comment-copy">I have updated it to support multiple columns. It should do what you need now.</span>
