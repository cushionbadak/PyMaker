<div class="post-text" itemprop="text">
<p>Well I hope this is a problem you didn't see before.</p>
<p>I paste the code here:</p>
<pre><code>import binascii
import urllib.request
import urllib.parse
client_id = '2da9e3d6414047c0000000000' # a made up string
client_secret = 'fe5f334a1cf240000000000' # a made up string

url = 'https://accounts.spotify.com/api/token'
data = {'grant_type':'client_credentials'}
data = urllib.parse.urlencode(data)
login = client_id + ':' + client_secret
encoded_login = binascii.b2a_base64(login.encode('ascii'))
encoded_login = encoded_login.decode('utf-8')
print(encoded_login) ## so you know it is a string indeed

headers = {'Authorization': 'Basic ' + encoded_login}
try:
    req = urllib.request.Request(url, data.encode('ascii'), headers)
    with urllib.request.urlopen(req) as response:
        result = response.read()
except:
    raise Exception('some failure')   
</code></pre>
<p>I didn't change anything so everyone can reproduce the problem. Now you see encoded_login has been successfully a string. But if you really run it, you should get 'Basic ' + encoded_login as a byte error. </p>
<p>Here is the error I get:</p>
<pre><code>Invalid header value b'Basic MmRhOWUzZDY0MTQwNDdjMDAwMDAwMDAwMDpmZTVmMzM0YTFjZjI0MDAwMDAwMDAwMA==\n'
</code></pre>
<p>How interesting and what a magic!. The string concat + has been converted to byte concate. Do you repo this and can you share your ideas of what is the reason? </p>
<p>Thanks </p>
</div>
<div class="post-text" itemprop="text">
<p>The binascii.b2a_base64 function appends a newline to its output: the <a href="https://docs.python.org/3/library/binascii.html" rel="nofollow">docs</a> state:</p>
<blockquote>
<p>Convert binary data to a line of ASCII characters in base64 coding.
  The return value is the converted line, including a newline char. The
  newline is added because the original use case for this function was
  to feed it a series of 57 byte input lines to get output lines that
  conform to the MIME-base64 standard.</p>
</blockquote>
<p>A newline is not permitted in header values, that's why you get the error message.  The exception reports the header value as bytes because the python http client code converts the request to bytes for transmission across the network.</p>
<p>Use the <a href="https://docs.python.org/3/library/base64.html" rel="nofollow">base64 module</a> functions - for example base64.b64encode - to avoid the newline being added.</p>
</div>
