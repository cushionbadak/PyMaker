<div class="post-text" itemprop="text">
<p>The structure of the project is:</p>
<p>project<br/>
- main.py<br/>
- session.py<br/>
- spider.py</p>
<p>There is a class in session.py:</p>
<pre><code>import requests

class Session:

    def __init__(self):
        self.session = requests.Session()
        print('Session created.')
</code></pre>
<p>And another class in spider.py:</p>
<pre><code>from session import Session

class Spider:

    def __init__(self, sess: Session = Session()):
        print('Spider created.')
</code></pre>
<p>When I import class <code>Spider</code> from spider.py in main.py like this:</p>
<pre><code>from spider import Spider

if __name__ == '__main__':

    print('Main function.')
    spider = Spider()
</code></pre>
<p>And run main.py, I get:</p>
<blockquote>
<p>Session created.<br/>
  Main function.<br/>
  Spider created.  </p>
</blockquote>
<p>It confuses me. I think <code>__init__</code> is the initial function used when initializing an instance, but in this case the <code>__init__</code> function of <code>Session</code> is called when <code>Session</code> is imported in spider.py. I think it must be related to the default value of <code>__init__</code> function in spider.py, but why?</p>
</div>
<div class="post-text" itemprop="text">
<p>The default values of parameters get evaluated only once in python.  This is <a href="https://docs.python.org/3/reference/compound_stmts.html#function-definitions" rel="nofollow noreferrer">documented here</a> and also <a href="https://docs.python.org/3/reference/expressions.html#calls" rel="nofollow noreferrer">here</a> as stated by <a href="https://stackoverflow.com/users/2201041/jetm">JETM</a>.</p>
<p>Therefore a isntance of <code>Session</code> is created when you import <code>spider</code> as default value for the <code>sess</code> parameter of the spiders <code>__init__</code> method.</p>
<p>If you do not wish such a behavior you can use <code>None</code> as default value and create the <code>Sesssion</code> instance inside the <code>__init__</code> method if no other value was provided as pointed out by <a href="https://stackoverflow.com/users/137650/matslindh">MatsLindh</a> and <a href="https://stackoverflow.com/users/4819449/fhtmitchell">FHTMitchel</a> like this:</p>
<pre><code>...
def __init__(self, sess: Session = None):
    if sess is None:
        sess = Session()
    print('Spider created.')
</code></pre>
</div>
<span class="comment-copy">.. and the solution is to set <code>sess=None</code>, and then <code>if not sess: sess = Session()</code> in that class' <code>__init__</code>.</span>
<span class="comment-copy">@MatsLindh even better: <code>if sess is None: sess = Session()</code></span>
<span class="comment-copy">@JETM thank you, I have added the link to my answer.</span>
<span class="comment-copy">@MatsLindh and FHTMitchel you are both correct, I add this to my answer too</span>
