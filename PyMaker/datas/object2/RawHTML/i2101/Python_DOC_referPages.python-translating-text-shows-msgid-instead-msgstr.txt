<div class="post-text" itemprop="text">
<p>I'm newbie using gettext library to translate text. I want to translate the text that there is in the next file:</p>
<p><strong>dobles_message.py</strong></p>
<pre><code>def set_message(self, language):
    t = gettext.translation("basketmetrics_i18n", "../i18n", fallback=True, languages=["'" + language + "'"])
    t.install()
    _ = t.gettext
    self.message = _("mensaje_dd_1")
</code></pre>
<p>To do that,first I have create dobles_message.po with this instrucction:</p>
<pre><code>xgettext -i dobles_message.py -o dobles_message.pot -d basketmetrics_i18n
</code></pre>
<p>Then, I have created these directory structure i18n/es/LC_MESSAGES and i18n/en/LC_MESSAGES and I have created the .po version for each languate with these instructions:</p>
<pre><code>msginit -i dobles_message.pot -o ../i18n/es/LC_MESSAGES/basketmetrics_i18n.po -l es
msginit -i dobles_message.pot -o ../i18n/en/LC_MESSAGES/basketmetrics_i18n.po -l en
</code></pre>
<p>Thrid, I have change the charset and translate the text of each file.
And fourth, I have created the .mo files from each .po file with this instruction in directory i18n/es/LC_MESSAGES and in directory i18n/en/LC_MESSAGES</p>
<pre><code>msgfmt basketmetrics_i18n.po -o basketmetrics_i18n.mo
</code></pre>
<p>But, when I run my application instead of translate the text, muy application shows me the msgid.</p>
<p>These is how is my structure of files and directories:</p>
<p><a href="https://i.stack.imgur.com/GS5iD.png" rel="nofollow noreferrer"><img alt="enter image description here" src="https://i.stack.imgur.com/GS5iD.png"/></a></p>
<p>And the content of my files are next ...</p>
<p><strong>dobles_message.pot</strong></p>
<pre><code># SOME DESCRIPTIVE TITLE.
# Copyright (C) YEAR THE PACKAGE'S COPYRIGHT HOLDER
# This file is distributed under the same license as the PACKAGE package.
# FIRST AUTHOR &lt;EMAIL@ADDRESS&gt;, YEAR.
#
#, fuzzy
msgid   ""
msgstr  "Project-Id-Version: PACKAGE VERSION\n"
        "Report-Msgid-Bugs-To: \n"
        "POT-Creation-Date: 2018-10-10 13:22+0200\n"
        "PO-Revision-Date: YEAR-MO-DA HO:MI+ZONE\n"
        "Last-Translator: FULL NAME &lt;EMAIL@ADDRESS&gt;\n"
        "Language-Team: LANGUAGE &lt;LL@li.org&gt;\n"
        "Language: \n"
        "MIME-Version: 1.0\n"
        "Content-Type: text/plain; charset=CHARSET\n"
        "Content-Transfer-Encoding: 8bit\n"

#: dobles_message.py:15
msgid   "mensaje_dd_1"
msgstr  ""
</code></pre>
<p><strong>basketmetrics_i18n.po (English version)</strong></p>
<pre><code>    # English translations for PACKAGE package.
    # Copyright (C) 2018 THE PACKAGE'S COPYRIGHT HOLDER
    # This file is distributed under the same license as the PACKAGE package.
    # José Carlos &lt;josecarlos@asterix&gt;, 2018.
    #
    msgid ""
    msgstr ""
    "Project-Id-Version: PACKAGE VERSION\n"
    "Report-Msgid-Bugs-To: \n"
    "POT-Creation-Date: 2018-10-10 13:22+0200\n"
    "PO-Revision-Date: 2018-10-10 13:31+0200\n"
    "Last-Translator: Jos Carlos &lt;josecarlos@asterix&gt;\n"
    "Language-Team: English\n"
    "Language: en\n"
    "MIME-Version: 1.0\n"
    "Content-Type: text/plain; charset=utf-8\n"
    "Content-Transfer-Encoding: 8bit\n"
    "Plural-Forms: nplurals=2; plural=(n != 1);\n"

    #: dobles_message.py:15
    msgid "mensaje_dd_1"
    msgstr "¡¡¡Hi ###twitter###!!! From www.basketmetrics.com we want to congrats to get your double double nº ###numero### this season. ¡¡¡Congratulations!!!"
</code></pre>
<p><strong>basketmetrics_i18n.po (Spanish version)</strong></p>
<pre><code># Spanish translations for PACKAGE package.
# Copyright (C) 2018 THE PACKAGE'S COPYRIGHT HOLDER
# This file is distributed under the same license as the PACKAGE package.
# José Carlos &lt;josecarlos@asterix&gt;, 2018.
#
msgid ""
msgstr ""
"Project-Id-Version: PACKAGE VERSION\n"
"Report-Msgid-Bugs-To: \n"
"POT-Creation-Date: 2018-10-10 13:22+0200\n"
"PO-Revision-Date: 2018-10-10 13:28+0200\n"
"Last-Translator: Jos Carlos &lt;josecarlos@asterix&gt;\n"
"Language-Team: Spanish\n"
"Language: es\n"
"MIME-Version: 1.0\n"
"Content-Type: text/plain; charset=latin-1\n"
"Content-Transfer-Encoding: 8bit\n"
"Plural-Forms: nplurals=2; plural=(n != 1);\n"

#: dobles_message.py:15
msgid "mensaje_dd_1"
msgstr "¡¡¡Hola ###twitter###!!! Desde www.basketmetrics.com queremos felicitarte por haber conseguido tu doble doble nº ###numero### esta temporada. ¡¡¡Felicidades!!!"
</code></pre>
<p>What am I doing wrong? I'm using python3</p>
<p><strong>Edit I:</strong></p>
<p>In my code, I have remove the option "fallback=True" and I get this error:</p>
<p><a href="https://i.stack.imgur.com/HULsp.png" rel="nofollow noreferrer"><img alt="enter image description here" src="https://i.stack.imgur.com/HULsp.png"/></a></p>
<p>In my first step I define the domain "basmetmetrics_i18n" and I've got the .po files created with that name. What happend? </p>
<p><strong>Edit II:</strong></p>
<p>Following the wise advice from @stovfl I have change my set_message function:</p>
<pre><code>def set_message(self, language):
    print("language: " + language)
    gettext.bindtextdomain('basketmetrics_i18n', '../i18n')
    gettext.textdomain('basketmetrics_i18n')
    _ = gettext.gettext
    self.message = _("mensaje_dd_1")
    print("Mensaje traducido: " + self.message)
</code></pre>
<p>Right now, I haven't any error in my application but I'm still getting the msgid instead of the msgstr. I don't understand anything :(</p>
</div>
<div class="post-text" itemprop="text">
<blockquote>
<p><strong>Question</strong>:  using gettext library to translate text</p>
</blockquote>
<hr/>
<p>From the Documentation:</p>
<blockquote>
<p><strong>gettext(message)</strong></p>
<p>Look up the message id in the catalog and return the corresponding message string, as a Unicode string. <strong>If there is no entry in the catalog</strong> for the message id, and a fallback has been set, the look up is forwarded to the fallback’s gettext() method. <strong>Otherwise, the message id is returned</strong>.</p>
</blockquote>
<hr/>
<p>Your code, will work for me, if you change the following <code>languages=[language]</code>:</p>
<pre><code>def set_message(self, language):
    t = gettext.translation(package, localedir, fallback=True, languages=[language])
    t.install()
    _ = t.gettext
    message = _("mensaje_dd_1")

set_message('es')
</code></pre>
<hr/>
<blockquote>
<p>According to <a href="https://docs.python.org/3/library/gettext.html#gnu-gettext-api" rel="nofollow noreferrer">Python Documentation</a>, you have to do:</p>
<pre><code>import gettext
gettext.bindtextdomain('myapplication', '/path/to/my/language/directory')
gettext.textdomain('myapplication')
_ = gettext.gettext
# ...
print(_('This is a translatable string.'))
</code></pre>
</blockquote>
</div>
<div class="post-text" itemprop="text">
<p>Finally, I have found the error. The error due to the path to the directory where you have your language directory. You have to specify this route from the root of the project and not from the file where you want to translate the text. So, my function finally is:</p>
<pre><code>def set_message(self, language):
    t = gettext.translation("basketmetrics_i18n", "../i18n", fallback=True, languages=["'" + language + "'"])
    t.install()
    _ = t.gettext
    self.message = _("mensaje_dd_1")
</code></pre>
<p>Because my directory language "i18n" is on the root of the project</p>
</div>
<span class="comment-copy">But in my .po files is defined the string to return for each id. Sorry, but I don't understand :( Where is not definied the string to return?</span>
<span class="comment-copy">@JoséCarlos: Try to do it according to the above example using <b>your</b> values.</span>
<span class="comment-copy">I have edit my original post</span>
<span class="comment-copy">@JoséCarlos: Updatet my Answer. Reproduced your setup and its working. Doublecheck your <b>.mo</b> file, if your expected <code>msgstr</code> is there. Check your environment variables <code>LANGUAGE, LC_ALL, LC_MESSAGES, and LANG</code>, you need at least <b>one</b>.</span>
