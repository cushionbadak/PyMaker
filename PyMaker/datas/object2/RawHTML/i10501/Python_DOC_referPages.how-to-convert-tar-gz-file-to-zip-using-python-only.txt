<div class="post-text" itemprop="text">
<p>Does anybody has any code for converting tar.gz file into zip using only Python code? I have been facing many issues with tar.gz as mentioned in the <a href="https://stackoverflow.com/questions/39263929/how-can-i-read-tar-gz-file-using-pandas-read-csv-with-gzip-compression-option">How can I read tar.gz file using pandas read_csv with gzip compression option?</a></p>
</div>
<div class="post-text" itemprop="text">
<p>You would have to use the <a href="https://docs.python.org/3/library/tarfile.html" rel="nofollow noreferrer">tarfile</a> module, with mode <code>'r|gz'</code> for reading.
Then use <a href="https://docs.python.org/3/library/zipfile.html#module-zipfile" rel="nofollow noreferrer">zipfile</a> for writing.</p>
<pre><code>import tarfile, zipfile
tarf = tarfile.open( name='mytar.tar.gz', mode='r|gz' )
zipf = zipfile.ZipFile( file='myzip.zip', mode='a', compression=zipfile.ZIP_DEFLATED )
for m in tarf:
    f = tarf.extractfile( m )
    fl = f.read()
    fn = m.name
    zipf.writestr( fn, fl )
tarf.close()
zipf.close()
</code></pre>
<p>You can use <code>is_tarfile()</code> to check for a valid tar file.</p>
<p>Perhaps you could also use <a href="https://docs.python.org/3/library/shutil.html#archiving-operations" rel="nofollow noreferrer"><code>shutil</code></a>, but I think it cannot work on memory.</p>
<p>PS: From the brief testing that I performed, you may have issues with members <code>m</code> which are directories.
If so, you may have to use <code>is_dir()</code>, or even first get the info on each tar file member with <code>tarf.getmembers()</code>, and the open the <code>tar.gz</code> file for transferring to <code>zip</code>, since you cannot do it after <code>tarf.getmembers()</code> (you cannot seek backwards). </p>
</div>
<span class="comment-copy">It must be a problem in the csv not the tar.gz</span>
<span class="comment-copy">I wish that was true, but I tried with three different tar.gz files.</span>
<span class="comment-copy">@Geet - Do you have feedback on answers?</span>
<span class="comment-copy">Can you please suggest me a code that I can try?</span>
<span class="comment-copy">@Geet - Please check corrected version. My apologies, I do not have python here. I guess it is not hard to catch typos/glitches.</span>
<span class="comment-copy">Really appreciate your help, here.I need just one more step. I changed zipf = ZipFile.open to zipf = zipfile.ZipFile.open. Now, it says "NameError: name 'ZIP_DEFLATED' is not defined"</span>
<span class="comment-copy">@Geet - I have now tested the code and fixed it. Please let me know if it suits you. Beware of the issue with directories that I mention!</span>
