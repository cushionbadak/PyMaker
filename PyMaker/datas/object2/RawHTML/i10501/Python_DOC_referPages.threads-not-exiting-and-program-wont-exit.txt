<div class="post-text" itemprop="text">
<p>Using the script below, I cannot seem to exit the threads. The script runs smoothly without issues but never exits when done. I can still see the thread alive, I have to use <code>htop</code> to kill them or completely exit the command line.</p>
<p>How can I get this script to exit and the threads to die?</p>
<pre><code>def async_dns():
    s = adns.init()
    while True:
        dname = q.get()
        response = s.synchronous(dname,adns.rr.NS)[0]
        if response == 0:
            dot_net.append("Y")
            print(dname + ", is Y")
        elif response == 300 or response == 30 or response == 60:
            dot_net.append("N")
            print(dname + ", is N")
        elif q.empty() == True:
            q.task_done()

q = queue.Queue()
threads = []
for i in range(20):
    t = threading.Thread(target=async_dns)
    threads.append(t)
    t.start()

for name in names:
    q.put_nowait(name)
</code></pre>
</div>
<div class="post-text" itemprop="text">
<blockquote>
<p>Remove and return an item from the queue. If optional args block is true and timeout is None (the default), block if necessary until an item is available. If timeout is a positive number, it blocks at most timeout seconds and raises the Empty exception if no item was available within that time. Otherwise (block is false), return an item if one is immediately available, else raise the Empty exception (timeout is ignored in that case).</p>
</blockquote>
<p>Remember to check your queue.</p>
<p>See the document of <a href="https://docs.python.org/3/library/queue.html#module-queue" rel="nofollow">queue</a>.</p>
</div>
<div class="post-text" itemprop="text">
<p>Your threads are stuck in <code>dname = q.get()</code></p>
<p>If you reaching empty queue, <code>q.get()</code> will wait forever for value to arrive.</p>
<p>You can replace <code>get</code> with <code>get_nowait()</code> but get ready to catch <code>Queue.Empty</code> execption</p>
</div>
<span class="comment-copy">Fill the queue before starting the threads and let the thread function return when the queue is empty.</span>
<span class="comment-copy">Are thread starts inside the async_dns?</span>
<span class="comment-copy">You can easily make it so all the threads exit when the main one does. See <a href="http://stackoverflow.com/questions/38804988/what-does-sys-exit-really-do-with-multiple-threads/38805873#38805873">my answer</a> to the question <i>What does sys.exit really do with multiple threads?</i> Note in your case you don't need to call <code>sys.exit()</code> explicitly, it will happen automatically after the final <code>for</code> loop at the end of the script.</span>
