<div class="post-text" itemprop="text">
<p>I am using <code>keras.preprocessing.image.array_to_img</code> to convert array data (representative of an image) to an image. Then when I use <code>.save()</code>, I notice that the data got transformed. </p>
<p>I have no idea why.</p>
<p>Thus I created a simple example and it turns out that <code>array_to_img()</code> really does something unexpected, or I am missing something:</p>
<hr/>
<pre><code>from keras.preprocessing.image import image
import matplotlib.pyplot as plt
import numpy as np

array1=np.array([[[255,0,0],[100,0,0]],
               [[0,0,0],[0,0,0]]])
plt.imshow(array1)
plt.show()

img_4=image.array_to_img()
img_4.save('img_4.jpg')

img_4load = image.load_img('img_4.jpg', target_size=(2, 2))
img_4load_array = image.img_to_array(img_4load)
print(img_4load_array)
</code></pre>
<p>Results:</p>
<pre><code>[[[117.  39.  39.]
  [ 97.  19.  19.]]

 [[ 65.   0.   0.]
  [ 55.   0.   0.]]]
</code></pre>
<p>My array data has been changed!!</p>
<p>Why does this happen and how can I avoid this?</p>
</div>
<div class="post-text" itemprop="text">
<p>The <code>jpeg</code> is a format which is compressed. This means that when you save an image with this format it will be passed by a compaction process with loss or simply compression. The purpose of this is to save storage space. With a real image and within a certain range of loss, our eyes are not able to distinguish the difference between the real image and the compressed one. Since your image is very small the modifications were huge. To keep the values unaltered, save the image in a format that does not compress the image, for instance, the <code>png</code> format. You just need to change the extension when saving: </p>
<pre><code>img_4.save('img_4.png')
</code></pre>
<p>You can see <a href="https://pillow.readthedocs.io/en/3.1.x/handbook/image-file-formats.html" rel="nofollow noreferrer">here</a> the available image formats in PIL module and you can read more about image compression <a href="https://en.wikipedia.org/wiki/Image_compression" rel="nofollow noreferrer">here</a></p>
</div>
<span class="comment-copy">That does make sense. Thank you so much, Hemerson!</span>
<span class="comment-copy">I am glad to hear that. If this post answers your question, please consider accepting it :) (just click in the check button)</span>
