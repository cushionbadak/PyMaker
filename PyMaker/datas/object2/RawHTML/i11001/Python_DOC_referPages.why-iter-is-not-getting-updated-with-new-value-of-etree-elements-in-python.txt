<div class="post-text" itemprop="text">
<p>The iter() function is pointing to an element which i removed from etree during the previous iteration,why iter () is not updated with new value? is there anything wrong with the code? heres the code</p>
<pre><code>root = etree.parse(open("Sample.xml",'r'))
for e in root.iter():
    print etree.tostring(e)
    b=root.getpath(e)
    for bad in root.xpath(b):
        if(some condition):
            bad.getparent().remove(bad)#removing some elements in etree which are yet to come in the iter()
    print etree.tostring(root, pretty_print=True, xml_declaration=True)
</code></pre>
<p><strong>My XMl input:</strong></p>
<pre><code>&lt;?xml version="1.0"?&gt;
&lt;catalog&gt;
   &lt;book id="bk101"&gt;
      &lt;author&gt;Gambardella, Matthew&lt;/author&gt;
      &lt;title&gt;XML Developer's Guide&lt;/title&gt;
      &lt;genre&gt;Computer&lt;/genre&gt;
      &lt;price&gt;44.95&lt;/price&gt;
      &lt;publish_date&gt;2000-10-01&lt;/publish_date&gt;
      &lt;description&gt;An in-depth look at creating applications 
      with XML.&lt;/description&gt;
   &lt;/book&gt;
   &lt;book id="bk102"&gt;
      &lt;author&gt;Ralls, Kim&lt;/author&gt;
      &lt;title&gt;Midnight Rain&lt;/title&gt;
      &lt;genre&gt;Fantasy&lt;/genre&gt;
      &lt;price&gt;5.95&lt;/price&gt;
      &lt;publish_date&gt;2000-12-16&lt;/publish_date&gt;
      &lt;description&gt;A former architect battles corporate zombies, 
      an evil sorceress, and her own childhood to become queen 
      of the world.&lt;/description&gt;
   &lt;/book&gt;
   &lt;book id="bk103"&gt;
      &lt;author&gt;fgh&lt;a1&gt;ss&lt;/a1&gt;&lt;a2&gt;dd&lt;/a2&gt;&lt;/author&gt;
      &lt;title&gt;Oberon's Legacy&lt;/title&gt;
      &lt;genre&gt;Fantasy&lt;/genre&gt;
      &lt;price&gt;5.95&lt;/price&gt;
      &lt;publish_date&gt;2001-03-10&lt;/publish_date&gt;
      &lt;description&gt;In post-apocalypse England, the mysterious 
      agent known only as Oberon helps to create a new life 
      for the inhabitants of London. Sequel to Maeve 
      Ascendant.&lt;/description&gt;
   &lt;/book&gt;
&lt;/catalog&gt;
</code></pre>
<p><strong>After going through all elements in 1st record of "book id=bk101",my etree is updated as</strong></p>
<pre><code>&lt;?xml version='1.0' encoding='ASCII'?&gt;
&lt;catalog&gt;
   &lt;book id="bk101"&gt;
      &lt;author&gt;Gambardella, Matthew&lt;/author&gt;
      &lt;title&gt;XML Developer's Guide&lt;/title&gt;
      &lt;genre&gt;Computer&lt;/genre&gt;
      &lt;price&gt;44.95&lt;/price&gt;
      &lt;publish_date&gt;2000-10-01&lt;/publish_date&gt;
      &lt;description&gt;An in-depth look at creating applications 
      with XML.&lt;/description&gt;
   &lt;/book&gt;
   &lt;book id="bk103"&gt;
      &lt;author&gt;fgh&lt;a1&gt;ss&lt;/a1&gt;&lt;a2&gt;dd&lt;/a2&gt;&lt;/author&gt;
      &lt;/book&gt;
   &lt;/catalog&gt;
</code></pre>
<p>that is i deleted the "book id=bk102" record completely,but during next iter it is pointing to book id="bk102" element which is not in etree and the program ends without going through "book id=bk103"
 why it is behaving like that? </p>
</div>
<div class="post-text" itemprop="text">
<p><a href="https://docs.python.org/3/library/xml.etree.elementtree.html#xml.etree.ElementTree.Element.iter" rel="nofollow"><code>iter()</code> documentation</a> explicitly states that behavior is undefined in when tree is modified:</p>
<blockquote>
<p>Creates a tree iterator with the current element as the root. The iterator iterates over this element and all elements below it, in document (depth first) order. If tag is not None or '*', only elements whose tag equals tag are returned from the iterator. If the tree structure is modified during iteration, the result is undefined.</p>
</blockquote>
</div>
<span class="comment-copy">Generally speaking, <code>iterators</code> can get into really funky states when you modify the thing that they are iterating over as they are iterating over it...</span>
<span class="comment-copy">Related:  <a href="http://stackoverflow.com/a/38003580/748858">stackoverflow.com/a/38003580/748858</a></span>
<span class="comment-copy">Possible dupe?  <a href="http://stackoverflow.com/q/37702011/748858">stackoverflow.com/q/37702011/748858</a></span>
