<div class="post-text" itemprop="text">
<p>After following <a href="https://stackoverflow.com/a/6229675/1279472">this </a> answer, I wrote a C library which I call from python using ctypes. The C library contains a function which takes a <code>char*</code> and modifies its contents. I would like to read the contents in Python, however, after calling the library function in Python, I get an empty string even though I see the correct output in the terminal if I include a  <code>printf</code> statement in the C code. What am I doing wrong? </p>
<p>C code:</p>
<pre><code>void somefunction(char * pythonbuffer)
{
    /* do something */
    printf("%s", pythonbuffer);
}
</code></pre>
<p>Python code:</p>
<pre><code>lib.somefunction.argtypes = [ctypes.c_char_p] 
lib.somefunction.restype = ctypes.c_void_p 

buffer = ctypes.create_string_buffer(upper_limit)

lib.somefunction(buffer)

print(buffer.value)
</code></pre>
<p>Output:
<code>b''</code></p>
</div>
<div class="post-text" itemprop="text">
<p>Found the problem. Turns out that the code in the <code>/* do something */</code> part somehow changed the adress of <code>pythonbuffer</code>. I solved it by using a temporary <code>char *</code> and then copying it to <code>pythonbuffer</code> with <code>strcpy</code>.</p>
</div>
<span class="comment-copy">How exactly does <code>somefunction</code> modify its parameter <code>pythonbuffer</code>?  What did you expect to see happen?</span>
<span class="comment-copy">It calls another library which stores a long string in <code>pythonbuffer</code>. If I then print the content in C I get what I expect, but I can't get the same output in Python.</span>
<span class="comment-copy">i guess you want <code>lib.somefunction(ctypes.POINTER(buffer))</code></span>
<span class="comment-copy">@Coldspeed, <code>POINTER(buffer)</code> makes no sense, and <code>pointer(buffer)</code> would be redundant.</span>
<span class="comment-copy">@Coldspeed , if you look at <a href="https://docs.python.org/3/library/ctypes.html#passing-pointers-or-passing-parameters-by-reference" rel="nofollow noreferrer">this</a> the buffer should be passed as is.</span>
<span class="comment-copy">Remember to fix <code>restype</code> to be <code>None</code> instead of returning a garbage <code>c_void_p</code> pointer.</span>
<span class="comment-copy">Yep, I did that.</span>
