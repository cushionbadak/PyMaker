<div class="post-text" itemprop="text">
<p>I am working on a Python wrapper to a DLL/SO. I have verified the code works calling the actual DLL and SO. I would like to unit test my wrapper without requiring the underlying DLL/SO be installed though. I am looking at using <a href="https://docs.python.org/3/library/unittest.mock.html" rel="nofollow noreferrer">mock</a>. </p>
<p>The problem I am having trouble with is with functions that take byref parameters and return values that way. For example, if the C fundtion looks something like this:</p>
<pre><code>int initialize(char *resource, ulong *new_handle)
{
    // Some code here
    *new_handle = temp_handle;
    return error;
}
</code></pre>
<p>and the Python code would look like:</p>
<pre><code>error_code = library.initialize(resource.encode('ascii'), ctypes.byref(session_handle))
</code></pre>
<p>I am able to mock the function and set the return value (error_code), but I have not been able to figure out how to set the value that is returned in session_handle.</p>
<p>Is this possible  and if so, how?</p>
</div>
<div class="post-text" itemprop="text">
<p>You can access the object passed to <code>byref</code> through the <code>_obj</code> attribute of the return value:</p>
<pre><code>x is ctypes.byref(x)._obj
</code></pre>
<p>Or at least, you can for now. This is an undocumented API and subject to change.</p>
<p>Once you have the object, you can set its value the usual ctypes way, through its <code>value</code> attribute:</p>
<pre><code>byref_session_handle._obj.value = whatever
</code></pre>
</div>
<span class="comment-copy">sorry, could you clear your answer further?</span>
