<div class="post-text" itemprop="text">
<p>I'm using a python package, <a href="https://code.mpimet.mpg.de/projects/cdo/wiki/Cdo%7Brbpy%7D" rel="nofollow noreferrer">cdo</a>, which heavily relies on <a href="https://docs.python.org/3.5/library/tempfile.html" rel="nofollow noreferrer">tempfile</a> for storing intermediate results. The created temporary files are quite large and when running bigger calculations, I've run into the problem that the <code>/tmp</code> directory got filled up and the script failed with a <code>disk full</code> error (we are talking about 10s to 100s of GB). I've found a workaround to the problem by creating a local folder, say <code>$HOME/tmp</code> and then doing</p>
<pre><code>import tempfile
tempfile.tempdir='$HOME/tmp'
</code></pre>
<p>before importing the <code>cdo</code> module. While this works for me, it is somewhat cumbersome if I want also others to use my scripts. Therefore I was wondering, whether there would be a more elegant way to solve the problem by, e.g., telling <code>tmpfile</code> periodically to clear out all temporary files (usually this is only done once the script finishes). From my side this would be possible, because I am running a long loop, which produces one named file each iteration and all the temporary files created during that iteration would be discardable afterwards.</p>
</div>
<div class="post-text" itemprop="text">
<p>as the <a href="https://docs.python.org/3/library/tempfile.html#examples" rel="nofollow noreferrer">examples</a> show: you could use <a href="https://docs.python.org/3/library/tempfile.html#module-tempfile" rel="nofollow noreferrer"><code>tempfile</code></a> in a context manager:</p>
<pre><code>with tempfile.TemporaryFile() as fp:
    fp.write(b'Hello world!')
    fp.seek(0)
    fp.read()
</code></pre>
<p>that way they are removed when the context exits.</p>
<p>...do you have that much control over how <code>cdo</code> uses tempfiles?</p>
</div>
<span class="comment-copy">Just use the tempfile module discussed in <a href="https://stackoverflow.com/questions/21257782/how-to-remove-file-when-program-exits" title="how to remove file when program exits">stackoverflow.com/questions/21257782/â€¦</a> It will auto-delete temp files when the file is closed.</span>
<span class="comment-copy">@MeterLongCat As stated in the question, cdo uses <code>tempfile</code>, and I need to delete <i>before</i> the script finishes. Unfortunately I don't have control over the parameters that cdo passes to the <code>TemporaryFile()</code> instances upon creation.</span>
<span class="comment-copy">Unfortunately I don't have that control, but the example is good anyway.</span>
<span class="comment-copy">...sorry about that!</span>
