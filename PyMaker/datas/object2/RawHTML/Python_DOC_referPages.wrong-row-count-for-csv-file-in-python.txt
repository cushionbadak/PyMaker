<div class="post-text" itemprop="text">
<p>I am processing a csv file and before that I am getting the row count using the below code.</p>
<pre><code>total_rows=sum(1 for row in open(csv_file,"r",encoding="utf-8"))
</code></pre>
<p>The code has been written with the help given in this <a href="https://stackoverflow.com/a/16108605/5658251">link</a>.
However, the total_rows doesn't match the actual number of rows in the csv file. I have found an alternative to do it but would like to know why is this not working correctly??</p>
<blockquote>
<p>In the CSV file, there are cells with huge text and I have to use the encoding to avoid errors reading the csv file.</p>
</blockquote>
<p>Any help is appreciated!</p>
</div>
<div class="post-text" itemprop="text">
<p>Let's assume you have a csv file in which some cell's a multi-line text.</p>
<pre><code>$ cat example.csv
colA,colB
1,"Hi. This is Line 1.
And this is Line2"
</code></pre>
<p>Which, by look of it, has three lines and <code>wc -l</code> agrees:</p>
<pre><code>$ wc -l example.csv
3 example.csv
</code></pre>
<p>And so does <code>open</code> with <code>sum</code>:</p>
<pre><code>sum(1 for row in open('./example.csv',"r",encoding="utf-8"))
# 3
</code></pre>
<p>But now if you read is with some csv parser such as <code>pandas.read_csv</code>:</p>
<pre><code>import pandas as pd

df = pd.read_csv('./example.csv')
df
   colA                                    colB
0     1  Hi. This is Line 1.\nAnd this is Line2
</code></pre>
<p>The other alternative way to fetch the correct number of rows is given below:</p>
<pre><code>with open(csv_file,"r",encoding="utf-8") as f:
     reader = csv.reader(f,delimiter = ",")
     data = list(reader)
     row_count = len(data)
</code></pre>
<p>Excluding the header, the csv contains 1 line, which I believe is what you expect.
This is because <code>colB</code>'s first cell (a.k.a. <em>huge text block</em>) is now properly handled with the quotes wrapping the entire text.</p>
</div>
<div class="post-text" itemprop="text">
<p>I think that the problem in here is because you are not counting rows, but counting newlines (either \r\n in windows or \n in linux). The problem lies when you have a cell with text where you have newline character example:</p>
<pre><code>1, "my huge text\n with many lines\n"
2, "other text"
</code></pre>
<p>Your method for data above will return <code>4</code> when accutaly there are only <code>2</code> rows</p>
<p>Try to use Pandas or other library for reading CSV files. Example:</p>
<pre><code>import pandas as pd
data = pd.read_csv(pathToCsv, sep=',', header=None);
number_of_rows = len(df.index) # or df[0].count()
</code></pre>
<p>Note that len(df.index) and df[0].count() are not interchangeable as count excludes NaNs.</p>
</div>
<span class="comment-copy">When you have <i>cells with huge text</i>, csv parsers such as <code>pandas.read_csv</code> will read it correctly as opposed to <code>open</code> which reads the file line by line, not considering the <i>huge text</i> as one.</span>
<span class="comment-copy">@Chris yes. I have found alternate ways to read the rows correctly. But what is wrong with the above code that was suggested for using to count rows??</span>
<span class="comment-copy">As I said, suppose your <i>huge text</i> is two or more lines. In csv, this is considered as <b>one cell</b> which will be inside a single line. Nevertheless, <code>open</code> doesn't know it should be considered as one cell, and simply returns count of lines.</span>
<span class="comment-copy">How many lines are in your file? Are you sure there is not a mix of <code>\r</code> and <code>\n</code> that might give your a wrong count?  or some <code>\n</code> or <code>\r</code> within some cell text?</span>
<span class="comment-copy">I have run your code on a large file and it was providing me the correct output:  <code>python count_row.py   1715181568</code> same result with <code>wc -l</code></span>
<span class="comment-copy">I was able to get the correct number of rows without using pandas but are you suggesting that open function is counting the number of lines in each cell as well?</span>
<span class="comment-copy">Yes, because open just reads file. It is not taking into account that this is CSV.</span>
<span class="comment-copy">Chris summed what you're saying. Thank you.</span>
