<div class="post-text" itemprop="text">
<p>I am trying to iterate and over a g-zipped text file. The format is that the data is in blocks of four lines. I need to take a percentage of these blocks and copy them to another file. My code takes in each block and then determines if it should be copied using random.random(). My problem is the code stops after the first block is selected and stops iterating over the g-zip file. Anyone have any ideas what I might be doing wrong?</p>
<p>Thanks!
Chris</p>
<p>Link to file: <a href="https://er365-my.sharepoint.com/:u:/g/personal/chris_kan_dovetail-genomics_com/Ec9OJW60ly9Hjua23G-rWNEBWYmXiZbCL6QgP-pBmUi7Pw?e=dXUXv9" rel="nofollow noreferrer">Download</a></p>
<pre><code>#Calc percentage of reads that should be sampled
per_reads = sub_reads_num/input_reads

#Read gzipped file and save selected lines to mem
output_list = []

input_f = gzip.open(input_path, 'rb')

counter = 0
buffer = []
for line in input_f:
    buffer.append(line)
    counter += 1
    if counter == 4:
        if random.random() &lt; per_reads:
            for x in buffer:
                output_list.append(x)
        else:
            buffer = []
            counter = 0

input_f.close()
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>After you gather a group of four and decide to save it or not; reset your counter and buffer.</p>
<pre><code>for line in input_f:
    buffer.append(line)
    counter += 1
    if counter == 4:
        if random.random() &lt; per_reads:
            for x in buffer:
                output_list.append(x)
        buffer = []
        counter = 0
</code></pre>
<hr/>
<p>Refactored to make use of <a href="https://docs.python.org/3/library/functions.html#enumerate" rel="nofollow noreferrer">enumerate</a> and <a href="https://docs.python.org/3/library/stdtypes.html#mutable-sequence-types" rel="nofollow noreferrer">list.extend</a></p>
<pre><code>for line_no, line in enumerate(input_f, 1):
    buffer.append(line)
    if line_no % 4 == 0:
        if random.random() &lt; per_reads:
            output_list.extend(buffer)
        buffer = []
</code></pre>
<hr/>
<p>This test works,...</p>
<pre><code>output_list = []
buffer = []
input_f = list('abcdefghejklmnopqrstuvwxyz')
for line_no, line in enumerate(input_f, 1):
    buffer.append(line)
    print(line_no)
    if line_no % 4 == 0:
##        if random.random() &lt; per_reads:
        if random.choice((0,1,2,3)) &lt; 2:
            print(buffer)
            output_list.extend(buffer)
        buffer = []
</code></pre>
<p>Result:</p>
<pre><code>&gt;&gt;&gt;
1
2
3
4
5
6
7
8
9
10
11
12
['e', 'j', 'k', 'l']
13
14
15
16
17
18
19
20
['q', 'r', 's', 't']
21
22
23
24
25
26
&gt;&gt;&gt; output_list
['e', 'j', 'k', 'l', 'q', 'r', 's', 't']
&gt;&gt;&gt; 
</code></pre>
<p>Maybe your conditional is not working</p>
</div>
<span class="comment-copy">Got a test file? Upload it somewhere and add a link to get it to your question.</span>
<span class="comment-copy">can you confirm the file is bring opened properly by printing <code>input_f.read()</code>?</span>
<span class="comment-copy">Make sure that your else branch is being executed occasionally.</span>
<span class="comment-copy">Have you tried input_f = gzip.open(input_path, 'rt')</span>
<span class="comment-copy">Thank you for the reminder. Link added.</span>
<span class="comment-copy">I just tried that modification and the result was the same. The first block that gets selected stops the outer loop.</span>
<span class="comment-copy">@barspurk How do you know that <code>random.random() &lt; per_reads</code> is evaluating as <code>True</code>?</span>
<span class="comment-copy">@wii I have it where it print output_list at the end of the script and writes the binary to a gz file. Using my original code I get 4 lines exactly everytime. My logic is that the loop must then be evaluating as True once and then stops the for loop iterating over the file</span>
<span class="comment-copy">@ wii. I tried your modification with enumerate and extend. It worked better than my code since it gave me the percentage of blocks I was looking for. But it off set the results by 1. So rather than selecting as the first block as lines 0,1,2,3. It is selecting 1,2,3,4. Any ideas?</span>
<span class="comment-copy">... Yea I saw that it needs to start the enumeration at 1, <code>enumerate(input_f, 1)</code> --&gt; see the edit.</span>
