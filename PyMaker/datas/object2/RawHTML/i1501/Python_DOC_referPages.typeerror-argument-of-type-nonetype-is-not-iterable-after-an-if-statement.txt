<div class="post-text" itemprop="text">
<p>I am trying to get the 2-letter state code for a city from user input, but getting the "TypeError: argument of type 'NoneType' is not iterable" error message.. Not sure how to fix it to get the right results? This is the line that's giving the error message: </p>
<pre><code>if 'status' not in js or js['status'] != 'OK':
</code></pre>
<p>Below is the full code:</p>
<pre><code>import urllib
import urllib.request as ur
import json

serviceurl = 'http://maps.googleapis.com/maps/api/geocode/json?'

while True:
    address = input('Enter location: ')
    if len(address) &lt; 1 : break

    url = serviceurl + urllib.parse.urlencode({'sensor':'false', 'address': address})
    print ('Retrieving', url)
    uh = ur.urlopen(url)
    data = uh.read()
    print ('Retrieved',len(data),'characters')

    try: js = json.loads(str(data))
    except: js = None
    if 'status' not in js or js['status'] != 'OK':
        print ('==== Failure To Retrieve ====')
        print (data)
        continue

    print (json.dumps(js, indent=4))
    '''
    lat = js["results"][0]["geometry"]["location"]["lat"]
    lng = js["results"][0]["geometry"]["location"]["lng"]
    print ('lat',lat,'lng',lng)
    ''' #not necessary for this assignment
    location = js['results'][0]['formatted_address']
    print (location)

    results = js['results'][0]
    address_components = results["address_components"]
    country = 0;
    for each_dict in address_components:
        types = each_dict["types"]
        if types == ["country", "political"]:
            country = 1;
            print ("The two character country  code is:", each_dict["short_name"])

    if country == 0:
        print ("Location isn't in any country")
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>I can only guess but looks like it's because of this particular code block -</p>
<pre><code>try: js = json.loads(str(data))
except: js = None
if 'status' not in js or js['status'] != 'OK':
    print ('==== Failure To Retrieve ====')
    print (data)
    continue
</code></pre>
<p>Your <code>json.loads(str(data))</code> raises an <code>Exception</code> due to some error, since it is being caught by <code>except</code>, you assign </p>
<pre><code>js = None
</code></pre>
<p>And in the next line you do an <code>in</code> comparison on <code>js</code> but <code>js</code> is <code>None</code> or <code>NoneType</code>, you can not iterate over <code>NoneType</code>, therefore -</p>
<pre><code>TypeError: argument of type 'NoneType' is not iterable
</code></pre>
<p>And <a href="https://docs.python.org/3/reference/expressions.html#membership-test-operations" rel="nofollow noreferrer">here's</a> more about the <code>in</code> operator of Python</p>
</div>
<div class="post-text" itemprop="text">
<p>In the code:</p>
<pre><code>try: js = json.loads(str(data))
except: js = None
</code></pre>
<p>You're telling Python that if an exception is thrown in <code>json.loads</code> you want to set <code>js</code> to None. Then in the following if-statement, you reference <code>js</code> directly. The problem here is that an exception was indeed thrown but your code following this check does not take that into account. To fix your problem, you should change your if-statement to be:</p>
<pre><code>if (not js or 'status' not in js or js['status'] != 'OK'):
</code></pre>
<p>assuming you want the statements inside the if-statement to execute on error.</p>
<p>As an aside, please don't inline <code>try</code> or <code>except</code> or <code>if</code> statements. It makes your code very difficult to follow.</p>
</div>
<div class="post-text" itemprop="text">
<p>It's pretty obvious: if there's any exception with loading the JSON information, you set <code>js</code> to <code>None</code>, but immediately try to use it as a sequence.  Adding the <code>print</code> statement makes this clear:</p>
<pre><code>try: js = json.loads(str(data))
except: js = None

print("TRACE: js=", js)
if 'status' not in js or js['status'] != 'OK':
</code></pre>
<p>Output:</p>
<pre><code>Enter location: Hillsborough
Retrieving http://maps.googleapis.com/maps/api/geocode/json?address=Hillsborough&amp;sensor=false
Retrieved 279 characters
TRACE: js= None
Traceback (most recent call last):
  File "so.py", line 21, in &lt;module&gt;
    if 'status' not in js or js['status'] != 'OK':
TypeError: argument of type 'NoneType' is not iterable
</code></pre>
<p>Instead, issue and error message and loop back for another try:</p>
<pre><code>try:
    js = json.loads(str(data))
except: 
    print("Map fetch failed; try again\n")
    continue
</code></pre>
<p>Output:</p>
<pre><code>Enter location: Hillsborough
Retrieving http://maps.googleapis.com/maps/api/geocode/json?address=Hillsborough&amp;sensor=false
Retrieved 279 characters
Map fetch failed; try again

Enter location: Chicago
Retrieving http://maps.googleapis.com/maps/api/geocode/json?address=Chicago&amp;sensor=false
Retrieved 279 characters
Map fetch failed; try again
</code></pre>
</div>
<span class="comment-copy">Would you mind fixing the indentation? It also looks like some of your code at the top isn't formatted as code.</span>
<span class="comment-copy">It's failing at <code>js = json.loads(str(data))</code> and you're setting <code>js = None</code>, then trying to iterate over it.</span>
<span class="comment-copy">If you check data it says " '{\n   "error_message" : "Keyless access to Google Maps Platform is deprecated. Please use an API key with all your API calls to avoid service interruption. For further details please refer to <a href="http://g.co/dev/maps-no-account" rel="nofollow noreferrer">g.co/dev/maps-no-account</a>",\n   "results" : [],\n   "status" : "OVER_QUERY_LIMIT"\n}\n' "</span>
<span class="comment-copy">@tgikal Ahh, I thought it was the exception if clause. What can I do to fix it?</span>
<span class="comment-copy">It's an answer for an android question, but I think the accepted answer is still valid in this situation. <a href="https://stackoverflow.com/questions/52352941/keyless-access-to-google-maps-platform-is-deprecated" title="keyless access to google maps platform is deprecated">stackoverflow.com/questions/52352941/â€¦</a> Basically you need to get a API key and include it in the URL.</span>
