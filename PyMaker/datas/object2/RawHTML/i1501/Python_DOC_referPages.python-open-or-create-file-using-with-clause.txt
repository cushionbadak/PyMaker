<div class="post-text" itemprop="text">
<div class="question-status question-originals-of-duplicate">
<p>This question already has an answer here:</p>
<ul>
<li>
<a dir="ltr" href="/questions/1466000/python-open-built-in-function-difference-between-modes-a-a-w-w-and-r">python open built-in function: difference between modes a, a+, w, w+, and r+?</a>
<span class="question-originals-answer-count">
                    6 answers
                </span>
</li>
</ul>
</div>
<p>I have the following code, but it doesn't work if the file doesn't exist:</p>
<pre><code>def log(self, action, data):
    import json
    with open('ReservationsManagerApp/logs/'+data['booking']+'.json', 'r+') as outfile:
        log_data = {
            'timestamp': str(datetime.today()),
            'action': action,
            'data': data
        }
        json.dump(log_data, outfile)
</code></pre>
<p>I want the method to create the file if it doesn't exist, but all the examples I have found don't explain how to do it using <code>with</code> clause, they just use <code>try: open</code>.
How can I instruct <code>with</code> clause to create the file if it doesn't exist?</p>
</div>
<div class="post-text" itemprop="text">
<p>You can open the file in <code>a+</code> mode (append mode with the permission to read) instead, and do a file seek to position 0 so that it creates the file if it doesn't already exist, but also allows reading the file from the beginning:</p>
<pre><code>with open('ReservationsManagerApp/logs/'+data['booking']+'.json', 'a+') as outfile:
    outfile.seek(0)
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>The mode <code>r+</code> is read+write, but does not create the file if needed.  I think you want <code>w+</code>.  Nice <a href="https://stackoverflow.com/questions/1466000/python-open-built-in-function-difference-between-modes-a-a-w-w-and-r">table here</a>.</p>
</div>
<span class="comment-copy">Have you tried w+ instead of r+?</span>
<span class="comment-copy">You can just next the <code>with</code> inside the <code>try</code>, these are two separate, composable constructs. However, there may be a mode that allows you to not have to use <code>try-except</code></span>
<span class="comment-copy">@MatthieuBrucher <code>w+</code> will truncate if it exists. Likely, the OP wants <code>'a'</code> mode, i.e. "append"</span>
<span class="comment-copy">Oh yes, that's true. Anyway all these modes are easily retrieved from the open documentation, i.e. the question is moot, open does create the file if required.</span>
<span class="comment-copy">For reference: <a href="https://docs.python.org/3/library/functions.html#open" rel="nofollow noreferrer">docs.python.org/3/library/functions.html#open</a></span>
<span class="comment-copy">Already said in the comment.</span>
<span class="comment-copy">@MatthieuBrucher: Putting answers in comments defeats the purpose of StackOverflow.  However, happy to remove my answer if you move your answer to the answer section.</span>
<span class="comment-copy">Well, isn't your link basically saying this is a duplicate? So no need for any answer here.</span>
<span class="comment-copy">No. While related, that question does not ask anything about the "open or create" functionality this user is looking for.  One of the answers does contain a useful table, however.</span>
<span class="comment-copy">That's your opinion. For me, and for lots of people, this is a duplicate, as OP wants to create a file. The fact that it's in a <code>with</code> clause doesn't change the original problem.</span>
