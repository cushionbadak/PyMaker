<div class="post-text" itemprop="text">
<p>I need to determine Windows short file name from my python code. For that I can find a solution using the win32api.</p>
<pre><code>import win32api
long_file_name='C:\Program Files\I am a file'
short_file_name=win32api.GetShortPathName(long_file_name)
</code></pre>
<p>Reference: <a href="http://blog.lowkster.com/2008/10/spaces-in-directory-names-i-really-love.html" rel="nofollow noreferrer">http://blog.lowkster.com/2008/10/spaces-in-directory-names-i-really-love.html</a> </p>
<p>Unfortunately for that I need to install <code>pywin32</code> or <code>ActivePython</code> which is not possible in my case.</p>
<p>Also reference from SO:</p>
<p>Getting short path in python: <a href="https://stackoverflow.com/questions/6085688/getting-short-path-in-python">Getting short path in python</a></p>
</div>
<div class="post-text" itemprop="text">
<p>You can use <a href="https://docs.python.org/3/library/ctypes.html" rel="noreferrer" title="ctypes module"><code>ctypes</code></a>. According to <a href="http://msdn.microsoft.com/en-us/library/aa364989.aspx" rel="noreferrer" title="GetShortPathName function">the documentation on MSDN</a>, <code>GetShortPathName</code> is in <code>KERNEL32.DLL</code>. Note that the real functions are <code>GetShortPathNameW</code> for <strong>w</strong>ide (Unicode) characters and <code>GetShortPathNameA</code> for single-byte characters. Since wide characters are more general, we'll use that version. First, set the prototype according to the documentation:</p>
<pre><code>import ctypes
from ctypes import wintypes
_GetShortPathNameW = ctypes.windll.kernel32.GetShortPathNameW
_GetShortPathNameW.argtypes = [wintypes.LPCWSTR, wintypes.LPWSTR, wintypes.DWORD]
_GetShortPathNameW.restype = wintypes.DWORD
</code></pre>
<p><code>GetShortPathName</code> is used by first calling it without a destination buffer. It will return the number of characters you need to make the destination buffer. You then call it again with a buffer of that size. If, due to a <a href="https://en.wikipedia.org/wiki/Time_of_check_to_time_of_use" rel="noreferrer" title="Time of check to time of use on Wikipedia">TOCTTOU</a> problem, the return value is still larger, keep trying until you've got it right. So:</p>
<pre><code>def get_short_path_name(long_name):
    """
    Gets the short path name of a given long path.
    http://stackoverflow.com/a/23598461/200291
    """
    output_buf_size = 0
    while True:
        output_buf = ctypes.create_unicode_buffer(output_buf_size)
        needed = _GetShortPathNameW(long_name, output_buf, output_buf_size)
        if output_buf_size &gt;= needed:
            return output_buf.value
        else:
            output_buf_size = needed
</code></pre>
</div>
<span class="comment-copy">@ruslo: Oops, you’re right! Thanks.</span>
<span class="comment-copy">Hi, the piece of code seems to go perfectly for me, except when I add the last folder. Would you have an idea on why ? Here is the path <code>C:\data\SIEA\_0 Mise à niveau des boites\Zone NRA de Ferney\Ornex 04-05\APD_e\06_Fichier Adresse - IPE</code></span>
