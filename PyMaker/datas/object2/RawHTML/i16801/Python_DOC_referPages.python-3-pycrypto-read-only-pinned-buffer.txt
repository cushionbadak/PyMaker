<div class="post-text" itemprop="text">
<p>So, I'm using Pycrypto to do some AES encryption and I am now porting my Python 2.7 code to Python 3.4. I am encoutering following error which I just cannot get my head around :</p>
<pre><code>TypeError : argument must be read-only pinned buffer, not bytearray.
</code></pre>
<p>This occurs when I am trying to encrypt the content of a variable apparently. The exact line is :</p>
<pre><code>token = b"\0" * 16
final_token = cipher.encrypt(token)
</code></pre>
<p>(token is obviously not 000... but i'm simplifying)</p>
<p>I have searched the internets for a solution and found that this error occured a lot in the websocket lib in python 2.6, but the solution (using memoryview(token) instead of token) doesn't help. Can someone explain what is happening there ? I am positively lost...</p>
</div>
<div class="post-text" itemprop="text">
<p>As Pycrypto uses the encode method, it requires a <a href="https://docs.python.org/3/c-api/arg.html#strings-and-buffers" rel="noreferrer">s# read-only buffer</a>. The buffer should not be resizeable, which isn't the case of <code>bytearray</code>. Such a buffer can be built by using the <code>bytes</code> function. Python 2 <code>str</code> was already immutable and so it was aceptable. The new line should be :</p>
<pre><code>final_token = cipher.encrypt(bytes(token))
</code></pre>
<p>(all credits for this answer goes to @eryksun, see comments)</p>
</div>
<span class="comment-copy">I got that, thanks ^^! Actually, I should probably rephrase the question : how do I build such a buffer from a bytearray ?</span>
<span class="comment-copy">Sorry, that I didn't get your explanation, but I think my problem is ont knowing of these buffers. Tank you very much for the link, I'll read it and try <code>bytes()</code>. I'll get back to you and mark the question as answered if it works.</span>
<span class="comment-copy">Ah, I see. Thank you very much for the clarification !</span>
<span class="comment-copy">Well it worked, thank you very much ! And I even understand why.</span>
<span class="comment-copy">There is an <a href="http://stackoverflow.com/questions/23800972/python-3-pycrypto-read-only-pinned-buffer">open pull request</a> for pycrypto to support bytearrays.</span>
