<div class="post-text" itemprop="text">
<p>I have a file that has 27 fields and is fixed-width.  I would like to be able to run a script on it, that would go through and add a comma or something at the field end spots so that I can then easily import it into Excel without having to manually set the lengths each time.</p>
<p>I am able to read the file into Python, but am not sure how I would add the commas. </p>
<p>Field info:</p>
<p>Start Position: 1, 21, 41, 61, 81, 86, 89, 95, 99, 103, 183, 193, 243, 293, 343, 393, 423, 425, 435, 436, 437, 438, 440, 442, 445, 447, 450</p>
<p>Length: 20, 20, 20, 20, 5, 3, 6, 4, 4, 80, 10, 50, 50, 50, 50, 30, 2, 10, 1, 1, 1, 2, 2, 3, 2, 3, 1</p>
</div>
<div class="post-text" itemprop="text">
<p>You could do as follows,</p>
<pre><code>from itertools import chain
import csv

n = 27 # num of fields
with open('in.csv') as fr, open('out.csv', 'w') as fw:
    reader = csv.reader(fr)
    writer = csv.writer(fw)
    for row in reader:
        row_ = chain(row, [None] * (n - len(row))
        writer.writerow(list(row_))
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>Use <a href="https://docs.python.org/3/library/struct.html" rel="nofollow"><code>struct</code></a> to read in the fixed-format file and <a href="https://docs.python.org/3/library/csv.html" rel="nofollow"><code>csv</code></a> to generate the CSV file.</p>
</div>
<div class="post-text" itemprop="text">
<p>Alternatively you could use the <a href="http://pandas.pydata.org/pandas-docs/version/0.18.1/io.html" rel="nofollow">pandas</a> library for this.</p>
<pre><code>import pandas as pd

length = [20, 20, 20, 20, 5, 3, 6, 4, 4, 80, 10, 50, 50, 50, 50, 30, 2, 10, 1, 1, 1, 2, 2, 3, 2, 3, 1]

pd.read_fwf("input file.txt", widths=length).to_csv("output.csv")
</code></pre>
<p>You'll need to use either the <code>colspec</code> or <code>widths</code> keyword arguments in <code>pd.read_fwf</code> to specify how the column widths are laid out. More on that can be found <a href="http://pandas.pydata.org/pandas-docs/stable/generated/pandas.read_fwf.html" rel="nofollow">here</a>.</p>
</div>
<span class="comment-copy">I'm not sure I entirely understand what the itertools chain is doing here. I see that for each row there is a n-1 removing one of the 27 fields, but I'm still not able to define the field length or add a delimiter at the field length</span>
<span class="comment-copy">@Tom I didn't get what you meant by 'add a delimiter at the field length'. <code>itertools.chain</code> puts the iterators back to back. there are <code>n</code> fields <code>len(row)</code> is there, you need to add <code>n-len(row)</code> more. where does <code>n-1</code> come from as you have commented?</span>
<span class="comment-copy">@C Panda, I guess what I'm not understanding is how I define the lengths of the 27 fields with that for loop.</span>
<span class="comment-copy">@Tom what do you mean by length of fields? you mean individual fields? say in <code>a,b,c</code> you want to configure width for like <code>a</code>?</span>
<span class="comment-copy">@ C Panda, right, so field a may be 20 characters long, but field b might only be 3 characters.</span>
