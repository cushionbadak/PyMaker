<div class="post-text" itemprop="text">
<p>I'm using a LeakyReLU activation in my model. I'm able to train it. But when I train to save the model,</p>
<pre><code>discriminator_model.save(os.path.join(output_folder_path, 'discriminator_model_{0}.h5'.format(iteration_no)))
</code></pre>
<p>I get the below error</p>
<pre><code>AttributeError: 'LeakyReLU' object has no attribute '__name__'
</code></pre>
<p>I'm using keras-gpu 2.2.4 with tensorflow-gpu 1.12.0 backend. This is my model:</p>
<pre><code>discriminator_model = Sequential()
discriminator_model.add(Conv2D(64, 5, strides=2, input_shape=(28, 28, 1), padding='same', activation=LeakyReLU(alpha=0.2)))
discriminator_model.add(Dropout(0.4))
discriminator_model.add(Conv2D(128, 5, strides=2, padding='same'))
discriminator_model.add(LeakyReLU(alpha=0.2))
discriminator_model.add(Dropout(0.4))
discriminator_model.add(Conv2D(256, 5, strides=2, padding='same'))
discriminator_model.add(LeakyReLU(alpha=0.2))
discriminator_model.add(Dropout(0.4))
discriminator_model.add(Conv2D(512, 5, strides=2, padding='same'))
discriminator_model.add(LeakyReLU(alpha=0.2))
discriminator_model.add(Dropout(0.4))
discriminator_model.add(Flatten())
discriminator_model.add(Dense(1))
discriminator_model.add(Activation('sigmoid'))
discriminator_model.summary()
</code></pre>
<p>Initially, I was using </p>
<pre><code>discriminator_model.add(Conv2D(128, 5, strides=2, padding='same', activation=LeakyReLU(alpha=0.2)))
</code></pre>
<p>But it was suggested <a href="https://github.com/keras-team/keras/issues/2272" rel="nofollow noreferrer">here</a> and <a href="https://stackoverflow.com/questions/48828478/how-do-you-use-keras-leakyrelu-in-python/48828561">here</a> to add LeakyReLU as a separate activation layer. No luck even after trying that.</p>
<p>Full stack trace:</p>
<pre><code>Traceback (most recent call last):
  File "/opt/PyCharm/pycharm-community-2018.3.3/helpers/pydev/pydevd.py", line 1741, in &lt;module&gt;
    main()
  File "/opt/PyCharm/pycharm-community-2018.3.3/helpers/pydev/pydevd.py", line 1735, in main
    globals = debugger.run(setup['file'], None, None, is_module)
  File "/opt/PyCharm/pycharm-community-2018.3.3/helpers/pydev/pydevd.py", line 1135, in run
    pydev_imports.execfile(file, globals, locals)  # execute the script
  File "/opt/PyCharm/pycharm-community-2018.3.3/helpers/pydev/_pydev_imps/_pydev_execfile.py", line 18, in execfile
    exec(compile(contents+"\n", file, 'exec'), glob, loc)
  File "..../Workspace/src/v01/MnistTrainer.py", line 100, in &lt;module&gt;
    main()
  File "..../Workspace/src/v01/MnistTrainer.py", line 92, in main
    mnist_trainer.train(train_steps=100, log_interval=1, save_interval=1)
  File "..../Workspace/src/v01/MnistTrainer.py", line 56, in train
    self.save_models(output_folder_path, i + 1)
  File "..../Workspace/src/v01/MnistTrainer.py", line 69, in save_models
    os.path.join(output_folder_path, 'discriminator_model_{0}.h5'.format(iteration_no)))
  File "..../.conda/envs/e0_270_ml_3.6/lib/python3.6/site-packages/keras/engine/network.py", line 1090, in save
    save_model(self, filepath, overwrite, include_optimizer)
  File "..../.conda/envs/e0_270_ml_3.6/lib/python3.6/site-packages/keras/engine/saving.py", line 382, in save_model
    _serialize_model(model, f, include_optimizer)
  File "..../.conda/envs/e0_270_ml_3.6/lib/python3.6/site-packages/keras/engine/saving.py", line 83, in _serialize_model
    model_config['config'] = model.get_config()
  File "..../.conda/envs/e0_270_ml_3.6/lib/python3.6/site-packages/keras/engine/sequential.py", line 278, in get_config
    'config': layer.get_config()
  File "..../.conda/envs/e0_270_ml_3.6/lib/python3.6/site-packages/keras/layers/convolutional.py", line 493, in get_config
    config = super(Conv2D, self).get_config()
  File "..../.conda/envs/e0_270_ml_3.6/lib/python3.6/site-packages/keras/layers/convolutional.py", line 226, in get_config
    'activation': activations.serialize(self.activation),
  File "..../.conda/envs/e0_270_ml_3.6/lib/python3.6/site-packages/keras/activations.py", line 176, in serialize
    return activation.__name__
AttributeError: 'LeakyReLU' object has no attribute '__name__'
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>Edited part( Thanks @NagabhushanSN for mentioning the remaining issue) </p>
<p>There is a line of the code where we still have <code>discriminator_model.add(Conv2D(64, 5, strides=2, input_shape=(28, 28, 1), padding='same', activation=LeakyReLU(alpha=0.2)))</code> ,  it is the second line of the code. </p>
<p>If we modify that line, the final corrected code should be like this:</p>
<pre><code>discriminator_model = Sequential()
discriminator_model.add(Conv2D(64, 5, strides=2, input_shape=(28, 28, 1), padding='same'))
discriminator_model.add(LeakyReLU(alpha=0.2))
discriminator_model.add(Dropout(0.4))
discriminator_model.add(Conv2D(128, 5, strides=2, padding='same'))
discriminator_model.add(LeakyReLU(alpha=0.2))
discriminator_model.add(Dropout(0.4))
discriminator_model.add(Conv2D(256, 5, strides=2, padding='same'))
discriminator_model.add(LeakyReLU(alpha=0.2))
discriminator_model.add(Dropout(0.4))
discriminator_model.add(Conv2D(512, 5, strides=2, padding='same'))
discriminator_model.add(LeakyReLU(alpha=0.2))
discriminator_model.add(Dropout(0.4))
discriminator_model.add(Flatten())
discriminator_model.add(Dense(1))
discriminator_model.add(Activation('sigmoid'))
discriminator_model.summary()
</code></pre>
<p>And this one should work well on the most recent version of tensroflow, I tested on 1.8.0 and it works fine.
However, if check your code with older version like tesnorflow1.1.0, we get the same error.</p>
<p>For that case, I suggest update tensorflow to a higher version</p>
<ul>
<li>To check the current tensorflow version python is using, do as <a href="https://stackoverflow.com/questions/38549253/how-to-find-which-version-of-tensorflow-is-installed-in-my-system">here</a>.</li>
<li>To update tensorflow, <a href="https://stackoverflow.com/questions/42574476/update-tensorflow">this post</a> seems good enough to show how to do it.</li>
</ul>
</div>
<span class="comment-copy">Can you add the imports? Are you mixing keras and tf.keras? A self-containing example that reproduces the issue would be the best</span>
<span class="comment-copy">I'm using tensorflow 1.12.0 <code>$ python -c 'import tensorflow as tf; print(tf.__version__)' 1.12.0</code></span>
<span class="comment-copy">Okay. Thank you. I'll check</span>
<span class="comment-copy">TF 1.12 is newer than 1.8, there is no upgrade there.</span>
<span class="comment-copy">@NagabhushanSN Oh! you re right, I did not pay attention to it. I have just corrected the code on my local machine. Thanks for letting me know, let me edit the answer</span>
<span class="comment-copy">Note that the error is on the keras side, if you change the version of tensorflow and it fixes something, that means you are probably mixing tf.keras and keras, which you shouldn't do.</span>
