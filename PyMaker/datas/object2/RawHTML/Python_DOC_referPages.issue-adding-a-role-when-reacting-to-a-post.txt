<div class="post-text" itemprop="text">
<p>I'm  having an issue adding a role when a user reacts to a post.</p>
<p>How I'm wanting it to function is that when a user joins the Discord server the bot will send send a message using the <code>on_join</code> event (for now I'm using the command <code>test</code> for testing purposes). </p>
<p>The next step is the <code>on_reaction_add</code> event, when the user reacts to this message the bot will add the role to that user. </p>
<p>Here is what I'm working with. I've tested this however, I'm not getting the desired result. </p>
<p>(on discord.py rewrite)</p>
<pre><code> @commands.command(pass_context=True)
async def test(self, user: discord.Member): #lets change this to the command 'test' for now and change on on_join event later. 
    guildName = user.guild.name
    embed = discord.Embed(colour=discord.Color(random.randint(0x000000, 0xFFFFFF)))
    embed.title = "Welcome to {} {}!".format(guildName, user)
    embed.description = "Head over to &lt;#443133907102203912&gt; to have a read up on our rules. Once you have read them please reaction to this post with a :thumbsup:"
    embed.set_image(url='')
    await user.send(embed=embed)

async def on_reaction_add(reaction, user): 
    channelid = '555844758778544160' #The text-channel where the react should happen
    role = discord.utils.get(user.guild.roles, name="Members") #The role applied when the post is reacted to

    if reaction.message.channel.id != channelid:
        return #So it only happens in the specified channel
    if str(reaction.emoji) == "&lt;:thumbsup:555844758778544160&gt;":#The reaction (not sure if this should be raw in discord.py rewrite)
        await user.add_roles(user, role)#Adds role when post is reacted to
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>You can wait for a reaction to a specific message if you need to.  This is handy for times like this, where you maybe want to wait for a reaction then keep doing your coroutine.  I will write the below assuming you're using the most up-to-date rewrite.  You can find the documentation for all this <a href="https://discordpy.readthedocs.io/en/rewrite/ext/commands/cogs.html" rel="nofollow noreferrer">here</a>:</p>
<pre><code>from discord.utils import get
from discord.ext.commands import Cog, command
listener = Cog.listener

thumbs_up = "\N{THUMBS UP SIGN}"

def react_check(user, msg, emoji):
    def check(reaction, usr):
        return usr==user and reaction.message.id==msg.id and reaction.emoji==emoji
    return check

class MyCog(Cog):
    def __init__(self, bot):
        self.bot = bot
    @listener()
    async def on_member_join(self, member):
        guildName = user.guild.name
        embed = discord.Embed(colour=discord.Color(random.randint(0x000000, 0xFFFFFF)))
        embed.title = "Welcome to {} {}!".format(guildName, user)
        embed.description = "Head over to &lt;#443133907102203912&gt; to have a read up on our rules. Once you have read them please reaction to this post with a :thumbsup:"
        embed.set_image(url='')
        msg = await user.send(embed=embed)
        await self.bot.wait_for('reaction_add', check=react_check(user, msg, thumbs_up))
        role = get(user.guild.roles, name="Members")
        await user.add_roles(role)
</code></pre>
<p>Then in your main bot, you need a line that says</p>
<pre><code>from mycog import MyCog

bot.add_cog(MyCog(bot))
</code></pre>
</div>
<div class="post-text" itemprop="text">
<pre><code>from discord.ext import commands
import discord
import random
from .utils import checks
from random import randint
from discord.utils import get


thumbs_up = "\N{THUMBS UP SIGN}"

def react_check(user, msg, emoji):
    def check(reaction, usr):
        return usr==user and reaction.message==msg and reaction.emoji==emoji
    return check

class Welcome(commands.Cog):
    def __init__(self, bot):
        self.bot = bot

    @commands.Cog.listener()
    async def on_member_join(self, user: discord.Member):
    guildName = user.guild.name
    channel = self.bot.get_channel(555844758778544160) 
    embed = discord.Embed(colour=discord.Color(random.randint(0x000000, 0xFFFFFF)))
    embed.title = "Welcome to {} {}!".format(guildName, user)
    embed.description = "Head over to &lt;#443133907102203912&gt; to have a read up on our rules. Once you have read them please reaction to this post with a :thumbsup:"
    embed.set_image(url='')
    msg = await channel.send(embed=embed)
    await self.bot.wait_for('reaction_add', check=react_check(user, msg, thumbs_up))
    role = get(user.guild.roles, name="Members")
    await user.add_roles(role)
    await channel.send('test')# Check 

def setup(bot):
    bot.add_cog(Welcome(bot))
</code></pre>
</div>
<span class="comment-copy">Is this code in a cog or an extension?  Exactly what version of discord.py are you using?  A recent change broke a lot of backwards compatibility in how extensions and cogs work, so you may be looking at outdated examples.  You need have a <code>ctx</code> argument before <code>user</code> because the context is being passed in, and you probably also need a <code>self</code> in <code>on_reaction_add</code> (assuming this code is in a cog).</span>
<span class="comment-copy">This is a cog and I'm using discord.py rewrite</span>
<span class="comment-copy">What version  number?  When did you last update it?  There were breaking changes made a few weeks ago, so if you're using the new code but following an old tutorial/example that may explain your problems.</span>
<span class="comment-copy">@PatrickHaugh discord.py rewrite 1.0.0a</span>
<span class="comment-copy">@PatrickHaugh thank you for the reply I've posted an answer so I can show you that I have tried this (a few changes added) the react to the message from the user unfortunately still doesn't apply the role have I missed something here?</span>
<span class="comment-copy">Your event is not in the cog.  It should be indented one more level</span>
<span class="comment-copy">That would be <code>def react_check(user, msg, emoji):...</code> ?</span>
<span class="comment-copy">No, <code>on_member_join</code></span>
<span class="comment-copy">@PatrickHaugh ah yes I see the indent error I've just fixed that and test the code again and still I'm not getting any results here is a screenshot <a href="https://pasteboard.co/I62lvRn.png" rel="nofollow noreferrer">pasteboard.co/I62lvRn.png</a> it seems to be sending the message when the user joins but when the thumbs up reaction is added to the post  I go to check the users roles and the Members role hasn't been added.</span>
<span class="comment-copy">@PatrickHaugh I've just noticed in my console ` File "C:\Users\Sean\Desktop\developer-bot\cogs\welcome.py", line 28, in on_member_join     await msg.add_reaction(check=react_check(msg, thumbs_up, reaction.emoji)) NameError: name 'reaction' is not defined`   Though isn't it already defined?</span>
