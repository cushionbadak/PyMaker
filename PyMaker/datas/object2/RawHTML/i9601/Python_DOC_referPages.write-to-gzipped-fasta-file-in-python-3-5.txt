<div class="post-text" itemprop="text">
<p>I have just migrated all modules in my tool from python 2 to python 3. I run into a problem I just could not solve - I don't know how to write to gzipped fasta file.</p>
<pre><code>with gzip.open("sample.fasta.gz", "w") as file:
    print("writing...")
    for oid, seq in temp_data.items():
        # prepare row
        row = SeqRecord(Seq(seq), id=str(oid), description=temp_tax[oid])
        SeqIO.write(row, file, "fasta")
</code></pre>
<p>This code works in python 2 but it does not work in python 3, it raises:</p>
<blockquote>
<p>TypeError: memoryview: a bytes-like object is required, not 'str'</p>
</blockquote>
<p>How should I fix the problem?</p>
</div>
<div class="post-text" itemprop="text">
<p>The <a href="https://docs.python.org/3/library/gzip.html#gzip.open" rel="nofollow noreferrer"><code>gzip.open</code> function</a>, unlike the regular <code>open</code> function, defaults to binary mode, not text mode. You have to explicitly pass a <code>t</code> as part of the mode string to open in text mode (which accepts/expects <code>str</code>):</p>
<pre><code>with gzip.open("sample.fasta.gz", "wt") as file:
</code></pre>
<p>To avoid line ending conversion, you may also want to <a href="https://docs.python.org/3/library/io.html#io.TextIOWrapper" rel="nofollow noreferrer">pass <code>newline=''</code></a> (the empty string) so that, on a system like Windows, it doesn't convert <code>\n</code> to <code>\r\n</code> when it writes.</p>
</div>
<div class="post-text" itemprop="text">
<p>Try converting the string which is returned from <code>SeqRecord</code> to a <code>bytes</code> object.</p>
<pre><code>byte_row = record.format('').encode()
</code></pre>
<p><a href="http://biopython.org/DIST/docs/api/Bio.SeqRecord.SeqRecord-class.html#format" rel="nofollow noreferrer"><code>record.format('')</code></a> returns the record as a <code>string</code>.</p>
<p><a href="http://pythoncentral.io/encoding-and-decoding-strings-in-python-3-x/" rel="nofollow noreferrer"><code>.encode()</code></a> converts the <code>string</code> to a <code>byte</code> object.</p>
</div>
<span class="comment-copy">I totally forgot about <code>t</code> option. Thanks!</span>
