<div class="post-text" itemprop="text">
<p>If I'm doing df.update() on a frame for which the key doesn't exist, what's the cleanest way I can add it?</p>
<p>Something like:</p>
<pre><code>try:
  df.update(new_data)
except:
  df.insert(new_data)
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>It's unclear what the real use case here, but firstly you can test if the key exists already by calling <code>in</code> on the columns:</p>
<pre><code>In [61]:
df = pd.DataFrame(np.random.randn(5,3), columns=list('abc'))
df

Out[61]:
          a         b         c
0 -0.968358  0.666118  0.758028
1 -0.805671 -0.994780  0.624423
2  0.449329  0.768457 -0.311637
3 -0.793448  1.258319 -0.924384
4  1.698867 -0.624939 -0.167027

In [62]:
'd' in df.columns

Out[62]:
False
</code></pre>
<p>Besides if the column doesn't exist then you can just add it whether it's a scalar value or the array is the same length:</p>
<pre><code>In [63]:
df['d'] = 10
df

Out[63]:
          a         b         c   d
0 -0.968358  0.666118  0.758028  10
1 -0.805671 -0.994780  0.624423  10
2  0.449329  0.768457 -0.311637  10
3 -0.793448  1.258319 -0.924384  10
4  1.698867 -0.624939 -0.167027  10
</code></pre>
</div>
<span class="comment-copy">why not just test <code>if key in df.columns:</code>? Also is the new_data the same size? i.e. same number of rows? why not just overwrite if so or create new column with the new data?</span>
<span class="comment-copy"><a href="https://docs.python.org/3/glossary.html#term-eafp" rel="nofollow noreferrer">Easier to ask for forgiveness than permission</a> is the preferred python way</span>
