<div class="post-text" itemprop="text">
<p>I've created a choropleth map in Altair with US state-level data. However, I have no data for some of the states. By default, these states do not appear on the map at all. Here's an example image:</p>
<p><a href="https://i.stack.imgur.com/eLFHN.png" rel="nofollow noreferrer"><img alt="enter image description here" src="https://i.stack.imgur.com/eLFHN.png"/></a></p>
<p>I would like for the null states to appear on the map as a greyish color. The Altair documentation shows another map that fit this description:</p>
<p><a href="https://i.stack.imgur.com/Vmrtv.png" rel="nofollow noreferrer"><img alt="enter image description here" src="https://i.stack.imgur.com/Vmrtv.png"/></a></p>
<p>My question is how can I make the states with nulls in the 1st map appear like the states in the 2nd map. I tried a few things. Here's my code for the original map:</p>
<pre><code>states = alt.topo_feature(data.us_10m.url, 'states')
source = df

alt.Chart(states).mark_geoshape().encode(
    color=alt.Color('avg_prem:Q')
).transform_lookup(
    lookup='id',
    from_=alt.LookupData(source, 'id', ['avg'])
).project(
    type='albersUsa'
).properties(
    width=700,
    height=450
) 
</code></pre>
<p>Here's the code for the 2nd map: </p>
<pre><code># US states background
alt.Chart(states).mark_geoshape(
    fill='lightgray',
    stroke='white'
).properties(
    title='US State Capitols',
    width=700,
    height=400
).project('albersUsa')
</code></pre>
<p>The main thing I tried was applying the fill and stroke parameters from the 2nd map on the 1st map:</p>
<pre><code>alt.Chart(states).mark_geoshape(fill='lightgray',
    stroke='white').encode(
    color=alt.Color('avg_prem:Q')
).transform_lookup(
    lookup='id',
    from_=alt.LookupData(source, 'id', ['avg'])
).project(
    type='albersUsa'
).properties(
    width=700,
    height=450
) 
</code></pre>
<p>I could change the color of the outlines for the states with values that way, but could not fill in the states with nulls. </p>
<p>Is there a good way to fix the missing data issue on the map?</p>
</div>
<div class="post-text" itemprop="text">
<p>One approach would be to use a layered chart with the background you want. You didn't provide your data, so I can't actually try it, but it might look something like this:</p>
<pre><code>states = alt.topo_feature(data.us_10m.url, 'states')
source = df

foreground = alt.Chart(states).mark_geoshape().encode(
    color=alt.Color('avg_prem:Q')
).transform_lookup(
    lookup='id',
    from_=alt.LookupData(source, 'id', ['avg'])
).project(
    type='albersUsa'
).properties(
    width=700,
    height=400
)  

background = alt.Chart(states).mark_geoshape(
    fill='lightgray',
    stroke='white'
).properties(
    title='US State Capitols',
    width=700,
    height=400
).project('albersUsa')

background + foreground
</code></pre>
<p>Edit: Another possible approach is to use a conditional encoding, similar to <a href="https://vega.github.io/vega-lite/examples/point_invalid_color.html" rel="nofollow noreferrer">https://vega.github.io/vega-lite/examples/point_invalid_color.html</a>:</p>
<pre><code>alt.Chart(states).mark_geoshape().encode(
    color=alt.condition('datum.avg_prem !== null', 'avg_prem:Q', alt.value('lightgray'))
).transform_lookup(
    lookup='id',
    from_=alt.LookupData(source, 'id', ['avg'])
).project(
    type='albersUsa'
).properties(
    width=700,
    height=400
)  
</code></pre>
</div>
<span class="comment-copy">Thanks, that works!</span>
<span class="comment-copy">jakevdp, if you don't mind me asking a follow-up question, how would I change the font size for the title using this methodology? I think this is actually what was giving me problems. I used the .configure_title(font_size=14) when I originally tried something like this and it gave me an error message. So I'm assuming I need to do the stuff with the title in the .properties() section of the code instead, but how would I change the title font size from there? I'm not finding any relevant examples online, unfortunately.</span>
<span class="comment-copy">Nevermind. Took me a long time, but I think I figured it out.  alt.layer(background, foreground).configure_title(fontSize=24)</span>
<span class="comment-copy">Yes, configurations are only valid at the top level.</span>
