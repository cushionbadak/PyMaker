<div class="post-text" itemprop="text">
<pre><code>email_user ='user@gmail.com '

email_send='user@gmail.com'

subject='Python!'

msg= MIMEMultipart()

msg['From']=email_user

msg['To']=email_user

msg['Subject']=subject

body ='hi there,'

msg.attach(MIMEText(body,'plain'))

filename='log.txt'

attachment =open(filename,'rb')

part= MIMEBase('application','octet_stream')
part.set_payload((attachment).read())
encoders.encode_base64(part)
part.add_header('Content-Disposition',"attachment; filename= "+filename)

msg.attach(part)

text= msg.as_string()

server = smtplib.SMTP('smtp.gmail.com',587)

server.starttls()

server.login(email_user,'password')

server.sendmail(email_user,email_send,text)

server.quit()
</code></pre>
<p>i want to delete the text file after sending it, but when i try 
os.remove("C:\log.txt") it tells me log.txt is in use even though 
server.quit() , i also just started coding so dont judge</p>
</div>
<div class="post-text" itemprop="text">
<p>this is because you are opening a file however you are not closing it. </p>
<pre><code>attachment =open(filename,'rb')
</code></pre>
<p>Following should work. </p>
<pre><code>attachment =open(filename,'rb')

part= MIMEBase('application','octet_stream')
part.set_payload((attachment).read())
encoders.encode_base64(part)
part.add_header('Content-Disposition',"attachment; filename= "+filename)

msg.attach(part)
attachment.close()
os.remove(filename)
</code></pre>
<p>A better approach should be to read a file using <code>with</code> context manager. </p>
<pre><code>with open(filename,'rb') as attachment:

    part= MIMEBase('application','octet_stream')
    part.set_payload((attachment).read())
    encoders.encode_base64(part)
    part.add_header('Content-Disposition',"attachment; filename= "+filename)

    msg.attach(part)

# send message 

# remove file
os.remove(filename)
</code></pre>
</div>
<span class="comment-copy">Thank you so much</span>
