<div class="post-text" itemprop="text">
<p>I'm trying to do some sort of Session Initiation Protocol sniffer. I'm using the <code>pyshark</code> module for python that offers me some functions to sniff packets from an interface. The thing is that there is a function called <code>sniff()</code> that when I give a parameter <code>packet_count=0</code> it checks for packets indefinitely until I stop the whole program.</p>
<p>What I want to know if there is a way to stop the <code>cap.sniff()</code> function and retrieve the <code>cap._packets</code> (which is a list) and then let the rest of the program run.</p>
<p>Here is the code that I made:</p>
<pre><code>def sniffsip():
    cap = pyshark.LiveCapture(interface='Ethernet')
    cap.sniff(packet_count=0)#This is function sniff() that checks for packets

    udp_packets = []

    for i in cap._packets:
        j = cap._packets.index(i)
        if cap._packets[j].transport_layer == 'UDP' and cap._packets[j].highest_layer == 'SIP':
            udp_packets.append(cap._packets[j])

    return udp_packets
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>I guess you just want to break that cycle.</p>
<pre><code>stop_flag = False # It is a global variable, you can set it in other functions

def sniffsip():
    global stop_flag # Our global variable...
    cap = pyshark.LiveCapture(interface='Ethernet')
    cap.sniff(packet_count=0)

    udp_packets = []

    for i in cap._packets:
        j = cap._packets.index(i)
        if cap._packets[j].transport_layer == 'UDP' and cap._packets[j].highest_layer == 'SIP':
            udp_packets.append(cap._packets[j])
        if stop_flag: # Here check the state of the flag
           stop_flag = False # Do not forget to set it false if you want to use the function again.
           break # Break the cycle

    return udp_packets
</code></pre>
</div>
<span class="comment-copy">Where would you like to stop the function? A <code>break</code> <code>return</code> or <code>continue</code> could all do the job but some more context on how this function is working in your script would be helpful.</span>
<span class="comment-copy">You can probably put the call to <code>sniff()</code> in a <code>try</code> block and <a href="https://stackoverflow.com/q/21120947/354577">catch <code>KeyboardInterrupt</code> (often bound to Ctrl+C)</a>. Run the code, stop capturing with Ctrl+C, then continue. I haven't tested this though, so just commenting.</span>
<span class="comment-copy"><i>cap.sniff(packet_count=0)</i> is where the script start to check for packets, so I want to stop that function so I can get the <i>cap._packets</i> list. As I said before, this <i>cap.sniff()</i> is in the pyshark module</span>
<span class="comment-copy">@F.Estevez, that's what I think my suggestion will let you do. Please read the linked page.</span>
<span class="comment-copy">@F.Estevez, also, please use <i>backticks</i> (<code>`</code>) not underscores or asterisks to mark code.</span>
<span class="comment-copy">I think the problem is that <code>cap.sniff(packet_count=5)</code> doesn't return. It just keeps capturing packets, so the program doesn't progress past that line.</span>
<span class="comment-copy">Actually, <i>cap.sniff(packet_count=0)</i> is where the script start to check for packets, so I want to stop that function so I can get the <i>cap._packets</i> list. As I said before, this <i>cap.sniff()</i> is in the pyshark module</span>
