<div class="post-text" itemprop="text">
<p>Trying to put the last 24hrs of data into a CSV file and getting using tweepy for python</p>
<pre><code>Traceback (most recent call last):
File "**", line 74, in &lt;module&gt;
get_all_tweets("BQ")
File "**", line 66, in get_all_tweets
writer.writerows(outtweets)
File "C:\Users\Barry\AppData\Local\Programs\Python\Python35-32\lib\encodings\cp1252.py", line 19, in encode
return codecs.charmap_encode(input,self.errors,encoding_table)[0]
UnicodeEncodeError: 'charmap' codec can't encode characters in position 6-7: character maps to &lt;undefined&gt;
</code></pre>
<p>as an error, can anyone see what is wrong as this was working in some capacity before today. </p>
<p>Code:
    def get_all_tweets(screen_name):</p>
<pre><code># authorize twitter, initialize tweepy
auth = tweepy.OAuthHandler(consumer_token, consumer_secret)
auth.set_access_token(access_token, access_secret)
api = tweepy.API(auth, wait_on_rate_limit=True)

# initialize a list to hold all the tweepy Tweets
alltweets = []    

# make initial request for most recent tweets (200 is the maximum allowed count)
new_tweets = api.home_timeline (screen_name=screen_name, count=200)

# save most recent tweets
alltweets.extend(new_tweets)

# save the id of the oldest tweet less one
oldest = alltweets[-1].id - 1

outtweets = []

page = 1
deadend = False


print ("getting tweets before %s" % (oldest))

# all subsiquent requests use the max_id param to prevent duplicates
new_tweets = api.home_timeline(screen_name=screen_name, count=200, max_id=oldest, page=page)

# save most recent tweets
alltweets.extend(new_tweets)

# update the id of the oldest tweet less one
oldest = alltweets[-1].id - 1

print ("...%s tweets downloaded so far" % (len(alltweets)))

for tweet in alltweets:

    if (datetime.datetime.now() - tweet.created_at).days &lt; 1:
        # transform the tweepy tweets into a 2D array that will populate the csv    
        outtweets.append([tweet.user.name, tweet.created_at, tweet.text.encode("utf-8")])

    else:
        deadend = True
        return
    if not deadend:
        page += 1

# write the csv    
with open('%s_tweets.csv' % screen_name, 'w') as f:
    writer = csv.writer(f)
    writer.writerow(["name", "created_at", "text"])
    writer.writerows(outtweets)
pass


print ("CSV written")

if __name__ == '__main__':
# pass in the username of the account you want to download
get_all_tweets("BQ")
</code></pre>
<p>** EDIT 1 **</p>
<pre><code> with open('%s_tweets.csv' % screen_name, 'w', encode('utf-8')) as f:
 TypeError: an integer is required (got type bytes)
</code></pre>
<p>** EDIT 2**</p>
<pre><code> return codecs.charmap_encode(input,self.errors,encoding_table)[0]
 UnicodeEncodeError: 'charmap' codec can't encode characters in position 6-7: character maps to &lt;undefined&gt;
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>Your problem is with the characters in some tweets. You're not able to write them to the file you open.
If you replace this line</p>
<pre><code>with open('%s_tweets.csv' % screen_name, 'w') as f:
</code></pre>
<p>with this:</p>
<pre><code>with open('%s_tweets.csv' % screen_name, mode='w', encoding='utf-8') as f:
</code></pre>
<p>it should work. Please note that this will only work with python 3.x</p>
</div>
<div class="post-text" itemprop="text">
<p>It seems that the character is something that cannot be encoded into utf-8. While it may be useful to view the tweet in question that triggered the error, you can prevent such an error in the future by changing <code>tweet.text.encode("utf-8")</code> to either <code>tweet.text.encode("utf-8", "ignore")</code>, <code>tweet.text.encode("utf-8", "replace")</code>, or <code>tweet.text.encode("utf-8", "backslashreplace")</code>. <code>ignore</code> removes anything that cannot be encoded; <code>replace</code> replaces the infringing character with <code>\ufff</code>; and <code>backslashreplace</code> adds a backslash to the infringing character <code>\x00</code> would become <code>\\x00</code>.</p>
<p>For more on this: <a href="https://docs.python.org/3/howto/unicode.html#converting-to-bytes" rel="nofollow">https://docs.python.org/3/howto/unicode.html#converting-to-bytes</a></p>
</div>
<span class="comment-copy">that gave me an error that i put in as an edit 1</span>
<span class="comment-copy">what is the error and your python version?</span>
<span class="comment-copy">the error is named edit 1 and python 3.5.2</span>
<span class="comment-copy">can you try: with open('%s_tweets.csv' % screen_name, mode='w', encoding='utf-8') as f:</span>
<span class="comment-copy">that worked, thank you for your help</span>
<span class="comment-copy">getting the same error after i tried this, posted the traceback as edit 2</span>
<span class="comment-copy">What did you change it your code to? Also, can you show us the twitter post in question? That way we can run tests on our side to see what works.</span>
