<div class="post-text" itemprop="text">
<p>I am playing with Flask to understand it better. I have a simple app that queries a large database and returns a random element. The following code is not working but I know exactly where it fails. It fails when I can random.randint() to get a random element in the list. There is however no error shown in my logs, what is the root cause of this? It works if I use a hardcoded value instead of a random int. I use curl to test it. I snipped the database code as it seems to be correct.</p>
<pre><code>from flask import Flask, render_template, request
import sqlite3
import random
app = Flask(__name__)
def show_home_page():
    return render_template("home.html")

def get_random_element():
    # &lt;snipped&gt;: Do some sql queries and populate a list called P_LIST
    r = random.randint(0, len(P_LIST)) # This line silently fails.
    r_e = P_LIST[r]  # Never seems to get here
    print "get_random_element", r_e  # Never prints this line!!
    return r_e

@app.route('/')
def server():
    return show_home_page()

@app.route('/element', methods=['POST', 'GET'])
def random():
    if request.method == 'GET':
        p = request.args.get('q', '')
        print "Request:", p
        if p == 'random' or p == '':
           p = get_random_element()
           print "Random element:", p
        else:
           print "Else:", p
        return render_template('random.html', element=p)
    return show_home_page()

if __name__ == '__main__':
    app.run()
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>You have redefined <code>random</code> by defining a function named <code>random()</code>.</p>
<pre><code>@app.route('/element', methods=['POST', 'GET'])
def random():
    ...
</code></pre>
<p>This shadows the imported module, causing the problem that you see. When you <code>import random</code> again in <code>get_random_element()</code> your code can access the <em>module</em> <code>random</code> instead of the local function <code>random()</code>.</p>
<p>Fix this by renaming the function, perhaps call it <code>element()</code> since that is the route name.</p>
</div>
<div class="post-text" itemprop="text">
<p>It is something I don't understand but here is what is happening. I need to import random inside the random() function. Otherwise the global "import random" statement does not seem to be sufficient. Not sure why. So adding one import line inside random() made it work.
If anybody can explain this I would be grateful.</p>
<p>EDIT: Now I understand what is going on. The function name random() was causing some sort of conflict. If I change it to rand() everything works fine now with just one global import.</p>
</div>
<span class="comment-copy">Check the <a href="https://docs.python.org/3/library/random.html#random.randint" rel="nofollow noreferrer">documentation</a> for <code>random.randint</code>. It doesn't do what you seem to think it does.</span>
<span class="comment-copy">Didnt get it.. The doc says "Return a random integer N such that a &lt;= N &lt;= b. Alias for randrange(a, b+1)." Thats what I want..  I am looking for a random index into my list (P_LIST). So random.randint(0, len(P_LIST)).</span>
<span class="comment-copy">What are the valid indexes for your list? What are the possible outputs of <code>random.randint(0, len(P_LIST))</code>? There is a discrepancy.</span>
<span class="comment-copy">I don't get it. Even just calling print random.randint(0, 6000) inside the function random() makes it not work. random.randint(0, len (P_LIST)) should return something between 0 and len(P_LIST) (both inclusive which is an error but that's not what I am hitting here and len(P_LIST) is in the tens of thousands)</span>
<span class="comment-copy">See my answer below.</span>
<span class="comment-copy">You named your method <code>random</code>, which shadows the <code>random</code> module you imported</span>
