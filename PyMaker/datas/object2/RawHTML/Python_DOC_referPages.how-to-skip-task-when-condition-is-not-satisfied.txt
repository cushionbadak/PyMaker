<div class="post-text" itemprop="text">
<p>Have a role with the following task that is supposed to create a cron job if <em>my_environment</em> var is <em>"prod"</em>.</p>
<p>I would like the playbook to <strong>skip</strong> this task rather than failing, when the condition is not satisfied:</p>
<pre><code>---
- name: Configure cron job to export patch logs
  cron:
    name: export patch logs daily
    minute: 0
    hour: 0
    user: root
    cron_file: patch_logs
    job: "/usr/local/bin/aws s3 cp /var/log/dpkg.log s3://{{ patch_logs_bucket }}/dpkg.log.$(hostname).$(date +\\%F)"
  when: my_environment == "prod"
</code></pre>
<p>Failure message:</p>
<pre><code>TASK [ansible-contxt-base : Configure cron job to export patch logs] ***********
    fatal: [ubuntu-1604]: FAILED! =&gt; {"msg": "The conditional check 'scx_environment == \"prod\"' failed. The error was: error while evaluating conditional (scx_environment == \"prod\"): 'my_environment' is undefined\n\nThe error appears to have been in '/**&lt;path&gt;**/tasks/base.yml': line 125, column 3, but may\nbe elsewhere in the file depending on the exact syntax problem.\n\nThe offending line appears to be:\n\n\n- name: Configure cron job to export patch logs\n  ^ here\n"}
</code></pre>
</div>
<div class="post-text" itemprop="text">
<pre><code>when:

my_environment is defined

my_environment != ”prod”
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>We can use the jinja2 shortcut for 'default(False) ’: 'd(False)’.</p>
<pre><code>when: my_environment|d(False) == "prod"
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>found here <a href="https://ansible-docs.readthedocs.io/zh/stable-2.0/rst/playbooks_conditionals.html#the-when-statement" rel="nofollow noreferrer">https://ansible-docs.readthedocs.io/zh/stable-2.0/rst/playbooks_conditionals.html#the-when-statement</a></p>
<pre><code>- shell: echo "This certainly isn't epic!"
  when: not epic
</code></pre>
<p>or</p>
<pre><code>- fail: msg="Bailing out. this play requires 'bar'"
  when: bar is undefined
</code></pre>
</div>
<span class="comment-copy">some explanation pls</span>
