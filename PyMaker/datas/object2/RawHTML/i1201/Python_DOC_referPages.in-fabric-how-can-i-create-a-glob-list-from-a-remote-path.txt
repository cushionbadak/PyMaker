<div class="post-text" itemprop="text">
<p>With Python's <a href="http://docs.fabfile.org/en/2.4/index.html" rel="nofollow noreferrer">Fabric</a> I want to transfer files to and from a remote server.</p>
<p>The list of files to transfer I need to generate from a glob expression like <code>*</code> or <code>*.txt</code> (and then apply some addional exclusions afterwards).</p>
<p>For the case of transferring <em>to</em> the remote it is easy to glob the list of source files, because the source is local:</p>
<pre><code>[ f for f in Path(local_dir).glob(&lt;my glob expression&gt;)]
</code></pre>
<p>But how do I do this on the remote server? I have a connection to the remote established via <code>with fabric.Connection(...) as c:</code>, but I cannot find a <code>glob</code> method in the connection object.</p>
</div>
<div class="post-text" itemprop="text">
<p>One option is to utilize the <code>listdir</code> method of the <code>SFTPClient</code> object returned by <a href="http://docs.fabfile.org/en/2.4/api/connection.html#fabric.connection.Connection.sftp" rel="nofollow noreferrer"><code>c.sftp()</code></a> to get a listing of all remote files, and then apply <a href="https://docs.python.org/3/library/fnmatch.html#fnmatch.filter" rel="nofollow noreferrer"><code>fnmatch.filter</code></a> with your glob expression:</p>
<pre><code>fnmatch.filter(c.sftp().listdir(), '*.py')
</code></pre>
<p>Result: With the following remote directory,</p>
<pre><code>$ ls
1.log  2.txt  3.py  4.csv  5.py
</code></pre>
<p>first listing the entire dir, then with glob:</p>
<pre><code>&gt;&gt;&gt; c.sftp().listdir()
['5.py', '3.py', '4.csv', '2.txt', '1.log']
&gt;&gt;&gt; fnmatch.filter(c.sftp().listdir(), '*.py')
['5.py', '3.py']
</code></pre>
</div>
<span class="comment-copy">Works pretty well. Thanks! Great to have a working example. (One thing though to be aware of is that remote globbing using this answer does <i>not</i> treat dot files differently to other files (while the <code>glob</code> module does so for local files)..</span>
