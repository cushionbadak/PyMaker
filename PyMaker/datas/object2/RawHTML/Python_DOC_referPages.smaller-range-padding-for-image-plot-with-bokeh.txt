<div class="post-text" itemprop="text">
<p>I'm using bokeh 1.0.4 and I would like to generate an image plot in bokeh using <code>match_aspect=True</code>. Here is a example code for illustration:</p>
<pre class="lang-py prettyprint-override"><code>from bokeh.models.ranges import DataRange1d
from bokeh.plotting import figure, show
import numpy as np

arr = np.array([[1,2,3],[4,5,6]])

plot = figure(match_aspect=True)
plot.image([arr], x=0, y=0, dw=3, dh=2)

show(plot)
</code></pre>
<p>This is what I get:
<a href="https://i.stack.imgur.com/qvn2b.png" rel="nofollow noreferrer"><img alt="Plot without given ranges" src="https://i.stack.imgur.com/qvn2b.png"/></a></p>
<p>There is a lot empty space around the data, too much for my application, and I would like to have the axes more tight - knowing that this currently cannot perfectly be done, see this <a href="https://stackoverflow.com/questions/53617819/image-plot-in-bokeh-with-tight-axes-and-matching-aspect-ratio">other question</a> in section "Update".</p>
<p>So I've tried to use the parameter <code>range_padding</code>, which should be relative to the image dimensions (default unit: percent), but it doesn't work for me, e.g. if I use</p>
<pre class="lang-py prettyprint-override"><code>from bokeh.models.ranges import DataRange1d
from bokeh.plotting import figure, show
import numpy as np

arr = np.array([[1,2,3],[4,5,6]])

x_range = DataRange1d(range_padding=5, range_padding_units='percent')
y_range = DataRange1d(range_padding=5, range_padding_units='percent')

plot = figure(x_range=x_range, y_range=y_range, match_aspect=True)
plot.image([arr], x=0, y=0, dw=3, dh=2)

show(plot)
</code></pre>
<p>the padding is even larger:</p>
<p><a href="https://i.stack.imgur.com/7b7NZ.png" rel="nofollow noreferrer"><img alt="Plot using &lt;code&gt;range_padding&lt;/code&gt;" src="https://i.stack.imgur.com/7b7NZ.png"/></a></p>
<p>Small padding values like <code>0.05</code> seem to have no effect. Also I cannot use <code>start</code> and <code>end</code> arguments for the ranges because then the
matching aspect ratio is lost. A square in data space should match a square on the screen.</p>
<p>Did I miss something in the way I use the <code>range_padding</code> parameters here?
Does anybody have an idea how to reduce the space around the image such that
the matching aspect is kept? </p>
<h1>Update</h1>
<p>I would like not to set plot's height and width to fixed values, because I also want to add a colorbar and maybe other things later and this will increase the plot dimensions in an unpredictable way such that the aspect ratios don't match any more. </p>
</div>
<div class="post-text" itemprop="text">
<p>Is this work-around acceptable for you (Bokeh v1.0.4)?</p>
<pre><code>from bokeh.models.ranges import DataRange1d
from bokeh.plotting import figure, show
from bokeh.layouts import Row
from bokeh.palettes import Greys
from bokeh.models import LinearColorMapper, ColorBar
import numpy as np

arr = np.array([[1, 2, 3], [4, 5, 6]])

sx = 3
sy = 2

x_range = DataRange1d(start = 0, end = sx, bounds = (0, sx), range_padding = 5, range_padding_units = 'percent')
y_range = DataRange1d(start = 0, end = sy, bounds = (0, sy), range_padding = 5, range_padding_units = 'percent')

pw = 400
ph = pw * sy / sx
plot = figure(plot_width = pw,
              plot_height = ph,
              x_range = x_range,
              y_range = y_range,
              match_aspect = True)
plot.image([arr], x = 0, y = 0, dw = sx, dh = sy)

color_mapper = LinearColorMapper(palette = Greys[6], low = arr.min(), high = arr.max())
colorbar_plot = figure(plot_height = ph, plot_width = 69, x_axis_location = None, y_axis_location = None, title = None, tools = '', toolbar_location = None)
colorbar = ColorBar(color_mapper = color_mapper, location = (0, 0))
colorbar_plot.add_layout(colorbar, 'left')

show(Row(plot, colorbar_plot))
</code></pre>
<p>Result:</p>
<p><a href="https://i.stack.imgur.com/8vxll.png" rel="nofollow noreferrer"><img alt="enter image description here" src="https://i.stack.imgur.com/8vxll.png"/></a></p>
</div>
<span class="comment-copy">Thanks again @Tony. Yes, that would work, but forgot to mention in my question, that I'm also needing a colorbar besides the plot and then this will increase the width of the plot and breaks the matching aspect ratio like in my <a href="https://stackoverflow.com/questions/53617819/image-plot-in-bokeh-with-tight-axes-and-matching-aspect-ratio">other question</a>. Sorry for not being clear here.</span>
<span class="comment-copy">See modified code with ColorBar</span>
<span class="comment-copy">Thanks Tony. In my <a href="https://stackoverflow.com/questions/53617819/image-plot-in-bokeh-with-tight-axes-and-matching-aspect-ratio">other question</a> I accepted this workaround. Here, my question is more about the <code>range_padding</code> parameter, which seems to have problems for image plots. It seems to be a bug in bokeh, so I've opened an <a href="https://github.com/bokeh/bokeh/issues/8770" rel="nofollow noreferrer">issue</a> on that. If <code>range_padding</code> would work as expected, I would have a perfect matching aspect ratio, which I have not with this workaround. So I would like to keep the answer open here, until that issue is clarified.</span>
