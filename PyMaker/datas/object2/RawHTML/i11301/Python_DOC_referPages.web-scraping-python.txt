<div class="post-text" itemprop="text">
<p>I'm new to python and want some help regarding Web Scraping. </p>
<p>I have a Raspberry Pi3 with python on it and i want to extract some data from a web page using BeautifulSoap and write it to a text file with a time stamp, i keep my Pi 24x7 on so i want the python to repeat itself after a certain time interval so that i can later create a graph using those values.</p>
<p>Starting, i tried &gt;</p>
<pre><code>    from urllib.request import urlopen
    from bs4 import BeautifulSoup
    html = urlopen("https://172.30.83.14/bsnlfup/usage.php")
    bsObj = BeautifulSoup(html.read());
    print(bsObj.td)" 
</code></pre>
<p>And the output was something else-</p>
<pre><code>    &lt;td align="right"&gt;
&lt;a href="usage.php"&gt;&lt;img alt="" border="0" height="152" src="images/fuph.jpg" width="100%"/&gt;&lt;/a&gt;
</code></pre>
<p></p>
<p>the data was enclosed within a td tag, but there were many td tags in the page, so it didnt work and i dont know how to make it write the data to txt file.</p>
<p>The html source-</p>
<pre class="lang-html prettyprint-override"><code>    &lt;html&gt;
  &lt;head&gt;
&lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt;
&lt;meta http-equiv="Expires" content="0"&gt;
&lt;meta http-equiv="Pragma" content="No-cache"&gt;
&lt;meta http-equiv="Cache-Control" content="no-cache"&gt;
&lt;meta name="keywords" content="High-Speed, Broadband, IPTV, Internet, VoIP"&gt;
&lt;meta name="description" content="Leading provider of high-speed communication services."&gt;
&lt;link rel="stylesheet" type="text/css" href="css/npm.css"&gt;
&lt;title&gt;BSNL BROADBAND&lt;/title&gt;
&lt;script language="Javascript" type="text/javascript" src="js/npmcommon.js"&gt;&lt;/script&gt;
 &lt;/head&gt;
 &lt;body onload="TINIT();" topmargin="0" leftmargin="0" marginheight="0" marginwidth="0" bgcolor="#ffffff"&gt;
&lt;div class="portalheader" align="left"&gt;
  &lt;table style="width: 100%;" border="0" cellspacing="0" cellpadding="0" bgcolor="white"&gt;
    &lt;tr&gt;
      &lt;td align="right"&gt;
        &lt;a href="usage.php"&gt;&lt;img src="images/fuph.jpg" alt="" border="0" height="152" width="100%"&gt;&lt;/a&gt;
      &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style="width: 100%; height: 10px; background-color: rgba(29, 117, 182, 1);"&gt;&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/table&gt;
&lt;/div&gt;
&lt;div class="serviceservlet"&gt;
  &lt;table style="width: 100%;" border="0" cellpadding="0" cellspacing="0"&gt;
    &lt;tbody&gt;
      &lt;tr&gt;
        &lt;td style="width: 165px; vertical-align: top; background-color: rgb(f, f, f);"&gt;
          &lt;table border="0" cellpadding="0" cellspacing="0" width="165"&gt;
            &lt;tbody&gt;
              &lt;tr&gt;
                &lt;td colspan="3" height="48"&gt;
                  &lt;br&gt;
                &lt;/td&gt;
              &lt;/tr&gt;
            &lt;/tbody&gt;
          &lt;/table&gt;
          &lt;table border="0" cellpadding="0" cellspacing="0" width="165"&gt;
            &lt;tbody&gt;
              &lt;tr&gt;
                &lt;td style="width: 10px;"&gt;
                  &lt;br&gt;
                &lt;/td&gt;
              &lt;/tr&gt;
            &lt;/tbody&gt;
          &lt;/table&gt;
        &lt;/td&gt;
        &lt;td valign="top" width="100%"&gt;
          &lt;table style="width: 100%; height: 204px;" border="0" cellpadding="0" cellspacing="0"&gt;
            &lt;tbody&gt;
              &lt;tr&gt;&lt;/tr&gt;
              &lt;tr&gt;
                &lt;td colspan="2"&gt;
                  &lt;font size="-1" face="Verdana, Arial, Helvetica, sans-serif"&gt;
                    &lt;br&gt;
                    &lt;b&gt;
                                  You are logged in as
                                  'abcdef_ghijkl@bsnl.in' at 117.000.000.000.
                                  &lt;br&gt;
                      &lt;br&gt;
                    &lt;/b&gt;
                    &lt;br&gt;
                    &lt;br&gt;
                  &lt;/font&gt;
                  &lt;!--Display the available metered time usage stats--&gt;
                  &lt;table border="0" width="100%" cellpadding="0" cellspacing="0"&gt;
                    &lt;noscript&gt;
                      &lt;tr&gt;
                        &lt;td&gt;
                          &lt;a href="help.php#Java_script" target="new"&gt;
                            &lt;font color="#FF0000"&gt;
                              &lt;u&gt;You must have JavaScript enabled in order to view usage stats.&lt;/u&gt;
                            &lt;/font&gt;
                          &lt;/a&gt;
                          &lt;br&gt;
                          &lt;br&gt;
                        &lt;/td&gt;
                      &lt;/tr&gt;
                    &lt;/noscript&gt;
                    &lt;tr&gt;
                      &lt;td colspan="4"&gt;
                        &lt;font color="#0A63BF"&gt;
                          &lt;b&gt; &lt;/b&gt;
                        &lt;/font&gt;
                      &lt;/td&gt;
                    &lt;/tr&gt;
                    &lt;tr&gt;
                      &lt;td&gt;
                        &lt;i&gt;&lt;/i&gt;
                      &lt;/td&gt;
                    &lt;/tr&gt;
                  &lt;/table&gt;
                  &lt;br&gt;
                  &lt;table border="0" width="100%" cellpadding="0" cellspacing="0"&gt;
                    &lt;noscript&gt;
                      &lt;tr&gt;
                        &lt;td&gt;
                          &lt;a href="help.php#Java_script" target="new"&gt;
                            &lt;font color="#FF0000"&gt;
                              &lt;u&gt;You must have JavaScript enabled in order to view usage stats.&lt;/u&gt;
                            &lt;/font&gt;
                          &lt;/a&gt;
                          &lt;br&gt;
                          &lt;br&gt;
                        &lt;/td&gt;
                      &lt;/tr&gt;
                    &lt;/noscript&gt;
                    &lt;tr&gt;
                      &lt;td colspan="7"&gt;
                        &lt;font color="#0A63BF"&gt;
                          &lt;b&gt; &lt;/b&gt;
                        &lt;/font&gt;
                      &lt;/td&gt;
                    &lt;/tr&gt;
                    &lt;tr align="left"&gt;
                      &lt;th&gt;Download Remaining with High(FUP-original)Speed &lt;/th&gt;
                    &lt;/tr&gt;
                    &lt;tr align="left"&gt;
                      &lt;td&gt;78.647 GB&lt;/td&gt;
                      &lt;td&gt;
                        &lt;a href="top_up.php?service=HS-I-H-50MB-90GB-10MB-B-M&amp;amp;timeMetered=false"&gt;&lt;img name="addBytes" src="images/btn1.png" border="0" alt="[AddBytes]" title="Top up volume quota"&gt;&lt;/a&gt;
                      &lt;/td&gt;
                    &lt;/tr&gt;
                    &lt;tr height="10"&gt;
                      &lt;td&gt;
                        &lt;font color="#0A63BF"&gt;&lt;/font&gt;
                      &lt;/td&gt;
                    &lt;/tr&gt;
                  &lt;/table&gt;
                  &lt;p&gt;
                    &lt;p&gt;&lt;/p&gt;
                  &lt;/p&gt;
                &lt;/td&gt;
                &lt;td style="width: 10px; background-color: rgb(f,f,f);"&gt;
                  &lt;br&gt;
                &lt;/td&gt;
              &lt;/tr&gt;
            &lt;/tbody&gt;
          &lt;/table&gt;
        &lt;/td&gt;
      &lt;/tr&gt;
    &lt;/tbody&gt;
  &lt;/table&gt;
&lt;/div&gt;
&lt;div class="portalfooter" align="left"&gt;
  &lt;td style="vertical-align: top;"&gt;
    &lt;table style="width: 100%; height: 86px;" border="0" cellpadding="0" cellspacing="0"&gt;
      &lt;tbody&gt;
        &lt;tr&gt;
          &lt;td colspan="3" rowspan="1" style="background-color: rgb(f, f, f);"&gt;
            &lt;br&gt;
          &lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr valign="top"&gt;
          &lt;td style="width: 165px; height: 10px;" border="0"&gt;
            &lt;br&gt;
          &lt;/td&gt;
          &lt;td class="npm10Text" height="10"&gt;
            &lt;br&gt;
            &lt;br&gt;
            &lt;p align="right"&gt;2014 BSNL . All rights reserved.&lt;/p&gt;
            &lt;br&gt;
            &lt;br&gt;
          &lt;/td&gt;
          &lt;td align="right" style="vertical-align: middle;"&gt;&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
          &lt;td colspan="3" rowspan="1" style="background-color: rgba(29, 117, 182, 1);"&gt;
            &lt;br&gt;
          &lt;/td&gt;
        &lt;/tr&gt;
      &lt;/tbody&gt;
    &lt;/table&gt;
  &lt;/td&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>I wanted to export the data in  tag just after "Download Remaining with High(FUP-original)Speed" </p>
<p>i.e I wanted to export the 78.647GB into a text file with a time stamp. And then repeat after a time interval and again add the exported to the same text file.</p>
</div>
<div class="post-text" itemprop="text">
<p>Ok, you got the soup part right but you are looking only at the first td element.</p>
<p>You need to find the exact one that you want.
In this case, it's the first td inside the second tr with left alignment (there are several ways to get there, this was the one I found easier)</p>
<p>In this case you can use:</p>
<pre><code>tr = bsObj.find_all('tr', align='left')[1]      # find_all returns all the elements in a list
td = tr.find('td')      # find returns only the first element in that block
text = td.get_text()    # we want the text, not the whole tag
</code></pre>
<p><br/></p>
<p>I believe that you can work out the timestamp using the <code>datetime</code> module.
datetime has an option to create a string the way you want, you can see all the options <a href="https://docs.python.org/2/library/datetime.html#strftime-and-strptime-behavior" rel="nofollow">here</a></p>
<p>One example, without the miliseconds, would be:</p>
<pre><code>now = datetime.datetime.now()
timestamp = now.strftime('%d/%m - %Hh%M')  # Note that you can add your own text with the time directives.
</code></pre>
<p><br/></p>
<p>To write the output you have several options, you can start by looking <a href="https://docs.python.org/3/tutorial/inputoutput.html#reading-and-writing-files" rel="nofollow">here</a></p>
<p><br/></p>
<p>Finally, the easiest way to repeat every X seconds is to put everything in a while loop with a <code>sleep(X)</code> in the end. Let's pretend you created a magic function with all the scrap and file I/O and that you want to run every 60s.</p>
<p>You have two options now:</p>
<p>1) An infinite loop that keeps going no matter what (you need to manually break it with ctrl+c or by itself when an error occurs.</p>
<pre><code>while True:
    do_your_magic()
    sleep(60)
</code></pre>
<p>2) A slightly better option would be to find out when the download is over (i.e. the remaining is zero or the page changes), but this depends on how your page source would behave when the download is over. For that you could have your magic function returning False while downloading and True when it's done and your loop could become:</p>
<pre><code>while True:
    done = do_your_magic()
    if done:
        break
    sleep(60)
</code></pre>
<p>or, more directly:</p>
<pre><code>while not do_your_magic():
    sleep(60)  # This runs your magic and breaks when it's done.
</code></pre>
<p><br/></p>
<p>Have a try, if you need more help just tell us how far you've got and what you think you're missing...</p>
</div>
<span class="comment-copy">Use something like Chrome's developer tools to get the XPath for the element you wish to analyze.</span>
<span class="comment-copy">thats it! it solved the first problem!</span>
<span class="comment-copy">help, i'm unable to make it repeat itself after a time interval. the datetime module also prints the mili-seconds, can the milisecond be removed? the text output to file works great, used "a" to add the output to the bottom of the text file. thanks for your help!</span>
<span class="comment-copy">Updated with more info, have a look if you can get your desired results now.</span>
<span class="comment-copy">I'll give it a try right away! Will let you know about the results!</span>
