<div class="post-text" itemprop="text">
<p>Below code works perfectly in python2 with MySQLDB, how can I make it Python3 compatible?</p>
<p>I have debugged and searched for similar questions. </p>
<blockquote>
<p>Error:
  Exception ignored in: &gt; Traceback (most recent call last): File &gt; &gt; &gt; "/usr/local/lib/python3.4/dist-packages/pymysql/cursors.py", line 41, in del File &gt; "/usr/local/lib/python3.4/dist-packages/pymysql/cursors.py", line 47, in close ReferenceError: weakly-referenced object no longer exists –</p>
</blockquote>
<pre><code>class Database():

    def __init__(self):
        self.host = 'localhost'
        self.user = 'user'
        self.password = 'pwd'  
        self.db = 'dbname'
        self.connection = pymysql.connect(host=self.host, user=self.user, passwd=self.password, db=self.db,use_unicode=True, charset="utf8")
        self.cursor = self.connection.cursor()

    def storeToDB(self,ID,string,g,e):
        import datetime

        curr_time = datetime.datetime.now()
        status = 0
        try:
            self.cursor.execute("""INSERT INTO master_data (`job_id`,`sstring`,`grl`,`erl`,`status`,`insert_timestamp`) \
            VALUES (%s,%s,%s,%s,%s,%s)""",(jobID,search_string,g,e,status,curr_time))
            self.connection.commit()
        except:
            self.connection.rollback()
if __name__ == "__main__":
    db = Database()
    db.storeToDB(20,"hello","something.com","e.com")
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>Try to do some opt before db operation finish :</p>
<pre><code>cursor.close()
connection.close()
</code></pre>
</div>
<span class="comment-copy">Your example code would not even compile. Please show the exact code, or obscure the local variables correctly.</span>
<span class="comment-copy">but it's interpreted... :)</span>
<span class="comment-copy">Well. Your code catches all exceptions and then ignores them. Check out how it's done in the pymysql's documentation instead. Use a context manager (<code>with connection.cursor() as cursor:</code>) and <code>try-finally</code> instead of <code>try-except-(pretend error didn't happen)</code> <a href="http://pymysql.readthedocs.io/en/latest/user/examples.html" rel="nofollow noreferrer">pymysql.readthedocs.io/en/latest/user/examples.html</a></span>
<span class="comment-copy">Make sure that you have the latest version of PyMySQL (0.7.4). It seems like your version doesn't implement the <a href="https://docs.python.org/3/reference/datamodel.html#context-managers" rel="nofollow noreferrer">context manager</a> interfaces.</span>
<span class="comment-copy">Thanks @HåkenLid, it worked perfectly :)</span>
