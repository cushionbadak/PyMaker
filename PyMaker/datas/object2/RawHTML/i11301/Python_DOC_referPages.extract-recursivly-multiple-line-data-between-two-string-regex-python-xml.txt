<div class="post-text" itemprop="text">
<p>I have a huge XML file from which I need data for specific entries. File structure is:</p>
<pre><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt; 
&lt;!DOCTYPE stuff&gt;
&lt;?xml-stylesheet href="file:///usr/local/test.xsl" type="text/xsl"?&gt;
&lt;!-- 127.0.0.1 --&gt;
&lt;opentag&gt;
&lt;tag1&gt;&lt;XXXX YYYY VVV SSS&gt;&lt;/tag1&gt;
&lt;tag2&gt;
&lt;test&gt;aaa_string_bbb_ccc&lt;/test&gt;
&lt;/tag2&gt;  
&lt;debugging level="0"/&gt;
&lt;/opentag&gt;
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE &gt;
&lt;?xml-stylesheet href="file:///usr/local/test.xsl" type="text/xsl"?&gt;
&lt;!-- 192.168.10.1 --&gt;
&lt;opentag&gt;
&lt;tag1&gt;&lt;DDD FFF BBB&gt;&lt;/tag1&gt;
&lt;tag2&gt;
&lt;test&gt;zzz_number_yyy_xxxx&lt;/test&gt;
&lt;/tag2&gt;
&lt;debugging level="0"/&gt;
&lt;/opentag&gt;
</code></pre>
<p>In my XML i have many of these entry.
What I have to achieve is to extract all the lines (complete record) for certain entries.
I need to create different xml file, one for every times that you found text between 
<code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;</code>
 till next 
<code>&lt;/opentag&gt;</code>.</p>
<p>In this case i would like to have tow different xml file, with different file name. Ex : </p>
<p>1  -&gt; 127.0.0.1.xml  :</p>
<pre><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt; 
&lt;!DOCTYPE stuff&gt;
&lt;?xml-stylesheet href="file:///usr/local/test.xsl" type="text/xsl"?&gt;
&lt;!-- 127.0.0.1 --&gt;
&lt;opentag&gt;
&lt;tag1&gt;&lt;XXXX YYYY VVV SSS&gt;&lt;/tag1&gt;
&lt;tag2&gt;
&lt;test&gt;aaa_string_bbb_ccc&lt;/test&gt;
&lt;/tag2&gt;
&lt;debugging level="0"/&gt;
&lt;/opentag&gt;
</code></pre>
<p>and the second one : </p>
<p>2 -&gt; 192.168.10.1.xml : </p>
<pre><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE &gt;
&lt;?xml-stylesheet href="file:///usr/local/test.xsl" type="text/xsl"?&gt;
&lt;!-- 192.168.10.1 --&gt; 
&lt;opentag&gt;
&lt;tag1&gt;&lt;DDD FFF BBB&gt;&lt;/tag1&gt;
&lt;tag2&gt;
&lt;test&gt;zzz_number_yyy_xxxx&lt;/test&gt;
&lt;/tag2&gt;
&lt;debugging level="0"/&gt;
&lt;/opentag&gt;
</code></pre>
<p>What could be the REGEX to perform such extraction of record for specific entries? 
Is there any more pythonic way to achieve this?
I would appreciate your help on this.</p>
<p>AS</p>
</div>
<div class="post-text" itemprop="text">
<p>Do not use regex for this. Instead have a look at the <a href="https://docs.python.org/3/library/xml.etree.elementtree.html" rel="nofollow">ElementTree</a> module. With this, you can just iterate over all the opentags, and then write each one into a different file. This is more pythonic than using regex ('<em>don't reinvent the wheel</em>').</p>
<p>If you have to use regex you could do:</p>
<pre><code>(&lt;\?xml version="1\.0" encoding="UTF-8"\?&gt;.+?&lt;\/opentag&gt;)
</code></pre>
<p>Make sure to pass the <code>'s'</code> modifier so <code>'.'</code> matches newline.</p>
<p>This is the final solution: </p>
<pre><code>pattern = re.compile('&lt;\?xml version="1\.0" encoding="UTF-8"\?&gt;.+?&lt;\/nmaprun&gt;', re.DOTALL)
result= re.findall(pattern,data)
for item in result:
            print item
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>Presuming the format is the same for all the files and <code>&lt;!-- 127.10.10.1 --&gt;</code> is actually in the first file you can use <em>itertools.groupby</em> to group the sections:</p>
<pre><code>from itertools import groupby

with open("your_file") as f:
   grps = groupby(f, key=lambda x: x.strip().startswith('&lt;?xml version&gt;'))
   for k, v in grps:
      if k:
          lines = list(v) + list(next(grps)[1])
          with open("{}".format(lines[2]), "w") as out:
              out.writelines( lines)
</code></pre>
<p>Which for your example data gives you exactly what you want. </p>
</div>
<span class="comment-copy">Where did <code>&lt;!-- 127.10.10.1 --&gt;</code> come from?</span>
<span class="comment-copy">&lt;!-- here there are some detail about a command line executed on  specific IP addresses 127.0.0.1/16 --&gt;</span>
<span class="comment-copy">I can use any scripting language or any libraries. the important thing is being able to divide the xml files and produce many new xml files whenever I strings that I indicated earlier.</span>
<span class="comment-copy">Your solution does not work. Thanks anyway for your help</span>
<span class="comment-copy">It does work. pattern = re.compile('(&lt;\?xml version="1\.0" encoding="UTF-8"\?&gt;.+?&lt;\/opentag&gt;)', re.DOTALL) result = re.findall(pattern, xmlstring) this returns a list of all the blocks.</span>
<span class="comment-copy">I edited your regex raising single quotes and the script worked. You were right !!! ;) Thanks for the help,</span>
<span class="comment-copy">I was wrong because in my XML file is not present any new line. I'm sorry</span>
<span class="comment-copy">Use the second code block then but where does the 127....  line come from?</span>
<span class="comment-copy">Within that comment there are the details of a command run on a IP(127.0.0.1)/subnet(127.0.0.1/20) that is launched from the terminal.</span>
<span class="comment-copy">Is it always the third line of section?</span>
<span class="comment-copy">yes is always the third line of the section in every section.</span>
