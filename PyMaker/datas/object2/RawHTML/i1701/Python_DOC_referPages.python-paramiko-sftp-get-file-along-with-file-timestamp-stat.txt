<div class="post-text" itemprop="text">
<pre><code># create SSHClient instance
ssh = paramiko.SSHClient()

list = []

# AutoAddPolicy automatically adding the hostname and new host key
ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy())
ssh.load_system_host_keys()
ssh.connect(hostname, port, username, password)
stdin, stdout, stderr = ssh.exec_command("cd *path*; ls")

for i in stdout:
    list.append(i)

sftp = ssh.open_sftp()

for i in list:
    tempremote = ("*path*" + i).replace('\n', '')
    templocal = ("*path*" + i).replace('\n', '')

    try:
        #Get the file from the remote server to local directory
        sftp.get(tempremote, templocal)
    except Exception as e:
        print(e)
</code></pre>
<blockquote>
<p>Remote Server File Date Modified Stat : 6/10/2018 10:00:17</p>
<p>Local File Date Modified Stat : Current datetime</p>
</blockquote>
<p>But I found that the date modified changed after done copy the file.</p>
<p>Is there anyway to copy remote file along with the file stat to the local file too ?</p>
</div>
<div class="post-text" itemprop="text">
<p>Paramiko indeed won't preserve timestamp when transferring files.</p>
<p>You have to explicitly call the <a href="https://docs.python.org/3/library/os.html#os.utime" rel="nofollow noreferrer"><code>os.utime</code></a> after the download.</p>
<hr/>
<p>Note that <a href="https://pypi.org/project/pysftp/" rel="nofollow noreferrer">pysftp</a> (that internally uses Paramiko) supports preserving the timestamp with its <a href="https://pysftp.readthedocs.io/en/latest/cookbook.html#pysftp-connection-get" rel="nofollow noreferrer"><code>pysftp.Connection.get()</code> method</a>.</p>
<p>You can reuse their implementation (code simplified by me):</p>
<pre><code>sftpattrs = sftp.stat(tempremote)
os.utime(templocal, (sftpattrs.st_atime, sftpattrs.st_mtime))
</code></pre>
<hr/>
<p>Similarly for <a href="https://stackoverflow.com/q/29363697/850848">uploads</a>.</p>
</div>
<div class="post-text" itemprop="text">
<p>There doesn't seem to be a way to copy with the stats documented in the paramiko SFTP module. It makes sense why though, because copying the stats besides times for a remote file wouldn't necessarily make sense (i.e. the user/group ids would not make sense on your local machine).</p>
<p>You can just copy the file, then get the atime/mtime/ctime using the SFTP client's <code>stat</code> or <code>lstat</code> methods and set those on the local file using <code>os.utime</code>.</p>
</div>
<span class="comment-copy">Why are you using shell <code>ls</code> command to retrieve file a list? Use SFTP: <a href="https://docs.paramiko.org/en/stable/api/sftp.html#paramiko.sftp_client.SFTPClient.listdir" rel="nofollow noreferrer"><code>SFTPClient.listdir</code></a>.</span>
<span class="comment-copy">Thanks this is what I need in my function. Because I need the date modified to process my files.</span>
