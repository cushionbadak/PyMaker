<div class="post-text" itemprop="text">
<p>I would like to add in the following for every log entry:</p>
<pre><code>user
request_method
status
</code></pre>
<p>The only way I've seen to be able to do this is a bit of a hackish way, which is to pass them as <code>args</code>, because that's picked up by the django formatter (I don't see any place where you can pass kwargs -- <a href="https://docs.python.org/3/library/logging.html#formatter-objects" rel="nofollow noreferrer">https://docs.python.org/3/library/logging.html#formatter-objects</a>). Here's an example:</p>
<pre><code>log.info("hi", {"user": str(request.user)})
</code></pre>
<p>And the following formatter:</p>
<pre><code>'format': '{"message": "%(message)s", "extra": "%(args)s"}',
</code></pre>
<p>When I parse the log I do something like this:</p>
<pre><code>info = {
  'message': message
}
data = ast.literal_eval(extra)
for k,v in extra.items():
    info[k] = v
</code></pre>
<p>It seems pretty ghetto -- is there a better way to do this, for example, a way to get the kwargs in the formatter? When I try doing something like:</p>
<pre><code>log.info("hi", extra = {"user": str(request.user)})
</code></pre>
<p>It either errors, or doesn't pass in the <code>args</code> (obviously).</p>
</div>
<div class="post-text" itemprop="text">
<p>I would do it by linking the request to the current thread of execution.  Here's an example of how to do this:</p>
<p><a href="https://nedbatchelder.com/blog/201008/global_django_requests.html" rel="nofollow noreferrer">https://nedbatchelder.com/blog/201008/global_django_requests.html</a></p>
<p>Then you can use <code>get_request()</code> in your logging handler to get the request, from which you can get the user.  (I'm not sure what you mean by "status")</p>
</div>
