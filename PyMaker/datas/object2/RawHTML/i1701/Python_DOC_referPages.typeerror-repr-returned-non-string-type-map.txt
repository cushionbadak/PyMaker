<div class="post-text" itemprop="text">
<p>How do I correctly define <code>__repr__</code> for my map class?</p>
<pre><code>class map(object):
    """Find data folders that could be imported and return as list"""
    def __init__(self,height=400,zoom=0):
        """Initialize the map"""
        if zoom == 0:
            z = get_map_zoom()
        else:
            z = zoom
        self.map = Map(center=get_map_center(), zoom=z)
        self.map.layout.height = f'{height}px'
    def __repr__(self):
        return self.map
    def add_layer(self,tableName:str,style_name='default',geomColumn:str = 'geom'):
        """Get GeoJSON data from database and add as layer to map"""
        data = db.execute(f'SELECT ST_AsGeojson(ST_Transform({geomColumn},4326)) from {tableName} order by random() limit 5000;')
        style = get_style(style_name)
        geo_json = GeoJSON(style=style,data={'type': "FeatureCollection", 'features': [json.loads(row[0]) for row in data]})
        self.map.add_layer(geo_json)
</code></pre>
<p>From Jupyter I am generating the map like this:</p>
<pre><code>from modules import map
m = map.map()

m.add_layer('geo.service_area','service_area')
m.add_layer('rawgeo.ways',geomColumn='the_geom')

display(m)
</code></pre>
<p>But <code>TypeError: __repr__ returned non-string (type Map)</code> error occurs on <code>display(m)</code>.</p>
<p>I am able to make it work if I use <code>display(m.map)</code> instead.</p>
</div>
<div class="post-text" itemprop="text">
<p>The <code>__repr__</code> method must return a string. From <a href="https://docs.python.org/3/reference/datamodel.html#object.__repr__" rel="nofollow noreferrer">the docs</a> (some emphasis mine):</p>
<blockquote>
<p><code>object.__repr__(self)</code></p>
<p>Called by the repr() built-in function to compute the “official” string representation of an object. If at all possible, this should look like a valid Python expression that could be used to recreate an object with the same value (given an appropriate environment). If this is not possible, a string of the form &lt;...some useful description...&gt; should be returned. <strong>The return value must be a string object</strong>. If a class defines <code>__repr__()</code> but not <code>__str__()</code>, then <code>__repr__()</code> is also used when an “informal” string representation of instances of that class is required.</p>
</blockquote>
<p><strong>Edit</strong>: As @khelwood suggests you can <code>return repr(self.map)</code> in the <code>__repr__</code> method.</p>
</div>
<span class="comment-copy">How about <code>return repr(self.map)</code> ?</span>
