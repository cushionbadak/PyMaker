<div class="post-text" itemprop="text">
<p>Is it possible to have a script iterate through each IP and backup running configuration on a local tftp server</p>
<pre><code>   import paramiko
    import sys
    import time


    USER = "root"
    PASS = "cisco"
    HOST = ["10.10.10.10","11.11.11.11","12.12.12.12"]
    i=0
    while i &lt;len(HOST)
    def fn():
      client1=paramiko.SSHClient()
      #Add missing client key
      client1.set_missing_host_key_policy(paramiko.AutoAddPolicy())
      #connect to switch
      client1.connect(HOST,username=USER,password=PASS)
      print "SSH connection to %s established" %HOST

     show run | redirect tftp://10.10.10.20/HOST.cfg 
    print "Configuration has been backed up"for  %HOST
    i+1
</code></pre>
<p><code>show run | redirect tftp://10.10.10.20/HOST.cfg</code> --- can I use variable name as a text file name?</p>
</div>
<div class="post-text" itemprop="text">
<ul>
<li>Use <code>for h in HOST</code> to iterate your <code>HOST</code> array;</li>
<li>Use <a href="https://docs.paramiko.org/en/stable/api/client.html#paramiko.client.SSHClient.exec_command" rel="nofollow noreferrer"><code>SSHClient.exec_command</code></a> to execute the command;</li>
<li>Use <a href="https://docs.python.org/3/library/functions.html#format" rel="nofollow noreferrer"><code>string.format</code></a> to format your messages and commands.</li>
</ul>
<pre><code>for h in HOST:
    client = paramiko.SSHClient()
    #Add missing client key
    client.set_missing_host_key_policy(paramiko.AutoAddPolicy())
    #connect to switch
    client.connect(h, username = USER, password = PASS)
    print("SSH connection to {0} established".format(h))
    command = "show run | redirect tftp://10.10.10.20/{0}.cfg".format(h)
    (stdin, stdout, stderr) = client.exec_command(command)
    for line in stdout.readlines():
        print(line)
    client.close()
    print("Configuration has been backed up for {0}".format(h))
</code></pre>
<hr/>
<p><em>Obligatory warning: Do not use <code>AutoAddPolicy</code> - You are losing a protection against <a href="https://en.wikipedia.org/wiki/Man-in-the-middle_attack" rel="nofollow noreferrer">MITM attacks</a> by doing so. For a correct solution, see <a href="https://stackoverflow.com/q/10670217/850848">Paramiko "Unknown Server"</a>.</em></p>
</div>
<span class="comment-copy">What is <code>redirect</code>? Is that a command? Where do you want to execute that? Locally or on the routers?</span>
<span class="comment-copy">Redirect is Cisco published command to run on any switch/router to push a running configuration via tftp server running on a local PC. If you know a better way please share.</span>
<span class="comment-copy">Going to try this, thank you.</span>
