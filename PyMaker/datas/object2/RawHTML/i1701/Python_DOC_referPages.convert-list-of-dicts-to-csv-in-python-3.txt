<div class="post-text" itemprop="text">
<p>I got a list of dictionaries with different length and even different <code>(key: values)</code> pairs. For example: </p>
<pre><code>[
    {'key1': 'value1', 'key3':'value3'},
    {'key1': 'someValue', 'key2':'value2', 'key3':'value3'},
    {'anotherKey': 'anotherValue', 'key1': 'value1', 'key2':'value2'},
    {'anotherKey': 'anotherValue', 'anotherKey1': 'anotherValue1', 'key1': 'value1', 'key2':'value2', 'key3':'value3'},
]
</code></pre>
<p>I need to create <code>CSV</code> file with all of keys as headers and values. If key not in the current dictionary then set the default value (for example '-'). The <code>CSV</code> from example should be looking like that:  </p>
<p><a href="https://i.stack.imgur.com/slEQr.png" rel="nofollow noreferrer"><img alt="enter image description here" src="https://i.stack.imgur.com/slEQr.png"/></a></p>
<p>I'm trying this code for my list of dictionaries, but it returns an error: </p>
<pre><code>listOfDicts = [
    {'key1': 'value1', 'key3':'value3'},
    {'key1': 'someValue', 'key2':'value2', 'key3':'value3'},
    {'anotherKey': 'anotherValue', 'key1': 'value1', 'key2':'value2'},
    {'anotherKey': 'anotherValue', 'anotherKey1': 'anotherValue1', 'key1': 'value1', 'key2':'value2', 'key3':'value3'},
]

keys = listOfDicts[0].keys()
with open('test.csv', 'a') as output_file:
    dict_writer = csv.DictWriter(output_file, fieldnames=keys, delimiter='@')
    dict_writer.writeheader()
    dict_writer.writerows(listOfDicts)
</code></pre>
<p>ERROR:</p>
<pre><code>ValueError: dict contains fields not in fieldnames: 'key2'
</code></pre>
<p>How I can add all unique keys as headers for CSV and fill it values by key?</p>
</div>
<div class="post-text" itemprop="text">
<p>Use <code>DicitWritter()</code> <code>restval</code> parameter, </p>
<blockquote>
<p>The optional restval parameter specifies the value to be written if
  the dictionary is missing a key in fieldnames.</p>
</blockquote>
<p>and for <code>fieldnames</code> parameter use a list of all available keys in a list of dictionaries.</p>
<pre><code>import csv


listOfDicts = [
    {'key1': 'value1', 'key3':'value3'},
    {'key1': 'someValue', 'key2':'value2', 'key3':'value3'},
    {'anotherKey': 'anotherValue', 'key1': 'value1', 'key2':'value2'},
    {'anotherKey': 'anotherValue', 'anotherKey1': 'anotherValue1', 'key1': 'value1', 'key2':'value2', 'key3':'value3'},
]

keys = [i for s in [d.keys() for d in listOfDicts] for i in s]

with open('test.csv', 'a') as output_file:
    dict_writer = csv.DictWriter(output_file, restval="-", fieldnames=keys, delimiter='@')
    dict_writer.writeheader()
    dict_writer.writerows(listOfDicts)
</code></pre>
<p>output:</p>
<pre><code>$ cat test.csv 
key3@key1@key2@anotherKey@anotherKey1
value3@value1@-@-@-
value3@someValue@value2@-@-
-@value1@value2@anotherValue@-
value3@value1@value2@anotherValue@anotherValue1
</code></pre>
<p>Reference: <a href="https://docs.python.org/2/library/csv.html#csv.DictWriter" rel="nofollow noreferrer">https://docs.python.org/2/library/csv.html#csv.DictWriter</a></p>
</div>
<div class="post-text" itemprop="text">
<p>To overcome the error, you can collect all the keys before writing the file, like this:</p>
<pre><code>keys = set()
for d in listOfDicts:
    keys.update(d.keys())

with open('test.csv', 'a') as output_file:
    dict_writer = csv.DictWriter(
        output_file, fieldnames=keys, restval='-', delimiter='@')
    dict_writer.writeheader()
    dict_writer.writerows(listOfDicts)
</code></pre>
<p>You can use the parameter <a href="https://docs.python.org/3/library/csv.html#csv.DictWriter" rel="nofollow noreferrer"><code>DictWriter.restval</code></a> to assign default values for missing keys.</p>
</div>
<span class="comment-copy">You can use <code>pandas.from_dict()</code> method, add each row in a loop and save with <code>df.to.csv(path_to_csv)</code></span>
<span class="comment-copy">Copy and pasted your code, but got same error</span>
<span class="comment-copy">@KonstantinRusanov accidentally i have erased a important line of code while editing a post. Sorry :) please try now.</span>
<span class="comment-copy">Worked perfect, thanks</span>
