<div class="post-text" itemprop="text">
<p>I have a problem parsing data from xml file. I'm using xml.etree.ElementTree to extract data from files and then save them into .csv. I have all the necessery modules installed on server.
I am aware that there is bs4 module with BeutifulSoup, <strong>yet I would like to know if is possible to parse this data/xml file using ElementTree</strong>. Sorry if the answear is easy or obvious, yet I'm still very much a beginner and with this problem I could not name the problem in a way to find an answear.</p>
<p>While running python script written below I have no errors and no outcome. I don't really know what should I change. I can not find solution. I tried using different child.tag or attributes but with no result.</p>
<p>The xml file that I have problem with.:</p>
<pre><code>&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;offer file_format="IOF" version="2.6" extensions="yes" xmlns="http://www.iai-shop.com/developers/iof.phtml"&gt;
    &lt;product id="9" vat="23.0" code_on_card="BHA"&gt;
      &lt;producer id="1308137276" name="BEAL"/&gt;
      ...
      &lt;price gross="175" net="142.28"/&gt;
      &lt;sizes&gt;
        &lt;size code_producer="3700288265272" code="9-uniw" weight="0"&gt;
          &lt;stock id="0" quantity="-1"/&gt;
          &lt;stock id="1" quantity="4"/&gt;
        &lt;/size&gt;
      &lt;/sizes&gt;
    &lt;/product&gt;
    &lt;product&gt;
              ...
    &lt;/product&gt;
              ...
</code></pre>
<p>and script that I tried to use (here to extract code_on_card, price net, quantity).</p>
<p>(I am aware that there are two childs: stock and quantity, and I'm completely fine with the second one overwrting the first one)</p>
<pre><code>import requests
import os,sys
import csv
import xml.etree.ElementTree as ET

reload(sys)
sys.setdefaultencoding('utf-8')

xml_path = '/file.xml'

xml = ET.parse(xml_path)

with open('/home/file.csv', 'wb') as f:
    c = csv.writer(f, delimiter=';')
    for product in xml.iter('product'):
    product_id = product.attrib["code_on_card"]
        for child in product:
            if child.tag == 'price':
                if child.attrib["net"] != None:
                    hurt_net = child.attrib["net"]
        for size in product.iter('size'):
            for stock in size.iter('stock'):
                if 'quantity' in stock.attrib.keys():
                    quantity = stock.attrib["quantity"]

        line = product_id, hurt_net, quantity
        c.writerow(line)
</code></pre>
<p>Files that seem to me to be built on similar scheme work just fine (offer -&gt; product -&gt;child/attrib ), like this one:</p>
<pre><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;offer file_format="IOF" version="2.5"&gt;
    &lt;product id="2"&gt;
        &lt;price gross="0.00" net="0.00" vat="23.0"/&gt;
        &lt;srp gross="0.00" net="0" vat="23.0"/&gt;
        &lt;sizes&gt;
            &lt;size id="0"  code="2-0"  weight="0" &gt;
            &lt;/size&gt;
        &lt;/sizes&gt;
    &lt;/product&gt;
        ...
    &lt;/product&gt;
        ...
</code></pre>
<p>EDIT:
Outcome should be .csv file containing multpile rows (each for each product in xml file) of code_on_card, price net, quantity. It should look like:</p>
<pre><code>BC097B.50GD.O;70.81;37
BC097B.50.A;76.75;24
BC086C.50.B;76.75;29
BGRT.L;3;96.75;28
....
</code></pre>
<p><strong>EDIT2</strong>
code as it is, after drec4s answear:</p>
<pre><code>import requests
import os,sys
import csv
import xml.etree.cElementTree as ET

reload(sys)
sys.setdefaultencoding('utf-8')

xml_path = '/home/platne/serwer16373/dane/z_hurtowni/pobrane/beal2.xml'

root = ET.parse(xml_path)

ns = {'offer': 'http://www.iai-shop.com/developers/iof.phtml'}

products = root.getchildren()

with open('/home/platne/serwer16373/dane/z_hurtowni/stany_magazynowe/karol/bealKa.csv', 'wb') as f:
    c = csv.writer(f, delimiter=';')
    hurtownia = 'beal'
    for product in root.iter('product'):
        qtt = [1]
        code = product.get('code_on_card')
        hurt_net = product.find('price').get('net')
        for stock in product.find('sizes').find('size').getchildren():
            qtt.append(stock.get('quantity'))
        quantity = max(qtt)


        line = 'beal-'+str(code), hurt_net, quantity
        c.writerow(line)
</code></pre>
<p>somehow I'm getting
AttributeError: 'ElementTree' object has no attribute 'getchildren'
I've got Ele</p>
</div>
<div class="post-text" itemprop="text">
<p>This is how I would go and parse an <code>xml</code> file with namespaces. As per <a href="https://docs.python.org/3/library/xml.etree.elementtree.html" rel="nofollow noreferrer">official documentation</a>, the easiest way is to define a <code>dictionary</code> specifying the namespace.</p>
<pre><code>from xml.etree import cElementTree as ET

root = ET.fromstring("""
&lt;offer file_format="IOF" version="2.6" extensions="yes" xmlns="http://www.iai-shop.com/developers/iof.phtml"&gt;
    &lt;product id="9" vat="23.0" code_on_card="BHA"&gt;
      &lt;producer id="1308137276" name="BEAL"/&gt;
      &lt;price gross="175" net="142.28"/&gt;
      &lt;sizes&gt;
        &lt;size code_producer="3700288265272" code="9-uniw" weight="0"&gt;
          &lt;stock id="0" quantity="-1"/&gt;
          &lt;stock id="1" quantity="4"/&gt;
        &lt;/size&gt;
      &lt;/sizes&gt;
    &lt;/product&gt;
&lt;/offer&gt;
""")

ns = {'offer': 'http://www.iai-shop.com/developers/iof.phtml'}

products = root.getchildren()

for p in products:
    qtt = [] #to store all stock quantities
    product_id = p.get('code_on_card')
    hurt_net = p.find('offer:price', ns).get('net')
    for stock in p.find('offer:sizes', ns).find('offer:size', ns).getchildren():
        qtt.append(int(stock.get('quantity')))

    quantity = max(qtt) #or sum

line = (product_id, hurt_net, quantity)
print(line)
</code></pre>
<p>Outputs:</p>
<pre><code>('BHA', '142.28', 4)
</code></pre>
<p>Also, I did not understand what was the stock quantity that you needed to extract, since you were only getting the last children(<code>stock</code>) value (change the <code>sum</code> function to <code>max</code> or to whatever you need).</p>
</div>
<span class="comment-copy">It's because of the default namespace (<a href="https://docs.python.org/3.6/library/xml.etree.elementtree.html#parsing-xml-with-namespaces" rel="nofollow noreferrer">see here</a> on how to parse XML with namespaces). It would also be helpful if you added an example of what your output should look like.</span>
<span class="comment-copy">Another thing that would be helpful is code that will run as-is (see <a href="https://stackoverflow.com/help/mcve">stackoverflow.com/help/mcve</a>).</span>
<span class="comment-copy">default namespace - I think thats it - need time to bite into it.</span>
<span class="comment-copy">I think that this is the answear, yet I can't seem to work it out. Somehow i'm getting AttributeError: 'ElementTree' object has no attribute 'getchildren'</span>
