<div class="post-text" itemprop="text">
<p>I am attempting to upload a CSV file to an API (which gives me very little error info) using python requests library.</p>
<p>(I'm running Python 3.5 and using requests version 2.18.4 on OS X 10.11.6)</p>
<p>This curl command in terminal works fine: <code>curl -F 'file=@/path/to/file.csv' myurl.com/upload -H "Authorization: TOKEN sometoken"</code></p>
<p>A multipart/form-data POST request from Postman also works, but I can't seem to make it work with the python requests library.</p>
<p>I've tried many variations of this request:</p>
<pre><code>import requests
headers = {'Authorization': 'TOKEN sometoken', 'Content-Type': 'multipart/form-data'}

with open(file_path, 'rb') as f:
    r = requests.post(myurl, headers=headers, data=f)

## I've also tried data={"file": f}
</code></pre>
<p>I get a status code of 200, but the response is <code>{"success": "false"}</code> (frustratingly unhelpful).</p>
<p>What am I missing in the python request compared to the curl request?</p>
<p><strong>EDIT:</strong> it seems that the <code>-F</code> flag for the <code>curl</code> command emulates an HTML form that has been submitted...is there a way to do this with requests?</p>
</div>
<div class="post-text" itemprop="text">
<p>In your <code>curl</code> code you're using the <code>-F</code> parameter, which submits the data as a multipart message - in other words you're uploading a file.<br/>
With <code>requests</code> you can post files with the <a href="http://docs.python-requests.org/en/master/user/quickstart/#post-a-multipart-encoded-file" rel="nofollow noreferrer"><code>files</code></a> parameter. An example:  </p>
<pre><code>import requests

headers = {'Authorization': 'TOKEN sometoken'}
data = {'file': open(file_path, 'rb')}
r = requests.post(myurl, headers=headers, files=data)
</code></pre>
<p>Note that <code>requests</code> creates the Content-Type header automatically, based on the submitted data. </p>
</div>
<div class="post-text" itemprop="text">
<p>The python <code>open()</code> <a href="https://docs.python.org/3/library/functions.html#open" rel="nofollow noreferrer">function</a> returns a file object. This is not what you want to send to the API.<br/>
Instead, you can use:<br/></p>
<pre><code>with open(file_path, 'rb') as f:
    r = requests.post(myurl, headers=headers, data=f.read())
</code></pre>
<p>Syntax taken from <a href="https://stackoverflow.com/questions/43246857/python-requests-post-a-file">here</a>.</p>
</div>
<span class="comment-copy">This worked, thanks! I noticed the <code>files</code> param in the docs, but they only mention it <a href="http://docs.python-requests.org/en/master/user/advanced/#post-multiple-multipart-encoded-files" rel="nofollow noreferrer">specifically for multiple file uploads at the same time</a>, which threw me off.</span>
<span class="comment-copy">That's the dvanced usage documentation (in case you want to upload multiple files with the same name), and it can be confusing. The example in <a href="http://docs.python-requests.org/en/master/user/quickstart/#post-a-multipart-encoded-file" rel="nofollow noreferrer">quickstart</a> in is much clearer.</span>
<span class="comment-copy">Unfortunately, that didn't do the trick. I wish I could provide more info, but I have absolutely no error info to go on.</span>
