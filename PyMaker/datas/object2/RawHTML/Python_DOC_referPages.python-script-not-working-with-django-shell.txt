<div class="post-text" itemprop="text">
<p>i have written script to <code>create users</code> using csv file. i have to check the <code>sso username</code> is valid or not using an api request as well and its written in <code>_validate_user</code> function. To make the api request i'm using <code>urllib3</code>. Sample code provided below.</p>
<pre><code>import csv
import urllib3.request
from django.contrib.auth.models import User

def _validate_user(sso_username):
    http = urllib3.PoolManager()
    fl_name = '&lt;url&gt;' + sso_username
    site_data = http.request('GET', fl_name)
    _data = site_data.data
    print(_data)

FILENAME = r'./csv/usernames.csv'

with atomic():
    with open(FILENAME, 'rt',  encoding='utf-8-sig') as f:
        reader = csv.DictReader(f)
        for i, row in enumerate(reader):
            user_name = row['username']
            if _validate_user(user_name):
                User.objects.get_or_create(
                    username=row['username'],
                    password='password',
                )
                print("User added")
            else:
                print("Invaid user")
</code></pre>
<p>when i run the code using <code>python3 manage.py shell</code> and input code line by line i'm not getting any error and everything is working as expected.</p>
<p>When i use <code>python3 manage.py shell &lt; utility_folder/load_users.py</code> to run the script i'm getting <code>NameError: name 'urllib3' is not defined at line number 6</code>. What am i missing here. I tried with <code>requests</code> module also didn't do much help.</p>
<pre><code>Django version is 1.11 and python 3.6
</code></pre>
<p>Please advice.</p>
</div>
<div class="post-text" itemprop="text">
<p>Use <code>exec(open("utility_folder/load_users.py").read())</code> into the shell instead of <code>python3 manage.py shell &lt; utility_folder/load_users.py</code>.</p>
</div>
<span class="comment-copy">If you're going to do this more than once, consider creating a Django management command.</span>
<span class="comment-copy">This is working, do you have any idea why the conventional way is not working ?</span>
