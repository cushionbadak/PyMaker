<div class="post-text" itemprop="text">
<p>It's my first time writing here, so I hope I'm doing everything all right.
I'm using python 3.5 on Win10, and I'm trying to "sync" music from Itunes to my Android device. Basically, I'm reading the Itunes Library XML file and getting all the files location ( so I can copy/paste them into my phone ) but I have problems with songs containing foreign characters.</p>
<pre><code>import getpass
import re
import os
from urllib.parse import unquote

user = getpass.getuser()
ITUNES_LIB_PATH = "C:\\Users\\%s\\Music\\Itunes\\iTunes Music Library.xml" % user
ITUNES_SONGS_FILE = "ya.txt"


def write(file, what, newline=True):
    with open(file, 'a', encoding="utf8") as f:
        if  not os.path.isfile(what):
            print("Issue locating file %s\n" % what)
        if newline:
            what+"\n"
        f.write(what)


def get_songs(file=ITUNES_LIB_PATH):
    with open(file, 'r', encoding="utf8") as f:
        f = f.read()
        songs_location = re.findall("&lt;key&gt;Location&lt;/key&gt;&lt;string&gt;file://localhost/(.*?)&lt;/string&gt;", f)
        for song in songs_location:
            song = unquote(song.replace("/", '\\'))
            write(ITUNES_SONGS_FILE, song)


get_songs()
</code></pre>
<p>Output: </p>
<pre><code>Issue locating file C:\Users\Dymy\Desktop\Media\Norin &amp;#38;amp; Rad - Bird Is The Word.mp3
</code></pre>
<p>How should I handle that "&amp;amp;" in the file name?</p>
</div>
<div class="post-text" itemprop="text">
<p>There are a couple of related issues in your code e.g., unescaped xml character references, hardcoded character encodings cause by using <a href="https://stackoverflow.com/q/1732348/4279">regular expressions to parse xml</a>. To fix them, use <code>xml</code> parser such as <a href="https://docs.python.org/3/library/xml.etree.elementtree.html#tutorial" rel="nofollow noreferrer"><code>xml.etree.ElementTree</code></a> or use a more specific <a href="https://github.com/liamks/pyitunes" rel="nofollow noreferrer"><code>pyitunes</code> library (I haven't tried it)</a>.</p>
</div>
<span class="comment-copy">Maybe you could use <code>replace()</code> again to make all <code>&amp;amp;</code>s into <code>&amp;</code></span>
<span class="comment-copy">or use the html lib like the answer <a href="http://stackoverflow.com/questions/2360598/how-do-i-unescape-html-entities-in-a-string-in-python-3-1">on here</a></span>
<span class="comment-copy">thanks @RNar, it solved the issue! I was wondering if there could be a way to avoid the utf8 encoding avoiding read() and write()...</span>
<span class="comment-copy"><code>&amp;#38;amp;</code> is an ampersand escaped twice. That has nothing to do with any character encoding.</span>
<span class="comment-copy">I had to overcome the UnicodeError by setting "utf8" as encoding which changes the strings and causes file paths to be wrong, I was wondering if there was anyway to work with those paths without encoding to utf8. @roeland</span>
