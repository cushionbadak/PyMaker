<div class="post-text" itemprop="text">
<p>Can I open a gzip file directly with argparse by changing the <code>type=argparse.FileType()</code> to some gzip type?  It's not in the docs, so I'm not sure if argparse even suppoets compressed file types...</p>
</div>
<div class="post-text" itemprop="text">
<p>First, the <code>type</code> parameter is a function or other callable that converts a string into something else.  That's all.</p>
<p><code>argparse.FileType</code> is factory class that ends up doing something close to:</p>
<pre><code>def filetype(astring):
    mode = 'r' # or 'w' etc.
    try:
        f = open(astring, mode)
    except IOError:
        raise argparse.ArgumentError('')
    return f
</code></pre>
<p>In other words, it converts the string from the commandline into an open file.</p>
<p>You could write an analogous <code>type</code> function that opens a <code>zipped</code> file.</p>
<p><code>FileType</code> is just a convenience, and an example of how to write a custom type function or class.  It's a convenience for small script programs that take an input file, do something, and write to an output file.  It also handles <code>'-'</code> argument, in the same way that shell programs handle stdin/out.</p>
<p>The downside to the <code>type</code> is that it opens a file (creates if write mode), but does not provide an automatic close.  You have to do that, or wait for the script to end and let the interpreter do that.  And a 'default' output file will be created regardless of whether you need it or not.</p>
<p>So a safer method is to accept the filename, possibly with some testing, and do the open/close later with your own <code>with</code> context.  Of course you could do that with gzip files just as well.</p>
</div>
<div class="post-text" itemprop="text">
<p><a href="https://docs.python.org/3/library/gzip.html#gzip.open" rel="nofollow"><code>gzip.open</code></a> also accepts an open file instead of a filename, so just pass the file object opened by <code>argparse</code> to <code>gzip.open</code> to get a file-like object that reads the uncompressed data.</p>
</div>
<div class="post-text" itemprop="text">
<p>No, argparse has no concept of file type unless you add a flag to indicate file type.</p>
<p>On the other hand you can use python's <a href="https://docs.python.org/3/library/gzip.html" rel="nofollow">gzip lib</a> with a try block to read the file.</p>
</div>
<span class="comment-copy">Got it.  I didn't realize argparse doesn't close the file automatically as in the with open construct, but thinking about it makes sense</span>
<span class="comment-copy">For a bug/issue I wrote a <code>FileContext</code> that would return an object that could be used in <code>with</code> context.  But it took work to test for a file without actually opening or creating it, and it was tricky to handle <code>stdin/out</code> that way.  You don't want those closed automatically.  So I doubt if that patch will ever see the light of day.</span>
