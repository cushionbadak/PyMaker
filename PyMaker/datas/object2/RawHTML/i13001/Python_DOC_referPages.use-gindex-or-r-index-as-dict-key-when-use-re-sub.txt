<div class="post-text" itemprop="text">
<div class="question-status question-originals-of-duplicate">
<p>This question already has an answer here:</p>
<ul>
<li>
<a dir="ltr" href="/questions/22545114/python-regex-sub-use-match-as-dict-key-in-substitution">Python Regex Sub - Use Match as Dict Key in Substitution</a>
<span class="question-originals-answer-count">
                    1 answer
                </span>
</li>
</ul>
</div>
<p>For example, I have the following string:</p>
<pre><code>s = 'Name: @name, ID: @id'
</code></pre>
<p>Now I want to use <code>re.sub()</code> to replace <code>@name</code> and <code>@id</code>. I know that I can use group to catch some string and then use <code>'\g&lt;index&gt;'</code> or <code>r'\index'</code> to use  it. </p>
<p>But now I need use it as a dict key, I have this dict:</p>
<pre><code>d = {'id': '20', 'name': 'Jon'}
</code></pre>
<p>And I wish I can get this:</p>
<pre><code>s = 'Name: Jon, ID: 20'
</code></pre>
<p>Also I tried:</p>
<pre><code>&gt;&gt;&gt; re.sub('@(\w+)', d[r'\1'], s)
Traceback (most recent call last):
  File "&lt;input&gt;", line 1, in &lt;module&gt;
KeyError: '\\1'

&gt;&gt;&gt; re.sub('@(\w+)', d['\g&lt;1&gt;'], s)
Traceback (most recent call last):
  File "&lt;input&gt;", line 1, in &lt;module&gt;
KeyError: '\\g&lt;1&gt;'
&gt;&gt;&gt; 
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>You need to use the function form for <code>re.sub</code> in this case. For your basic use case, it could be a simple as:</p>
<pre><code>re.sub(r'@(\w+)', lambda m: d[m.group(1)], s)
</code></pre>
<p>If the logic is more complicated, a top-level <code>def</code> is the way to go. Basically, you pass a <code>callable</code> instead of a <code>str</code>, per the <a href="https://docs.python.org/3/library/re.html#re.sub" rel="nofollow"><code>re.sub</code> docs</a>:</p>
<blockquote>
<p>If repl is a function, it is called for every non-overlapping occurrence of pattern. The function takes a single match object argument, and returns the replacement string.</p>
</blockquote>
</div>
<div class="post-text" itemprop="text">
<p>Python provides a <a href="https://docs.python.org/3/library/string.html#template-strings" rel="nofollow"><code>string.Template</code> class</a> (see also <a href="https://www.python.org/dev/peps/pep-0292/" rel="nofollow">PEP 292</a>) which can format strings very similar to kind you are working with. By default the <code>string.Template</code> class recognizes <code>$</code> as the placeholder. If you change it to <code>@</code> (by subclassing <code>string.Template</code>) then you can perform the substitutions by calling the <a href="https://docs.python.org/3/library/string.html#string.Template.substitute" rel="nofollow"><code>substitute</code></a> or <a href="https://docs.python.org/3/library/string.html#string.Template.safe_substitute" rel="nofollow"><code>safe_substitute</code></a> method:</p>
<pre><code>import string
class MyTemplate(string.Template):
    delimiter = '@'

content = 'Name: @name, ID: @id'
d = {'id': '20', 'name': 'Jon'}
template = MyTemplate(content)
result = template.safe_substitute(**d)
print(result)
</code></pre>
<p>prints</p>
<pre><code>Name: Jon, ID: 20
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>If formatting your string differently is an option, you can do it this way:</p>
<pre><code>&gt;&gt;&gt; d = {'id': '20', 'name': 'Jon'}
&gt;&gt;&gt; 'Name: {name}, ID: {id}'.format(**d)
'Name: Jon, ID: 20'
</code></pre>
</div>
<span class="comment-copy">Wow, great! What does <code>lambda</code> do here?</span>
<span class="comment-copy">See <a href="https://docs.python.org/3/library/re.html#re.sub" rel="nofollow noreferrer"><code>re.sub</code> docs</a>. I'll include a quote in the answer.</span>
<span class="comment-copy">Thanks again :P. Will accept answer in 4 mins.</span>
<span class="comment-copy">@KevinGuan: BTW, a useful thing to note: <code>callable</code>s in Python can have state. This has come up before in <a href="https://stackoverflow.com/questions/32980674/how-can-i-know-the-match-index-in-a-regular-expression-subns-repl-function/32980816#32980816">another answer of mine for keeping track of the match number in <code>re.sub</code></a>.</span>
<span class="comment-copy">Wow, don't know this before :D. But my question is about <i>use '\g&lt;index&gt; or r'\index' as dict key when use re.sub</i>. So I can't accept this. But good to know :)</span>
<span class="comment-copy">Thanks i did not know this cool stuff! Another trick in hat!</span>
<span class="comment-copy">But my string isn't formatted in this format...however a good suggestion.</span>
