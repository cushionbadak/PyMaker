<div class="post-text" itemprop="text">
<h2>Current setup</h2>
<p>using </p>
<ul>
<li>pytest 3.4.1</li>
<li>python 3.5 and above</li>
</ul>
<p>This is my test case under <code>tests/test_8_2_openpyxl.py</code></p>
<pre><code>class TestSomething(unittest.TestCase):

    def setUp(self):
        # do setup stuff here

    def tearDown(self):
        # do teardown stuff here

    def test_case_1(self):
        # test case here...
</code></pre>
<p>I use <code>unittest</code> style to write my test case. I use pytest to run the tests.</p>
<p>I have also setup and teardown functions following <code>unittest</code> conventions</p>
<p>My commandline to run the tests become</p>
<p><code>pytest -s -v tests/test_8_2_openpyxl.py</code></p>
<p>It works as expected</p>
<h2>What I want</h2>
<p>When I debug sometimes, i want to be able to easily turn off either setup or teardown or both at the same time using some kind of commandline option</p>
<p><code>pytest -s -v tests/test_8_2_openpyxl.py --skip-updown</code> </p>
<p>in order to skip both teardown and setup</p>
<p><code>pytest -s -v tests/test_8_2_openpyxl.py --skip-setup</code> </p>
<p>in order to skip setup</p>
<p><code>pytest -s -v tests/test_8_2_openpyxl.py --skip-teardown</code> </p>
<p>in order to skip teardown</p>
<h2>What I tried and didn't work</h2>
<h3>Tried <code>sys.argv</code></h3>
<p>I have tried using <code>sys.argv</code></p>
<pre><code>class TestSomething(unittest.TestCase):

    def setUp(self):
        if '--skip-updown' in sys.argv:
            return
        # do setup stuff here
</code></pre>
<p>and then</p>
<p>`pytest -s -v tests/test_8_2_openpyxl.py --skip-updown</p>
<p>This didn't work and my error message is </p>
<pre><code>usage: pytest [options] [file_or_dir] [file_or_dir] [...]
pytest: error: argument --skip-updown: expected one argument
</code></pre>
<h3>Tried sys.argv</h3>
<p>I have tried using <code>sys.argv</code></p>
<pre><code>class TestSomething(unittest.TestCase):

    def setUp(self):
        if '--skip-updown' in sys.argv:
            return
        # do setup stuff here
</code></pre>
<p>and then</p>
<p><code>pytest -s -v tests/test_8_2_openpyxl.py --skip-updown</code></p>
<p>This didn't work and my error message is </p>
<pre><code>usage: pytest [options] [file_or_dir] [file_or_dir] [...]
pytest: error: argument --skip-updown: expected one argument
</code></pre>
<h3>Tried conftest.py and config.getoption</h3>
<p>I setup a <code>conftest.py</code> in the project root</p>
<pre><code>def pytest_addoption(parser):
    parser.addoption("--skip-updown", default=False)


@pytest.fixture
def skip_updown(request):
    return request.config.getoption("--skip-updown")
</code></pre>
<p>And then</p>
<pre><code>class TestSomething(unittest.TestCase):

    def setUp(self):
        if pytest.config.getoption("--skip-updown"):
            return
        # do setup stuff here and then
</code></pre>
<p><code>pytest -s -v tests/test_8_2_openpyxl.py --skip-updown</code></p>
<p>Then I get </p>
<pre><code>usage: pytest [options] [file_or_dir] [file_or_dir] [...]
pytest: error: argument --skip-updown: expected one argument
</code></pre>
<h2>What I tried and worked but not as ideal</h2>
<h3>Tried conftest and config.getoption but this time declare --skip-updown=True</h3>
<p>Exactly the same as before except this time in my command line I declare <code>--skip-updown=True</code></p>
<p><code>pytest -s -v tests/test_8_2_openpyxl.py --skip-updown=True</code></p>
<h2>My question</h2>
<p>This is very close to what I want, but I was hoping not to have to declare the value <code>--skip-updown=True</code></p>
<p>Or maybe I am doing it all wrong in the first place and there's an easier way using <code>sys.argv</code>.</p>
</div>
<div class="post-text" itemprop="text">
<p>Fix <code>addoption</code>:</p>
<pre><code>def pytest_addoption(parser):
    parser.addoption("--skip-updown", action='store_true')
</code></pre>
<p>See the docs at <a href="https://docs.python.org/3/library/argparse.html" rel="nofollow noreferrer">https://docs.python.org/3/library/argparse.html</a></p>
<blockquote>
<p>Or maybe I am doing it all wrong in the first place and there's an easier way using sys.argv.</p>
</blockquote>
<p>No, what you're doing is the right and the only way.</p>
</div>
<span class="comment-copy">oh thanks! I didn't realise that about <code>store_true</code>.</span>
