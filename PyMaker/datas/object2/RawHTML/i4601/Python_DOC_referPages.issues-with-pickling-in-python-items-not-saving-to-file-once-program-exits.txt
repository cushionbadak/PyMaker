<div class="post-text" itemprop="text">
<p>I am trying to create a python program to save my friends' birthdays and access them easily and check for birthdays each day(I am not great at remembering dates and I never use facebook), but when I add a new birthday it is only accessible until I end the program - it then disappears again. I have been struggling with this for a while now and would really appreciate help fixing the error. Thanks!</p>
<pre><code>import time
import pickle
def main():
        birthday_file = open('birthdays_dict.dat','ab')
        birthday_doc = open('birthdays_dict.dat','rb')
        birthdays = pickle.load(birthday_doc)
        date = time.strftime("%m/%d")
        again = 'y'
        while again.lower() == 'y' or again.lower() == 'yes':
                choice = menu_choice()
                if choice == 1:
                        name = add_name()
                        birthday = add_birthday()
                        birthdays[name] = birthday
                        print(name)
                        print(birthday)
                        pickle.dump(birthdays,birthday_file)
                elif choice == 2:
                        print('Birthdays today(' + date + '):')
                        birth_today = {}
                        for key, value in birthdays.items():
                                if value == date:
                                        print(key)
                elif choice == 3:
                        search_name = input('Enter name to search: ')
                        print()
                        if search_name in birthdays:
                                print(birthdays[search_name])
                                if birthdays[search_name] == date:
                                        print('Their birthday is today!')
                        else:
                                print('Not found')
                else:
                        print('Not a valid selection!')
                print()
                again = go_again()
        birthday_file.close()
        birthday_doc.close()
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>Your problem is that you keep appending new dicts onto the file instead of replacing the old one, but then at startup you only load the very first one instead of all of them.</p>
<hr/>
<p>To fix this, you need to change this:</p>
<pre><code>birthday_file = open('birthdays_dict.dat','ab')
</code></pre>
<p>… to this:</p>
<pre><code>birthday_file = open('birthdays_dict.dat','wb')
</code></pre>
<p>But don't do that change on its own, because that will erase the file before you've read the old version!</p>
<hr/>
<p>You probably want to do something like this at the top of the function:</p>
<pre><code>with open('birthdays_dict.dat', 'rb') as birthday_doc:
    birthdays = pickle.load(birthday_doc)
</code></pre>
<p>I used a <code>with</code> statement so the file will automatically get closed right after the <code>load</code>, so it's definitely safe for us to overwrite it later.</p>
<p>Then later, when you want to write to the file, that's when you open it in <code>w</code> mode to erase the file and overwrite it with the new version—at which point you might as well close it immediately, because if you ever do write to it again, you're going to want to erase it again first, so let's use <code>with</code> again:</p>
<pre><code>with open('birthdays_dict.dat', 'wb') as birthday_doc:
    pickle.dump(birthdays, birthday_doc)
</code></pre>
</div>
<span class="comment-copy">This probably isn't your problem (although maybe it could be, if you're on Windows?), but you probably don't want to open the same file twice at the same time like that. Open it in read mode, <code>pickle.load</code>, close it, and then open it in append mode.</span>
<span class="comment-copy">Also, you may want to look at the [ <code>shelve</code>](<a href="https://docs.python.org/3/library/shelve.html" rel="nofollow noreferrer">docs.python.org/3/library/shelve.html</a>) module in the stdlib. It's a super-simple database that acts like a dict, but on-disk, which is exactly what you want here. IIRC, the keys have to be strings, but the values can be anything that can be pickled, which should work fine for you.</span>
<span class="comment-copy">One more thing that probably isn't the issue, but still worth doing: You should use a <code>with open(…) as birthday_file:</code> statement instead of manually calling <code>close</code> at the end. That way, if your program is interrupted by an unexpected error or a ^C or the like, the file still gets closed. (If you don't close a file before exiting, sometimes the last block of writes can get lost.)</span>
<span class="comment-copy">@abarnert thank you! the [shelve] is something i am going to definitely try and familiarize myself with. In the meantime I have tried changing the file opening in the way suggested but am still failing to save anything after exiting. I am unsure if the issue is with how I am opening/closing the file or the way I am dumping to it. I know this program is fairly simple but I am still learning and this error has left me banging my head against the wall haha</span>
<span class="comment-copy">@abarnet This totally fixed it! Thank you so much for all your help! I think my confusion was in that I was coding as if I was appending the dictionary as opposed to writing over it with a new version of the dictionary each time.. woops. I really appreciate the help and effort you put into explaining this. Pickling is something new I have been struggling with in python and failing repetitively on something that felt so simple was starting to get incredibly frustrating. (especially with a subject that felt so important!)</span>
