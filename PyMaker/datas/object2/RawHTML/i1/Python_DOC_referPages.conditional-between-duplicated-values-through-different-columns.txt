<div class="post-text" itemprop="text">
<p>A customer is duplicated when it has more than one subscription.
I want to generate a new_status for the customers status as a whole and not for each of subscriptions:
to a customer which has Reactivated the subscription
and to a customer which has canceled one subscription but still has another active one.</p>
<p>df:</p>
<pre><code>Customer | Status  | Canceled_at | Created  | New_status
 X       | Active  |             |8/9/2017  |
 X       |Canceled |  8/3/2017   |6/19/2017 |             
 Y       | Active  |             |2/13/2019 |
 Y       |Canceled | 11/28/2018  |10/14/2018|
 Z       | Active  |             |3/29/2018 |
 Z       |Canceled | 8/8/2018    |7/10/2018 |
 A       |Canceled | 9/2/2018    |7/10/2018 |          
 A       |Canceled | 9/29/2018   |7/12/2018 |
 A       |Active   |             |5/31/2018 |
</code></pre>
<p>The condition for those situation is:
if the 'canceled_at' date of the canceled duplicate &gt; 'created' date of the active: new _status will be 'Downgrade'
if the 'canceled_at' date of the canceled duplicate &lt; 'created' date of the
active: new_status will be 'Reactivate'</p>
<p>Desired Output:</p>
<pre><code>Customer | Status  | Canceled_at | Created  | New_status
 X       | Active  |             |8/9/2017  |Reactivate
 X       |Canceled |  8/3/2017   |6/19/2017 |Reactivate              
 Y       | Active  |             |2/13/2019 |Reactivate
 Y       |Canceled | 11/28/2018  |10/14/2018|Reactivate
 Z       | Active  |             |3/29/2018 |Downgrade
 Z       |Canceled | 8/8/2018    |7/10/2018 |Downgrade
 A       |Canceled | 9/2/2018    |7/10/2018 |Downgrade           
 A       |Canceled | 9/29/2018   |7/12/2018 |Downgrade
 A       |Active   |             |5/31/2018 |Downgrade
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>I'm too new to comment but I need more info, why is 'Y' customer Reactivate? Maybe I don't understand your explanation because customer 'A' is in a similar situation and you gave it the 'Downgrade'. Maybe just re-type your question, but pretend its for a 8 year old to read (me).</p>
<p>heres the code you want tho, it works:</p>
<pre><code>#convert columns to dates
df['Canceled_at'] = pd.to_datetime(df['Canceled_at'])
df['Created'] = pd.to_datetime(df['Created'])

#make customer a list so we can loop through it
customer = list(df['Customer'].drop_duplicates())

#super awesome for loop that give us the largest date (this is the part where maybe your logic is different than what I read it as)
for c in customer:
    df.loc[(df['Customer'] == c), 'Most Recent Cancel'] = df.loc[(df['Customer'] == c)]['Canceled_at'].max()
    df.loc[(df['Customer'] == c), 'Most Recent Created'] = df.loc[(df['Customer'] == c)]['Created'].max()

#Make 'New_status' column
df.loc[(df['Most Recent Created'] &gt; df['Most Recent Cancel']), 'New_status'] = 'Reactivate'
df.loc[(df['New_status'] != 'Reactivate'), 'New_status'] = 'Downgrade'
</code></pre>
</div>
<span class="comment-copy">oh thank you so much! the 'Y' Value are wrong i'm gonna edit this</span>
<span class="comment-copy">The Reactivate status is working pretty well and thanks for that! the downgrade that is not working because actually there's more than those two status so the downgrade can't be just a NON-Reactivated</span>
<span class="comment-copy">that's fine, do you understand how the df.loc[] works? I'm sure you'll be able to incorporate whatever other values you want with that logic you need</span>
<span class="comment-copy">yes I changed a bit of the downgrade line and nailed it!</span>
