<div class="post-text" itemprop="text">
<p>Every SQLITE query I make usually goes fine, except I cannot seem to be able to update the DB.</p>
<pre><code>db = sqlite3.connect("data.db")
cursor = db.cursor()
str_datetime = str(datetime.datetime.now())
cursor.execute("""UPDATE ads SET publish_end_datetime = ? WHERE ad_code = ?""", (str_datetime, 1411671200))
db.commit() # is this commit statement even necessary?
db.close()
</code></pre>
<p>I get the following operational error:</p>
<blockquote>
<p>OperationalError                          Traceback (most recent call
  last)  in ()
        3 str_datetime = str(datetime.datetime.now())
        4 
  ----&gt; 5 cursor.execute("""UPDATE ads SET publish_end_datetime = ? WHERE ad_code = ?""", (str_datetime, 1411671200))
        6 db.commit()
        7 db.close()</p>
<p>OperationalError: database is locked</p>
</blockquote>
</div>
<div class="post-text" itemprop="text">
<p>I think I've found the problem.
Whenever the DB is in use, a database.db-journal file is created in the same location. That's the main indicator that the DB is in use.
I have not found what was "using" my DB, but I've found how to solve my problem. It appears that OneDrive might have been the problem. I copied my data.db on the desktop, outisde of OneDrive, and I finally have been able to get the update statement to work.</p>
<p>I hope it helps other people.</p>
</div>
<span class="comment-copy">try this <code>db = sqlite3.connect("data.db", timeout=20)</code></span>
<span class="comment-copy">Please make sure no other program is working on this database, for example, if you are using pycharm, please break pycharm database connection first.</span>
<span class="comment-copy">Most likely your database is being used elsewhere or perhaps a previous connection is still open.2 things can't happen at once, that is update AND read cannot happen or update AND write so maybe check if you're closing you connections wherever you've opened them previously and try to re-run the query.</span>
<span class="comment-copy">timeout=20 didn't work, no other program should be working on the DB. I use DB Browser (SQLite), but it's closed. I program python in Jupyter Notebooks, and prior to running the code above, i spam a cell containing db.close()  I really don't see where concurrence could be coming from... Weirder, if I replace the update statement by a select statement, in the same cell (block of code), the query works...</span>
<span class="comment-copy">OneDrive was likely the problem. I copied my db file on desktop and the update statement worked.</span>
