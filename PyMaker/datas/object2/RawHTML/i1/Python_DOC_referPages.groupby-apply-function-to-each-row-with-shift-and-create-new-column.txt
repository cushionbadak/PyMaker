<div class="post-text" itemprop="text">
<p>I want to group by <code>id</code>, apply a function to the data, and create a new column with the results. It seems there must be a faster/more efficient way to do this than to pass the data to the function, make the changes, and return the data. Here is an example.</p>
<p><strong>Example</strong></p>
<pre><code>dat = pd.DataFrame({'id': ['a', 'a', 'a', 'b', 'b', 'b'], 'x': [4, 8, 12, 25, 30, 50]})

def my_func(data):
    data['diff'] = (data['x'] - data['x'].shift(1, fill_value=data['x'].iat[0]))
    return data

dat.groupby('id').apply(my_func)
</code></pre>
<p><strong>Output</strong></p>
<pre><code>&gt; print(dat)


id  x   diff
0   a   4   0
1   a   8   4
2   a   12  4
3   b   25  0
4   b   30  5
5   b   50  20
</code></pre>
<p>Is there a more efficient way to do this?</p>
</div>
<div class="post-text" itemprop="text">
<p>You can use <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.core.groupby.DataFrameGroupBy.diff.html" rel="nofollow noreferrer"><code>.groupby.diff()</code></a> for this and after that fill the <code>NaN</code> with zero like following: </p>
<pre><code>dat['diff'] = dat.groupby('id').x.diff().fillna(0)

print(dat)
  id   x  diff
0  a   4   0.0
1  a   8   4.0
2  a  12   4.0
3  b  25   0.0
4  b  30   5.0
5  b  50  20.0
</code></pre>
</div>
<span class="comment-copy">What you want to do then , different situation may have different solutions .</span>
<span class="comment-copy">@Wen-Ben I am wanting to apply a general function to a dataset.</span>
<span class="comment-copy">Thank you, but my question is related to applying a function in general, not only diff.</span>
<span class="comment-copy">@Vedda Perhaps you should have been clearer about this in the question. You asked "Is there a more efficient way to do this", and this answers it perfectly (at least as originally asked - I see you've edited the question)</span>
<span class="comment-copy">Functions are in general slower than vectorized solutions, so if you have the option not to use function, you should not. Besides that, if you definitely want to use a function, yours looks fine.</span>
<span class="comment-copy">@AndrewGuy Yes, you are correct. I've updated the question to be more general. This solution certainly works and I appreciate the effort.</span>
<span class="comment-copy">The first one can be done with the solution above. But I see your point. Good luck and the calculations sound interesting :)</span>
