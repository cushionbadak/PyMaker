<div class="post-text" itemprop="text">
<p>Using Airflow worker and webserver/scheduler as a Docker images running on Kubernetes Engine on EC2</p>
<p>We have a task which has <code>KubernetesPodOperator</code> which is resource intensive and runs every 15min.</p>
<p><strong>Got these error as email in airflow-worker</strong> </p>
<pre><code>Try 2 out of 3
Exception:
('Connection broken: IncompleteRead(0 bytes read)', IncompleteRead(0 bytes read))
Log: Link
Host: airflow-worker-deployment-123456789
Log file: /usr/local/airflow/logs/DAG_NAME/TASK_NAME/2019-03-14T10:50:00+00:00.log
Mark success: Link
</code></pre>
<p>Any idea what It can be ? </p>
</div>
<div class="post-text" itemprop="text">
<p>Well, it means that thge program logic didn't get the data it expected to receive from some socket. This can mean anything, from an intermittent network problem to the data simply not arriving in time and the logic not programmed to wait for it. IF the task is automatically retried, you may not even need to worry about intermittent problems.</p>
<p>If you wish to diagnose this further, you need to gather some diagnostic information. Problems are always diagnosed by the same scenario:</p>
<ol>
<li>Identify the exact place in the program when the problem manifests itself.</li>
<li>Examine the program's state at that moment and find out which of the values is wrong.</li>
<li>Trace the erroneous value back to its origin.</li>
</ol>
<p>The first can be identified by the stack trace and/or searching the codebase for relevant logic. The second -- debugging or debug printing. The 3rd is usually done by rerunning the program with breakpoints set earlier, at the step in the logic that produces the erroneous value; in your case, you can only do that very slowly, by waiting for the problem to happen again, so you are forced to do educated guesses from the codebase.</p>
</div>
<span class="comment-copy">Well, <code>Connection broken: IncompleteRead</code> is pretty descriptive. A network connection was broken. Does the log say any more?</span>
<span class="comment-copy">Nope the logs says nothing, just got these email as alert (email_on_retry) and the task was retried after that worked fine.   Wanted to dig deeper why it has failed in the first, since we are running K8sPod, we do not have control on killing task which might lead to inconsistency.</span>
