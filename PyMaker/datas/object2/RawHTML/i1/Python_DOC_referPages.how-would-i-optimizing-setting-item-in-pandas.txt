<div class="post-text" itemprop="text">
<p>Is it possible to optimize that </p>
<pre><code>_df['side_diff'][_df['s'] == 0] = 0
</code></pre>
<p>I have profiled the code, and this line takes a lot of time.</p>
<pre><code>def diff_last_first(ser):
    try:
        return ser.iloc[-1] - ser.iloc[0]
    except AttributeError:
        return ser[-1] - ser[0]
_df['is_primary'] = _df.groupby(gb)['side'].transform(diff_last_first)
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>Use the below:</p>
<pre><code>_df['side_diff']=np.where((_df['s'] == 0),0,_df['side_diff'])
</code></pre>
</div>
<span class="comment-copy">Please clarify your question</span>
<span class="comment-copy">ValueError: too many values to unpack (expected 1)</span>
<span class="comment-copy">@WaleedSaleh how about the second one? updated</span>
<span class="comment-copy">works like charm, how about this line too ?     _df['is_primary'] = _df.groupby(gb)['side'].transform(diff_last_first)</span>
<span class="comment-copy">I edited my question for another line of code that needs to be optimized please</span>
<span class="comment-copy">@WaleedSaleh for code optimisation , the ideal platform is <a href="https://codereview.stackexchange.com/">code review</a> i tried what i understood seeing your code before you updated it. Thanks</span>
