<div class="post-text" itemprop="text">
<p>I am trying to deploy a spark job (using pyspark librairies : ML) on aws EMR.
I want to create a simple cluster with a single instance, to understand how EMR works.</p>
<p>I create the cluster with the console with the following configuration :</p>
<pre><code>spark-submit --deploy-mode cluster s3://bucket/key/file.py
</code></pre>
<p>My step fails with a bunch of error logs that I struggle to understand besides this on :</p>
<pre><code>  File "PowerProdPredictionEmr.py", line 261
df = df.select("Perimetre", *target_exprs, *window_exprs, "rn")

SyntaxError: invalid syntax            
</code></pre>
<p>Which I don't understand since it's working locally on my machine.</p>
<p>Here is the code :</p>
<pre><code>...
window_exprs = [df.power_prod[i] for i in range(w*sample_week)]
df = df.select("Perimetre", *target_exprs, *window_exprs, "rn")
...
</code></pre>
<p>Any idea ? I can add other log files if necessary.                   </p>
</div>
<div class="post-text" itemprop="text">
<p>As @user10938362 pointed out, even though EMR supports python up to version 3.6, version 2.x is the default one installed on instances.</p>
<p>To set up python 3 as default version, you can add the following code in the "Edit Software / Enter configuration".</p>
<pre><code>[
  {
     "Classification": "spark-env",
     "Configurations": [
       {
         "Classification": "export",
         "Properties": {
            "PYSPARK_PYTHON": "/usr/bin/python3"
          }
       }
    ]
  }
]
</code></pre>
<p>All python versions issues will be solved.</p>
</div>
<span class="comment-copy">You use Python 3 locally, but Python 2 remotely. In Python 2, not named arguments cannot follow varargs and you can only have one <code>*</code> expression. This would be portable: <code>df.select("Perimetre", "rn", *target_exprs + window_exprs)</code> -assuming <code>target_exprs</code> and <code>window_exprs</code> are lists.</span>
<span class="comment-copy">Thanks a lot, that was the issue. EMR has 2.x as default python version, do you know how to set it to 3.x when creating the cluster ? I saw : <a href="https://aws.amazon.com/fr/premiumsupport/knowledge-center/emr-pyspark-python-3x/" rel="nofollow noreferrer">aws.amazon.com/fr/premiumsupport/knowledge-center/â€¦</a> but don't know how to run the sh command on all executors</span>
<span class="comment-copy">Standard way (<code>PYSPARK_(DRIVER)_PYTHON</code>) placed in EMR configuration should work just fine - <a href="https://stackoverflow.com/a/40717927/10938362">stackoverflow.com/a/40717927/10938362</a></span>
