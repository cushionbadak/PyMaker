<div class="post-text" itemprop="text">
<p>I would like to replace values in a NumpyArray, in only one column, on several selected rows only, using putmask. I wish to use indexing on the array to be modified as well as the mask used. Therefor I create a nd.array, a mask and and array of desired replacements. as follows:</p>
<pre><code>import numpy as np

a = np.linspace(1,30,30)
a.shape(10,3)
mask = np.random.randint(2, size=8)
replacements = a[[2,4,5,6,7,8],0]*a[[2,4,5,6,7,8],1]

a
array([[ 1.,  2.,  3.],
   [ 4.,  5.,  6.],
   [ 7.,  8.,  9.],
   [10., 11., 12.],
   [13., 14., 15.],
   [16., 17., 18.],
   [19., 20., 21.],
   [22., 23., 24.],
   [25., 26., 27.],
   [28., 29., 30.]])

mask
array([0, 1, 0, 0, 1, 0, 1, 1])

replacements
array([ 56., 182., 272., 380., 506., 650.])

np.putmask(a[[2,4,5,6,7,8],2], mask[2::], replacements)
</code></pre>
<p>My expected result would look like this:</p>
<pre><code>a
array([[ 1.,  2.,  3.],
   [ 4.,  5.,  6.],
   [ 7.,  8.,  9.],
   [10., 11., 12.],
   [13., 14., 15.],
   [16., 17., 272.],
   [19., 20., 21.],
   [22., 23., 506.],
   [25., 26., 650.],
   [28., 29., 30.]])
</code></pre>
<p>But instead I get this:</p>
<pre><code>a
array([[ 1.,  2.,  3.],
   [ 4.,  5.,  6.],
   [ 7.,  8.,  9.],
   [10., 11., 12.],
   [13., 14., 15.],
   [16., 17., 18.],
   [19., 20., 21.],
   [22., 23., 24.],
   [25., 26., 27.],
   [28., 29., 30.]])
</code></pre>
<p>Anybody has an idea maybe?</p>
</div>
<div class="post-text" itemprop="text">
<p>Note that you are using fancy indexing, so when using <a href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.putmask.html" rel="nofollow noreferrer"><code>np.putmask</code></a> you are modifying a <code>copy</code> rather than a <a href="https://scipy-cookbook.readthedocs.io/items/ViewsVsCopies.html" rel="nofollow noreferrer">sliced view</a>, and thus the original array remains unchanged. You can check this by trying to index using slice notation, <code>np.putmask(a[2:8,2], mask[2::], replacements)</code> for instance, which <i> would </i> in this case modify the values in <code>a</code>.</p>
<p>What you could do is use <a href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.where.html" rel="nofollow noreferrer"><code>np.where</code></a> and reassign the values to the corresponding indices in <code>a</code>:</p>
<pre><code>a[[2,4,5,6,7,8],2] = np.where(mask[2::], replacements, a[[2,4,5,6,7,8],2])
</code></pre>
<p><b> Output </b></p>
<pre><code>array([[  1.,   2.,   3.],
       [  4.,   5.,   6.],
       [  7.,   8.,  56.],
       [ 10.,  11.,  12.],
       [ 13.,  14., 182.],
       [ 16.,  17., 272.],
       [ 19.,  20., 380.],
       [ 22.,  23., 506.],
       [ 25.,  26., 650.],
       [ 28.,  29.,  30.]])
</code></pre>
</div>
<span class="comment-copy"><code>a[[2,4,5,6,7,8],2]</code> with advanced indexing (lists) is a copy of <code>a</code>, not a view.</span>
<span class="comment-copy">Wow, it works! Thank you yatu!</span>
<span class="comment-copy">You're welcome :)</span>
