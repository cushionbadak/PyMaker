<div class="post-text" itemprop="text">
<p>I'm trying to use channels(v2.1.7) in django to send messages from server to client. When i execute the celery task below, my message is not being fetched in consumers.py(so not being sent to client) and surprisingly no error occures.</p>
<p>I'm able to send message from consumers to client directly. But i couldn't manage to send from outside of consumers using async_to_sync(). </p>
<p>(I tried to use async_to_sync method in standard django views.py and i had same problem)</p>
<p><em>wololo/tasks.py</em></p>
<pre><code>@app.task(name='wololo.tasks.upgrade_building')
def upgrade_building(user_id):


    os.environ['DJANGO_SETTINGS_MODULE'] = 'DjangoFirebaseProject.settings'

    from channels.layers import get_channel_layer
    channel_layer = get_channel_layer()
    print(channel_layer, "wololo")

    async_to_sync(channel_layer.send)('chat', {
        'type': 'hello.message',
        'message': 'hadiInsss',
    })

    return True
</code></pre>
<p><em>wololo/consumers.py</em></p>
<pre><code>from channels.generic.websocket import WebsocketConsumer
import json
from asgiref.sync import async_to_sync

class ChatConsumer(WebsocketConsumer):
    def connect(self):
        async_to_sync(self.channel_layer.group_add)("chat", self.channel_name)
        self.accept()

    def disconnect(self, close_code):
        async_to_sync(self.channel_layer.group_discard)("chat", self.channel_name)

    def hello_message(self, event):
        print("U MUST SEE THAT MSG")
        # Send a message down to the client
        self.send(text_data=json.dumps(event['message']))
</code></pre>
<p><em>the result that i have in celery terminal</em>
<a href="https://i.stack.imgur.com/BLvFr.png" rel="nofollow noreferrer">click to see celery terminal</a></p>
<p>Thanks in advance</p>
</div>
<div class="post-text" itemprop="text">
<p>It looks like you are using the channel_layer.send method, but I think you actually want to use channel_layer.group_send instead. </p>
</div>
