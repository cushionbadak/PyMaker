<div class="post-text" itemprop="text">
<p>I have a problem with ForeignKey relation between User and Post models. Or rather, when creating the ForeignKey for the Custom User Model, an error appears:</p>
<p>Traceback:</p>
<pre><code>File "C:\Users\jack_\.virtualenvs\SNDProject-v81rGQ8f\lib\site-packages\django\db\backends\base\base.py" in _commit
  239.                 return self.connection.commit()

The above exception (FOREIGN KEY constraint failed) was the direct cause of the following exception:

File "C:\Users\jack_\.virtualenvs\SNDProject-v81rGQ8f\lib\site-packages\django\core\handlers\exception.py" in inner
  34.             response = get_response(request)

File "C:\Users\jack_\.virtualenvs\SNDProject-v81rGQ8f\lib\site-packages\django\core\handlers\base.py" in _get_response
  126.                 response = self.process_exception_by_middleware(e, request)

File "C:\Users\jack_\.virtualenvs\SNDProject-v81rGQ8f\lib\site-packages\django\core\handlers\base.py" in _get_response
  124.                 response = wrapped_callback(request, *callback_args, **callback_kwargs)

File "C:\Users\jack_\.virtualenvs\SNDProject-v81rGQ8f\lib\site-packages\django\contrib\admin\options.py" in wrapper
  604.                 return self.admin_site.admin_view(view)(*args, **kwargs)

File "C:\Users\jack_\.virtualenvs\SNDProject-v81rGQ8f\lib\site-packages\django\utils\decorators.py" in _wrapped_view
  142.                     response = view_func(request, *args, **kwargs)

File "C:\Users\jack_\.virtualenvs\SNDProject-v81rGQ8f\lib\site-packages\django\views\decorators\cache.py" in _wrapped_view_func
  44.         response = view_func(request, *args, **kwargs)

File "C:\Users\jack_\.virtualenvs\SNDProject-v81rGQ8f\lib\site-packages\django\contrib\admin\sites.py" in inner
  223.             return view(request, *args, **kwargs)

File "C:\Users\jack_\.virtualenvs\SNDProject-v81rGQ8f\lib\site-packages\django\contrib\admin\options.py" in add_view
  1637.         return self.changeform_view(request, None, form_url, extra_context)

File "C:\Users\jack_\.virtualenvs\SNDProject-v81rGQ8f\lib\site-packages\django\utils\decorators.py" in _wrapper
  45.         return bound_method(*args, **kwargs)

File "C:\Users\jack_\.virtualenvs\SNDProject-v81rGQ8f\lib\site-packages\django\utils\decorators.py" in _wrapped_view
  142.                     response = view_func(request, *args, **kwargs)

File "C:\Users\jack_\.virtualenvs\SNDProject-v81rGQ8f\lib\site-packages\django\contrib\admin\options.py" in changeform_view
  1525.             return self._changeform_view(request, object_id, form_url, extra_context)

File "C:\Users\jack_\.virtualenvs\SNDProject-v81rGQ8f\lib\site-packages\django\db\transaction.py" in __exit__
  212.                         connection.commit()

File "C:\Users\jack_\.virtualenvs\SNDProject-v81rGQ8f\lib\site-packages\django\db\backends\base\base.py" in commit
  261.         self._commit()

File "C:\Users\jack_\.virtualenvs\SNDProject-v81rGQ8f\lib\site-packages\django\db\backends\base\base.py" in _commit
  239.                 return self.connection.commit()

File "C:\Users\jack_\.virtualenvs\SNDProject-v81rGQ8f\lib\site-packages\django\db\utils.py" in __exit__
  89.                 raise dj_exc_value.with_traceback(traceback) from exc_value

File "C:\Users\jack_\.virtualenvs\SNDProject-v81rGQ8f\lib\site-packages\django\db\backends\base\base.py" in _commit
  239.                 return self.connection.commit()

Exception Type: IntegrityError at /admin/auth_pp/posts/add/
Exception Value: FOREIGN KEY constraint failed
</code></pre>
<p>ERROR PAGE:
<a href="https://i.stack.imgur.com/0pyRq.png" rel="nofollow noreferrer">https://i.stack.imgur.com/0pyRq.png</a></p>
<pre><code>#CustomUserModel
class Usr(AbstractBaseUser):
    username = models.CharField(max_length=30, validators=[
    RegexValidator(
            regex=USERNAME_REGEX,
            message='Username must be alphanumeric or numbers',
            code='invalid_username'
        )
    ], unique=True)

    objects = UsrManager()

    is_active = models.BooleanField(default=True)
    is_admin = models.BooleanField(default=False)
    is_staff = models.BooleanField(default=False)
    is_superuser = models.BooleanField(default=False)


    def has_perm(self, perm, obj=None):
    # Simplest possible answer: Yes, always
    return True

    def has_module_perms(self, app_label):  
    # Simplest possible answer: Yes, always
    return True

    USERNAME_FIELD = 'username'
    REQUIRED_FIELDS = []

#Model with ForeignKey 
class Posts(models.Model):
    title = models.CharField(max_length=50, unique=True)
    text = models.CharField(max_length=300)
    author = models.OneToOneField(get_user_model() ... default=1, swappable=True, related_query_name='post', db_constraint=True,      related_name='posts', on_delete=models.CASCADE)
</code></pre>
<p>I apologize in advance for possible flaws in the code and grammatical errors. Thank you in advance!</p>
<p>EDIT:
Error happens only in admin, in shell it works</p>
</div>
<div class="post-text" itemprop="text">
<p>OneToOneField means a user has only one post and a post has only one user
Which adds the unique constraint.
You need to use a foreignkey (yes you're not using it)</p>
<pre><code>author = models.ForeignKey(...)
</code></pre>
</div>
<span class="comment-copy">Could you please provide the error, with the current behavior and the expected one?</span>
<span class="comment-copy">Do you want it so that a user can only have one post or multiple?</span>
<span class="comment-copy">As Whodini hinted, your <code>author</code> field is a <code>OnToOneField</code>. That means it will have a Foreign Key constraint that makes sure you can have at most a one-to-one relationship between users and posts. My guess is that you have more than one post created already, and when you are trying to add this model, it is failing because your <code>default=1</code> will result in more that one post being associated with a user.</span>
<span class="comment-copy">I tried to change <code>default=None</code> but the result remained unchanged</span>
<span class="comment-copy">even when i replaced <code>OneToOneField</code> to <code>ForeignKey</code> error not avoid</span>
<span class="comment-copy">Specify on_delete param for the constructor of ForeignKey or see an example from DOC</span>
