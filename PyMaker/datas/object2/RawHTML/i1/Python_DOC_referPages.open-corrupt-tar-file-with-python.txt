<div class="post-text" itemprop="text">
<p>I am downloading tar files from a ftp server with the help of python. However, now I am facing problems and getting the error "ReadError: unexpected end of data". I assume my file got corrupted. I can open the files outside python with the comment 'wget' inside the terminal, however I would like to only stick to python. This is my code:</p>
<pre><code>os.chdir(aod_ipng)
[urlretrieve('%s%s'%(url_ipng,x),'%s'%(x)) for x in ari]

for i in range(len(ari)):
    fileName = '%s'%(ari[i])
    ind = save_ipng[i].index('IVAOT')
    h5f = save_ipng[i][ind:]
    tfile = tarfile.open(fileName,'r|')
    for t in tfile:
        if t.name == '%s'%h5f:
            f = tfile.extract(t)
</code></pre>
<ul>
<li>ari is a string array that holds several names of tar files that needs to be downloaded. </li>
<li>h5f is the name of the specific h5.gz file that needs to be extracted from the tar file 
Let me know if you need more information regarding my code!</li>
</ul>
</div>
<div class="post-text" itemprop="text">
<p>Reliable downloads of large files over bad connections is not easy. If <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Range_requests" rel="nofollow noreferrer">http range</a> requests are supported then you can resume the download on broken connections.</p>
<p>A good start is to use the requests library and <a href="http://docs.python-requests.org/en/master/api/#requests.Response.iter_content" rel="nofollow noreferrer">read the remote file as a stream</a>.
However disconnects and resumes might still have to be handled by you.</p>
<p>See <a href="https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests">this question</a> for how to use that API </p>
<p>But please make sure that the file is indeed a tar. You can use <a href="https://github.com/ahupp/python-magic" rel="nofollow noreferrer">libmagic</a> for file format detection.</p>
<p>That file extension suggests a gzip not a tar.</p>
<pre><code>import gzip
f = gzip.open('h5.gz', 'rb')
file_content = f.read()
f.close()
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>"ReadError: unexpected end of data"</p>
<p>This means that your file is shorter than expected, so it is not fully downloaded.</p>
<p><code>wget</code> does not open tar files, it downloads files.</p>
</div>
<span class="comment-copy">Make sure that you actually download a tar file. And then make sure your code finishes downloading the whole file.</span>
<span class="comment-copy">Okay, thank you! Do you have any tricks for that (besides a good internet connection)? How do I make sure my code finishes downloading the whole file?</span>
<span class="comment-copy">Thank you! I will take a look! :-) Have a nice day!</span>
<span class="comment-copy">Thank you for your comment! However, I still get the same error if I try to open the specific tar file when it is completely downloaded. Any ideas how to solve this problem?</span>
<span class="comment-copy">Download the full file.</span>
