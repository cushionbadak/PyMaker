<div class="post-text" itemprop="text">
<p>The following code creates the dataframe that is my starting point:</p>
<pre><code>import pandas as pd
import numpy as np


d= {'PX_LAST':[1,2,3,3,3,1,2,2,1,1,3,3],'ma':[2,2,2,2,2,2,2,2,2,2,2,2],'action':[0,0,1,0,0,1,0,0,1,0,1,0]}
df_zinc = pd.DataFrame(data=d)

#add column buy_sell
mask1 = df_zinc['action'] != 0
mask2 = df_zinc['PX_LAST'] &lt; df_zinc['ma']
mask3 = df_zinc['PX_LAST'] &gt; df_zinc['ma']

df_zinc['buy_sell'] = np.select([mask1 &amp; mask2, mask1 &amp; mask3], [-1,1], 0)
df_zinc
</code></pre>
<p>What I am trying to do in the below is to add a column in which each row is the result of the sum between the value in the previous row, the current value of column 'operational_col', and the current value of column 'buy_sell'.</p>
<pre><code>#empty operational column and weight column
df_zinc['operational_col']=0
df_zinc['weight']=0

#weight column
while index &lt; df_zinc.shape[0]:                      
df_zinc['weight'][index] = df_zinc['weight'][index-1] + df_zinc['operational_col'][index] + df_zinc['buy_sell'][index]
index = index + 1
</code></pre>
<p>This yields a column with only zeros, instead of the values I am looking for. Can anybody help, please?</p>
</div>
<div class="post-text" itemprop="text">
<p>In your example <code>index</code> is not defined before it is accessed in the <code>while</code> loop, so it creates a Name Error. Here is your loop rewritten using a <code>for</code> loop, and <code>loc</code> to select the values in the columns:</p>
<pre><code>for index in range(1, len(df_zinc)):                     
    df_zinc.loc[index, 'weight'] = df_zinc.loc[index-1, 'weight'] + \
    df_zinc.loc[index, 'operational_col'] + df_zinc.loc[index, 'buy_sell']
</code></pre>
</div>
<span class="comment-copy">same issue actually. The question has been edited - now the code is as it is in my sheet. To summarize, the problem is that I get only zeros on column weight</span>
<span class="comment-copy">The code I suggested produces some non-zero values for me on the example data you gave - 1 in row 2, -1 in row 5 etc.</span>
<span class="comment-copy">It does not to me. I copied and pasted your version for 'df_zinc['weight'] = df_zinc['weight'].shift(1) + df_zinc['operational_col'] + df_zinc['buy_sell']' and it does not work</span>
<span class="comment-copy">Ok see updated answer, this is an update on your loop using <code>.loc</code> and a <code>for</code> instead of <code>while</code></span>
