<div class="post-text" itemprop="text">
<p>I have different groups of transactions, and within each transaction group there are different dates. I want to get the nearest date that is <em>before</em> a given date. <em>However</em>, if it doesn't exist, just get the nearest date. For example,</p>
<p>Say the given date for the following two examples is:
<code>np.datetime(2014,12,16)</code> </p>
<p><strong>Example 1</strong>:</p>
<p>The dates within the group are: <code>np.datetime(2014,12,17)</code>, <code>np.datetime(2014,12,15)</code>, and <code>np.datetime(2014,12,14)</code></p>
<p>The returned value should be <code>np.datetime(2014,12,15)</code> since it the nearest date BEFORE the given date from above. We prioritize not only getting a date that is <em>before</em> the given date, but also the <em>closest</em> one to it.</p>
<p><strong>Example 2</strong>:</p>
<p>The dates within the group are: <code>np.datetime(2014,12,17)</code>, <code>np.datetime(2014,12,18)</code>, and <code>np.datetime(2014,12,19)</code></p>
<p>The returned value should be <code>np.datetime(2014,12,17)</code> since there are no dates before the given date, the nearest date to the above date will be turned.</p>
<p>I found a function that looks like it can satisfy the 2nd example, but not the first: </p>
<p><code>def nearest(items, pivot):
    return min(items, key=lambda x: abs(x - pivot))</code></p>
<p>Any help would be greatly appreciated, thanks!</p>
</div>
<div class="post-text" itemprop="text">
<p>Check with <code>searchsorted</code></p>
<pre><code>def yourfunc(items,pivot):
    items=np.sort(items)
    if np.searchsorted(items,s)==0:
        return items[np.searchsorted(items,s)]
    else :
        return items[np.searchsorted(items, s)-1]

yourfunc(ary1,s)
Out[148]: datetime.datetime(2014, 12, 15, 0, 0)
yourfunc(ary2,s)
Out[149]: datetime.datetime(2014, 12, 17, 0, 0)
</code></pre>
<p>Data input </p>
<pre><code>ary1=np.array([pd.datetime(2014,12,17), pd.datetime(2014,12,15), pd.datetime(2014,12,14)])
ary2=np.array([pd.datetime(2014,12,17), pd.datetime(2014,12,18), pd.datetime(2014,12,19)]


s=pd.datetime(2014,12,16)
</code></pre>
</div>
