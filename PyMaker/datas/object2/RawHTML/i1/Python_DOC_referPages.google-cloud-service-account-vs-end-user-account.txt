<div class="post-text" itemprop="text">
<p>I am currently learning GCP and need to run a python notebook in a VM Instance. When opening the shell of my VM, I ran the following code: </p>
<pre><code>sudo install python-pip
pip install --upgrade google-api-python-client
pip install --upgrade google-cloud-datastore
gcloud auth application-default login
</code></pre>
<p>And then I loaded my python notebook. When running this code to launch the notebook: </p>
<pre><code>python mynotebook.py
</code></pre>
<p>I get the following error: </p>
<pre><code>/home/rnby87/.local/lib/python2.7/site-packages/google/auth/_default.py:66: UserWarning: Your application has authenticated using end user credentials from Google Cloud SDK. We recommend that most server applications use service accounts instead. If your application continues to use end user credentials from Cloud SDK, you might receive a "quota exceeded" or "API not enabled" error. For more information about service accounts, see https://cloud.google.com/docs/authentication/warnings.warn(_CLOUD_SDK_CREDENTIALS_WARNING)
</code></pre>
<p>I'm running the python code from the Google Cloud SDK Documentation (<a href="https://cloud.google.com/datastore/docs/datastore-api-tutorial" rel="nofollow noreferrer">https://cloud.google.com/datastore/docs/datastore-api-tutorial</a>) </p>
<pre><code>from google.cloud import datastore 

def create_client(project_id):
     return datastore.Client(project_id)
</code></pre>
<p>Any help is much appreciated! Thank you! </p>
</div>
<div class="post-text" itemprop="text">
<p>For the Google Cloud SDK and the CLI you should be using service account credentials.</p>
<p><strong>Step 1: Create a service account and download</strong></p>
<ol>
<li>Login to the Google Cloud Console.</li>
<li>Go to IAM &amp; admin -&gt; Service accounts</li>
<li>Click CREATE SERVICE ACCOUNT</li>
<li>Enter a Service account name and Service account description</li>
<li>Click CREATE</li>
<li>In the next screen Service account permissions, select a role.</li>
<li>Add desired roles.</li>
<li>Click CONTINUE</li>
<li>Click Create key</li>
<li>Check the JSON radio button for the Key type</li>
<li>Save the json file to your computer. </li>
<li>Since you are running in a VM, upload to the VM.</li>
</ol>
<p><strong>Step 2: Configure gcloud and the SDKs to use the service account.</strong></p>
<p>You will need the email address of the service account (which is also stored in the Json file) and the service account file name.</p>
<p>Run this command from a shell in your VM:</p>
<pre><code>gcloud auth activate-service-account SERVICE_ACCOUNT_EMAIL_ADDRESS --key-file=service_account_filename.json
</code></pre>
<p><strong>Step 3: Verify that your credentials are working:</strong></p>
<p><code>gcloud auth list</code></p>
<p>You should see your service account listed with an asterisk in the left column (which desigates the account account).</p>
<p>Note: Since you are running inside a Google virtual machine (GCE) instance, an advanced user will often use the Compute Engine Default Service Account for credentials. I recommend learning how to use a service account Json file first.</p>
<p><strong>Step 4: Specify the service account</strong></p>
<p>Set the environment variable <code>GOOGLE_APPLICATION_CREDENTIALS</code> to point to your service account json file. This is an example, change the path to your path.</p>
<p>For Linux:</p>
<pre><code>export GOOGLE_APPLICATION_CREDENTIALS="/home/username/[FILE_NAME].json"
</code></pre>
<p>For Windows:</p>
<pre><code>set GOOGLE_APPLICATION_CREDENTIALS="c:\Users\username\[FILE_NAME].json"
</code></pre>
<p><strong>Step 5: Optionally specify the service account when creating the service client:</strong></p>
<pre><code>from google.cloud import datastore 

def create_client(project_id):
     return datastore.Client(project_id).from_service_account_json('service_account_filename.json')
</code></pre>
</div>
<span class="comment-copy">Thank you! I did this and adding my service account worked perfectly, but I still get the same error when trying to run my python notebook. Any suggestions?</span>
<span class="comment-copy">I forgot to add the final steps - how to use the credentials. I updated my answer.</span>
<span class="comment-copy">Thank you! I really appreciate the help!</span>
