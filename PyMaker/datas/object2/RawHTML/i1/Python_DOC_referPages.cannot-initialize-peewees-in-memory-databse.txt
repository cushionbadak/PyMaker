<div class="post-text" itemprop="text">
<p>I'm trying to set in-memory database for testing with peewee. However, I cannot initialize database:</p>
<pre><code>&gt;&gt;&gt; import peewee
&gt;&gt;&gt; import Entities
&gt;&gt;&gt; db = peewee.SqliteDatabase(':memory:')
&gt;&gt;&gt; db.connect()
True
</code></pre>
<p>This above is okay. Then I got following error:</p>
<pre><code>&gt;&gt;&gt; db.bind(Entities.RouterSettings)
Traceback (most recent call last):
  File "C:\Users\Kamil\AppData\Local\Programs\Python\Python37-32\lib\site-packages\peewee.py", line 2833, in execute_sql
    cursor = self.cursor(commit)
  File "C:\Users\Kamil\AppData\Local\Programs\Python\Python37-32\lib\site-packages\peewee.py", line 2819, in cursor
    self.connect()
  File "C:\Users\Kamil\AppData\Local\Programs\Python\Python37-32\lib\site-packages\peewee.py", line 2768, in connect
    raise InterfaceError('Error, database must be initialized '
peewee.InterfaceError: Error, database must be initialized before opening a connection.
During handling of the above exception, another exception occurred:
Traceback (most recent call last):
  File "&lt;input&gt;", line 1, in &lt;module&gt;
  File "C:\Users\Kamil\AppData\Local\Programs\Python\Python37-32\lib\site-packages\peewee.py", line 3008, in bind
    for model in models:
  File "C:\Users\Kamil\AppData\Local\Programs\Python\Python37-32\lib\site-packages\peewee.py", line 5630, in __iter__
    return iter(self.select())
  File "C:\Users\Kamil\AppData\Local\Programs\Python\Python37-32\lib\site-packages\peewee.py", line 6198, in __iter__
    self.execute()
  File "C:\Users\Kamil\AppData\Local\Programs\Python\Python37-32\lib\site-packages\peewee.py", line 1698, in inner
    return method(self, database, *args, **kwargs)
  File "C:\Users\Kamil\AppData\Local\Programs\Python\Python37-32\lib\site-packages\peewee.py", line 1769, in execute
    return self._execute(database)
  File "C:\Users\Kamil\AppData\Local\Programs\Python\Python37-32\lib\site-packages\peewee.py", line 1943, in _execute
    cursor = database.execute(self)
  File "C:\Users\Kamil\AppData\Local\Programs\Python\Python37-32\lib\site-packages\peewee.py", line 2848, in execute
    return self.execute_sql(sql, params, commit=commit)
  File "C:\Users\Kamil\AppData\Local\Programs\Python\Python37-32\lib\site-packages\peewee.py", line 2842, in execute_sql
    self.commit()
  File "C:\Users\Kamil\AppData\Local\Programs\Python\Python37-32\lib\site-packages\peewee.py", line 2627, in __exit__
    reraise(new_type, new_type(*exc_args), traceback)
  File "C:\Users\Kamil\AppData\Local\Programs\Python\Python37-32\lib\site-packages\peewee.py", line 178, in reraise
    raise value.with_traceback(tb)
  File "C:\Users\Kamil\AppData\Local\Programs\Python\Python37-32\lib\site-packages\peewee.py", line 2833, in execute_sql
    cursor = self.cursor(commit)
  File "C:\Users\Kamil\AppData\Local\Programs\Python\Python37-32\lib\site-packages\peewee.py", line 2819, in cursor
    self.connect()
  File "C:\Users\Kamil\AppData\Local\Programs\Python\Python37-32\lib\site-packages\peewee.py", line 2768, in connect
    raise InterfaceError('Error, database must be initialized '
peewee.InterfaceError: Error, database must be initialized before opening a connection.
</code></pre>
<p>Me entities are all right for sure, since I use peewee for managing data in sqlite database without troubles. They came when I made a try to create tests with in-memory database. The same error happens when I try to create tables:</p>
<pre><code>&gt;&gt;&gt; db = peewee.SqliteDatabase(':memory:')
&gt;&gt;&gt; db.connect()
True
&gt;&gt;&gt; db.create_tables([Entities.RouterSettings], safe=True)
Traceback (most recent call last):
  File "C:\Users\Kamil\AppData\Local\Programs\Python\Python37-32\lib\site-packages\peewee.py", line 2833, in execute_sql
    cursor = self.cursor(commit)
  File "C:\Users\Kamil\AppData\Local\Programs\Python\Python37-32\lib\site-packages\peewee.py", line 2819, in cursor
    self.connect()
  File "C:\Users\Kamil\AppData\Local\Programs\Python\Python37-32\lib\site-packages\peewee.py", line 2768, in connect
    raise InterfaceError('Error, database must be initialized '
peewee.InterfaceError: Error, database must be initialized before opening a connection.
During handling of the above exception, another exception occurred:
Traceback (most recent call last):
  File "&lt;input&gt;", line 1, in &lt;module&gt;
  File "C:\Users\Kamil\AppData\Local\Programs\Python\Python37-32\lib\site-packages\peewee.py", line 2995, in create_tables
    model.create_table(**options)
  File "C:\Users\Kamil\AppData\Local\Programs\Python\Python37-32\lib\site-packages\peewee.py", line 6012, in create_table
    cls._schema.create_all(safe, **options)
  File "C:\Users\Kamil\AppData\Local\Programs\Python\Python37-32\lib\site-packages\peewee.py", line 5225, in create_all
    self.create_table(safe, **table_options)
  File "C:\Users\Kamil\AppData\Local\Programs\Python\Python37-32\lib\site-packages\peewee.py", line 5111, in create_table
    self.database.execute(self._create_table(safe=safe, **options))
  File "C:\Users\Kamil\AppData\Local\Programs\Python\Python37-32\lib\site-packages\peewee.py", line 2848, in execute
    return self.execute_sql(sql, params, commit=commit)
  File "C:\Users\Kamil\AppData\Local\Programs\Python\Python37-32\lib\site-packages\peewee.py", line 2842, in execute_sql
    self.commit()
  File "C:\Users\Kamil\AppData\Local\Programs\Python\Python37-32\lib\site-packages\peewee.py", line 2627, in __exit__
    reraise(new_type, new_type(*exc_args), traceback)
  File "C:\Users\Kamil\AppData\Local\Programs\Python\Python37-32\lib\site-packages\peewee.py", line 178, in reraise
    raise value.with_traceback(tb)
  File "C:\Users\Kamil\AppData\Local\Programs\Python\Python37-32\lib\site-packages\peewee.py", line 2833, in execute_sql
    cursor = self.cursor(commit)
  File "C:\Users\Kamil\AppData\Local\Programs\Python\Python37-32\lib\site-packages\peewee.py", line 2819, in cursor
    self.connect()
  File "C:\Users\Kamil\AppData\Local\Programs\Python\Python37-32\lib\site-packages\peewee.py", line 2768, in connect
    raise InterfaceError('Error, database must be initialized '
peewee.InterfaceError: Error, database must be initialized before opening a connection.
</code></pre>
<p>I'm using:</p>
<ul>
<li>Python 3.7.1</li>
<li>Peewee 3.9.2</li>
</ul>
<p>Anybody faced similar problem?</p>
</div>
<div class="post-text" itemprop="text">
<p>I found the reason of the error. It looks I forgot to put <code>foreign_key</code> pragma:</p>
<pre><code>&gt;&gt;&gt; import peewee
&gt;&gt;&gt; test_db = peewee.SqliteDatabase(':memory:', pragmas={'foreign_keys': 1})
import Entities
&gt;&gt;&gt; models = [Entities.RouterSettings]
&gt;&gt;&gt; test_db.bind(models, bind_refs=False, bind_backrefs=False)
&gt;&gt;&gt; test_db.connect()
True
&gt;&gt;&gt; test_db.create_tables(models)
</code></pre>
<p>When I put <code>pragmas={'foreign_keys': 1}</code>, which is what my entity requires, this error disappears.</p>
</div>
