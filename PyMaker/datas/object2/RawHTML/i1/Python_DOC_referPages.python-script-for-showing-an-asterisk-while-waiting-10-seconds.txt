<div class="post-text" itemprop="text">
<p>I'm trying to place a call 'on hold' in asterisk using a python AGI script, the function will check if the person is available, when he is asterisk will dial the person if he is not the script should wait 10 seconds before checking availabilty again and dial when the person is available. However I ran into a small problem, using the <code>time.sleep(10)</code> function hangs up the call when a person is not available, I expect this is because the thread the script runs on will sleep and asterisk thinks the script is done running and hangs up the call. Removing the <code>time.sleep()</code> gives me what I want without the time interval.</p>
<pre><code>agi = AGI()
agi.verbose("python agi started")
place_call_on_hold("SIP/6001")

def place_call_on_hold(s):
  agi.verbose("entered place_call_on_hold function")
  while True:
    status = agi.get_variable('DEVICE_STATE(%(redirect)s)'%{'redirect':s})
    agi.verbose(status)
    if status == 'NOT_INUSE':
      agi.verbose("Info: place_call_on_hold: calling the number")
      agi.appexec("Dial",s)
    else:
      agi.verbose("Info: place_call_on_hold: sleeping for 10 sec")
      time.sleep(10)
</code></pre>
<p>Is there a way to wait 10 seconds without using the <code>sleep()</code> function or how can I make sure the call won't end before the <code>time.sleep</code> wakes back up?</p>
</div>
<div class="post-text" itemprop="text">
<p>why not try time difference before condition and after condition something like this </p>
<pre><code>import time

start = time.time()
end = time.time()

while (end-start) &lt; 10:
    end = time.time()
print(start, end, end-start)
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>I fixed my problem by just calling the Asterisk Wait(10) function instead of time.sleep(10).</p>
</div>
<span class="comment-copy">The <code>while()</code> loop has no stopping condition?</span>
<span class="comment-copy">there is no need to stop, eigther the caller hangs up and the script stops or the call gets redirected to the person.</span>
<span class="comment-copy">There HAVE be condition which check CHANNEL(state).</span>
<span class="comment-copy">@arheops i'm not sure if i understand what you mean.</span>
<span class="comment-copy">NEVER use infinite loop in agi. It will loop and eat you cpu in any asterisk version above 1.4</span>
<span class="comment-copy">Thanx for the reply, but this will be the same as removing the sleep() because it will still keep looping every tick. I fixed my issue by just calling the Asterisk Wait(10) function.</span>
<span class="comment-copy">You can accept your own answer to close the question.</span>
<span class="comment-copy">i can't accept it for 2 days afther posting, ( 22 hours to go before i can accept it )</span>
