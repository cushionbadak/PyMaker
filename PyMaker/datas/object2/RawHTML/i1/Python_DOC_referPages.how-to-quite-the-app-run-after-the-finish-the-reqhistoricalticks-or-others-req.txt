<div class="post-text" itemprop="text">
<p>I would like to have a python program to request the historical tick data from IBapi, do some calculation after received all the requested tick and exit the program.</p>
<p>However, the IBapi EClient.run() is an infinity loop, how can I exist the loop after receive all the historical tick data?</p>
<p>Thank you.</p>
</div>
<div class="post-text" itemprop="text">
<p>You didn't show any code so here is a starting point.  It requests <code>contractDetails</code> and closes when the end wrapper method is called.</p>
<p><a href="https://stackoverflow.com/a/54423878/2855515">https://stackoverflow.com/a/54423878/2855515</a></p>
<p>What you should do is request the historical data once <code>nextValidId</code> is received, that is how you know the connection is established and ready for data.</p>
<p>There is a callback for <a href="http://interactivebrokers.github.io/tws-api/interfaceIBApi_1_1EWrapper.html#a715bb6750de66a0e072a910e697e20cf" rel="nofollow noreferrer">historicalDataEnd</a> so in that method you can disconnect and stop your program.  </p>
<p>If there is a problem post your code and add a comment for me.</p>
</div>
<span class="comment-copy">Thank you Brian, I didn't realize there is a historicalDataEnd callback. I  can make use of it to exist the program.</span>
<span class="comment-copy">I've never actually used that callback.  It didn't exist when I first started.  I look for the string 'finished' in the data received in the <code>historicaldata</code> callback.  Just be aware that both should happen now.</span>
<span class="comment-copy">I just use some counters inside those historicaltick function to count the data received and exist once got enough data. Will try to test on the historicalDataEnd. Thank you.</span>
