<div class="post-text" itemprop="text">
<p>I'm learning about BlueZ and BLE. In the bluez/test directory there is a python 'example gatt server'. I've read the code and almost understood how it works, but something is not clear. For example there's this method which notifies when a characteristic's value changes (in this example is the battery level value):</p>
<pre><code>    def notify_battery_level(self):
    if not self.notifying:
        return
    self.PropertiesChanged(
            GATT_CHRC_IFACE,
            { 'Value': [dbus.Byte(self.battery_lvl)] }, [])
</code></pre>
<p>The method PropertiesChanged is so defined:</p>
<pre><code>@dbus.service.signal(DBUS_PROP_IFACE,
                     signature='sa{sv}as')
def PropertiesChanged(self, interface, changed, invalidated):
    pass
</code></pre>
<p>I'm starting advertising and running this example, then i'm using the BLE scanner app on my smartphone for reading the characteristic (the battery level in this case). Well, the self.battery_lvl is an integer number (24 for example), but on ble scanner as the value of characteristic i see "24 % battery level". The problem is that nowhere in the code is added '% battery level' to the self.battery_lvl (simply 24). So where are this additional informations added?
Sorry for my english. If you need additional informations please tell me</p>
</div>
<div class="post-text" itemprop="text">
<p>The battery level example uses the Bluetooth service adopted UUID (0x180F) and attribute format (Please see <a href="https://www.bluetooth.com/specifications/gatt/viewer?attributeXmlFile=org.bluetooth.service.battery_service.xml" rel="nofollow noreferrer">this</a>). As such, when the mobile phone app finds the service and sees the UUID, it will know that this is the battery service, and add the % when reading the value. This is a major advantage when using adopted services/characteristics vs custom ones, you can add intelligence at the remote end because the local end has a predefined format. Please note that this also applies to adopted heart rate service/characteristic (the app will immediately add bpm), adopted temperature service/characteristic (the app will immediately add (Â°C), and so on.</p>
<p>For a full list of adopted services and characteristics, please see these links:-</p>
<ul>
<li><a href="https://www.bluetooth.com/specifications/gatt/services" rel="nofollow noreferrer">Adopted GATT Services</a></li>
<li><a href="https://www.bluetooth.com/specifications/gatt/characteristics" rel="nofollow noreferrer">Adopted GATT Characteristics</a> </li>
</ul>
<p>For further reading about this subject:-</p>
<ul>
<li><a href="https://www.novelbits.io/bluetooth-gatt-services-characteristics/" rel="nofollow noreferrer">Bluetooth GATT: How to Design Custom Services and Characteristics</a></li>
</ul>
<p>I hope this helps.</p>
</div>
<span class="comment-copy">The "%" sign is added in the smartphone app.</span>
