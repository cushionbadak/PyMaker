<div class="post-text" itemprop="text">
<p>I am trying to format the following xml </p>
<pre><code>&lt;block formula="MY_VAR &lt; 3"&gt;&lt;set-variable name="OTHER_VAR"&gt;&lt;/set-variable&gt;&lt;/block&gt;
</code></pre>
<p>into</p>
<pre><code>&lt;block formula="MY_VAR &lt; 3"&gt;
  &lt;set-variable name="OTHER_VAR"&gt;
  &lt;/set-variable&gt;
&lt;/block&gt;
</code></pre>
<p>using <a href="https://pypi.org/project/xmlformatter/" rel="nofollow noreferrer">xmlformatter</a> and getting an error because of the <code>&lt;</code> in my formula. Specifically the error is </p>
<blockquote>
<p>ExpatError: not well-formed (invalid token)</p>
</blockquote>
<p>when I try the code  </p>
<pre><code>my_xml = '&lt;block formula="MY_VAR &lt; 3"&gt;&lt;set-variable name="OTHER_VAR"&gt;&lt;/set-variable&gt;&lt;/block&gt;'
formatter = xmlformatter.Formatter(indent="1", indent_char="  ", encoding_output="UTF-8", preserve=["literal"])
pretty_xml = formatter.format_string(my_xml)
</code></pre>
<p>How do I include the less than in my formula and be able to format my XML?</p>
</div>
<div class="post-text" itemprop="text">
<p>You can use <a href="https://docs.python.org/3/library/xml.sax.utils.html#xml.sax.saxutils.quoteattr" rel="nofollow noreferrer">xml.sax.saxutils.quoteattr</a> to escape the attribute value when constructing the xml string.</p>
<pre><code>&gt;&gt;&gt; my_xml = '&lt;block formula=%s&gt;&lt;set-variable name="OTHER_VAR"&gt;&lt;/set-variable&gt;&lt;/block&gt;' % su.quoteattr('MY_VAR &lt; 3')
&gt;&gt;&gt; my_xml
'&lt;block formula="MY_VAR &amp;lt; 3"&gt;&lt;set-variable name="OTHER_VAR"&gt;&lt;/set-variable&gt;&lt;/block&gt;'
</code></pre>
<p>If you don't control construction of the xml this hack will fix the xml in the  example:</p>
<pre><code>stack = []

out = []
brackets = '&lt;&gt;'

for c in bad_xml:
    if c in brackets:
        try:
            prev = stack[-1]
        except IndexError:
            stack.append(c)
            out.append(c)
        else:
            if prev == c:
                escaped = '&amp;gt;' if c == '&gt;' else '&amp;lt;'
                out.append(escaped)
            else:
                stack.append(c)
                out.append(c)
    else:
        out.append(c)
my_xml = ''.join(out)
</code></pre>
</div>
<span class="comment-copy">Similar <a href="https://stackoverflow.com/questions/29398950/is-there-a-way-to-include-greater-than-or-less-than-signs-in-an-xml-file" title="is there a way to include greater than or less than signs in an xml file">stackoverflow.com/questions/29398950/â€¦</a></span>
