<div class="post-text" itemprop="text">
<p>I have many columns that i'm performing joins on which can sometimes contain billions of rows of null values, so I would like to salt the columns to prevent skew after the join like mentioned in Jason Evan's post: <a href="https://stackoverflow.com/a/43394695">https://stackoverflow.com/a/43394695</a></p>
<p>I cannot find an equivalent example of this in Python, and the syntax is just different enough that I can't figure out how to translate it.</p>
<p>I approximately have this:</p>
<pre><code>import pyspark.sql.functions as psf
big_neg = -200
for column in key_fields: #key_fields is a list of join keys in the dataframe
    df = df.withColumn(column,
                       psf.when(psf.col(column).isNull(),
                                psf.round(psf.rand().multiply(big_neg))
                      ).otherwise(df[column]))
</code></pre>
<p>This is currently failing on a syntax error (TypeError: 'Column' object is not callable
), but I have already tried many syntax combinations to get rid of the typeError and am stumped. I would really appreciate a second pair of eyes on this problem.</p>
</div>
<div class="post-text" itemprop="text">
<p>I was actually able to figure it out after taking a break.</p>
<p>I thought it would be helpful for anyone else who encounters this problem, so I will post my solution:</p>
<pre><code>df = df.withColumn(column, psf.when(df[column].isNull(), psf.round(psf.rand()*(big_neg))).otherwise(df[column]))
</code></pre>
</div>
