<div class="post-text" itemprop="text">
<p>I have a python script for running a tensorflow model, and I need to run this script from a PHP file (for complicated reasons) using the PHP <code>shell_exec</code> function.  When I run the python file with the following code:</p>
<pre><code>$command = 'cd testModels/crosswalkPredict &amp;&amp; . activate keras &amp;&amp; python test_script.py';
$output = shell_exec($command);
</code></pre>
<p>I get the following error: <code>Illegal instruction (core dumped)</code></p>
<p>I read that the issue typcally occurs when the CPU doesn't support instructions that are present in newer versions of Tensorflow. So I downgraded to Tensorflow 1.5.</p>
<p>However, this error does not occur when I run <code>cd testModels/crosswalkPredict &amp;&amp; . activate keras &amp;&amp; python test_script.py</code> directly from the terminal; it only occurs when I run it from within the PHP <code>shell_exec</code> function.  </p>
<p>I have gone as far as to try the python script with only the following lines:</p>
<pre><code>import tensorflow
print('Hello!')
</code></pre>
<p>It still gives the same error, so I know the issue occurs  when all I'm doing is importing tensorflow and running the script with <code>shell_exec</code>.</p>
<p>What could be the problem?</p>
</div>
<div class="post-text" itemprop="text">
<p>Its a known TensorFlow compatibility issue with AVX support on older CPU, it could be fixed if you compile TensorFlow from the sources:</p>
<p><a href="https://github.com/tensorflow/tensorflow/issues/17411#issuecomment-386888244" rel="nofollow noreferrer">https://github.com/tensorflow/tensorflow/issues/17411#issuecomment-386888244</a></p>
<p><a href="https://github.com/tensorflow/tensorflow/issues/17411#issuecomment-420157421" rel="nofollow noreferrer">https://github.com/tensorflow/tensorflow/issues/17411#issuecomment-420157421</a></p>
</div>
<div class="post-text" itemprop="text">
<p>I figured out the problem.  as I mentioned in a couple of the comments, I am using a python virtual environment.  When I was executing the python script from the command line, the python interpreter from within the python virtual environment was being used, and everything was fine.  Whenever I executed the script rom <code>shell_exec</code>, the default installation of the python interpreter was being used, and this was where the error occurred.  </p>
<p>I am not very experienced in using python virtual environments, so that is likely why it took so long for me to arrive at an understanding of the problem.  Luckily, MohammedAyoubBENJELLOUN's comment about shell_exec using the default python installation put me on the right path, and I figured it out from there.</p>
<p>To solve this problem, I simply invoked the python interpreter at the path of the interpreter inside of the python virtual environment instead of trying to activate the virtual environment and then executing. </p>
<p>For example, I used:</p>
<pre><code>/home/user01/anaconda3/envs/keras/bin/python test_script.py
</code></pre>
<p>Instead of:</p>
<pre><code>. activate keras &amp;&amp; python test_script.py
</code></pre>
</div>
<span class="comment-copy">are you able to run any other shell command? try <code>ls -la</code> for example</span>
<span class="comment-copy">I can run other shell commands with no problem.  I only ran into errors when running scripts that use tensorflow/keras.</span>
<span class="comment-copy">For exmaple, in the minimized script with the print(Hello), if I comment out the "import tensorflow" line, everything works perfectly.</span>
<span class="comment-copy">where is your <code>testModels</code> folder is located? does it belong to your php project? try to replace that part with full path to your file</span>
<span class="comment-copy">My PHP file, called <code>crosswalkPredict.php</code>, is located in <code>/home/user01/Desktop/transportation</code>, and my testModels folder is located in the same directory (<code>/home/user01/Desktop/transportation</code>).</span>
<span class="comment-copy">If I try to run a python script that uses TensorFlow, and I run it directly from the command line, it runs perfectly, while if I run it using <code>shell_exec()</code>, I get the error.  If I don't get the error when running it from the command line, would it still be possible that it's a CPU compatibility issue?</span>
