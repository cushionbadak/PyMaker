<div class="post-text" itemprop="text">
<p>I am training FasterRCNN for MobileNetV1.</p>
<p><a href="https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/detection_model_zoo.md" rel="nofollow noreferrer">This model zoos</a> doesn't have pre-trained model for FasterRCNN for MobileNetV1.</p>
<p>So I used pre-trained model from <a href="https://github.com/tensorflow/models/tree/master/research/slim#pre-trained-models" rel="nofollow noreferrer">here</a>.</p>
<p>But I have error as variables are not available in checkpoint.
Quite a lot of warnings and I showed some of them.
These are warning and but training still can proceed with no pretrained weights.</p>
<p>My query is why I can't use these pretrained weights fro FasterRCNN.</p>
<p>In this <a href="https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/defining_your_own_model.md" rel="nofollow noreferrer">tutorial</a>, it is mentioned at the middle as <code>"We typically initialize the weights of this feature extractor using those from the Slim Resnet-101 classification checkpoint, and we know that images were preprocessed when training this checkpoint by subtracting a channel mean from each input image. Thus, we implement the preprocess function to replicate the same channel mean subtraction behavior."</code></p>
<p>Why I can't use those weights?</p>
<p>I load pretrained model in the config file as</p>
<pre><code>fine_tune_checkpoint: "object_detection/data/mobilenet_v1_1.0_224/mobilenet_v1_1.0_224.ckpt"
from_detection_checkpoint: true
</code></pre>
<p>The warnings are</p>
<pre><code>WARNING:root:Variable [FirstStageFeatureExtractor/MobilenetV1/Conv2d_0/BatchNorm/beta] is not available in checkpoint
WARNING:root:Variable [FirstStageFeatureExtractor/MobilenetV1/Conv2d_0/BatchNorm/gamma] is not available in checkpoint
WARNING:root:Variable [FirstStageFeatureExtractor/MobilenetV1/Conv2d_0/BatchNorm/moving_mean] is not available in checkpoint
WARNING:root:Variable [FirstStageFeatureExtractor/MobilenetV1/Conv2d_0/BatchNorm/moving_variance] is not available in checkpoint
WARNING:root:Variable [FirstStageFeatureExtractor/MobilenetV1/Conv2d_0/weights] is not available in checkpoint
WARNING:root:Variable [FirstStageFeatureExtractor/MobilenetV1/Conv2d_10_depthwise/BatchNorm/beta] is not available in checkpoint
WARNING:root:Variable [FirstStageFeatureExtractor/MobilenetV1/Conv2d_10_depthwise/BatchNorm/gamma] is not available in checkpoint
WARNING:root:Variable [FirstStageFeatureExtractor/MobilenetV1/Conv2d_10_depthwise/BatchNorm/moving_mean] is not available in checkpoint
WARNING:root:Variable [FirstStageFeatureExtractor/MobilenetV1/Conv2d_10_depthwise/BatchNorm/moving_variance] is not available in checkpoint
WARNING:root:Variable [FirstStageFeatureExtractor/MobilenetV1/Conv2d_10_depthwise/depthwise_weights] is not available in checkpoint
WARNING:root:Variable [FirstStageFeatureExtractor/MobilenetV1/Conv2d_10_pointwise/BatchNorm/beta] is not available in checkpoint
WARNING:root:Variable [FirstStageFeatureExtractor/MobilenetV1/Conv2d_10_pointwise/BatchNorm/gamma] is not available in checkpoint
WARNING:root:Variable [FirstStageFeatureExtractor/MobilenetV1/Conv2d_10_pointwise/BatchNorm/moving_mean] is not available in checkpoint
WARNING:root:Variable [FirstStageFeatureExtractor/MobilenetV1/Conv2d_10_pointwise/BatchNorm/moving_variance] is not available in checkpoint
WARNING:root:Variable [FirstStageFeatureExtractor/MobilenetV1/Conv2d_10_pointwise/weights] is not available in checkpoint
WARNING:root:Variable [FirstStageFeatureExtractor/MobilenetV1/Conv2d_11_depthwise/BatchNorm/beta] is not available in checkpoint
WARNING:root:Variable [FirstStageFeatureExtractor/MobilenetV1/Conv2d_11_depthwise/BatchNorm/gamma] is not available in checkpoint
WARNING:root:Variable [FirstStageFeatureExtractor/MobilenetV1/Conv2d_11_depthwise/BatchNorm/moving_mean] is not available in checkpoint
WARNING:root:Variable [FirstStageFeatureExtractor/MobilenetV1/Conv2d_11_depthwise/BatchNorm/moving_variance] is not available in checkpoint
WARNING:root:Variable [FirstStageFeatureExtractor/MobilenetV1/Conv2d_11_depthwise/depthwise_weights] is not available in checkpoint
WARNING:root:Variable [FirstStageFeatureExtractor/MobilenetV1/Conv2d_11_pointwise/BatchNorm/beta] is not available in checkpoint
WARNING:root:Variable [FirstStageFeatureExtractor/MobilenetV1/Conv2d_11_pointwise/BatchNorm/gamma] is not available in checkpoint
WARNING:root:Variable [FirstStageFeatureExtractor/MobilenetV1/Conv2d_11_pointwise/BatchNorm/moving_mean] is not available in checkpoint
WARNING:root:Variable [FirstStageFeatureExtractor/MobilenetV1/Conv2d_11_pointwise/BatchNorm/moving_variance] is not available in checkpoint
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>Yes pre-trained model from <a href="https://github.com/tensorflow/models/tree/master/research/slim#pre-trained-models" rel="nofollow noreferrer">here</a> can be used. What variables are needed to initialize and what variable are available from loaded checkpoint can be checked from variable_names_map. From there, select the variable and initialize to further fine tuning.</p>
<p>Need a bit of modification to the Tensorflow's code mainly at utils/variables_helper.py file.</p>
<p>What to be in FirstStage and SecondStage of FasterRCNN are decided at faster_rcnn_mobilenet_v1_feature_extractor.py</p>
</div>
<span class="comment-copy">models from Tensorflow repo from provided link use <code>tf.contrib.framework.arg_scope</code> to define batchnorm. Have you tried inspecting checkpoint file with <code>tf.train.list_variables(ckpt)</code>?</span>
<span class="comment-copy">How can I check? I am new to Tensorflow.</span>
<span class="comment-copy">Two parameters are mentioned as <code>--checkpoint_exclude_scopes=InceptionV3/Logits,InceptionV3/AuxLogits</code> and      <code>--trainable_scopes=InceptionV3/Logits,InceptionV3/AuxLogits</code>. They are to exclude in loading weights and to train only on those layers. That is for classification. But for detection, there is no such parameter inputs. Here is the link we can find parameters for object detection (<a href="https://github.com/tensorflow/models/blob/master/research/object_detection/model_main.py" rel="nofollow noreferrer">github.com/tensorflow/models/blob/master/research/â€¦</a>)</span>
<span class="comment-copy">tf.train.list_variables returns list of all variables in checkpoint. it doesn't need to be run inside session.  then you can decide what variables to load.  take a look <a href="https://kwotsin.github.io/tech/2017/02/11/transfer-learning.html" rel="nofollow noreferrer">kwotsin.github.io/tech/2017/02/11/transfer-learning.html</a></span>
