<div class="post-text" itemprop="text">
<p>I am developing App leveraging Microsoft Graph using Python 3.6.</p>
<p>I am getting very strange behavior when requesting Graph API which uses request data as nested JSON.  </p>
<p>This is a successful request:</p>
<pre><code>url = f "https://graph.microsoft.com/v1.0/users/{user_id}"
headers = {
  'Authorization': f 'Bearer {office365_access_token}',
  'Content-Type': 'application/json'
}
data = {
  "city": "Tokyo"
}
req = urllib.request.Request(url, json.dumps(data).encode("utf-8"), headers = headers, method = 'PATCH')
urllib.request.urlopen(req)
</code></pre>
<p>The next snipped fails with an <code>HTTP Error 400</code> error. The <a href="https://docs.microsoft.com/en-us/graph/api/user-update?view=graph-rest-1.0" rel="nofollow noreferrer">documentation</a> states that the <code>skills</code> property is a String Collection, so I used an Array of String values:</p>
<pre><code>url = f "https://graph.microsoft.com/v1.0/users/{user_principal_name}"
headers = {
  'Authorization': f 'Bearer {office365_access_token}',
  'Content-Type': 'application/json'
}
data = {
  "skills": ["swift", "python"]
}
req = urllib.request.Request(url, json.dumps(data).encode("utf-8"), headers = headers, method = 'PATCH')
urllib.request.urlopen(req)
</code></pre>
<p>The only difference is whether the value is a string or not. I can dump the data dictionary to a JSON string,  so I don't think the code is wrong but I do not know why this error occurres.</p>
</div>
<div class="post-text" itemprop="text">
<p>It appears to be a <em>bug</em> related with Microsoft Graph itself, specifically with <a href="https://docs.microsoft.com/en-us/graph/api/user-update?view=graph-rest-1.0" rel="nofollow noreferrer"><code>User</code> <em>update</em> operation</a>. For example the following query:</p>
<pre><code>PATCH https://graph.microsoft.com/v1.0/me
Content-type: application/json
{
  "skills": [
    "Fortran",
    "Cobol"
  ],
  "city": "Helsinki"
}
</code></pre>
<p>indeed <em>fails</em> and returns the following error:</p>
<pre><code>{
    "error": {
        "code": "BadRequest",
        "message": "The request is currently not supported on the targeted entity set"
    }
}
</code></pre>
<p>At the same time updating another User properties, for example User.otherMails property which has the same <code>Collection(Edm.String)</code> type  as <code>User.skills</code>:   </p>
<pre><code>PATCH https://graph.microsoft.com/v1.0/me
Content-type: application/json


{
  "otherMails": [
    "office365admin@gmail.com",
    "office365admin@yahoo.com"
  ],
  "city": "Helsinki"
}
</code></pre>
<p>completes successfully.</p>
<p><strong>Workaround</strong></p>
<p>It appears it fails when <code>skills</code> property of <a href="https://docs.microsoft.com/en-us/graph/api/resources/user?view=graph-rest-1.0" rel="nofollow noreferrer"><code>User</code> resource</a> is getting updated along with another properties.  But if <strong>only</strong> a <code>skills</code> property is getting updated</p>
<pre><code>PATCH https://graph.microsoft.com/v1.0/me
Content-type: application/json

{
  "skills": [
    "Fortran",
    "Cobol",
    "C"
  ]
}
</code></pre>
<p>no error occurs and the operation successfully completes. </p>
</div>
<span class="comment-copy">Thank you for your comment. But my request is only updating skills property and the request fails.</span>
<span class="comment-copy">@penlight, surprisingly, your example for updating <code>skills</code> property only works on  my side</span>
