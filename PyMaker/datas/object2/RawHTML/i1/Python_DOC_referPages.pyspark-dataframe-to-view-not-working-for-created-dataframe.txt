<div class="post-text" itemprop="text">
<p>I'm trying to create a view for spark sql, but I'm having trouble creating it from a list of strings.</p>
<p>So I decided to follow the pyspark.sql document <strong>verbatim</strong>, <em>and it still doesn't work</em>:</p>
<pre><code>testd = [{'name': 'Alice', 'age': 1}]
spark.createDataFrame(testd).collect()
</code></pre>
<p>Error trace:</p>
<pre><code>Py4JJavaError                             Traceback (most recent call last)
&lt;ipython-input-55-d4321f74b607&gt; in &lt;module&gt;()
      1 testd = [{'name': 'Alice', 'age': 1}]
      2 
----&gt; 3 spark.createDataFrame(testd).collect()

/opt/app/anaconda2/python27/lib/python2.7/site-packages/pyspark/sql/dataframe.pyc in collect(self)
    389         """
    390         with SCCallSiteSync(self._sc) as css:
--&gt; 391             port = self._jdf.collectToPython()
    392         return list(_load_from_socket(port, BatchedSerializer(PickleSerializer())))
    393 

/opt/app/anaconda2/python27/lib/python2.7/site-packages/py4j/java_gateway.pyc in __call__(self, *args)
   1131         answer = self.gateway_client.send_command(command)
   1132         return_value = get_return_value(
-&gt; 1133             answer, self.gateway_client, self.target_id, self.name)
   1134 
   1135         for temp_arg in temp_args:

/opt/app/anaconda2/python27/lib/python2.7/site-packages/pyspark/sql/utils.pyc in deco(*a, **kw)
     61     def deco(*a, **kw):
     62         try:
---&gt; 63             return f(*a, **kw)
     64         except py4j.protocol.Py4JJavaError as e:
     65             s = e.java_exception.toString()

/opt/app/anaconda2/python27/lib/python2.7/site-packages/py4j/protocol.pyc in get_return_value(answer, gateway_client, target_id, name)
    317                 raise Py4JJavaError(
    318                     "An error occurred while calling {0}{1}{2}.\n".
--&gt; 319                     format(target_id, ".", name), value)
    320             else:
    321                 raise Py4JError(

Py4JJavaError: An error occurred while calling o896.collectToPython.
....
TypeError: range() integer end argument expected, got list.
</code></pre>
<p>Meanwhile, this in the tutorial:</p>
<pre><code>l = [('Alice', 1)]
spark.createDataFrame(l, ['name', 'age']).collect()
</code></pre>
<p>Got the same essential error trace <code>'range() integer end argument expected, got list.'</code></p>
<p>What is going on here???</p>
<p>Here's how I initiate my spark instance:</p>
<pre><code>os.environ['SPARK_HOME']='/path/to/spark2-client'
os.environ['PY4JPATH']='/path/to/spark2-client/python/lib/py4j-0.10.4-src.zip'
sys.path.insert(0, os.path.join(os.environ['SPARK_HOME'],'python'))
sys.path.insert(1, os.path.join(os.environ['SPARK_HOME'],'python/lib'))
os.environ['HADOOP_CONF_DIR']='/etc/hadoop/conf'
os.environ['MASTER']="yarn"
os.environ['SPARK_MAJOR_VERSION']="2"
spark = (SparkSession
            .builder
            .appName('APPNAME')
            .config("spark.executor.instances","8")
            .config("spark.executor.memory","32g")
            .config("spark.driver.memory","64g")
            .config("spark.driver.maxResultSize","32g")
            .enableHiveSupport()
            .getOrCreate())
</code></pre>
<p>All other spark functions work fine, including hive queries, dataframe joining etc. Only when I try to create something from local memory, it doesn't work.</p>
<p>Thanks for any insights.</p>
</div>
<div class="post-text" itemprop="text">
<p><code>spark.createDataFrame(['Alice',1], ['name', 'age']).collect()</code></p>
<p>According to the documentation
<a href="https://spark.apache.org/docs/2.3.1/api/python/pyspark.sql.html" rel="nofollow noreferrer">https://spark.apache.org/docs/2.3.1/api/python/pyspark.sql.html</a>
<a href="https://spark.apache.org/docs/2.3.1/api/python/_modules/pyspark/sql/dataframe.html#DataFrame.unionByName" rel="nofollow noreferrer">https://spark.apache.org/docs/2.3.1/api/python/_modules/pyspark/sql/dataframe.html#DataFrame.unionByName</a></p>
</div>
<span class="comment-copy">That looks like a version mismatch - probably, but not necessarily, related to all the funky path manipulation. I'd start with confirming that actually use versions you think you do, both locally (driver) and remotely. For the former you can use technique I described <a href="https://stackoverflow.com/a/53457308/10465355">here</a>.</span>
<span class="comment-copy">@user10465355 Perhaps, but something has to be right for <i>every other function</i> to work just fine, but this one <code>createDataFrame</code> in particular.</span>
<span class="comment-copy">No version is fully breaking the compatibility, a <code>DataFrame</code> API, with it's minimal dependency on Python code, has negligible failure surface. That's at least my best guess, as the error is not reproducible on proper deployments.</span>
<span class="comment-copy">This does not work -- My question is that it's throwing that error trace when I tried stuff from <i>the document</i>.</span>
