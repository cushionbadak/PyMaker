<div class="post-text" itemprop="text">
<p>I'm using the following -</p>
<pre><code>import urllib.request as req

proxy = req.ProxyHandler({'http': r'http://USER:PASS@PROXY:PORT'})
auth = req.HTTPBasicAuthHandler()
opener = req.build_opener(proxy, auth, req.HTTPHandler)
req.install_opener(opener)
conn = req.urlopen('http://google.com')
return_str = conn.read()
</code></pre>
<p>Here is my traceback - </p>
<pre><code>Traceback (most recent call last):
  File ".\proxy.py", line 8, in &lt;module&gt;
    conn = req.urlopen('http://google.com')
  File "D:\Python34\lib\urllib\request.py", line 153, in urlopen
    return opener.open(url, data, timeout)
  File "D:\Python34\lib\urllib\request.py", line 461, in open
    response = meth(req, response)
  File "D:\Python34\lib\urllib\request.py", line 571, in http_response
    'http', request, response, code, msg, hdrs)
  File "D:\Python34\lib\urllib\request.py", line 499, in error
    return self._call_chain(*args)
  File "D:\Python34\lib\urllib\request.py", line 433, in _call_chain
    result = func(*args)
  File "D:\Python34\lib\urllib\request.py", line 579, in http_error_default
    raise HTTPError(req.full_url, code, msg, hdrs, fp)
urllib.error.HTTPError: HTTP Error 407: Proxy Authentication Required
</code></pre>
<p>Despite how simple this should be I'm always getting <code>407: Proxy Authentication Required</code>. I've checked tons of questions on SO about this very problem, but can't find an answer that works. It almost seems as if <code>urllib</code> isn't passing my credentials at all. I can put a bogus password and it doesn't return saying my that credentials are invalid.</p>
<p>What am I missing?</p>
</div>
<div class="post-text" itemprop="text">
<p>Most likely, your proxy doesn't accept username and password embedded in the URL. And <code>ProxyHandler</code> doesn't automatically strip them out of the URL and use them for authentication. So, you need to look at what type of authentication the proxy wants and use a <a href="https://docs.python.org/3/library/urllib.request.html#urllib.request.ProxyBasicAuthHandler" rel="nofollow"><code>ProxyBasicAuthHandler</code></a> or <code>ProxyDigestAuthHandler</code>, etc.</p>
<p>If you look at the <a href="https://docs.python.org/3/library/urllib.request.html#examples" rel="nofollow">Examples</a>, the 8th one shows how to do this:</p>
<pre><code>proxy_handler = urllib.request.ProxyHandler({'http': 'http://www.example.com:3128/'})
proxy_auth_handler = urllib.request.ProxyBasicAuthHandler()
proxy_auth_handler.add_password('realm', 'host', 'username', 'password')

opener = urllib.request.build_opener(proxy_handler, proxy_auth_handler)
# This time, rather than install the OpenerDirector, we use it directly:
opener.open('http://www.example.com/login.html')
</code></pre>
</div>
<span class="comment-copy">You know what? I had tried that by setting my <code>realm</code> to <code>None</code> and all I get back is <code>AbstractBasicAuthHandler does not support the following scheme: 'NEGOTIATE'</code>.</span>
<span class="comment-copy">@user3238014: Well, you need to figure out how the proxy wants you to auth before you can write the code for it. You can do this through trial and error, by looking at your browser's config and understanding what it means, by watching the traffic that goes between your browser and your proxy, by looking at the proxy's configurationâ€¦ but somehow, you have to do it.</span>
