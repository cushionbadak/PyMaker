<div class="post-text" itemprop="text">
<p>i wrote this program to sniff arp packets in the network and print there source address. The code is as follows:
(this is just modify sample source a little bit about amazon dash button sniping packet )</p>
<pre><code>from scapy.all import *

import urllib

global flag

def arp_display(pkt):


if pkt[ARP].op == 1: #who-has (request)

#if pkt[ARP].psrc == '0.0.0.0': # ARP Probe

  if pkt[ARP].hwsrc == '0c:47:c3:e6:c5:b7': # Energizier

    print ("Pushed Energizier")

    if (flag == NULL) or (flag == 0):

       url = url + "LED=0"

       req = urllib2.Request(url)

       response = urllib2.urlopen(req)

       flag = 1

       print ( "send signal")

    else :

       url = url + "LED=1"

       req = urllib2.Request(url)

       response = urllib2.urlopen(req)

       flag = 0


  elif pkt[ARP].hwsrc == 'a4:af:66:df:9e:45': # Elements

    print ("Pushed Elements")

  else:

    print ("ARP Probe from unknown device: " + pkt[ARP].hwsrc)



print ( sniff(prn=arp_display, filter="arp", store=0, count=10,lfilter=lambda pkt: ARP in pkt) )
</code></pre>
<p>error message is</p>
<pre><code>Traceback (most recent call last):
File "/share/Web/python/dash_check.py", line 54, in &lt;module&gt;
print ( sniff(prn=arp_display, filter="arp", store=0, 
count=10,lfilter=lambda pkt: ARP in pkt) )
File "/opt/lib/python2.7/site-packages/scapy/sendrecv.py", line 620, in sniffr = prn(p)
File "/share/Web/python/dash_check.py", line 21, in arp_display
if (flag == NULL) or (flag == 0):
UnboundLocalError: local variable 'flag' referenced before assignment
</code></pre>
<p>really i don't know why print out error message like this </p>
</div>
<div class="post-text" itemprop="text">
<p>You are trying to access and modify a global variable in your function. But as you are assigning this <code>flag</code> variable within the function's scope, as in:</p>
<pre><code>flag = 1
</code></pre>
<p>and </p>
<pre><code>flag = 0
</code></pre>
<p><code>flag</code> is assumed as a local variable and it shadows the same named global variable in the outer scope. Take a look at here: <a href="https://docs.python.org/3/faq/programming.html#why-am-i-getting-an-unboundlocalerror-when-the-variable-has-a-value" rel="nofollow noreferrer">Why am I getting an UnboundLocalError when the variable has a value?</a></p>
<p>This is a minimal example of what is happening with your code:</p>
<pre><code>flag = 0
def func():
    if flag==0:
        print("flag is 0")
        flag = 1
</code></pre>
<p>calling <code>func()</code> will raise the same error:</p>
<pre><code>UnboundLocalError: local variable 'flag' referenced before assignment
</code></pre>
<p>The solution for this is to use the <code>global</code> keyword for modifying the global variable in local scope. Like this:</p>
<pre><code>flag = 0
def func():
    global flag
    if flag==0:
        print("flag is 0")
        flag = 1
</code></pre>
<p>Please check the link with the answer for better understanding.</p>
</div>
<span class="comment-copy">you are using <code>flag</code> before it has a value in the <code>if</code> statement in line 21. You need to assign a value, or even <code>None</code>, to the <code>flag</code> variable before you come to that <code>if</code> statement.</span>
<span class="comment-copy">Please edit your question's title if you can because your problem do not relate with <code>scrapy</code>.</span>
