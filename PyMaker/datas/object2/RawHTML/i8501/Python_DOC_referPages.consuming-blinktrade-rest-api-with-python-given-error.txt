<div class="post-text" itemprop="text">
<p>I'm new with python. Just few hours learning it.</p>
<p>I'm trying to consume an REST API to get some account infos...</p>
<p>Here is my request:</p>
<pre><code>def getAccountData():
    nonce = int(datetime.datetime.now().timestamp())
    signature = hmac.new(b'TDDh8djV3NwXt53gSrScDul6o6w3HnnZsHuh6HTF9SA', msg=nonce, digestmod=hashlib.sha256).digest()
    print(signature)
    headers = {
            'content-type': 'application/json',
            'APIKey':conf['API_KEY'],
            'Nonce':str(nonce),
        }
    data = {
            "MsgType": "U2",
            "BalanceReqID": 1
        }   
    r = requests.post('https://api.blinktrade.com/tapi/v1/message', data=data, headers=headers)
    print(r.json())
</code></pre>
<p>And here is the error:</p>
<blockquote>
<p>Traceback (most recent call last):   File "foxbit.py", line 51, in
  
      getAccountData()   File "foxbit.py", line 30, in getAccountData
      signature = hmac.new(b'TDDh8djV3NwXt53gSrScDul6o6w3HnnZsHuh6HTF9SA', msg=nonce,
  digestmod=hashlib.sha256).digest()   File
  "C:\Python\Python35\lib\hmac.py", line 144, in new
      return HMAC(key, msg, digestmod)   File "C:\Python\Python35\lib\hmac.py", line 84, in <strong>init</strong>
      self.update(msg)   File "C:\Python\Python35\lib\hmac.py", line 93, in update
      self.inner.update(msg) TypeError: object supporting the buffer API required</p>
</blockquote>
<p>I'm trying consume this API:
<code><a href="https://blinktrade.com/docs/?shell#balance" rel="nofollow noreferrer">https://blinktrade.com/docs/?shell#balance</a></code>
on <code>balance</code> method</p>
<p>with no success.</p>
<p>I'm wanna create and python app to watch my opened orders of Bitcoin.
What was happening with this error?? On documentation, says i need do this to work:</p>
<pre><code>{
    "MsgType": "U2",
    "BalanceReqID": 1
}
message='{ "MsgType": "U2", "BalanceReqID": 1 }'

api_url='API_URL_REST_ENDPOINT'
api_key='YOUR_API_KEY_GENERATED_IN_API_MODULE'
api_secret='YOUR_SECRET_KEY_GENERATED_IN_API_MODULE'

nonce=`date +%s`
signature=`echo -n "$nonce" | openssl dgst -sha256 -hex -hmac "$api_secret" | cut -d ' ' -f 2`

curl -X POST "$api_url"              \
  -H "APIKey:$api_key"               \
  -H "Nonce:$nonce"                  \
  -H "Signature:$signature"          \
  -H "Content-Type:application/json" \
  -d "$message"
</code></pre>
<p>3 hours trying it and nothing! hehe
I need some help here.</p>
</div>
<div class="post-text" itemprop="text">
<p>The main problem is that you are not passing the nonce as a bytearray format when generating the signature.</p>
<p>This is a change after python 3.4</p>
<blockquote>
<p>hmac now accepts bytearray as well as bytes for the key argument to
  the new() function, and the msg parameter to both the new() function
  and the update() method now accepts any type supported by the hashlib
  module. (Contributed by Jonas Borgstr√∂m in bpo-18240.)</p>
</blockquote>
<p><a href="https://docs.python.org/3/whatsnew/3.4.html#hmac" rel="nofollow noreferrer">https://docs.python.org/3/whatsnew/3.4.html#hmac</a></p>
<p>Passing a <code>bytearray</code> on nonce should work as expected.</p>
<pre><code>signature = hmac.new(b'SECRET', msg=bytearray(nonce), digestmod=hashlib.sha256).digest()
</code></pre>
<p>Also, you are forgetting the <code>Signature</code> header.</p>
<p>You can follow this gist that has very useful python examples, it's actually built on python2, but you still can follow it, and it's very easy to get started.
<a href="https://gist.github.com/pinhopro/60b1fd213b36d576505e" rel="nofollow noreferrer">https://gist.github.com/pinhopro/60b1fd213b36d576505e</a> </p>
<p>As a BlinkTrade employee, don't hesite to ask me anything.</p>
</div>
