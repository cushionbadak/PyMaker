<div class="post-text" itemprop="text">
<pre><code>#!/usr/bin/python

import time
import random
import struct
import select
import socket


def chk(data):
    x = sum(x &lt;&lt; 8 if i % 2 else x for i, x in enumerate(data)) &amp; 0xFFFFFFFF
    x = (x &gt;&gt; 16) + (x &amp; 0xFFFF)
    x = (x &gt;&gt; 16) + (x &amp; 0xFFFF)
    return struct.pack('&lt;H', ~x &amp; 0xFFFF)


def ping(addr, timeout=1, number=1, data=b''):
    conn = socket.socket(socket.AF_INET, socket.SOCK_RAW,  socket.IPPROTO_ICMP)
    payload = struct.pack('!HH', random.randrange(0, 65536), number) + data

    conn.connect((addr, 80))
    conn.sendall(b'\x08\0' + chk(b'\x08\0\0\0' + payload) + payload)
    start = time.time()

    while select.select([conn], [], [], max(0, start + timeout - time.time()))[0]:
        data = conn.recv(65536)
        if len(data) &lt; 20 or len(data) &lt; struct.unpack_from('!xxH', data)[0]:
            continue
        if data[20:] == b'\0\0' + chk(b'\0\0\0\0' + payload) + payload:
            return time.time() - start


if __name__ == '__main__':
    target = raw_input("Please enter a IP Adress: ")
    print(ping(target))
</code></pre>
<p>I have tried to script which works for creating packet and send to    icmp packet. I got the error the result of the script is shown below:</p>
<pre><code># python Pinger.py 
Please enter a IP Adress: 89.1.3.2
Traceback (most recent call last):
  File "Pinger.py", line 35, in &lt;module&gt;
    print(ping(target))
  File "Pinger.py", line 22, in ping
    conn.sendall(b'\x08\0' + chk(b'\x08\0\0\0' + payload) + payload)
  File "Pinger.py", line 11, in chk
    x = sum(x &lt;&lt; 8 if i % 2 else x for i, x in enumerate(data)) &amp; 0xFFFFFFFF
TypeError: unsupported operand type(s) for +: 'int' and 'str'
</code></pre>
<p>Can you help m to resolve TypeError and Traceback?</p>
</div>
<div class="post-text" itemprop="text">
<p>checkout this !</p>
<pre><code>data = b'\0\0\0\0'

list(enumerate(data))
&gt;&gt;&gt; [(0, '\x00'), (1, '\x00'), (2, '\x00'), (3, '\x00')]
</code></pre>
<p>you missed here</p>
<pre><code>x = sum(x &lt;&lt; 8 if i % 2 else x for i, x in enumerate(data)) &amp; 0xFFFFFFFF
        ^ &lt;&lt; also raise TypeError     ^ this is str
</code></pre>
<p>I guess, the reason of <code>TypeError</code>, function <code>sum</code> may use <code>+</code> operator.</p>
</div>
<span class="comment-copy">I'd say that something in <code>payload</code> is a string, while the rest of what you sent to <code>chk</code> has elements that evaluate to integers, and you're trying to add the bitshifted integers with the strings (that's what <code>sum</code> does). Or the first element of what you sent to <code>sum</code> could be a string, and it's trying to add that to the default start value of 0. That's probably more likely.</span>
<span class="comment-copy">What is the value of <code>data</code> when it fails?</span>
<span class="comment-copy">On Python 2.7 <a href="https://docs.python.org/2/library/struct.html#struct.pack" rel="nofollow noreferrer"><code>struct.pack</code></a> returns <code>str</code>. On 3.6 it <a href="https://docs.python.org/3/library/struct.html#struct.pack" rel="nofollow noreferrer">returns <code>bytes</code></a></span>
<span class="comment-copy">Payload was turned to bytes. However, it did not worked. conn.sendall(b'\x80\0' + chk(b'\x80\0\0\0' + b'payload') + b'payload')</span>
<span class="comment-copy">How can I change to x in enumarate(data) to int?                                        x = sum(x &lt;&lt; 8 if i % 2 else x for i, x in int(enumerate(data))) &amp; 0xFFFFFFFF   was not corrected.</span>
<span class="comment-copy">1. casting to int.  <code>int(x)</code> 2. using <code>map</code>. <code>enumerate(map(int, data))</code>. Before that, you sure all of data elements can be casted to int.</span>
