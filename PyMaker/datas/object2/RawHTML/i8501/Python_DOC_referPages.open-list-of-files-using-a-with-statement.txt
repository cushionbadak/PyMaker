<div class="post-text" itemprop="text">
<p>I'm trying to open several files from <code>sys.argv</code> inputs using a <code>with</code> statement.</p>
<p>I know I can do it by manually typing out each one:</p>
<pre><code>with open(sys.argv[1], 'r') as test1, open(sys.argv[2], 'r') as test2, \
     open(sys.argv[3], 'r') as test3, open(sys.argv[4], 'r') as test4:
    do_something()
</code></pre>
<p>But is there a way to do this without doing so, like the following pseudocode:</p>
<pre><code>with open(sys.argv[1:4], 'r') as test1, test2, test3:
    do_something()
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>You can do this in Python 3.3+ <a href="https://docs.python.org/3/library/contextlib.html#contextlib.ExitStack" rel="nofollow noreferrer">with <code>contextlib.ExitStack</code></a>:</p>
<pre><code>from contextlib import ExitStack

with ExitStack() as stack:
    files = [stack.enter_context(open(arg, 'r')) for arg in sys.arv[1:4]]
</code></pre>
<p>Amusingly, the example in the documentation is exactly what you want.</p>
<p>This correctly closes any open files upon exiting the <code>with</code> statement - even if something went wrong before they were all open</p>
<hr/>
<p>For earlier version of python, there is <a href="https://contextlib2.readthedocs.io/en/stable/index.html?highlight=ExitStack#contextlib2.ExitStack" rel="nofollow noreferrer">a backport in the <code>contextlib2</code> package</a>, which you can get through <code>pip</code></p>
</div>
<span class="comment-copy">Great question! Not easily in python 2 though</span>
<span class="comment-copy">According to the documentation, I'm assuming this example still holds for contextlib2 in Python 2?</span>
<span class="comment-copy">@anita: yes, it should still hold</span>
