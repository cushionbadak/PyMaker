<div class="post-text" itemprop="text">
<p>I am trying to send an email using Pythion smtp library. I have got below code but somehow when I get an email, it doesn't have <code>"To"</code>, <code>"Subject"</code> and <code>"Body"</code> contents as they are missing. I believe something is wrong with the way <code>message</code> string is constructed.</p>
<pre><code>import smtplib
import socket

FROM = "from@host.com"
TO = ["to@host.com"]

def send_email():
    hostname = socket.getfqdn()
    text = "Hello"
    subject = "Error on %s " % (hostname)
    print subject

    # Prepare actual message
    message = """\
    From: %s
    To: %s
    Subject: %s

    %s
    """ % (FROM, ", ".join(TO), subject, text)

    smtp_server = ""
    if ".dev" not in hostname:
        smtp_server = "abc.host.com"
    else:
        smtp_server = "pqr.host.com"

    # Send the mail
    server = smtplib.SMTP(smtp_server)
    server.sendmail(FROM, TO, message)
    server.quit()

send_email()
</code></pre>
<p>But when I use exact same below code, it works fine without any issues so I am sure something is wrong with my above code when I put everything in a method. I believe indentation is causing issues with the way message string is contructed or something else which I am not able to figure out.</p>
<pre><code>import smtplib
import socket

SERVER = "abc.host.com"

FROM = "from@host.com"
TO = ["to@host.com"]
SUBJECT = "Test! %s " % (socket.getfqdn())
TEXT = "Testing."

# Prepare actual message

message = """\
From: %s
To: %s
Subject: %s

%s
""" % (FROM, ", ".join( TO), SUBJECT, TEXT)

# Send the mail

server = smtplib.SMTP(SERVER)
server.sendmail(FROM, TO, message)
server.quit()
</code></pre>
<p>Here is what I see with first code. If you see closely it has lot of spaces in front of each tag as compared to what gets printed out with second code:</p>
<pre><code>    From: from@host.com
    To: to@host.com
    Subject: Error on machineA

    Hello
</code></pre>
<p>This is what I see with second code:</p>
<pre><code>From: from@host.com
To: to@host.com
Subject: Test! machineA

Testing.
</code></pre>
<p>How do I fix this in first code when I am putting it in a method?</p>
<p><strong>Update:</strong></p>
<p>I tried with below code but it gives me error about indentation is wrong on <code>print message</code>.</p>
<pre><code>import smtplib
import socket

FROM = "from@host.com"
TO = ["to@host.com"]

def send_email():
    hostname = socket.getfqdn()
    text = "Hello"
    subject = "Error on %s " % (hostname)
    print subject

    # Prepare actual message
    message = """\
From: %s
To: %s
Subject: %s

%s
""" % (FROM, ", ".join(TO), subject, text)

    print message
    smtp_server = ""
    if ".dev" not in hostname:
        smtp_server = "abc.host.com"
    else:
        smtp_server = "pqr.host.com"

    # Send the mail
    server = smtplib.SMTP(smtp_server)
    server.sendmail(FROM, TO, message)
    server.quit()

send_email()
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>You are allowed to remove the indents:</p>
<pre><code>def send_email():
    # stuff ...

    # Prepare actual message
    message = """\
From: %s
- other stuff...

""" % (FROM, ", ".join(TO), subject, text)

    smtp_server = ""

    # more stuff...
    server.sendmail(FROM, TO, message)
    server.quit()
</code></pre>
<p>Also, not sure you need the back slash?</p>
<pre><code>message = '''    &lt; == no backslash
stuff
'''
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>Use the stdlib <code>email</code>package to help you building your mail as correct SMTP payloads (headers, encoding, parts, ...). <a href="https://docs.python.org/3/library/email.html#module-email" rel="nofollow noreferrer">https://docs.python.org/3/library/email.html#module-email</a></p>
<p>There are tons of examples in the standard doc or in stackoverflow.</p>
</div>
<span class="comment-copy">Your literal 'three-quote' string in the function includes the indents.</span>
<span class="comment-copy">I updated my question with your suggestion but it gives me error on indentation while compiling? Anything wrong in my updated code?</span>
<span class="comment-copy">It still sounds like there is something wrong with the string.</span>
