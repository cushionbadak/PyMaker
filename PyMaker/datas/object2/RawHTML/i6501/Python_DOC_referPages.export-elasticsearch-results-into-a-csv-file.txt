<div class="post-text" itemprop="text">
<p>I am trying to export the results that is found using the below query into a CSV on my desktop.</p>
<p>This is my first time using Elasticsearch and cURL so i am confused on how to do this.</p>
<pre><code>from elasticsearch import Elasticsearch

es = Elasticsearch(["9200"])

# Replace the following Query with your own Elastic Search Query
res = es.search(index="search", body=
                {
                    "_source": ["DTDT", "TRDT", "SPLE", "RPLE"],
                    "query": {
                        "bool": {
                            "should": [
                                {"wildcard": {"CN": "TEST1"}}

                            ]
                        }
                    }
}, size=10)

for doc in res['hits']['hits']:
    print(doc)
</code></pre>
<p>right now when i run this query it returns the name, lastname, address and gender for dave and i want to put the results into a csv on my desktop when i run the query.</p>
<p>i have been reading this link on how to do it but im not sure how to make my query do this - (<a href="https://docs.python.org/3/library/csv.html" rel="nofollow noreferrer">https://docs.python.org/3/library/csv.html</a>)</p>
<p>could someone help and show me how to convert my query in exporting a csv PLEASE!</p>
<p>thanks</p>
<p>the output i get is - </p>
<pre><code>{'_index': 'search', '_type': 'trades', '_id': '179299804977823744', '_score': 1.0, '_source': {'DTDT': '20170928', 'SPLE': '1001', 'RPLE': '1001', 'TRDT': '2017-09-28 17:01:19'}}
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>You can use csv module to write data.</p>
<p>From the output you have given, I am assuming that you want to write data from <code>_source</code> to csv file.</p>
<p><strong>Code :</strong></p>
<pre><code>from elasticsearch import Elasticsearch
import csv

es = Elasticsearch(["9200"])

# Replace the following Query with your own Elastic Search Query
res = es.search(index="search", body=
                {
                    "_source": ["DTDT", "TRDT", "SPLE", "RPLE"],
                    "query": {
                        "bool": {
                            "should": [
                                {"wildcard": {"CN": "TEST1"}}

                            ]
                        }
                    }
}, size=10)



with open('mycsvfile.csv', 'w') as f:  # Just use 'w' mode in 3.x
    header_present  = False
    for doc in res['hits']['hits']:
        my_dict = doc['_source'] 
        if not header_present:
            w = csv.DictWriter(f, my_dict.keys())
            w.writeheader()
            header_present = True


        w.writerow(my_dict)
</code></pre>
</div>
<span class="comment-copy">Can you please give output of print(doc) ? Couple of lines will do</span>
<span class="comment-copy">the query i have posted i have edited some of the code such as what i am searching for. do you need the original code. the only difference is the column name. I have updated me original post when the output and original code now. thank you for taking a look. im struggling to convert my code into export the results in CSV.</span>
<span class="comment-copy">When you above code and print the result, at last in for loop, that output is required to understand how data is coming.</span>
<span class="comment-copy">thanks for replying quickly, have you seen my updated post with my updated code and out put?</span>
<span class="comment-copy">you able to show me how to add your code with my code please?</span>
<span class="comment-copy">@Rich - Check the update</span>
<span class="comment-copy">i got alot of errors  GET <a href="http://9200:9200/search/_search?size=10" rel="nofollow noreferrer">9200:9200/search/_search?size=10</a> [status:N/A request:8.984s] Traceback (most recent call last):   File "C:\Users\AppData\Local\Programs\Python\Python36-32\lib\site-packages\urllib3\util\connection.py", line 60, in create_connection     for res in socket.getaddrinfo(host, port, family, socket.SOCK_STREAM):</span>
<span class="comment-copy">File "C:\Users\\AppData\Local\Programs\Python\Python36-32\lib\socket.py", line 745, in getaddrinfo     for res in _socket.getaddrinfo(host, port, family, type, proto, flags): socket.gaierror: [Errno 11004] getaddrinfo failed During handling of the above exception, another exception occurred:</span>
<span class="comment-copy">Check if your elasticsearch is ruuning or not</span>
