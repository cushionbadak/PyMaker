<div class="post-text" itemprop="text">
<p>In Python I'm trying to create a file if it doesn't exist, then open it in read/write mode. The most succinct way I've been able to express this is with the following:</p>
<pre><code>with os.fdopen(os.open('foo.bar', os.O_RDWR | os.O_CREAT), "r+") as f:
    # read file contents...
    # append new stuff...
</code></pre>
<p>Is there a better way to do this? Should I just check <code>if not os.path.exists('foo.bar')</code>, create the file if it doesn't exist, then open the file in "r+" mode?</p>
<p>In essence:</p>
<pre><code> if not os.path.exists('foo.bar'):
      os.makedirs('foo.bar') # or open('foo.bar', 'a').close()
 with open('foo.bar', "r+") as f:
    # read file contents...
    # append new stuff...
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>The second option is a bit iffy, as testing before the open leave you open to race conditions if your program isn't the only user / consumer of the file.</p>
<p>I would probably use a+ and seek back to the beginning</p>
<pre><code>with open("file", "a+") as f:
    f.seek(0)
    f.read()
    ...
</code></pre>
<p>Something else to consider I guess would be to just ditch the python file object and use os directly.</p>
<pre><code>fd = os.open("file", os.O_RDWR | os.O_CREAT)
buffer = os.read(fd)
new_data = b'stuff to append'
os.write(fd, new_data)
os.close(fd)

etc
</code></pre>
<p>This would require a bunch more code as you'll have to keep track of file handles manually which may be more of a pain than what you're doing with the "with" context management. </p>
</div>
<div class="post-text" itemprop="text">
<p>The main question is whether you want to truncate the file if it already exists.</p>
<p>If so, then do:</p>
<pre><code>with open("filename", "w+") as f:
  f.write("Hello, world")
</code></pre>
<p>Otherwise, do what <a href="https://stackoverflow.com/users/5014455/juanpa-arrivillaga">juanpa.arrivillaga</a> suggested:</p>
<pre><code>with open("filename", "a+") as f
  f.write("Hello, world")
</code></pre>
<p>The "a+" opens the file and starts at the end of the file. Check the <a href="https://docs.python.org/3/tutorial/inputoutput.html#reading-and-writing-files" rel="nofollow noreferrer">documentation</a> for more on how this works.</p>
</div>
<span class="comment-copy">Always add the generic python tag, btw</span>
<span class="comment-copy">@juanpa.arrivillaga Good point; appreciate it!</span>
<span class="comment-copy">Hm, couldn't you just use <code>'a+'</code> mode, which will create it if it doesn't exist, and positions the stream at the end?</span>
<span class="comment-copy">@juanpa.arrivillaga Using f.seek(0), right? For some reason I didn't like the way it looked, but I think I'm just weird lol. Probably best to do that</span>
<span class="comment-copy">But are you only reading from the file so you can append to it?</span>
