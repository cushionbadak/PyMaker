<div class="post-text" itemprop="text">
<p>I'm trying to read a specific file from a compressed file bz2 using python.</p>
<pre><code>tar = tarfile.open(filename, "r|bz2", bufsize=57860311)

for tarinfo in tar:
    print tarinfo.name, "is", tarinfo.size, "bytes in size and is",
    if tarinfo.isreg():
        print "a regular file."
        # read the file
        f = tar.extractfile(tarinfo)
        #print f.read()
    elif tarinfo.isdir():
        print "a directory."
    else:
        print "something else."
tar.close()
</code></pre>
<p>But at the end I got the error:</p>
<pre><code>/usr/local/Cellar/python@2/2.7.15_1/Frameworks/Python.framework/Versions/2.7/lib/python2.7/tarfile.pyc in read(self, size)
    577             buf = "".join(t)
    578         else:
--&gt; 579             buf = self._read(size)
    580         self.pos += len(buf)
    581         return buf

/usr/local/Cellar/python@2/2.7.15_1/Frameworks/Python.framework/Versions/2.7/lib/python2.7/tarfile.pyc in _read(self, size)
    594                 break
    595             try:
--&gt; 596                 buf = self.cmp.decompress(buf)
    597             except IOError:
    598                 raise ReadError("invalid compressed data")

EOFError: end of stream was already found
</code></pre>
<p>I also tried to list the files within the tar through 'tar.list()' and again ...</p>
<pre><code>-rwxr-xr-x lindauer/or3uunp          0 2013-05-21 00:58:36 r3.2/
-rw-r--r-- lindauer/or3uunp       6057 2012-01-05 14:41:00 r3.2/readme.txt
-rw-r--r-- lindauer/or3uunp      44732 2012-01-04 10:08:54 r3.2/psychometric.csv
-rw-r--r-- lindauer/or3uunp   57860309 2012-01-04 09:58:20 r3.2/logon.csv

/usr/local/Cellar/python@2/2.7.15_1/Frameworks/Python.framework/Versions/2.7/lib/python2.7/tarfile.pyc in _read(self, size)
    594                 break
    595             try:
--&gt; 596                 buf = self.cmp.decompress(buf)
    597             except IOError:
    598                 raise ReadError("invalid compressed data")

EOFError: end of stream was already found
</code></pre>
<p>I listed the files inside the archive using the tar command. Here is the result:</p>
<pre><code>tar -tvf r3.2.tar.bz2
drwxr-xr-x  0 lindauer or3uunp     0 May 21  2013 r3.2/
-rw-r--r--  0 lindauer or3uunp  6057 Jan  5  2012 r3.2/readme.txt
-rw-r--r--  0 lindauer or3uunp 44732 Jan  4  2012 r3.2/psychometric.csv
-rw-r--r--  0 lindauer or3uunp 57860309 Jan  4  2012 r3.2/logon.csv
-rw-r--r--  0 lindauer or3uunp 12494829865 Jan  5  2012 r3.2/http.csv
-rw-r--r--  0 lindauer or3uunp  1066622500 Jan  5  2012 r3.2/email.csv
-rw-r--r--  0 lindauer or3uunp   218962503 Jan  5  2012 r3.2/file.csv
-rw-r--r--  0 lindauer or3uunp    29156988 Jan  4  2012 r3.2/device.csv
drwxr-xr-x  0 lindauer or3uunp           0 May 20  2013 r3.2/LDAP/
-rw-r--r--  0 lindauer or3uunp      140956 Jan  4  2012 r3.2/LDAP/2011-01.csv
-rw-r--r--  0 lindauer or3uunp      147370 Jan  4  2012 r3.2/LDAP/2010-05.csv
-rw-r--r--  0 lindauer or3uunp      149221 Jan  4  2012 r3.2/LDAP/2010-02.csv
-rw-r--r--  0 lindauer or3uunp      141717 Jan  4  2012 r3.2/LDAP/2010-12.csv
-rw-r--r--  0 lindauer or3uunp      148931 Jan  4  2012 r3.2/LDAP/2010-03.csv
-rw-r--r--  0 lindauer or3uunp      147370 Jan  4  2012 r3.2/LDAP/2010-04.csv
-rw-r--r--  0 lindauer or3uunp      149793 Jan  4  2012 r3.2/LDAP/2009-12.csv
-rw-r--r--  0 lindauer or3uunp      143979 Jan  4  2012 r3.2/LDAP/2010-09.csv
-rw-r--r--  0 lindauer or3uunp      145591 Jan  4  2012 r3.2/LDAP/2010-07.csv
-rw-r--r--  0 lindauer or3uunp      139444 Jan  4  2012 r3.2/LDAP/2011-03.csv
-rw-r--r--  0 lindauer or3uunp      142347 Jan  4  2012 r3.2/LDAP/2010-11.csv
-rw-r--r--  0 lindauer or3uunp      138285 Jan  4  2012 r3.2/LDAP/2011-04.csv
-rw-r--r--  0 lindauer or3uunp      149793 Jan  4  2012 r3.2/LDAP/2010-01.csv
-rw-r--r--  0 lindauer or3uunp      146008 Jan  4  2012 r3.2/LDAP/2010-06.csv
-rw-r--r--  0 lindauer or3uunp      144711 Jan  4  2012 r3.2/LDAP/2010-08.csv
-rw-r--r--  0 lindauer or3uunp      137967 Jan  4  2012 r3.2/LDAP/2011-05.csv
-rw-r--r--  0 lindauer or3uunp      140085 Jan  4  2012 r3.2/LDAP/2011-02.csv
-rw-r--r--  0 lindauer or3uunp      143420 Jan  4  2012 r3.2/LDAP/2010-10.csv
-r--r--r--  0 lindauer or3uunp        3923 Jan  4  2012 r3.2/license.txt
</code></pre>
<p>I think this is due to the fact the archive has subfolders and for some reason python libraries have problems in dealing with subfolders extractions? </p>
<p>I also tried to open the tar file manually and I have no problems so I don't think the file is corrupted. Any help appreciated.</p>
</div>
<div class="post-text" itemprop="text">
<blockquote>
<p><strong>Comment</strong>: I tried the debug=3 and I get : ReadError: bad checksum  </p>
</blockquote>
<p>Found the following related Infos: </p>
<blockquote>
<p><a href="https://docs.oracle.com/cd/E19455-01/806-1075/msgs-2104/" rel="nofollow noreferrer">tar: <strong>directory checksum error</strong></a> </p>
<p><strong>Cause</strong><br/>
  This error message from tar(1) indicates that the checksum of the directory and the files it has read from tape does not match the checksum advertised in the header block. Usually this message indicates the wrong blocking factor, although it could indicate corrupt data on tape.<br/>
<strong>Action</strong><br/>
  To resolve this problem, make certain that the blocking factor you specify on the command line (after -b) matches the blocking factor originally specified. If in doubt, leave out the block size and let tar(1) determine it automatically. If that remedy does not help, the tape data could be corrupted.   </p>
<p><a href="https://unix.stackexchange.com/questions/96428/tar-ignore-or-fix-checksum">SE:tar-ignore-or-fix-checksum</a><br/>
  I'd try the <code>-i</code> switch to see if you can just ignore and messages regarding EOF.  </p>
<pre><code> -i, --ignore-zeros         ignore zeroed blocks in archive (means EOF)
</code></pre>
<p>Example </p>
<pre><code> $ tar xivf backup.tar
</code></pre>
<p><a href="https://bugs.python.org/file7237/tarfile-headererror.diff" rel="nofollow noreferrer">bugs.python.org:tarfile-headererror</a><br/>
  The comment in <code>tarfile.py</code> reads (Don't know the date of the file!):  </p>
<pre><code>-           # We shouldn't rely on this checksum, because some tar programs
-           # calculate it differently and it is merely validating the
-           # header block.
</code></pre>
</blockquote>
<hr/>
<blockquote>
<p>ReadError: unexpected end of data  </p>
</blockquote>
<hr/>
<blockquote>
<p>From the <a href="https://docs.python.org/3/library/tarfile.html#module-tarfile" rel="nofollow noreferrer">tarfile Documentation</a> </p>
<p>The <code>tarfile</code> module defines the following exceptions:<br/>
<strong><code>exception tarfile.ReadError</code></strong><br/>
      Is raised when a tar archive is opened, that either cannot be handled by the tarfile module or is somehow invalid.</p>
</blockquote>
<p>First, try with another tar archiv file <strong>to verify your python environent</strong>.<br/>
Second, check if your tar archiv file <strong>match the following format</strong>:</p>
<blockquote>
<p>tarfile.DEFAULT_FORMAT</p>
<p>The default format for creating archives. This is currently GNU_FORMAT.</p>
</blockquote>
<p>Third, instead of using <code>tarfile.open(...)</code>, to create a <code>tarfile</code> instance, try to use the following, to set <code>debug=3</code>.</p>
<pre><code>tar = tarfile.TarFile(name=filename, debug=3)
tar.open()
...
</code></pre>
<blockquote>
<p>class tarfile.TarFile(name=None, mode='r', fileobj=None, format=DEFAULT_FORMAT, tarinfo=TarInfo, dereference=False, ignore_zeros=False, encoding=ENCODING, errors='surrogateescape', pax_headers=None, debug=0, errorlevel=0)</p>
</blockquote>
</div>
<span class="comment-copy">Try like this Example <a href="https://docs.python.org/3/library/tarfile.html#tar-examples" rel="nofollow noreferrer">How to extract a subset</a></span>
<span class="comment-copy">Just did : ReadError: unexpected end of data</span>
<span class="comment-copy">I tried the debug=3 and I get : ReadError: bad checksum I know the tar is not corrupted. However I tried another compressed single file and same error occurs. I tried also a new virtualenv (python2.7) same problem. I can confirm I can uncompress the file manually</span>
<span class="comment-copy">Seems a python related problem. Are you able to switch to <b>Python 3.x</b>?</span>
<span class="comment-copy">yeah same problems even in Python 3</span>
<span class="comment-copy">Edit your Question and tell how the tar archiv ist created. I assume outside python OS version, tar version. The Python3 implementation are dated <b>2011</b>. It's worth trying <code>ignore_zeros=True</code>.</span>
<span class="comment-copy">I don't know how it is created . It's . a dataset from an institution I just posted the list of files I can see from the terminal using the 'tar -tvf' command.</span>
