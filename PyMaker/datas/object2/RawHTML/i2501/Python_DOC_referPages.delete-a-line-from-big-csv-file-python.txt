<div class="post-text" itemprop="text">
<p>I have an 11GB CSV file which has some corrupt lines I have to delete,  I have identified the corrupted lines numbers from an ETL interface.</p>
<p>My program runs with small datasets, however, when I want to run on the main file I'm getting MemoryError. Below the code I'm using Do you have any suggestion to make it work? </p>
<pre><code>row_to_delete = 101068
filename = "EKBE_0_20180907_065907 - Copy.csv"
with open(filename, 'r', encoding='utf8' ,errors='ignore') as file:
    data = file.readlines()
    print(data[row_to_delete -1 ])
    data [row_to_delete -1] = ''
with open(filename, 'wb',encoding="utf8",errors='ignore') as file:
    file.writelines( data )
</code></pre>
<p>Error:</p>
<pre><code>Traceback (most recent call last):
  File "/.PyCharmCE2018.2/config/scratches/scratch_7.py", line 7, in &lt;module&gt;
    data = file.readlines()
MemoryError
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>Rather than read the whole list into memory, <em>loop over the input file</em>, and write all lines <em>except</em> the line you need to delete to the a new file. Use <code>enumerate()</code> to keep a counter if you need to delete by index:</p>
<pre><code>row_to_delete = 101068
filename = "EKBE_0_20180907_065907 - Copy.csv"
with open(filename, 'r', encoding='utf8', errors='ignore') as inputfile,\
     open(filename + '.fixed', 'wb', encoding="utf8") as outputfile:
    for index, line in enumerate(inputfile):
        if index == row_to_delete:
            continue  # don't write the line that matches
        outputfile.writeline(line)
</code></pre>
<p>Rather than use an index, you could even detect a bad line directly in code this way.</p>
<p>Note that this writes to a new file, with the same name but with <code>.fixed</code> added.</p>
<p>You can move that file back to replace the old file if you want to, with <a href="https://docs.python.org/3/library/os.html#os.rename" rel="nofollow noreferrer"><code>os.rename()</code></a>, once you are done copying all but the bad line:</p>
<pre><code>os.rename(filename + '.fixed', filename)
</code></pre>
</div>
