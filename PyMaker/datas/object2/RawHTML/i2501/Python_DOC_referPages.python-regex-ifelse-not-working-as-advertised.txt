<div class="post-text" itemprop="text">
<div class="question-status question-originals-of-duplicate">
<p>This question already has an answer here:</p>
<ul>
<li>
<a dir="ltr" href="/questions/3994493/checking-whole-string-with-a-regex">Checking whole string with a regex</a>
<span class="question-originals-answer-count">
                    5 answers
                </span>
</li>
</ul>
</div>
<p>I'm trying to educate myself on how the <code>if|else</code> pattern matching works in python and so created the following test from the <a href="https://docs.python.org/3.6/library/re.html" rel="nofollow noreferrer">documentation</a>. As near as I can tell it's not working per documentation but I've learned to assume I missed a critical step somewhere.</p>
<p>In this test case the third item <strong>should</strong> fail because it's missing its closing '&gt;'.</p>
<pre><code>In [1]: import re, sys
In [2]: regex = re.compile('(&lt;)?(\w+@\w+(?:\.\w+)+)(?(1)&gt;|$)')
In [3]: cases  = ['&lt;user@host.com&gt;', 'user@host.com', '&lt;user@host.com', 'user@host.com&gt;']

In [4]: [ re.search(regex, _) and ("match:", _) or ("fail:", _) for _ in cases ]
Out[4]:
[('match:', '&lt;user@host.com&gt;'),
 ('match:', 'user@host.com'),
 ('match:', '&lt;user@host.com'),
 ('fail:', 'user@host.com&gt;')]

In [5]: sys.version
Out[5]: '3.6.5 |Anaconda custom (64-bit)| (default, Apr 26 2018, 08:42:37) \n[GCC 4.2.1 Compatible Clang 4.0.1 (tags/RELEASE_401/final)]'
</code></pre>
<p>Relevant:</p>
<blockquote>
<p><code>(?(id/name)yes-pattern|no-pattern)</code></p>
<p>Will try to match with <code>yes-pattern</code>
  if the group with given id or name exists, and with no-pattern if it
  doesnâ€™t. <code>no-pattern</code> is optional and can be omitted. For example,
  <code>(&lt;)?(\w+@\w+(?:\.\w+)+)(?(1)&gt;|$)</code> is a poor email matching pattern,
  which will match with '<code>&lt;user@host.com&gt;</code>' as well as '<code>user@host.com</code>',
  but not with '<code>&lt;user@host.com</code>' nor '<code>user@host.com&gt;</code>'.</p>
</blockquote>
<p>So my question is, what step did I miss? Tried on different python versions and hosts/os.</p>
</div>
<div class="post-text" itemprop="text">
<p>You're using <code>search</code>, asking whether the string <em>contains</em> a match for your regex, rather than asking whether it <em>is</em> a match. <code>&lt;user@host.com</code> contains a match, specifically <code>user@host.com</code>.</p>
<p>Use <a href="https://docs.python.org/3/library/re.html#re.fullmatch" rel="nofollow noreferrer"><code>fullmatch</code></a> rather than <code>search</code>.</p>
</div>
<span class="comment-copy">The problem isn't the <code>if|else</code>. The problem is that your regex needs an end-of-string anchor <code>$</code> or <code>\Z</code>.</span>
<span class="comment-copy">Not the cause of your problem, but you should really use <code>yes_case if condition else no_case</code> instead of <code>condition and yes_case or no_case</code>. It's less bug-prone, since it doesn't go to <code>no_case</code> when <code>yes_case</code> is falsy.</span>
<span class="comment-copy">Yeah - just wanted a quick demo...</span>
<span class="comment-copy">That was it.  Sigh. In an earlier iteration I'd tested <code>match</code> on a slightly different regex and didn't think to try it again with the original regex. Thanks!</span>
