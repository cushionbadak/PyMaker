<div class="post-text" itemprop="text">
<p>pySerial can be used with Python's <code>with</code> statement like this:</p>
<pre><code>with serial.Serial("/dev/ttyS1") as ser:
    ser.write("AAAA")
    ser.read(8)
</code></pre>
<p>I tried to see exactly what it is pySerial does to make this work, but I couldn't find an <code>__enter__</code> or <code>__exit__</code> function anywhere! I ran <code>grep -e '\(__enter__\)\|\(__exit__\)' *.py</code> from the pySerial directory, and grep didn't find either function. How does pySerial do it?</p>
<p><strong>Edit:</strong> I also tried the following to see what was called next:</p>
<pre><code>import serial, pdb
with serial.Serial("/dev/ttyUSB0") as ser:
    pdb.set_trace()
</code></pre>
<p>This brought me directly to line 433 of <code>serialposix.py</code>, the <code>close()</code> function. Does the <code>with</code> statement also look for <code>open()</code> and <code>close()</code> functions?</p>
</div>
<div class="post-text" itemprop="text">
<p><code>Serial</code> class doesn't implement these methods, it inherits them from <a href="https://docs.python.org/3/library/io.html?highlight=io.rawiobase#io.IOBase" rel="nofollow"><code>io.IOBase</code></a>. The relevant part from <a href="http://svn.code.sf.net/p/pyserial/code/trunk/pyserial/serial/serialposix.py" rel="nofollow">/serial/serialposix.py</a>:</p>
<pre><code>try:
    import io
except ImportError:
    # classic version with our own file-like emulation
    class Serial(PosixSerial, FileLike):
        pass
else:
    # io library present
    class Serial(PosixSerial, io.RawIOBase):
        pass
</code></pre>
</div>
<span class="comment-copy">Wild guess: it uses the <a href="https://docs.python.org/2/library/contextlib.html#contextlib.contextmanager" rel="nofollow noreferrer"><code>contextmanager</code></a> decorator.</span>
