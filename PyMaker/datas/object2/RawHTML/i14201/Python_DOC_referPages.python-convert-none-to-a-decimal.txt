<div class="post-text" itemprop="text">
<p>How would I convert a None object to a Decimal object in Python.</p>
<p>Code:</p>
<pre><code>c['suspended_amount'] = sum([owned_license.charge_amount for owned_license in log.owned_licenses.all()])
</code></pre>
<p>Error:</p>
<pre><code>TypeError: unsupported operand type(s) for +: 'decimal.Decimal' and 'NoneType'
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>Just skip those values:</p>
<pre><code>c['suspended_amount'] = sum(owned_license.charge_amount
                            for owned_license in log.owned_licenses.all() 
                            if owned_license.charge_amount)
</code></pre>
<p>I removed the <code>[..]</code> square brackets; <code>sum()</code> takes an iterable, which I supplied by using a <a href="https://docs.python.org/3/tutorial/classes.html#generator-expressions" rel="nofollow noreferrer">generator expression</a>. With the square brackets it is a <a href="https://docs.python.org/3/tutorial/datastructures.html#list-comprehensions" rel="nofollow noreferrer">list comprehension</a> instead, which will needlessly build a full list of all values first. Sum just needs the values one by one, they don't need to exist all at once up front.</p>
<p>Better yet, ask the database to only include those rows where <code>charge_amount</code> is not <code>NULL</code>:</p>
<pre><code>c['suspended_amount'] = sum(
    owned_license.charge_amount
    for owned_license in log.owned_licenses.exclude(charge_amount__isnull=True).all())
</code></pre>
<p>Best still, ask the database to do the summing for you:</p>
<pre><code>from django.db.models import Sum

c['suspended_amount'] = (
    log.owned_licenses.exclude(charge_amount__isnull=True)
        .aggregate(Sum('charge_amount'))['charge_amount__sum'])
</code></pre>
<p>See the <a href="https://docs.djangoproject.com/en/stable/topics/db/aggregation/" rel="nofollow noreferrer"><em>Aggregation</em> documentation</a>.</p>
</div>
<div class="post-text" itemprop="text">
<p>You can also use the 'or' operator:</p>
<pre><code>c['suspended_amount'] = sum([owned_license.charge_amount or 0 for owned_license in log.owned_licenses.all()])
</code></pre>
</div>
<span class="comment-copy">Also note that Martijn removed the square brackets (<code>[]</code>) from inside the <code>sum(...)</code> call. This prevents python from creating a list of all of those items, but just iterates over them, which could potentially be a big performance/memory improvement depending on the size of that list.</span>
