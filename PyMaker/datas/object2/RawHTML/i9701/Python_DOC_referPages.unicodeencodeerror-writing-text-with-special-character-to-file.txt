<div class="post-text" itemprop="text">
<p>I get a <code>UnicodeEncodeError</code> writing text with a special character to a file:</p>
<pre><code>  File "D:\SOFT\Python3\lib\encodings\cp1252.py", line 19, in encode
    return codecs.charmap_encode(input,self.errors,encoding_table)[0]
UnicodeEncodeError: 'charmap' codec can't encode character '\ufffd' in position 956: character maps to &lt;undefined&gt;
</code></pre>
<p>My code:</p>
<pre><code>expFile = open(expFilePath, 'w')
# data var is what contains a special char
expFile.write("\n\n" + data)
</code></pre>
<p>The data is probably some weird character from something like Microsoft Word that got pasted into the application's HTML form and it got persisted, now I am importing it. I can't even see it, shows as a diamond in my DB editor when I query it. It just has a placeholder in the text editor. The input should be more rigorously checked for character set compliance but it is not.</p>
<p>Is there a way to encode the data to make any character digestable for I/O processing?</p>
<p>Alternatively, is there a way to check whether my str is compliant to the character standard expected by file IO in order to do replacements of any data that violates it?</p>
</div>
<div class="post-text" itemprop="text">
<p>Your problem is that opening in text mode on your Windows system defaulted to the locale code page, <code>cp1252</code>, an ASCII superset that only encodes a tiny fraction of the Unicode range.</p>
<p>To fix, supply a more comprehensive encoding that can support the whole Unicode range; <code>open</code> accepts a keyword argument to override the default encoding, so it's as simple as changing:</p>
<pre><code>expFile = open(expFilePath, 'w')
</code></pre>
<p>to</p>
<pre><code>expFile = open(expFilePath, 'w', encoding='utf-8')
</code></pre>
<p>Depending on your needs, I'd choose either <code>utf-8</code> or <code>utf-16</code>; the former is more compact for mostly ASCII text, and is commonly seen everywhere, while the latter matches Microsoft's typical encoding for storing portable (non-locale dependent) text, so it's possible a few Windows-specific text editors would recognize it/handle it more easily.</p>
</div>
<span class="comment-copy">This is beside the point, but what exactly does <code>data</code> contain?</span>
<span class="comment-copy">If you really want to write arbitrary bytes, try <code>b</code> as a modifier for <code>open</code> to switch to binary mode.</span>
<span class="comment-copy">it's probably some weird character from something like Microsoft Word that got pasted into the application's HTML form and it got processed, now I am importing it. I can't even see it, shows as a diamond in my DB editor when I query it. It just has a placeholder in the text editor.  The input should be more rigorously checked for character set compliance but it is not</span>
<span class="comment-copy">That should be <code>expFile = open(expFilePath, 'w', encoding='UTF-8')</code>. Please check the <a href="https://docs.python.org/3/library/functions.html#open" rel="nofollow noreferrer">documentation for <code>open</code></a>.</span>
<span class="comment-copy">Give the upvote to ShadowRanger. He wrote a nice explanation and I'm not a point hunter anyway. ;-)</span>
