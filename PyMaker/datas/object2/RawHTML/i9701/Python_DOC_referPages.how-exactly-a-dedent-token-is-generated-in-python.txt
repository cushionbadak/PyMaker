<div class="post-text" itemprop="text">
<p>I am reading a documentation about <a href="https://docs.python.org/3/reference/lexical_analysis.html#lexical-analysis" rel="nofollow noreferrer">lexical analysis of python</a>,which described the course how INDENT and DEDENT tokens are generated.I post the description here.</p>
<blockquote>
<p>The indentation levels of consecutive lines are used to generate INDENT and DEDENT tokens, using a stack, as follows.</p>
<p>Before the first line of the file is read, a single zero is pushed on the stack; this will never be popped off again. The numbers pushed on the stack will always be strictly increasing from bottom to top. At the beginning of each logical line, the line’s indentation level is compared to the top of the stack. If it is equal, nothing happens. If it is larger, it is pushed on the stack, and one INDENT token is generated. If it is smaller, it must be one of the numbers occurring on the stack; all numbers on the stack that are larger are popped off, and for each number popped off a DEDENT token is generated. At the end of the file, a DEDENT token is generated for each number remaining on the stack that is larger than zero.</p>
</blockquote>
<p>I've tried to understand the DEDENT section,but failed to,could somebody give a better explanation than the referenced?</p>
</div>
<div class="post-text" itemprop="text">
<p>As Python sometimes is easier than English, here is a rough translation of this description to Python. You can see real-world parser (written by myself) that works like this <a href="https://github.com/ischurov/qqmbr/blob/master/qqmbr/ml.py" rel="nofollow noreferrer">here</a>.</p>
<pre><code>import re
code = """
for i in range(10):
   if i % 2 == 0:
     print(i)
   print("Next number")
print("That's all")

for i in range(10):
   if i % 2 == 0:
       print(i)
print("That's all again)

for i in range(10):
   if i % 2 == 0:
      print(i)
  print("That's all")
"""
def get_indent(s) -&gt; int:
    m = re.match(r' *', s)
    return len(m.group(0))
def add_token(token):
    print(token)
INDENT="indent"
DEDENT="dedent"
indent_stack = [0]
# Before the first line of the file is read, a single zero is pushed on the stack
for line in code.splitlines():
    print("processing line:", line)
    indent = get_indent(line)
    # At the beginning of each logical line, the line’s 
    # indentation level is compared to the top of the stack. 
    if indent &gt; indent_stack[-1]:
        # If it is larger, it is pushed on the stack, 
        # and one INDENT token is generated.
        add_token(INDENT)
        indent_stack.append(indent)
    elif indent &lt; indent_stack[-1]:
        while indent &lt; indent_stack[-1]:
            #  If it is smaller, ...
            # all numbers on the stack that are larger are popped off,
            # and for each number popped off a DEDENT token is generated.
            add_token(DEDENT)
            indent_stack.pop()
        if indent != indent_stack[-1]:
            # it must be one of the numbers occurring on the stack; 
            raise IndentationError
while indent_stack[-1]&gt;0:
     # At the end of the file, a DEDENT token is generated for each number 
     # remaining on the stack that is larger than zero.
     add_token(DEDENT)
     indent_stack.pop()
</code></pre>
<p>Here is the output:</p>
<pre><code>processing line: 
processing line: for i in range(10):
processing line:    if i % 2 == 0:
indent
processing line:      print(i)
indent
processing line:    print("Next number")
dedent
processing line: print("That's all")
dedent
processing line: 
processing line: for i in range(10):
processing line:    if i % 2 == 0:
indent
processing line:        print(i)
indent
processing line: print("That's all again)
dedent
dedent
processing line: 
processing line: for i in range(10):
processing line:    if i % 2 == 0:
indent
processing line:       print(i)
indent
processing line:   print("That's all")
dedent
dedent
  File "&lt;string&gt;", line unknown
IndentationError
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>Let's say that we have a source file that uses 4 spaces per indentation level, and that we are currently at the third level of indentation.  The contents of the indentation stack will be <code>[0, 4, 8, 12]</code> - the initial zero, plus each new indentation level as it was first encountered.  Now, consider the number of leading spaces on the next line of code...</p>
<ul>
<li>If it is 12 (matching the current top of the stack), there's no indentation change, nothing special happens.</li>
<li>If it's anything greater than 12, an INDENT token is generated, and the new value added to the stack.</li>
<li>If it's 8, one DEDENT token gets generated, and the 12 popped off the stack.</li>
<li>If it's 4, you get two DEDENTs, and both the 12 and 8 get popped.</li>
<li>If it's 0, or the source file ends at this point, you get three DEDENTs, and 12, 8, 4 get popped.</li>
<li>If it's anything else less than 12, an "inconsistent indentation" error is generated, as it's impossible to tell which previous level of code you've dedented to.</li>
</ul>
<p>Note that only lines with actual code are considered - if a line contains only whitespace or a comment, its amount of leading space is irrelevant.</p>
<p>The whole point of this process is that exactly one DEDENT gets generated to correspond to each INDENT, occurring at the point where the indentation level returns to (or goes below) the amount present before the corresponding INDENT.</p>
</div>
