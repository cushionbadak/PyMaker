<div class="post-text" itemprop="text">
<p>I'm trying to convert python code into dart. It has two parts. This is the first one:</p>
<pre><code>passw = (salt + password).encode('utf8')
ha = base64.b64encode(hashlib.sha512(passw).digest())
return ha.decode('utf8')
</code></pre>
<p>And this is the second one:</p>
<pre><code>l2 = hashlib.sha512((hash_level_1 + date).encode('utf8')).digest()
return base64.urlsafe_b64encode(l2).decode('utf8')
</code></pre>
<p>However, I got stuck when implementing the first bit of python code. Currently, I have this code:</p>
<pre><code>var passw = utf8.encode(computedSalt + password);
var sha512 = pointycastle.Digest("SHA-512");
var result = base64.encode(sha512.process(passw));
_key = utf8.decode(result);
</code></pre>
<p>But this doesn't work, because <code>base64.encode</code> provides string, and <code>utf8.decode</code> expects bytes. How do I translate the python code to dart? And what is converted into what at the last two lines of first python code? I'm confused about the conversion system and I'm not sure what to do.</p>
</div>
<div class="post-text" itemprop="text">
<p>I've fixed it.</p>
<pre><code>var passw = utf8.encode(computedSalt + password);
var sha512 = pointycastle.Digest("SHA-512");
var result = base64.encode(sha512.process(passw));
return result;
</code></pre>
<p>and</p>
<pre><code>var result = sha512.process(utf8.encode(_key + date));
return base64.encode(result)
</code></pre>
<p>did the magic.</p>
<p>In the first code, <code>passw</code> is in byte format, encoded via utf8. Then, I hash it with sha512 and encode into base64. The additional call in python code (<code>ha.decode('utf8')</code>) was not needed in dart.</p>
<p>In the second code block is basically the same as the first one. However, in some cases, python seems to encode base64 slightly different - it's probably the urlsafe variant. I temporarily solved it by replacing <code>+</code> by <code>-</code> and <code>/</code> by <code>_</code> in the result.</p>
</div>
<span class="comment-copy">Yep, that's exactly what the <code>urlsafe_b64encode</code> function does – <a href="https://docs.python.org/3/library/base64.html#base64.urlsafe_b64encode" rel="nofollow noreferrer">check the docs</a>. There you can also see that Python's base64 library consistently processes <code>bytes→bytes</code>, which is why you need the final <code>.decode('utf8')</code> to get a string.</span>
<span class="comment-copy">You can use the <a href="https://api.dartlang.org/stable/2.1.0/dart-convert/base64UrlEncode.html" rel="nofollow noreferrer"><code>base64UrlEncode</code></a> function to do URL-safe base64 encoding in Dart.</span>
