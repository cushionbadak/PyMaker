<div class="post-text" itemprop="text">
<p>I have a recursive directory. Both subdirectory and files names have illegal characters. I have a function to clean up the names, such as it replaces a space with an underscore in the name. There must be an easier way but I couldn't find a way to both rename folders and files. So, I want to rename the folders first.</p>
<pre><code>for path, subdirs, files in os.walk(root):
        for name in subdirs:     
            new_name=clean_names(name)
            name=os.path.join(path,name)
            new_name=os.path.join(path,new_name) 
            os.chdir(path)
            os.rename(name,new_name)
</code></pre>
<p>When I check my real folder and it contents I see that only the first subfolder name is corrected. I can see the reason because <code>os.chdir(path)</code> changes the cwd then it doesn't change back before for loop starts to second path. I thought after the os.rename I could rechange the cwd but I am sure there is a more elegant way to do this. If I remove the os.chdir line it gives filenotfound error.</p>
<p>I see that renaming subdirectories has been asked about before, but they are in command line. </p>
</div>
<div class="post-text" itemprop="text">
<p>You should use <code>os.walk(root, topdown=False)</code> instead; otherwise once the top folder gets renamed, <code>os.walk</code> won't have access to the subfolders because it can no longer find their parent folders.</p>
<p>Excerpt from the <a href="https://docs.python.org/3/library/os.html#os.walk" rel="nofollow noreferrer">documentation</a>:</p>
<blockquote>
<p>If optional argument <code>topdown</code> is <code>True</code> or not specified, the triple for
  a directory is generated before the triples for any of its
  subdirectories (directories are generated top-down). If <code>topdown</code> is
  <code>False</code>, the triple for a directory is generated after the triples for
  all of its subdirectories (directories are generated bottom-up). No
  matter the value of topdown, the list of subdirectories is retrieved
  before the tuples for the directory and its subdirectories are
  generated.</p>
</blockquote>
<p>Note that you do not need to call <code>os.chdir</code> at all because all the paths passed to <code>os.rename</code> are absolute.</p>
</div>
<span class="comment-copy">Your solution worked! Thank you very much!</span>
