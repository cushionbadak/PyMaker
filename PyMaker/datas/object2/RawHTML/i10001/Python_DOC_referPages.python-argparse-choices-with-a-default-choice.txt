<div class="post-text" itemprop="text">
<p>I'm trying to use argparse in a Python 3 application where there's an explicit list of choices, but a default if none are specified.</p>
<p>The code  I have is:</p>
<pre><code>parser.add_argument('--list', default='all', choices=['servers', 'storage', 'all'], help='list servers, storage, or both (default: %(default)s)') 
args = parser.parse_args()
print(vars(args))
</code></pre>
<p>However, when I run this I get the following with an option:</p>
<pre><code>$ python3 ./myapp.py --list all
{'list': 'all'}
</code></pre>
<p>Or without an option:</p>
<pre><code>$ python3 ./myapp.py --list
usage: myapp.py [-h] [--list {servers,storage,all}]
myapp.py: error: argument --list: expected one argument
</code></pre>
<p>Am I missing something here? Or can I not have a default with choices specified?</p>
</div>
<div class="post-text" itemprop="text">
<p>Pass the <code>nargs</code> and <code>const</code> arguments to <code>add_argument</code>:</p>
<pre><code>parser.add_argument('--list',
                    default='all',
                    const='all',
                    nargs='?',
                    choices=['servers', 'storage', 'all'],
                    help='list servers, storage, or both (default: %(default)s)')
</code></pre>
<p>If you want to know if <code>--list</code> was passed without an argument, remove the <code>const</code> argument, and check if <code>args.list</code> is <code>None</code>.</p>
</div>
<div class="post-text" itemprop="text">
<p>Thanks @ShadowRanger.  <code>Subcommands</code> is exactly what I need, combined with <code>nargs</code> and <code>const</code>.  The following works:</p>
<pre><code>parser = argparse.ArgumentParser()
subparser = parser.add_subparsers()
parser_list = subparser.add_parser('list')
parser_list.add_argument('list_type', default='all', const='all', nargs='?', choices=['all', 'servers', 'storage'])

parser_create = subparser.add_parser('create')
parser_create.add_argument('create_type', default='server', const='server', nargs='?', choices=['server', 'storage'])

args = parser.parse_args()
pprint(vars(args))

$ python3 ./myapp.py -h
usage: dotool.py [-h] {list,create} ...

Digital Ocean tool

positional arguments:
  {list,create}

optional arguments:
  -h, --help     show this help message and exit
</code></pre>
<p>list option alone:</p>
<pre><code>$ python3 ./myapp.py list
{'list_type': 'all'}
</code></pre>
<p>List option with a parameter:</p>
<pre><code>$ python3 ./myapp.py list servers
{'list_type': 'servers'}
</code></pre>
</div>
<span class="comment-copy">Don't pass <code>--list</code> at all and your default will be used.</span>
<span class="comment-copy">I see... That'd work except for the fact that I need to tell it to list, create, delete, etc.</span>
<span class="comment-copy">Sounds like you want <a href="https://docs.python.org/3/library/argparse.html#sub-commands" rel="nofollow noreferrer">subcommands</a>, not a switch at all. Even with <code>nargs='?'</code> you can't tell the difference between <code>--list</code> and not passing anything when there is a default set.</span>
