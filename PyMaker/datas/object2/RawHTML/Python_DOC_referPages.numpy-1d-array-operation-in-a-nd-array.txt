<div class="post-text" itemprop="text">
<p>Let's say we have a 4D-array A of shape (n, m, g, h) and a 1D-array B of shape (n).</p>
<p>So I want to do a power operation for every 3D sub-array of A (m, g, h) with every element of B (which is an int).</p>
<pre><code>A = np.arange(24).reshape(3, 2, 2, 2)
&gt;&gt;&gt;array([[[[ 0,  1],
         [ 2,  3]],

        [[ 4,  5],
         [ 6,  7]]],


       [[[ 8,  9],
         [10, 11]],

        [[12, 13],
         [14, 15]]],


       [[[16, 17],
         [18, 19]],

        [[20, 21],
         [22, 23]]]]
B = np.arange(3)
&gt;&gt;&gt;array([0, 1, 2])
</code></pre>
<p>The result that I want is:</p>
<pre><code>C = somefunc(A, B) # just an example, can be anything
&gt;&gt;&gt;array([[[[ (ignore, 0^0),  1],
         [ 1,  1]],

        [[ 1,  1],
         [ 1,  1]]],


       [[[ 8,  9],
         [10, 11]],

        [[12, 13],
         [14, 15]]],


       [[[256, 289],
         [324, 361]],

        [[400, 441],
         [484, 529]]]]
</code></pre>
<p>What is the best way to get the desired result?</p>
<p>I thought about something like:</p>
<pre><code>A = [np.power(A[i, :, :, :], B[i]) for i in range(B.size)]
</code></pre>
<p>But that would be quite inefficient if B.size is a big number. Any other ideas?</p>
</div>
<div class="post-text" itemprop="text">
<p>This will work:</p>
<pre><code>C = A ** B[:,None,None,None]
print (C)
</code></pre>
<p><strong>Output:</strong></p>
<pre><code>[[[[  1   1]
   [  1   1]]

  [[  1   1]
   [  1   1]]]


 [[[  8   9]
   [ 10  11]]

  [[ 12  13]
   [ 14  15]]]


 [[[256 289]
   [324 361]]

  [[400 441]
   [484 529]]]]
</code></pre>
</div>
<span class="comment-copy">What is inefficient of <code>A = [np.power(A[i, :, :, :], b) for b in B)]</code> ? The <code>a**b</code> is necessary even if <code>b</code> is big.</span>
<span class="comment-copy"><code>np.power(A, B[:,None,None,None])</code> - that is, expand the dimensions of <code>B</code> so it broadcasts with <code>A</code>.</span>
<span class="comment-copy">Or <code>(A.T**B).T</code>.</span>
