<div class="post-text" itemprop="text">
<p>I'm trying to write a page in Django which gets start and finish times for a certain task using JavaScript and POSTs it using AJAX. Since JavaScript doesn't seem to have a very good way of formatting dates, I'm sending just sending a date string like <code>Fri May 13 2016 22:00:56 GMT-0600 (MDT)</code> to be parsed as a string by Python.</p>
<p>Here is my function for parsing the string:</p>
<pre><code>def get_js_date(string):
    date = datetime.datetime.strptime(string, '%a %b %d %Y %H:%M:%S GMT%z (%Z)')
    return date.strftime("%Y-%m-%d %H:%M:%S %Z")
</code></pre>
<p>And the view uses it like so:</p>
<pre><code>def review_new(request):                                                                                                                                                                                            
    if request.method == 'POST':                                                                                                                                                                                    
        review = Review(                                                                                                                                                                                            
            user = request.user,                                                                                                                                                                                    
            start = get_js_date(request.POST.get('start')),                                                                                                                                                         
            finish = get_js_date(request.POST.get('finish'))                                                                                                                                                        
        )                                                                                                                                                                                                           
        review.save()
</code></pre>
<p>When I import the function in the Python REPL, it works just fine:</p>
<pre><code>&gt;&gt;&gt; from checks.utilities import get_js_date
&gt;&gt;&gt; get_js_date('Fri May 13 2016 22:00:56 GMT-0600 (MDT)')
'2016-05-13 22:00:56 MDT'
</code></pre>
<p>But when I run it through <code>./manage.py shell</code>, it breaks:</p>
<pre><code>&gt;&gt;&gt; from checks.utilities import get_js_date
&gt;&gt;&gt; get_js_date('Fri May 13 2016 22:00:56 GMT-0600 (MDT)')
Traceback (most recent call last):
  File "/home/phin/virtualenvs/testenv/lib/python3.5/site-packages/django/core/management/commands/shell.py", line 69, in handle
    self.run_shell(shell=options['interface'])
  File "/home/phin/virtualenvs/testenv/lib/python3.5/site-packages/django/core/management/commands/shell.py", line 61, in run_shell
    raise ImportError
ImportError

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "&lt;console&gt;", line 1, in &lt;module&gt;
  File "/home/phin/grappleshark/checks/utilities.py", line 4, in get_js_date
    date = datetime.datetime.strptime(string, '%a %b %d %Y %H:%M:%S GMT%z (%Z)')
  File "/usr/lib64/python3.5/_strptime.py", line 500, in _strptime_datetime
    tt, fraction = _strptime(data_string, format)
  File "/usr/lib64/python3.5/_strptime.py", line 337, in _strptime
    (data_string, format))
ValueError: time data 'Fri May 13 2016 22:00:56 GMT-0600 (MDT)' does not match format '%a %b %d %Y %H:%M:%S GMT%z (%Z)'
</code></pre>
<p>Something about the Django environment seems to be breaking everything, and I can't seem to find what it is. Am I missing something obvious? Any suggestions would be appreciated.</p>
</div>
<div class="post-text" itemprop="text">
<p>I think you are hitting <a href="http://bugs.python.org/issue22377" rel="nofollow">this bug</a> in Python:</p>
<blockquote>
<p>The documentation for <a href="https://docs.python.org/3/library/datetime.html#strftime-strptime-behavior" rel="nofollow">%Z</a> says it matches <code>EST</code> among others, but in practice it doesn't.</p>
</blockquote>
<p>Further down in the thread someone points out that:</p>
<blockquote>
<p>Looking at the code, the only timezone strings it recognizes are utc, gmt, and whatever is in time.tzname (EST and EDT, in my case).</p>
</blockquote>
<p>(which might be why it works for you in REPL.)</p>
<p>The <code>MDT</code> timezone name is what it causing it to fail. You can confirm this by stripping it out. Try running this in Django shell and it will work:</p>
<pre><code>datetime.datetime.strptime('Fri May 13 2016 22:00:56 GMT-0600', 
                           '%a %b %d %Y %H:%M:%S GMT%z')
</code></pre>
<p>Possible solutions: strip out the last part of the time string before attempting to parse it; or use <a href="http://labix.org/python-dateutil" rel="nofollow">dateutil</a> which works well:</p>
<pre><code>from dateutil import parser
parser.parse('Fri May 13 2016 22:00:56 GMT-0600 (MDT)')
</code></pre>
</div>
<span class="comment-copy">You can use the moment.js library to format dates in JS.</span>
<span class="comment-copy">That must be it. Plain Python had time.tzname set to <code>('MST', 'MDT')</code>. Django had it set to <code>('UTC', 'UTC')</code>. Dateutil also seems like it could be very useful. Thanks!</span>
