<div class="post-text" itemprop="text">
<p>How can I check if a FTP server allows for TLS when I connect using ftplib? I Found easy documentation on how to use TLS, but no solution on how to check for it. My script is supposed to connect either way, but use TLS if possible.</p>
<p>So do I just connect using TLS and if it fails I do it without? I am sure there must be a better way.</p>
<p>Thank you for your help.</p>
</div>
<div class="post-text" itemprop="text">
<p><em>Note that trying an encryption only, is <strong>as bad as not using any encryption at all</strong>. And maybe even worse, as it gives an impression of security, while there's none.</em></p>
<p><em>When you are under an MITM attack, an attacker will divert a TCP traffic to him/her and simulate encryption rejection, making you send your credentials plain-text straight to the attacker.</em></p>
<hr/>
<p>Anyway:</p>
<ul>
<li><p>Call <a href="https://docs.python.org/3/library/ftplib.html#ftplib.FTP_TLS.auth" rel="nofollow noreferrer"><code>FTP_TLS.auth</code></a>, check if it throws or not.</p></li>
<li><p>Call <a href="https://hg.python.org/cpython/file/v3.4.6/Lib/ftplib.py#l742" rel="nofollow noreferrer"><code>FTP_TLS.login</code> with <code>secure=False</code></a>.</p></li>
</ul>
<p>If the server supports TLS, the <code>FTP_TLS.auth</code> will enable encryption and the <code>FTP_TLS.login</code> (even with <code>secure=False</code>) will continue using it. If the server does not support encryption, the <code>FTP_TLS.login</code> (with <code>secure=False</code>) continues unencrypted.</p>
<p><em>Note that <code>FTP_TLS.login</code> (with its <code>secure</code> parameter) is an undocumented method - If you do not want to use it, you can fallback to creating a plain <a href="https://docs.python.org/3/library/ftplib.html#ftplib.FTP" rel="nofollow noreferrer"><code>FTP</code></a>, when <code>FTP_TLS.auth</code> throws.</em></p>
<hr/>
<p>To check explicitly, you can also use <a href="https://docs.python.org/3/library/ftplib.html#ftplib.FTP.voidcmd" rel="nofollow noreferrer"><code>FTP.voidcmd('FEAT')</code></a> and look for <code>AUTH TLS</code> (or <code>AUTH SSL</code>) in the response.</p>
<p>But there's nothing wrong about trying <code>AUTH TLS</code>/<code>AUTH SSL</code> (what the <code>FTP_TLS.auth</code> does) straight away.</p>
</div>
<span class="comment-copy">The docs do not mention "secure=False" <a href="https://docs.python.org/2.7/library/ftplib.html" rel="nofollow noreferrer">docs.python.org/2.7/library/ftplib.html</a> . Is that depricated?</span>
<span class="comment-copy">While it's not documented, it's there: <a href="https://hg.python.org/cpython/file/2.7/Lib/ftplib.py#l667" rel="nofollow noreferrer">hg.python.org/cpython/file/2.7/Lib/ftplib.py#l667</a>. And anyway with <code>secure=False</code> it's the same as calling the documented <code>FTP.login(self, user = '', passwd = '', acct = '')</code>.</span>
