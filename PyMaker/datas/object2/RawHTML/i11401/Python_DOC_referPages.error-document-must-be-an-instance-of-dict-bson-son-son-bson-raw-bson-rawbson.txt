<div class="post-text" itemprop="text">
<p>Tried to store twitter stream data into MongoDB. The code is pretty much a copy from <a href="http://stats.seandolinar.com/collecting-twitter-data-storing-tweets-in-mongodb/" rel="nofollow">http://stats.seandolinar.com/collecting-twitter-data-storing-tweets-in-mongodb/</a>  but always show an error. If I tried to print out the data, it shown json file continuously grow, but it seems never ends in spite of the time limit for the while loop.!</p>
<pre><code>class listener(StreamListener):

    def __init__(self, start_time, time_limit=60):     
        self.time = start_time
        self.limit = time_limit

    def on_data(self, data):     
        while (time.time() - self.time) &lt; self.limit:    
            try:
                tweet = json.loads(data)
                client = MongoClient('localhost', 27017)
                db = client['twitter_db']
                collection = db['twitter_collection']
                collection.insert_many(tweet)
                return True
            except BaseException, e:
                print 'failed ondata,', str(e)
                time.sleep(5)
                pass
                exit()

    def on_error(self, status):
        print statuses
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>You are using the wrong method to insert the document into your collection. In your case, <a href="https://docs.python.org/3/library/json.html#json.loads" rel="nofollow"><code>json.loads</code></a> returns a dictionary not a <code>list</code> thus you need to use the <a href="http://api.mongodb.com/python/current/api/pymongo/collection.html#pymongo.collection.Collection.insert_one" rel="nofollow"><code>insert_one</code></a> method to insert that single document because <a href="http://api.mongodb.com/python/current/api/pymongo/collection.html#pymongo.collection.Collection.insert_many" rel="nofollow"><code>insert_many</code></a> only insert an iterable of documents.</p>
</div>
<span class="comment-copy">What is the output of <code>type(tweet)</code>?</span>
<span class="comment-copy">its dictionary type</span>
<span class="comment-copy">I changed it. it did not show the same error but seems still to take forever to run in spite of the time limit for while loop.</span>
