<div class="post-text" itemprop="text">
<pre><code> #####################################
 # Command code
 ####################################
import shlex
import subprocess


class CommandError(Exception):
   pass


class Command(object):
"""
Class to simplify the process of running a command and getting the output
and return code
"""
    def __init__(self, command=None):
       self.command = command
       self.args = None
       self.subprocess = None
       self.output = None
       self.errors = None
       self.status = None
       self.result = None

   def run(self, command=None):
       if command is not None:
           self.command = command
       if self.command is None:
           raise CommandError('No command specified')
       self.args = shlex.split(self.command)
       self.subprocess = subprocess.Popen(self.args,
                                       stdout=subprocess.PIPE,
                                       stderr=subprocess.PIPE)
       self.output, self.errors = self.subprocess.communicate()
       self.subprocess.wait(60)
       self.status = self.subprocess.returncode
       self.result = (0 == self.status)
       return self.result

   def A(X, logger,device_name,ip_address,value_type, value):
       command_string = "my_command" 
       cmd = Command(command_string)
       time.sleep(1.0)
       if not cmd.run():
           logger.error("cmd.errors = %s", device_name, cmd.errors.rstrip())
       elif 'No Such Instance' in cmd.output:
           logger.error("cmd.output = %s", device_name, cmd.output.rstrip())
       else:
            result = True
            return result
</code></pre>
<p>I added a self.subprocess.wait(60) for 60 seconds for my commands to run with a timeout value specified. </p>
<p>But it is throwing the following error ::<strong>self.subprocess.wait(60)
TypeError: wait() takes exactly 1 argument (2 given)</strong></p>
<p>What is the problem with the code? Can anyone point out the issue? </p>
</div>
<div class="post-text" itemprop="text">
<p>You have to change the code inside <code>class Command</code>, maybe <code>Command.run()</code>, to do its job <strong>without blocking the script execution</strong>. There is no good way to do what you ask, without knowing exactly what that class does. </p>
<p>The solutions (Threads, Processes, Asynchronous code) all depend on the specifics of your blocking code and can't be generally recommended with certain.</p>
<p>EDIT:
Now that you added the <code>Command</code> class, we can examine which part is blocking. In your code the part that blocks is this line:</p>
<pre><code>self.subprocess.wait()
</code></pre>
<p>Luckly that function has a <code>timeout</code> parameter as you can see in the <a href="https://docs.python.org/3/library/subprocess.html#subprocess.Popen.wait" rel="nofollow noreferrer"><code>subprocess</code> module documentation</a>.</p>
<pre><code>self.subprocess.wait(60)
</code></pre>
<p>That will automatically wait for 60 seconds and throw an error if it fails, as you asked.</p>
<p>EDIT 2:</p>
<p>The error you're now getting means your version of python doesn't have the timeout parameter. Which version of python are you using? As you can see in the documentation linked above, you need at least python 3.3 to use it.</p>
</div>
<span class="comment-copy">What kind of thing is <code>Command</code> and what does its <code>run</code> method do?</span>
<span class="comment-copy">Possible duplicate of <a href="https://stackoverflow.com/questions/492519/timeout-on-a-function-call">Timeout on a function call</a></span>
<span class="comment-copy">the Class command uses subprocess, a process of running a command and getting the output and return code</span>
<span class="comment-copy">@mkrieger1 can you help me out here? I have pasted the Command.run program here. I need to run with timeout=60 seconds.</span>
<span class="comment-copy">See also <a href="https://stackoverflow.com/questions/1191374/using-module-subprocess-with-timeout" title="using module subprocess with timeout">stackoverflow.com/questions/1191374/â€¦</a></span>
<span class="comment-copy">I added the self.subprocess.wait(60) .. Now I'm facing the error as follows  TypeError: wait() takes exactly 1 argument (2 given). How do I solve this? Can you paste the code for me?</span>
<span class="comment-copy">Did you read the documentation? The parameter is there since python 3.3 are you using it? The code is correct and works fine in my tests.</span>
