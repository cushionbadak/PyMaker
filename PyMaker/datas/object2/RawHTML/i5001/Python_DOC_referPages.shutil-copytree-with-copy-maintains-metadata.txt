<div class="post-text" itemprop="text">
<p>I am trying to copy a directory to a new location. When it arrives in the new location, I want the last modified date for the new directory to be the time that it was copied to the new location.</p>
<p>Looking at the documentation (<a href="https://docs.python.org/3/library/shutil.html" rel="nofollow noreferrer">https://docs.python.org/3/library/shutil.html</a> I am using python 3.6), shutil.copytree takes an argument "copy_function" which is "shutil.copy2" by default so as to maintain most metadata (like the modified date). However changing this to "shutil.copy" i.e:</p>
<pre><code>shutil.copytree(src, dst, symlinks=False, ignore=None, copy_function=shutil.copy, ignore_dangling_symlinks=False)
</code></pre>
<p>appears to still maintain the modified date of the original file. Even though shutil.copy() should not maintain metadata beyond file permissions according to the documentation.</p>
<p>Interestingly, watching the destination of the copy, I can see that the directory momentarily has its modified date set to the current time before being reverted to the modified date of the source directory.</p>
<p>Thanks in advance for any help.</p>
</div>
<div class="post-text" itemprop="text">
<p>If you are trying to prevent directories from having their metadata copied, this is unavoidable.  The <code>copy_function</code> is not called for directories in the first place, so changing it has no effect.  <code>copytree</code> always calls <a href="https://docs.python.org/3/library/shutil.html#shutil.copystat" rel="nofollow noreferrer"><code>copystat()</code></a> on each directory in the tree, as can be seen <a href="https://github.com/python/cpython/blob/3.6/Lib/shutil.py#L353" rel="nofollow noreferrer">in its source code</a>.  Note that this does not happen for files, because the function only recurses on directories (so the only way <code>src</code> will point to a regular file is if you pass a file as the argument).</p>
<p>If you're really desperate to make this work, you could <a href="https://en.wikipedia.org/wiki/Monkey_patch" rel="nofollow noreferrer">monkey patch</a> <code>copystat()</code> to do nothing, but I would hardly consider that a robust solution.  It would be much safer to <a href="https://docs.python.org/3/library/os.html#os.walk" rel="nofollow noreferrer">walk</a> the destination directory structure and use <a href="https://docs.python.org/3/library/os.html#os.utime" rel="nofollow noreferrer"><code>os.utime()</code></a> to reset each directory's modification time manually.</p>
<p>If you are trying to prevent files from having their metadata copied, I am unable to reproduce your problem:</p>
<pre><code>kevin@instance-1 ~ % mkdir foo
kevin@instance-1 ~ % mkdir foo/bar
kevin@instance-1 ~ % touch foo/bar/baz --date 19700101    
kevin@instance-1 ~ % ls -l foo/bar/baz
-rw-r--r-- 1 kevin kevin 0 Jan  1  1970 foo/bar/baz
kevin@instance-1 ~ % python3
Python 3.5.3 (default, Jan 19 2017, 14:11:04) 
[GCC 6.3.0 20170118] on linux
Type "help", "copyright", "credits" or "license" for more information.
&gt;&gt;&gt; import shutil
&gt;&gt;&gt; shutil.copytree('./foo', './qux', symlinks=False, ignore=None, copy_function=shutil.copy, ignore_dangling_symlinks=False)
'./qux'
&gt;&gt;&gt; 
kevin@instance-1 ~ % ls -l qux/bar/baz 
-rw-r--r-- 1 kevin kevin 0 Feb 23 05:04 qux/bar/baz
</code></pre>
</div>
<span class="comment-copy">You probably what <code>shutil.copyfile</code> rather than <code>shutil.copy</code>.</span>
<span class="comment-copy">@Waylan I've tried using  <code>shutil.copytree(src, dst, symlinks=False, ignore=None, copy_function=shutil.copyfile, ignore_dangling_symlinks=False)</code> but it yields the same result</span>
<span class="comment-copy">Thanks for the insight. I've taken to using <code>os.utime()</code> to edit the <b>st_mtime</b> value of the directory in question to the current time using <code>time.time()</code> after I've copied it to its new location.</span>
