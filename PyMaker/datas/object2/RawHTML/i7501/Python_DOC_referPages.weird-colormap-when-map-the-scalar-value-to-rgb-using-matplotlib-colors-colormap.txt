<div class="post-text" itemprop="text">
<p>I am trying to get RGB hex strings from a input scalar given a specific matplot lib colormap. I use matplotlib.get_cmap() to get the matplotlib.colors.Colormap object, and pass a scalar withing range (0, 1) to this map to get the RGBA value then plot that color. But sometimes the colors gets plotted are different from those plotted by imshow(). Am I doing something stupid here?</p>
<p><strong>Code for reproduction</strong></p>
<pre><code>import matplotlib.pyplot as plt
import numpy as np
plt.ioff()

cmap = 'RdBu_r'
cmap = plt.get_cmap(cmap)

f = plt.figure(figsize=(8, 4))
ax1 = f.add_subplot(121)
ax2 = f.add_subplot(122)
plot_arr = np.arange(100).reshape((10, 10)) / 99.
ax1.imshow(plot_arr, vmin=0., vmax=1., cmap=cmap, interpolation='nearest')

for i in range(10):
    for j in range(10):
        curr_rgb = cmap(plot_arr[i, j])[0:3]
        curr_rgb = tuple([int(x * 255) for x in curr_rgb])
        r, g, b = curr_rgb
        curr_cstr = '#{:0&lt;2}{:0&lt;2}{:0&lt;2}'.format(hex(r)[2:], hex(g)[2:], hex(b)[2:])
        ax2.plot(j, i, 'o', mfc=curr_cstr, lw=0, mec='none', ms=20)

ax2.set_xlim([-0.5, 9.5])
ax2.set_ylim([9.5, -0.5])
plt.show()
</code></pre>
<p><strong>Actual outcome</strong><br/>
<a href="https://i.stack.imgur.com/k4QQc.png" rel="nofollow noreferrer">output image</a></p>
<p><strong>Expected outcome</strong>
As implemented in the code, the left plot is plotted as imshow(). Right plot is plotted dots with the color from the colormap object according to the input scalar. If my understanding is right, the colors at the same grid cell should be identical. But clearly different at high and low values. </p>
<p><strong>Matplotlib version</strong><br/>
    Operating System: windows 7 64-bit<br/>
    Matplotlib Version: 2.0.2<br/>
    Python Version: 3.5.3<br/>
    numpy: 1.13.0  </p>
</div>
<div class="post-text" itemprop="text">
<p>In your format function, you're left aligning, not right aligning, causing the weird value jumps.  See this line:</p>
<pre><code>curr_cstr = '#{:0&lt;2}{:0&lt;2}{:0&lt;2}'.format(hex(r)[2:], hex(g)[2:], hex(b)[2:])
</code></pre>
<p>And the docs for <a href="https://docs.python.org/3/library/string.html#format-string-syntax" rel="nofollow noreferrer"><code>format</code></a>.  Fixed version:</p>
<pre><code>import matplotlib.pyplot as plt
import numpy as np
plt.ioff()

cmap = 'RdBu_r'
cmap = plt.get_cmap(cmap)

f = plt.figure(figsize=(8, 4))
ax1 = f.add_subplot(121)
ax2 = f.add_subplot(122)
plot_arr = np.arange(100).reshape((10, 10)) / 99.
ax1.imshow(plot_arr, vmin=0., vmax=1., cmap=cmap, interpolation='nearest')

for i in range(10):
    for j in range(10):
        curr_rgb = cmap(plot_arr[i, j])[0:3]
        curr_rgb = tuple([int(x * 255) for x in curr_rgb])
        r, g, b = curr_rgb
        curr_cstr = '#{:0&gt;2}{:0&gt;2}{:0&gt;2}'.format(hex(r)[2:], hex(g)[2:], hex(b)[2:])
        ax2.plot(j, i, 'o', mfc=curr_cstr, lw=0, mec='none', ms=20)

ax2.set_xlim([-0.5, 9.5])
ax2.set_ylim([9.5, -0.5])
plt.show()
</code></pre>
<p>Note the incorrect RGB to hex conversions in your original:</p>
<pre><code>if i==9: print i ,j, curr_rgb, curr_cstr

9 0 (170, 21, 41) #001500
9 1 (161, 18, 40) #001200
9 2 (155, 16, 39) #001000
9 3 (147, 14, 38) #00e000
9 4 (138, 11, 36) #00b000
9 5 (132, 9, 35) #009000
9 6 (123, 6, 34) #006000
9 7 (117, 4, 33) #004000
9 8 (108, 1, 31) #001000
9 9 (103, 0, 31) #000000
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>While the other answer explain well why the code from the question fails, I would like to note that there is no need to convert colors to hex at all and you may directly use the colormap to colorize the points in the plot.</p>
<p>You may either decide to loop over the points and directly supply the applied colormap value to the <code>color</code> argument of the plot. (middle plot)</p>
<p>Or you may use a scatter plot and supply the <code>plot_arr</code> to its <code>c</code> argument, together with the colormap, and, if needed, a normalization. (right plot)</p>
<p><a href="https://i.stack.imgur.com/pWin0.png" rel="nofollow noreferrer"><img alt="enter image description here" src="https://i.stack.imgur.com/pWin0.png"/></a></p>
<pre><code>import matplotlib.pyplot as plt
import numpy as np

cmapname = 'RdBu_r'
cmap = plt.get_cmap(cmapname)

plot_arr = np.arange(100).reshape((10, 10)) / 99.

fig, (ax1,ax2,ax3) = plt.subplots(ncols=3, figsize=(9, 3.5),subplot_kw={"aspect":"equal"})

ax1.set_title("image")
ax1.imshow(plot_arr, vmin=0., vmax=1., cmap=cmap, interpolation='nearest')

ax2.set_title("plot in loop")
for i in range(10):
    for j in range(10):
        ax2.plot(j, i, 'o', color=cmap(plot_arr[i, j]), lw=0, mec='none', ms=10)

ax2.set_ylim([9.5, -0.5])

ax3.set_title("scatter")
x = np.arange(0,10)
X,Y = np.meshgrid(x,x)
ax3.scatter(X,Y,c=plot_arr, s=100, vmin=0., vmax=1., cmap='RdBu_r', edgecolors="none")
ax3.set_ylim([9.5, -0.5])

plt.show()
</code></pre>
</div>
<span class="comment-copy">Thank you for finding the bug! This working!</span>
<span class="comment-copy">Thank you for providing this comment. It can simplify my code a lot!</span>
<span class="comment-copy">agreed, +1 from me!</span>
