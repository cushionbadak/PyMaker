<div class="post-text" itemprop="text">
<p>I want to subtract the cell values from one column with cell values from another column and write the sum to a new column in an excel file. Then I want the sum, if not equal to 0, to be added to a list for later use. The data in my excel file are structured like this:</p>
<pre><code>Name | Number | Name1 | Number1
Name2 | Number2 | Name3 | Number3
....
Namex | Numberx | Namey |Numbery
</code></pre>
<p>I want to subtract the numbers from each other and then add the sum to a new column like this:</p>
<pre><code>Name| Number | Name1 | Number1 | Sum of (Number - Number1)
</code></pre>
<p>I have tried to use openpyxl to do this, but I am really confused because the docs are so different from earlier versions of Python to newer. I am working in Python 3.4. I am happy to get suggestions on which module you would recommend me using.
The code I have so far is giving me errors because I am calling the excelfile as a generator, not a subscriptable. I am not sure how to search and read an excelfile and at the same time make it subscriptable so that it is possible to write to it. Could anyone please help me?</p>
<p>Here is my code:</p>
<pre><code>from openpyxl import Workbook, load_workbook

def analyzexlsx(filepath):
    numbers = []
    excel_input = load_workbook(filepath)
    filepath = [pth for pth in Path.cwd().iterdir()
                  if pth.suffix == '.xlsx'] #Want to iterate through several excel files in a folder.
    ws = excel_input.active
    cols = tuple(ws.columns)
    col_b = cols[1] 
    col_e = cols[4] 
    for j, k in zip(col_e, col_b): 
        if None:
            print('None')
        equally = (int(j.value) - int(k.value)) #line 13, error. Trying to subtract column cell values.
        if equally != 0: #If the columns sum is not equal to 0, it is to be added to the numbers list.
            numbers.append(j.row)

        else:
            pass

    col1 = []
    col2 = []
    col4 = []
    col5 = []
    col7 = []
    col8 = []

    mainlist = []
    try:
        for row in numbers:
            col1.append(str(ws.cell(row=row, column=1).value))
            col2.append(str(ws.cell(row=row, column=2).value))
            col4.append(ws.cell(row=row, column=4).value)
            col5.append(ws.cell(row=row, column=5).value)
            col7.append(ws.cell(row=row, column=7).value)
            col8.append(ws.cell(row=row, column=8).value)
    finally:
        for i, j, k, l, m, n in zip(col1, col2, col4, col5, col7, col8):
            mainlist.append(i + ", " + j + ", " + k + ", " + l + ", " + m + ", " + n)
    return mainlist

Traceback (most recent call last):
    Line 13, in analyzexlsx
        equally = (int(j.value) - int(k.value))
    TypeError: int() argument must be a string or a number, not 'NoneType
</code></pre>
<p>I would be really happy for answers as I have worked on this for quite a while and now I am stuck. I am fairly new to Python. </p>
</div>
<div class="post-text" itemprop="text">
<p>First create <code>DataFrame</code> from excel by <a href="http://pandas.pydata.org/pandas-docs/stable/generated/pandas.read_excel.html" rel="nofollow noreferrer"><code>read_excel</code></a>.</p>
<p>Then need substract <code>2.</code> with <code>4</code> columns:</p>
<pre><code>df = pd.read_excel('file.xlsx')

#select by column name
df['E'] = df['B'] - df['D']
</code></pre>
<hr/>
<pre><code>#select by positions, but python count from 0 so for 2. column need 1
df['E'] = df.iloc[:, 1] - df.iloc[:, 3]
</code></pre>
<p>Maybe also help check <a href="http://pandas.pydata.org/pandas-docs/stable/io.html#io-excel-reader" rel="nofollow noreferrer">documentation</a>.</p>
</div>
<span class="comment-copy">Can you add more data for explanation? Do you need substract <code>2.</code> with <code>4.</code> column ? How do you think sum?</span>
<span class="comment-copy">Yes, I need to subtract column 2 with column 4. So the sum should be cell value of column 2 - cell value of column 4.</span>
<span class="comment-copy">Ok, so it seems my solution works.</span>
<span class="comment-copy">Thank you, I will try this. Will let you know if it is working for me!</span>
<span class="comment-copy">Sure, no problem.</span>
<span class="comment-copy">I got the time to look at it a little bit, and I find it difficult to use this method when I have several excel files to go through. I need to go through all of the excelfiles in a directory and can not write "file.xlsx", as I do not know the name of all of the excel files from time to time. Have you got an idea on how to do this?</span>
<span class="comment-copy">I think you need <a href="https://docs.python.org/3/library/glob.html" rel="nofollow noreferrer">glob</a> like <code>files = glob.blob(*.xlsx)</code> for return all files names and then processes in loop by <code>for file in files:...</code></span>
<span class="comment-copy">When trying to run this, I am getting a KeyError: 'E'. Do you know how to fix this? All of my excel files have got cell values in the columns. I am writing my code like this for testing:     import pandas as pd     import glob          files = glob.glob(r'path*.xlsx')     for file in files:         df = pd.read_excel(files)         df['G'] = df['E'] - df['B']         if df['G'] != 0:             print(df['G'])</span>
