<div class="post-text" itemprop="text">
<p>I try to walk through folder and create folder depending of file extension and after that copying all relevant files in this one. But for an unexpected reason, only one file is copied and script switch at the next one. I think the base is good, because folder is properly created and one file is copied. So why all others are not copied??</p>
<p>Someone can help me to figure it out why?</p>
<pre><code>import os
import shutil

dir = "/home/user/Documents/utils/testFindAndCopy"
target = "/home/user/Documents/utils/result"

def createDir(target):
    os.makedirs(str(target))

def copyFiles(file, target):
    shutil.copy2(file, target)


for subdir, dirs, files in os.walk(dir):
    for file in files:
        filepath = subdir + os.sep + file
        folderName = file.split('.')
        targetDir = target + '/' + str(folderName[1])
        try:
            if os.path.exists(str(folderName)):
                print(folderName[1])
                print(targetDir)
                print(filepath)
                copyFiles(filepath, targetDir)
            else:
                createDir(str(targetDir))
                copyFiles(filepath, targetDir)
                print(folderName[1])
                print(targetDir)
                print(filepath)
        except OSError, e:
            if e.errno != 17:
                raise
                # time.sleep might help here
            pass
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>You have several errors here.  File and directory operations are tricky and you need to be very careful with then.</p>
<p>You should use os.path.join to build a file path.</p>
<p>When you split a filename on ".", the returned value is a list, not a string.  That's your variable <code>folderName</code> - not a well-chosen name.  Your expression <code>os.path.exists(str(folderName))</code> will always be False, since the str() function will not reconstitute a simple string from the list.</p>
<p>Filenames can contain more than 1 dot.  When you use <code>folderName[1]</code> as your directory name, you are assuming there are no such filenames in your case. 
 If you use <code>folderName[-1]</code> you will always get the last piece of the filename.</p>
<p>If you call mkdir/makedirs on a directory that already exists, an OSError exception is raised at that point.  Then no file copying takes place.</p>
<p>shutil.copy2 copies ONE file, even though you call it through a function named <code>copyFiles</code>.</p>
<p>You catch an OSError but don't do anything with it unless it's 17, whatever that is.  So you won't know if your script is catching errors or not.</p>
<p>You want your main loop to be something like this:</p>
<pre><code>for subdir, dirs, files in os.walk(dir):
    for file in files:
        filepath = os.path.join(subdir, file)
        folderName = file.split('.')
        targetDir = os.path.join(target, folderName[-1])
        try:
            print(targetDir, filepath, os.path.exists(targetDir))
            if not os.path.exists(targetDir):
                createDir(targetDir)
            shutil.copy2(filepath, targetDir)
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>Use <code>shutil.copytree(src, dst)</code>.</p>
<p>You won't even have to walk the file tree with that. Just set the top level directory as the source.</p>
<p>From the <a href="https://docs.python.org/3/library/shutil.html#shutil.copytree" rel="nofollow noreferrer">docs</a>:</p>
<blockquote>
<p>Recursively copy an entire directory tree rooted at src, returning the destination directory. The destination directory, named by dst, must not already exist; it will be created as well as missing parent directories. Permissions and times of directories are copied with copystat(), individual files are copied using shutil.copy2().</p>
</blockquote>
</div>
<span class="comment-copy">copyFiles might be overwriting existing files. Why don't you use <code>os.rename</code>?</span>
<span class="comment-copy">@COLDSPEED I need to copy all files present in source dir. And all files have a different name</span>
<span class="comment-copy">@COLDSPEED <code>os.rename</code> is the equivalent of <code>mv</code> in bash, and will just move the file, no?</span>
<span class="comment-copy">I'm not sure your filename/pathname manipulations are correct.  You check for the existence of <code>folderName</code> but then you create <code>targetDir</code>.  I notice that you print exactly the same thing no matter which branch of the <code>if</code> statement is taken.  Why don't you change one of the print statements and see what you get?</span>
<span class="comment-copy">Thanks for the answer, it was crystal clear. I understand all points and it's helpful to understand my mistakes. I applied your suggestion and it's works fine! Thanks you very much!</span>
<span class="comment-copy">Glad it worked for you.  If you don't mind, please accept the answer.</span>
<span class="comment-copy">Done and thx again</span>
