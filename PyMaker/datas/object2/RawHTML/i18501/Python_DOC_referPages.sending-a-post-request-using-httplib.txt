<div class="post-text" itemprop="text">
<p>I'm trying to send data using <code>httplib</code>. Here is my code:</p>
<pre><code>headers = {'User-agent': 'agent','Accept': 'application/json'}
params = { 'api_key':'kjdksnjd45555','ts':455555555}
data = {'job1':42,'job2':85}
params['data'] = json.dumps(data,separators =(',',':'))
re = requests.post(url,headers,params)
print re.json()   
</code></pre>
<p>When I using requests, it work very nice, but not when I use <code>httplib</code> </p>
<pre><code>params = urllib.urlencode(params)
con = httplib.HTTPConnection('api.sandbox.gengo.com')
con.request("POST", "/api/v", param, headers)
r2 = con.getresponse()
r2.read()
</code></pre>
<p>It returns the following error :  </p>
<pre><code>"msg":"\\"api_key\\" is a required field"}  
</code></pre>
<p>(This means that it can not recover my data.)</p>
<p>What can I try? Thanks.</p>
</div>
<div class="post-text" itemprop="text">
<p>Looks like you have a typo on line:</p>
<pre><code>con.request("POST", "/api/v", param, headers)
</code></pre>
<p>Shouldn't that be <code>params</code> and not <code>param</code>. This would explain why the server is responding about the missing <code>api_key</code></p>
</div>
<div class="post-text" itemprop="text">
<p>The third argument of HTTPConnection.request is not the http request parameters.
It is the POST request body. The parameters are part of the url and should be sent as such.</p>
<p><a href="https://docs.python.org/3/library/http.client.html?#http.client.HTTPConnection" rel="nofollow">https://docs.python.org/3/library/http.client.html?#http.client.HTTPConnection</a></p>
</div>
<div class="post-text" itemprop="text">
<p>Your code has two mistakes. First you are using <code>param</code> instead of <code>params</code> in your third line, but also you are passing the parameters as request body not as request parameters.</p>
<p>Try next code:</p>
<pre class="lang-py prettyprint-override"><code>params = urllib.urlencode(params)
con = httplib.HTTPConnection('api.sandbox.gengo.com')
con.request("POST", "/api/v?" + params, "", headers)
r2 = con.getresponse()
r2.read()
</code></pre>
</div>
<span class="comment-copy">nobody can help me</span>
