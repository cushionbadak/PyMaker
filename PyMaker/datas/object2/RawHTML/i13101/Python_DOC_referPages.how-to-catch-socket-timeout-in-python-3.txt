<div class="post-text" itemprop="text">
<p>Part of my script:</p>
<pre><code>def testConnection(self):
    # This code doesn't work
    try:
        self.imap.login(self.user, self.password)
        return True
    except:
        return False
</code></pre>
<p>When I try to connect with imaplib to mail server with wrong settings, script always crashes with this error:</p>
<pre><code>Traceback (most recent call last):
  File "./mail-notifier.py", line 198, in &lt;module&gt;
    mail_check()
  File "./mail-notifier.py", line 161, in mail_check
    if (SettingsExist() == True and Mail().testConnection() == True):
  File "./mail-notifier.py", line 142, in __init__
    self.imap = imaplib.IMAP4_SSL(settings.value("MailServer"), settings.value("Port"))
  File "/usr/lib64/python3.4/imaplib.py", line 1221, in __init__
    IMAP4.__init__(self, host, port)
  File "/usr/lib64/python3.4/imaplib.py", line 181, in __init__
    self.open(host, port)
  File "/usr/lib64/python3.4/imaplib.py", line 1234, in open
    IMAP4.open(self, host, port)
  File "/usr/lib64/python3.4/imaplib.py", line 257, in open
    self.sock = self._create_socket()
  File "/usr/lib64/python3.4/imaplib.py", line 1224, in _create_socket
    sock = IMAP4._create_socket(self)
  File "/usr/lib64/python3.4/imaplib.py", line 247, in _create_socket
    return socket.create_connection((self.host, self.port))
  File "/usr/lib64/python3.4/socket.py", line 512, in create_connection
    raise err
  File "/usr/lib64/python3.4/socket.py", line 503, in create_connection
    sock.connect(sa)
socket.timeout: timed out
</code></pre>
<p>I can't catch timeout exception and print error message and continue to work. I thought " except: " catches all errors that happen. I tried to set " except socket.timeout: " but unsuccessfully. What did I wrong?</p>
</div>
<div class="post-text" itemprop="text">
<p><strong><a href="https://docs.python.org/3/library/socket.html#socket.socket.connect" rel="nofollow">socket.connect(address)</a></strong></p>
<blockquote>
<p>Connect to a remote socket at address. (The format of address depends on the address family — see above.)</p>
<p>If the connection is interrupted by a signal, the method waits until the connection completes, or raise a <code>socket.timeout</code> on timeout, if the signal handler doesn’t raise an exception and the socket is blocking or has a timeout. For non-blocking sockets, the method raises an <code>InterruptedError</code> exception if the connection is interrupted by a signal (or the exception raised by the signal handler).</p>
<p><em>Changed in version 3.5</em>: The method now waits until the connection completes instead of raising an <code>InterruptedError</code> exception if the connection is interrupted by a signal, the signal handler doesn’t raise an exception and the socket is blocking or has a timeout (see the <strong><a href="http://www.python.org/dev/peps/pep-0475" rel="nofollow">PEP 475</a></strong> for the rationale).</p>
</blockquote>
<p>In case of remote connection you should check if the Internet connection can be established (you and remote destination are reachable) and connection setting to perform actions you want are correct.</p>
</div>
<span class="comment-copy">The problem seem to be in establishing connection, but not in connection timeout.</span>
<span class="comment-copy">How to catch this error?</span>
<span class="comment-copy">Try to catch the error there, where you call: <code>mail_check()</code></span>
<span class="comment-copy">No, it also gives error. <code>mail_check()</code> only uses function, that I pasted, and  print results. It does nothing itself with sockets and connections.</span>
<span class="comment-copy">Next on the stack trace we have <code>if (SettingsExist() == True and Mail().testConnection() == True):</code> Here <code>testConnection()</code> may cause questions.</span>
