<div class="post-text" itemprop="text">
<p>I have the following script to process filenames with non-latin characters:</p>
<pre><code>import os
filelst = []
allfile = os.listdir(os.getcwd())
for file in allfile:
        if os.path.isfile(file):
            filelst.append(file)

w = open(os.getcwd()+'\\_filelist.txt','w+')

for file in allfile:
    w.write(file)
    w.write("\n")
w.close()
</code></pre>
<hr/>
<p>filelist in my folder:</p>
<pre><code>new 1.py
ああっ女神さまっ 小っちゃいって事は便利だねっ.1998.Ep0108.x264.AC3CalChi.avi
ああっ女神さまっ 小っちゃいって事は便利だねっ.1998.Ep0108.x264.AC3CalChi.srt
</code></pre>
<p>output in _filelist.txt:</p>
<pre><code>new 1.py
???????? ??????????????.1998.Ep01-08.x264.AC3-CalChi.avi
???????? ??????????????.1998.Ep01-08.x264.AC3-CalChi.srt
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>You should get the list of files as Unicode strings instead by passing a Unicode file path to <code>listdir</code>. As you're using getcwd, use: <code>os.getcwdu()</code></p>
<p>Then open your output file with a text encoding wrapper. <code>io</code> module is the new way to do this (<code>io</code> handles Universal newlines correctly).</p>
<p>Putting it all together:</p>
<pre><code>import os
import io

filelst = []
allfile = os.listdir(os.getcwdu())
for file in allfile:
        if os.path.isfile(file):
            filelst.append(file)

w = io.open(os.getcwd()+'\\_filelist.txt','w+', encoding="utf-8")

for file in allfile:
    w.write(file)
    w.write("\n")
w.close()
</code></pre>
<p>In Windows and OS X, this will just work as filename translation is enforced. In Linux, a filename can be any encoding (or non at all!). Therefore, ensure that whatever is creating your files (avi + srt), is using UTF-8, your terminal is set to UTF-8 and your locale is UTF-8.</p>
</div>
<div class="post-text" itemprop="text">
<p>You need to open your file with a proper encoding to write unicode in it.You can use <a href="https://docs.python.org/2/library/codecs.html" rel="nofollow"><code>codecs</code> module</a> for opening the file:</p>
<pre><code>import codecs
with codecs.open(os.getcwd()+'\\_filelist.txt','w+',encoding='your-encoding') as w:
    for file in allfile:
        w.write(file + '\n')
</code></pre>
<p>You can use <code>UTF-8</code> as your encoding which is a universal encoding or another proper encoding based on your unicode type.Also note that instead of opening the file and closing it manually you can use <a href="https://docs.python.org/3/reference/compound_stmts.html#the-with-statement" rel="nofollow"><code>with</code> statement</a> to open the file which will close the file automatically at the end of the block.</p>
</div>
<span class="comment-copy">Why no matter I write anything , stackoverflow always saying "Body cannot contain XXXXXXX"?</span>
<span class="comment-copy">I've removed a number of filenames entries to work around the strange SO validation exception.</span>
<span class="comment-copy">Oh!Thank you!You sloved my problem.</span>
<span class="comment-copy">import os[LineFeed]import codecs[LineFeed]allfile = os.listdir(os.getcwd())[LineFeed]with codecs.open(os.getcwd()+'_filelist.txt','w+',encoding='utf-8') as w:[LineFeed][Tab]for file in allfile:[LineFeed][Tab][Tab]w.write(file + '\n')[LineFeed][LineFeed]#UnicodeDecodeError: 'ascii' codec can't decode byte 0xa4 in position 3: ordinal not in range(128)</span>
<span class="comment-copy">Screenshot:<a href="https://photos-6.dropbox.com/t/2/AADs41Yhga-PEBxeg7ta6eZiSjvAQtd2ZNdGqd2h6nZWgw/12/91395487/png/32x32/3/1446843600/0/2/%E8%9E%A2%E5%B9%95%E6%88%AA%E5%9C%96%202015-11-07%2000.22.15.png/EMbeg0cYmAcgASgB/C8MR7H-_T0UBHfO71748IGHzCcX_LIPViZvVfDiu-fs?size_mode=5&amp;size=32x32" rel="nofollow noreferrer">Dropbox link</a></span>
