<div class="post-text" itemprop="text">
<p>Here's the error message:</p>
<blockquote>
<p>RuntimeError: dictionary changed size during iteration</p>
</blockquote>
<p>Here's the segment of my code (&lt;= marks the error line):</p>
<pre><code># Probability Distribution from a sequence of tuple tokens
def probdist_from_tokens (tokens, N, V = 0, addone = False):
    cfd = ConditionalFreqDist (tokens)
    pdist = {}

    for a in cfd:  # &lt;= line with the error
        pdist[a] = {}
        S = 1 + sum (1 for b in cfd[a] if cfd[a][b] == 1)
        A = sum (cfd[a][b] for b in cfd[a])

        # Add the log probs.
        for b in cfd[a]:
            B = sum (cfd[b][c] for c in cfd[b])
            boff = ((B + 1) / (N + V)) if addone else (B / N)
            pdist[a][b] = math.log ((cfd[a][b] + (S * boff)) / (A + S))

        # Add OOV for tag if relevant
        if addone:
            boff = 1 / (N + V)
            pdist[a]["&lt;OOV&gt;"] = math.log ((S * boff) / (A + S))

    return pdist
</code></pre>
<p>I'm basically just using cfd as a reference to put the correct values in pdist. I'm not trying to change cfd, I just want to iterate over it's keys and the keys of it's sub dictionary.</p>
<p>I think the problem is caused by the lines where I set the variables A and B, I got the same error when I had different code on those lines but I don't get the error when I replace them with a constant value.</p>
</div>
<div class="post-text" itemprop="text">
<p><a href="http://www.nltk.org/api/nltk.html#nltk.probability.ConditionalFreqDist" rel="nofollow noreferrer"><code>nltk.probability.ConditionalFreqDist</code></a> inherits <a href="https://docs.python.org/3/library/collections.html#collections.defaultdict" rel="nofollow noreferrer"><code>defaultdict</code></a>, which means if you read a non-existing entry <code>cfd[b]</code>, a new entry <code>(b, FreqDist())</code> will be inserted to the dictionary, and thus changing its size. Demonstration of the problem:</p>
<pre><code>import collections
d = collections.defaultdict(int, {'a': 1})
for k in d:
    print(d['b'])
</code></pre>
<p>Output:</p>
<pre><code>0
Traceback (most recent call last):
  File "1.py", line 4, in &lt;module&gt;
    for k in d:
RuntimeError: dictionary changed size during iteration
</code></pre>
<hr/>
<p>So you should check this line:</p>
<pre><code>    for b in cfd[a]:
        B = sum (cfd[b][c] for c in cfd[b])
</code></pre>
<p>are you sure the <code>b</code> key really exists in <code>cfd</code>? You may want to change it to</p>
<pre><code>        B = sum(cfd[b].values()) if b in cfd else 0
#                                ^~~~~~~~~~~
</code></pre>
</div>
<span class="comment-copy">Can you provide a self-contained example demonstrating the problem?</span>
