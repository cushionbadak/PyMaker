<div class="post-text" itemprop="text">
<p>I am trying to run multiple Yolos in parallel in Python.</p>
<p>I have a function that I am trying to use as the worker. something like this:</p>
<pre><code>import darknet as dn
def yolo(input_queue, net, meta):
    while True:
        task = input_queue.get_nowait()
        c = task.shape[0]
        h = task.shape[1]
        w = task.shape[2]
        task = (task/255.0)
        task = task.flatten()
        new_arr = np.copy(task).astype(np.float32) 
        new_arr = np.ctypeslib.as_ctypes(new_arr)
        im = dn.IMAGE(w,h,c,new_arr)
        dn.rgbgr_image(im)

        print(dn.detect(net, meta, im))
</code></pre>
<p>You can find darknet file <a href="https://github.com/pjreddie/darknet/blob/master/python/darknet.py" rel="nofollow noreferrer">here</a>.</p>
<p>Let's don't talk about the way I convert the array to a ctype array. it has been discussed <a href="https://stackoverflow.com/questions/53755064/what-is-the-fastest-way-of-converting-a-numpy-array-to-a-ctype-array">here</a>.</p>
<p>If I run this function as a normal function works like a charm. But if I run it as a worker like this:</p>
<pre><code>p = Process(target=yolo, args=(input_queue, net, meta))
p.start()
</code></pre>
<p>it goes all the way down to the last line then it gives me this error:</p>
<pre><code>CUDA Error: initialization error
python: ./src/cuda.c:36: check_error: Assertion `0' failed.
</code></pre>
<p>I couldn't figure out why exactly this error happens.
can anyone help?  what's the difference between these two way of using this function that cause this problem?</p>
</div>
<div class="post-text" itemprop="text">
<p>Thanks to <a href="https://stackoverflow.com/a/40083505/6701576">this</a> I found the problem is that you can't share the context in CUDA between processes with different PIDs which makes sense. So I found that if I run related things (in my case, <code>net</code>) in the same process then it works okay. before this I was loading weights before I start the worker. </p>
</div>
<span class="comment-copy"><a href="https://stackoverflow.com/questions/33748750/cuda-error-initialization-error-when-using-parallel-in-python">Check this out.</a></span>
<span class="comment-copy">You may may need to put the "entry point" of the main script within an <code>if __name__ == '__main__':</code> conditional as described in the "Safe importing of main module" section of the <code>multiprocessing</code> <b>Programming guidelines</b> <a href="https://docs.python.org/3/library/multiprocessing.html#programming-guidelines" rel="nofollow noreferrer">documentation</a>.</span>
<span class="comment-copy">@GeeTransit it is different but answer by sagarwal gave me the idea to solve the problem</span>
