<div class="post-text" itemprop="text">
<p>So I have the following code:</p>
<pre><code>import pytz
from datetime import datetime


tz = pytz.timezone('Asia/Singapore')

original_time = tz.localize(datetime.now())
original_epoch = original_time.timestamp()
converted_dt = tz.localize(datetime.utcfromtimestamp(original_epoch))
converted_epoch = converted_dt.timestamp()

print('{}\t\t{}'.format(original_time, original_epoch))
print('{}\t\t{}'.format(converted_dt, converted_epoch))
</code></pre>
<p>And it spits out</p>
<pre><code># Original Time                         Original Epoch
2018-07-16 02:17:41.583510+08:00        1531678661.58351
2018-07-15 18:17:41.583510+08:00        1531649861.58351
# Converted Time                        Converted Epoch
</code></pre>
<p>Is this a Python bug or am I simply missing something? And either way, how can I convert datetime to epoch and back with confidence that I am getting back the right time?</p>
</div>
<div class="post-text" itemprop="text">
<p><code>tz.localize()</code> does not perform any timezone adjustments to the given <code>datetime</code>; it just sets its <code>tzinfo</code> to the given timezone.  For the timestamps you're using, this means that <code>tz.localtime()</code> performs the following:</p>
<pre><code> datetime.now()                           -&gt;  tz.localize(datetime.now())
 2018-07-16 02:17:41.583510                   2018-07-16 02:17:41.583510+08:00

 datetime.utcfromtimestamp(original_epoch) -&gt; tz.localize(datetime.utcfromtimestamp(original_epoch))
 2018-07-15 18:17:41.583510                -&gt; 2018-07-15 18:17:41.583510+08:00
</code></pre>
<p>Note that the times don't change; only the timezone offset does.  Because the inputs to <code>tz.localize()</code> are two different na√Øve times, you get two different aware times out.</p>
<p>The correct way to construct a <code>datetime</code> from a UNIX timestamp and a timezone is to use <a href="https://docs.python.org/3/library/datetime.html#datetime.datetime.fromtimestamp" rel="nofollow noreferrer"><code>datetime.fromtimestamp()</code></a> with two arguments:</p>
<pre><code>&gt;&gt;&gt; print(datetime.fromtimestamp(1531678661.58351, pytz.timezone('Asia/Singapore')))
2018-07-16 02:17:41.583510+08:00
</code></pre>
</div>
<span class="comment-copy">Thanks Jwodder! Been stumped all night trying to figure it out.</span>
