<div class="post-text" itemprop="text">
<p>Ive made a single POST request using sockets in python and it worked fine, but since trying to iterate username and passwords it just is not working, i have been trying for hours if not all day trying to figure out what is the problem.</p>
<p>...i just don't get this at all, code will be below(have tried many different versions of what i have now). Thanks, would really love to know were i have gone wrong with this, i do not think i am too far off?</p>
<pre><code>#!/usr/bin/python
#-*- coding: utf8 -*-

#imports
import socket



users = ['bill','ted','sally','sue']

num_00_09 = ['00','01','02','03','04','05','06','07','08','09']
num_10_100 = [x for x in range(10,101)]
pwd = num_00_09 + num_10_100

for user in users:
    for x in range(1,101):
        length = len(str(user)) + len(str(pwd[x]))

        req = '''POST /python/login2r.php HTTP/1.1
        Host: ad.samsclass.info
        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:61.0) Gecko/20100101 Firefox/61.0
        Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
        Accept-Language: en-US,en;q=0.5
        Accept-Encoding: deflate
        Content-Type: application/x-www-form-urlencoded
        Content-Length: %s''' % (length)

        req1 = '''\nCookie: __cfduid=d97d8c22217a6727cbe1a7d222f5f27ec1531510998
        DNT: 1
        Connection: keep-alive
        Upgrade-Insecure-Requests: 1

        u=%s&amp;p=%s''' % (user,pwd[x])

        s = socket.socket()
        socket.setdefaulttimeout(2)

        s.connect(('ad.samsclass.info',80))
        s.send(bytes(req + req1,'utf8'))
        r = s.recv(1024)
        print(r.decode('utf8'))
        s.close()
</code></pre>
<p>And here is the error code(obviously there is this code for each post iteration done)</p>
<pre><code>HTTP/1.1 400 Bad Request
Date: Sun, 15 Jul 2018 22:41:36 GMT
Server: Apache/2.4.18 (Ubuntu)
Content-Length: 313
Connection: close
Content-Type: text/html; charset=iso-8859-1

&lt;!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0//EN"&gt;
&lt;html&gt;&lt;head&gt;
&lt;title&gt;400 Bad Request&lt;/title&gt;
&lt;/head&gt;&lt;body&gt;
&lt;h1&gt;Bad Request&lt;/h1&gt;
&lt;p&gt;Your browser sent a request that this server could not understand.&lt;br /&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;address&gt;Apache/2.4.18 (Ubuntu) Server at attack.samsclass.info Port 80&lt;/address&gt;
&lt;/body&gt;&lt;/html&gt;
</code></pre>
<p>have added +5 too length variable but am now getting another error</p>
<pre><code>HTTP/1.1 400 Bad Request
Date: Sun, 15 Jul 2018 22:56:49 GMT
Server: Apache/2.4.18 (Ubuntu)
Content-Length: 313
Connection: close
Content-Type: text/html; charset=iso-8859-1

&lt;!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0//EN"&gt;
&lt;html&gt;&lt;head&gt;
&lt;title&gt;400 Bad Request&lt;/title&gt;
&lt;/head&gt;&lt;body&gt;
&lt;h1&gt;Bad Request&lt;/h1&gt;
&lt;p&gt;Your browser sent a request that this server could not understand.&lt;br /&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;address&gt;Apache/2.4.18 (Ubuntu) Server at attack.samsclass.info Port 80&lt;/address&gt;
&lt;/body&gt;&lt;/html&gt;

Traceback (most recent call last):
  File "file02.py", line 42, in &lt;module&gt;
    s.send(bytes(req + req1,'utf8'))
OSError: [WinError 10038] An operation was attempted on something that is not a socket
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>Your content length is incorrect. Your POST body is longer than you claim it to be:</p>
<pre><code>length = len(str(user)) + len(str(pwd[x]))
</code></pre>
<p>That only counts the user and password string lengths, but your content body consists of more characters still:</p>
<pre><code>u=%s&amp;p=%s
</code></pre>
<p>The <code>u=</code> and <code>&amp;p=</code> characters <em>also are part of the POST body</em>, so your content length is <em>at least</em> 5 bytes longer than you told the server to expect.</p>
<p>Next, you are sending headers with a lot of leading whitespace. The indentation on the <code>req = '''...'''</code> and  <code>req1 = '''...'''</code> strings <em>is part of the string value</em>, but HTTP headers should be sent without indentation. Remove that whitespace.</p>
<p>Next, HTTP requires that you send headers with both a carriage return <em>and</em> a newline between them. You are sending just <code>\n</code> separators, not <code>\r\n</code> separators.</p>
<p>You'd be much better off using the <a href="https://docs.python.org/3/library/http.client.html" rel="nofollow noreferrer"><code>http.client</code> library</a> that comes with Python. At the very least, try to <a href="https://github.com/python/cpython/blob/3.7/Lib/http/client.py" rel="nofollow noreferrer">study it's source code</a> so you can learn what that library does, if you must try to do this the hard way with a socket.</p>
<p>If you don't need to go this low-level, just install <a href="http://python-requests.org/" rel="nofollow noreferrer"><code>requests</code></a> and let it do all the heavy lifting.</p>
</div>
<span class="comment-copy">Like this you will send the request a) with spaces before all header lines except the first one and b) depending on your OS with <code>\n</code> instead of <code>\r\n</code> line breaks.</span>
<span class="comment-copy">Oh yes sorry, i forgot that i had it on earlier versions, ive been trying this all day it feels like, brain is going fuzzy. I just added + 5 to length and i get another error now</span>
<span class="comment-copy">@nc: you'll get many errors more still. Perhaps it is time to take a break and come back to this tomorrow?</span>
<span class="comment-copy">That new error is not due to you adding 5 to the content length, I'm sure.</span>
<span class="comment-copy">ha yea i know that i was just hoping someone might of been able to tell me what was wrong with my code, feels like ive been going around in circles...you rite im going to take a break also :)</span>
<span class="comment-copy">Ok thank you i appreciate your post, i think i need to take a break from this too as i really don't think that's has helped to be honest, yes i know the requests would be better and easier i just wanted to do it in sockets and learn something new :)</span>
