<div class="post-text" itemprop="text">
<p>I know just enough devops to be dangerous. I've successfully deployed a VERY simple python flask app to App Engine that basically publishes received post data as a message to PubSub. It is almost identical to Google's <a href="https://github.com/GoogleCloudPlatform/python-docs-samples/blob/master/appengine/flexible/pubsub/main.py" rel="nofollow noreferrer">sample code</a> to do so. Only difference is it uses a service account I push with the app repository to access PubSub to circumvent <a href="https://github.com/GoogleCloudPlatform/google-auth-library-python/issues/211" rel="nofollow noreferrer">this issue</a>.</p>
<p>Works very well so far, but I've started seeing a very small number of errors around starting a new thread in <code>threading.py</code>:</p>
<p>1)</p>
<pre><code>Traceback (most recent call last):
  File "src/python/grpcio/grpc/_cython/_cygrpc/credentials.pyx.pxi", line 33, in grpc._cython.cygrpc._spawn_callback_async
  File "src/python/grpcio/grpc/_cython/_cygrpc/credentials.pyx.pxi", line 24, in grpc._cython.cygrpc._spawn_callback_in_thread
  File "/usr/lib/python2.7/threading.py", line 736, in start
    _start_new_thread(self.__bootstrap, ())
thread.error: can't start new thread
</code></pre>
<p>2)</p>
<pre><code>Traceback (most recent call last):
  File "src/python/grpcio/grpc/_cython/_cygrpc/credentials.pyx.pxi", line 33, in grpc._cython.cygrpc._spawn_callback_async
  File "src/python/grpcio/grpc/_cython/_cygrpc/credentials.pyx.pxi", line 24, in grpc._cython.cygrpc._spawn_callback_in_thread
</code></pre>
<p>3) </p>
<pre><code>Traceback (most recent call last):
  File "src/python/grpcio/grpc/_cython/_cygrpc/credentials.pyx.pxi", line 33, in grpc._cython.cygrpc._spawn_callback_async
  File "src/python/grpcio/grpc/_cython/_cygrpc/credentials.pyx.pxi", line 33, in grpc._cython.cygrpc._spawn_callback_async
  File "src/python/grpcio/grpc/_cython/_cygrpc/credentials.pyx.pxi", line 24, in grpc._cython.cygrpc._spawn_callback_in_thread
  File "src/python/grpcio/grpc/_cython/_cygrpc/credentials.pyx.pxi", line 24, in grpc._cython.cygrpc._spawn_callback_in_thread
  File "/usr/lib/python2.7/threading.py", line 736, in start
  File "/usr/lib/python2.7/threading.py", line 736, in start
</code></pre>
<p><strong>I have 2 questions, in order of importance:</strong></p>
<ol>
<li>This is an app that basically needs 100% uptime in order to not lose data (not confident the clients attempt retries if there is an error on my server side). Are these errors internal to how App Engine is managing my app's resources, and not resulting in errors handling actual requests? How can I determine if I ever responded with an HTTP error/didn't successfully handle a request? I don't see any errors in my nginx logs...is that the place I need to look to see if anything failed?</li>
<li>Is there a way I can fix this error?</li>
</ol>
</div>
<div class="post-text" itemprop="text">
<p><a href="https://github.com/GoogleCloudPlatform/google-cloud-python/blob/master/pubsub/google/cloud/pubsub_v1/publisher/client.py#L143" rel="nofollow noreferrer">https://github.com/GoogleCloudPlatform/google-cloud-python/blob/master/pubsub/google/cloud/pubsub_v1/publisher/client.py#L143</a></p>
<p>it looks like <code>publisher.publish(topic_path, data=data)</code> is an async operation, returning a <code>concurrent.futures.Future</code> object</p>
<p>Have you trying calling the Future's <code>result()</code>? <a href="https://docs.python.org/3/library/concurrent.futures.html#concurrent.futures.Future.result" rel="nofollow noreferrer">https://docs.python.org/3/library/concurrent.futures.html#concurrent.futures.Future.result</a></p>
<p>This will block until the future object is successful, fails, or timesout.</p>
<p>You could then forward that result as your HTTP response.</p>
<p>Hopefully, the result object will give you more information about the error.</p>
</div>
<span class="comment-copy">Hey @Alex thanks for the thought--I can give this a shot, and perhaps re-attempt publishing if it returns a failed status, which answers my 2nd point. However, I'm still interested in the questions in my 1st point as well.</span>
<span class="comment-copy"><a href="https://console.cloud.google.com/logs/viewer" rel="nofollow noreferrer">console.cloud.google.com/logs/viewer</a> is where i check my logs and http activity, are your prints/stacktraces not appearing there? Also, the clients that submit requests to your server do need to implement some level of caching/retry. A few weeks ago all of my app engine projects went down and were not responding for about 30 minutes without warning.</span>
