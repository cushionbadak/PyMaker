<div class="post-text" itemprop="text">
<p>I am trying to use Python Requests via PHP for scraping a page<br/>
<strong>index.php</strong>:</p>
<pre><code>&lt;?php
$url = $_GET['url'];
$output = shell_exec("python /home/myusername/public_html/py/fetch.py $url");
echo $output;
</code></pre>
<p>and here is my <strong>fetch.py</strong>:</p>
<pre><code>#! /usr/bin/python

import requests
import sys

url = sys.argv[1]

headers = {'cache-control': 'no-cache'}

try:
    r = requests.request("GET", url, headers=headers)
    #print r.status_code
    #sys.exit(1)
except requests.exceptions.RequestException as e:
    print e
    sys.exit(1)

if not r.text:
    print("Response Empty")
else:
    print(r.text)
</code></pre>
<p>I tried checking status code, it's 200. I tried checking if response is empty, it's not. But <strong>r.text</strong> is not printing at all.
What i am doing wrong here?</p>
</div>
<div class="post-text" itemprop="text">
<p>According to the <a href="http://php.net/manual/en/function.shell-exec.php" rel="nofollow noreferrer">official documentation</a> there are some catches included in <code>shell_exec</code></p>
<p>You may have to update your code a bit. There are chances that you may have error in your code, which are basically redirected to <code>stderr</code> and hence not captured in the <code>stdout</code>. Further <a href="https://www.brianstorti.com/understanding-shell-script-idiom-redirect/" rel="nofollow noreferrer">read this</a></p>
<p>So back to your question. Edit your code</p>
<pre><code>&lt;?php
$url = $_GET['url'];
$output = shell_exec("python /home/myusername/public_html/py/fetch.py $url 2&gt;&amp;1");
echo $output;
?&gt;
</code></pre>
<p>Update Python code to:</p>
<pre><code>#! /usr/bin/python

import requests
import sys

url = sys.argv[1]

headers = {'cache-control': 'no-cache'}

try:
    r = requests.request("GET", url, headers=headers)
    #print r.status_code
    #sys.exit(1)
except requests.exceptions.RequestException as e:
    print e
    sys.exit(1)

if not r.text:
    print("Response Empty")
else:
    print(r.text.encode('utf-8')) # changes
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>Trying this way:</p>
<blockquote>
<p>shell_exec("python /home/myusername/public_html/py/fetch.py $url 2&gt;&amp;1");</p>
</blockquote>
<p>you can see the errors in the python script you have.</p>
</div>
<span class="comment-copy">Could you try using the <code>requests.get</code> method?</span>
<span class="comment-copy">@moritzg same, empty response</span>
<span class="comment-copy">Is there a reason why you use this two-step process? PHP can do this easily by itself (it will be faster too).</span>
<span class="comment-copy">@BartFriederichs the page i am trying to scrape is not working with PHP CURL, don't know why. I tested with Requests, it's working fine in <code>IDLE</code></span>
<span class="comment-copy">See here: <a href="https://stackoverflow.com/questions/4214031/php-and-shell-exec">stackoverflow.com/questions/4214031/php-and-shell-exec</a></span>
<span class="comment-copy">Still strange that the Python code works outside of PHP.</span>
<span class="comment-copy">@BartFriederichs i guess may be some contents in the page may be encoded according to some region. We can never guess how the website behaves.</span>
<span class="comment-copy"><code>Traceback (most recent call last): File "/home/myusername/public_html/py/ig.py", line 21, in print(r.text) UnicodeEncodeError: 'ascii' codec can't encode character u'\u2019' in position 15318: ordinal not in range(128)</code></span>
<span class="comment-copy">So you have an encode error on your python script. Fix it...</span>
