<div class="post-text" itemprop="text">
<p>I need to read from a file, linewise. Also also need to make sure the encoding is correctly handled.</p>
<p>I wrote the following code:</p>
<pre><code>#!/bin/bash

import codecs

filename = "something.x10"

f = open(filename, 'r')
fEncoded = codecs.getreader("ISO-8859-15")(f)

totalLength = 0
for line in fEncoded:
  totalLength+=len(line)

print("Total Length is "+totalLength)
</code></pre>
<p>This code does not work on all files, on some files I get a</p>
<pre><code>Traceback (most recent call last):
  File "test.py", line 11, in &lt;module&gt;
    for line in fEncoded:
  File "/usr/lib/python3.2/codecs.py", line 623, in __next__
    line = self.readline()
  File "/usr/lib/python3.2/codecs.py", line 536, in readline
    data = self.read(readsize, firstline=True)
  File "/usr/lib/python3.2/codecs.py", line 480, in read
    data = self.bytebuffer + newdata
TypeError: can't concat bytes to str
</code></pre>
<p>Im using python 3.3 and the script must work with this python version.</p>
<p>What am I doing wrong, I was not able to find out which files work and which not, even some plain ASCII files fail.</p>
</div>
<div class="post-text" itemprop="text">
<p>You are opening the file in non-binary mode. If you read from it, you get a string decoded according to your default encoding (<a href="http://docs.python.org/3/library/functions.html?highlight=open%20builtin#open" rel="nofollow">http://docs.python.org/3/library/functions.html?highlight=open%20builtin#open</a>). </p>
<p>codec's StreamReader needs a bytestream (<a href="http://docs.python.org/3/library/codecs#codecs.StreamReader" rel="nofollow">http://docs.python.org/3/library/codecs#codecs.StreamReader</a>)</p>
<p>So this should work:</p>
<pre><code>import codecs

filename = "something.x10"

f = open(filename, 'rb')
f_decoded = codecs.getreader("ISO-8859-15")(f)

totalLength = 0
for line in f_decoded:
   total_length += len(line)

print("Total Length is "+total_length)
</code></pre>
<p>or you can use the encoding parameter on <code>open</code>:</p>
<pre><code> f_decoded = open(filename, mode='r', encoding='ISO-8859-15')
</code></pre>
<p>The reader returns decoded data, so I fixed your variable name. Also, consider <a href="http://www.python.org/dev/peps/pep-0008/" rel="nofollow">pep8</a> as a guide for formatting and coding style.</p>
</div>
<span class="comment-copy">You say some plain ASCII files fail. Do you have one that is short enough to post here?</span>
