<div class="post-text" itemprop="text">
<p>Is it possible that installing <em>ipdb</em> (or some other package written to do it explicitely) will result in <code>breakpoint()</code> running <em>ipdb</em> instead of <em>pdb</em> without binding <code>sys.breakpointhook()</code> to <em>ipdb</em>?</p>
<p><a href="https://www.python.org/dev/peps/pep-0553/" rel="noreferrer">https://www.python.org/dev/peps/pep-0553/</a></p>
<p>I'm not asking if ipdb does that or if it will, but if its possible to code that. I know that I can set environment variable <code>PYTHONBREAKPOINT=ipdb.set_trace</code>. The question is if its possible to trigger this behavior by just installing <code>ipdb</code>.</p>
</div>
<div class="post-text" itemprop="text">
<p>During the installation one could programmatically create either a <code>usercustomize.py</code> or a <code>sitecustomize.py</code> in the correct directories and alter <code>os.environ['PYTHONBREAKPOINT']</code> in there.</p>
<p>These modules are imported by <a href="https://docs.python.org/3/library/site.html" rel="nofollow noreferrer"><code>site.py</code></a> early in the startup sequence and are suited for this sort of customization. Personally, I've never seen a package alter/create these files so I wouldn't expect <code>ipdb</code> to ever do it.</p>
</div>
<div class="post-text" itemprop="text">
<p>One way would be to create <code>.pth</code> file in your <code>site-packages</code> directory. If the line in that file starts with <code>import</code> statement then this line is being executed. In that file you can monkey-patch <code>sys.breakpointhook</code></p>
<p>Example:</p>
<pre><code>echo "import random; print('hello')" &gt; path/to/lib/python3.7/site-packages/test.pth
$ python -c ''
hello
</code></pre>
</div>
<span class="comment-copy">All that I can think of is that installation of package would actually change files of python's standard library.</span>
<span class="comment-copy"><code>usercustomize.py</code> sounds like a perfect place for this. Unfortunately, on my machines when using virtualenv <code>site.ENABLE_USER_SITE</code> is always <code>False</code> as if python was started with <code>-S</code> option or <code>PYTHONNOUSERSITE</code> environment variable was set.</span>
<span class="comment-copy">While site customize is the correct place, it's not really the installer's business to be dumping stuff there. User or sysadmin should do this manually.</span>
