<div class="post-text" itemprop="text">
<p>I'm currently working on moving some excel worksheets over to python automation, and have come across a speed issue.</p>
<p>I have a list of lists containing around 10.000 lists each with 20 or so columns. I also have a list of account numbers (100.000 numbers)</p>
<p>I wish to iterate over my list of lists and then pick out values from the list, if the account number in the lists matches one in the account list.</p>
<p>By running this code, i am able to get my desired result, however it is painfully slow.</p>
<pre><code>calc = 0
for row in listOfLists:
    if row[1] in Accounts:
        calc += row[8]
</code></pre>
<p>Any ideas on how to optimize for speed?</p>
</div>
<div class="post-text" itemprop="text">
<p>Make <code>Accounts</code> a <a href="https://docs.python.org/3/tutorial/datastructures.html#sets" rel="nofollow noreferrer"><code>set</code></a>. The contains check is <a href="https://wiki.python.org/moin/TimeComplexity" rel="nofollow noreferrer"><code>O(1)</code> for sets, but <code>O(N)</code> for lists</a>. Your entire process' time complexity will be reduced from <code>O(M*N)</code> to <code>O(M+N)</code>. You can further use <a href="https://docs.python.org/3/library/functions.html#sum" rel="nofollow noreferrer"><code>sum</code></a> with a conditional <a href="https://docs.python.org/3/reference/expressions.html#generator-expressions" rel="nofollow noreferrer">generator expression</a>:</p>
<pre><code>account_set = set(Accounts)
calc = sum(row[8] for row in listOfLists if row[1] in account_set)
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>A functional approach of this, using the <code>set</code> over <code>Accounts</code> as @schwobaseggle answered:</p>
<pre><code>account_set = set(Accounts)
calc = reduce(lambda row: row[8] if row[1] in account_set else 0, listOfLists , 0)
</code></pre>
</div>
<span class="comment-copy">Have you tried a list comprehension?</span>
<span class="comment-copy">@thefourtheye Why do you expect a list comprehension to help in this case?</span>
<span class="comment-copy">actually what he wants is a reduced version of it @thefourtheye</span>
<span class="comment-copy">was about tu use sum, that answer is just perfect!</span>
