<div class="post-text" itemprop="text">
<p>i'm trying to read a .gz file from S3 using AWS Lambda.</p>
<p>when i try to unzip the file using gzip, i get <strong>OSError: Not a gzipped file (b'PK')</strong> error.</p>
<p>Here is the code...</p>
<pre><code>retr = s3_client.get_object(Bucket=bucket, Key=key)
print(retr)
bytestream = BytesIO(retr['Body'].read())
print(bytestream)
got_text = GzipFile(mode='rb', fileobj=bytestream).read().decode('utf-8')
print(got_text)
</code></pre>
<p>Here is the response of the retr file.</p>
<pre><code>{  
   'ResponseMetadata':{  
      'RequestId':'aklsfjdlskfj',
      'HostId':'kajsdfhdkjfh/+r+i0OLx/adlksfjd/aksfh=',
      'HTTPStatusCode':200,
      'HTTPHeaders':{  
         'x-amz-id-2':'alsdkfjslkfjsalfjflkj/+r+i0OLx/asklfjslk/r9eTM=',
         'x-amz-request-id':'hgfhgf',
         'date':'Sun, 21 Jan 2018 08:35:28 GMT',
         'last-modified':'Sun, 21 Jan 2018 08:32:34 GMT',
         'etag':'"aksjdfhdskjfhfkjhf"',
         'accept-ranges':'bytes',
         'content-type':'application/x-gzip',
         'content-length':'2825',
         'server':'AmazonS3'
      },
      'RetryAttempts':0
   },
   'AcceptRanges':'bytes',
   'LastModified':datetime.datetime(2018,
   1,
   21,
   8,
   32,
   34,
   tzinfo=tzutc()),
   'ContentLength':2825,
   'ETag':'"akjsfhksdjfhsdkfj"',
   'ContentType':'application/x-gzip',
   'Metadata':{  

   },
   'Body':&lt;botocore.response.StreamingBody object at adsfdsf08&gt;
}
</code></pre>
<p>How to get that .gz file unzipped? i want to unzip it and read the .txt file in that .gz file. Can anyone guide me?</p>
</div>
<div class="post-text" itemprop="text">
<p>The file you are trying to decompress is not a gzip file.  It's a ZIP file.</p>
<p>Here's what happens why I try to use the Python <a href="https://docs.python.org/3/library/gzip.html" rel="nofollow noreferrer">gzip module</a> to decompress a ZIP file:</p>
<pre class="lang-none prettyprint-override"><code>Python 3.6.4 (v3.6.4:d48eceb, Dec 19 2017, 06:04:45) [MSC v.1900 32 bit (Intel)] on win32
Type "help", "copyright", "credits" or "license" for more information.
&gt;&gt;&gt; import gzip
&gt;&gt;&gt; with gzip.open("ResultList_example2.zip", "rb") as f: data = f.read()
...
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in &lt;module&gt;
  File "C:\Python36\lib\gzip.py", line 276, in read
    return self._buffer.read(size)
  File "C:\Python36\lib\gzip.py", line 463, in read
    if not self._read_gzip_header():
  File "C:\Python36\lib\gzip.py", line 411, in _read_gzip_header
    raise OSError('Not a gzipped file (%r)' % magic)
OSError: Not a gzipped file (b'PK')
</code></pre>
<p>You will need to use the <a href="https://docs.python.org/3/library/zipfile.html" rel="nofollow noreferrer">zipfile module</a> instead.</p>
</div>
<div class="post-text" itemprop="text">
<p>i was uploading a corrupted .gz file. The code is fine and is working well now.</p>
</div>
<span class="comment-copy">how do you say that it isnt a gzipped file? content type is <b>'ContentType':'application/x-gzip'</b></span>
<span class="comment-copy">@GaneshKumar how do you know the <code>Content-Type</code> isn't simply wrong?  That isn't set by S3.  That value is whatever is set when the file was uploaded.  <code>PK</code> is the <a href="https://en.m.wikipedia.org/wiki/Magic_number_(programming)" rel="nofollow noreferrer">magic string</a> for identifying zip files.</span>
<span class="comment-copy">Yeah. thanks for your answer man. got the solution.</span>
