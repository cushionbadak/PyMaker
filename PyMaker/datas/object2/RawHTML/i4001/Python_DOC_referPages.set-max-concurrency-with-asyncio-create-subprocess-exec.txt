<div class="post-text" itemprop="text">
<p>I need to run a program about 500 times with different inputs.
I'd like to use <code>asyncio.create_subprocess_exec</code> and want to limit the number of processes running at the same time so as not to clog up the machine. 
Is there a way to set the concurrency level? For example, I'd expect something like <code>AbstractEventLoop.set_max_tasks</code>.</p>
</div>
<div class="post-text" itemprop="text">
<p>As <a href="https://stackoverflow.com/questions/50283102/set-max-concurrency-with-asyncio-create-subprocess-exec/50293509#comment87586906_50283102">suggested</a> by @AndrewSvetlov, you can use an <a href="https://docs.python.org/3/library/asyncio-sync.html#asyncio.Semaphore" rel="nofollow noreferrer"><code>asyncio.Semaphore</code></a> to enforce the limit:</p>
<pre><code>async def run_program(input):
    p = await asyncio.create_subprocess_exec(...)
    # ... communicate with the process ...
    p.terminate()
    return something_useful

async def run_throttled(input, sem):
    async with sem:
        result = await run_program(input)
    return result

LIMIT = 10

async def many_programs(inputs):
    sem = asyncio.Semaphore(LIMIT)
    results = await asyncio.gather(
        *[run_throttled(input, sem) for input in inputs])
    # ...
</code></pre>
</div>
<span class="comment-copy">Use <code>asyncio.Semaphore</code></span>
