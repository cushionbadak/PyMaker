<div class="post-text" itemprop="text">
<p>Consider the following python snippet (I am running Python 3)</p>
<pre><code>name = "Sammy" 

def greet():
    name = 'johny'
    def hello():
        print('hello ' + name) # gets 'name' from the enclosing 'greet'
    hello()

greet()
</code></pre>
<p>This produces the output <code>hello johny</code> as expected</p>
<p>However,</p>
<pre><code>x = 50

def func1():
    x = 20
    def func2():
        print("x is ", x) # Generates error here
        x = 2
        print("Changed the local x to ",x)
    func2()

func1()
print("x is still ",x)
</code></pre>
<p>generates an <code>UnboundLocalError: local variable 'x' referenced before assignment</code>.</p>
<p>Why does the first snippet work, whereas the second doesn't? </p>
</div>
<div class="post-text" itemprop="text">
<p>The error is actually caused (indirectly) by the following line, i.e. <code>x = 2</code>. Try commenting out that line and you'll see that the function works.</p>
<p>The fact that there is an assignment to a variable named <code>x</code> makes <code>x</code> local to the function at <em>compile time</em>, however, at <em>execution time</em> the first reference to <code>x</code> fails because, at the time that the <code>print()</code> statement is executed, it does not exist yet <em>in the current scope</em>.</p>
<p>Correct it by using <a href="https://docs.python.org/3/reference/simple_stmts.html#the-nonlocal-statement" rel="nofollow noreferrer"><code>nonlocal</code></a> in <code>func2()</code>:</p>
<pre><code>def func2():
    nonlocal x
    print("x is ", x)
    x = 2
    print("Changed the local x to ",x)
</code></pre>
<p>The reason that the first function (<code>greet()</code>) works is because it's OK to read variables in an outer scope, however, you can not assign to them unless you specify that the variable exists in an outer scope (with <code>nonlocal</code> or <code>global</code>).</p>
<p>You can assign to a variable of the same name, however, that would create a new local variable, not the variable in the outer scope. So this also works:</p>
<pre><code>def func1():
    x = 20
    def func2():
        x = 2
        print('Inner x is', x)
    func2()
    print('Outer x is', x)
</code></pre>
<p>Here <code>x</code> is assigned to before being referenced. This creates a new variable named <code>x</code> in the scope of function <code>func2()</code> which shadows the <code>x</code> defined in <code>func1()</code>.</p>
</div>
<div class="post-text" itemprop="text">
<p>In a given scope, <em>you can only reference a variable's name from one given scope</em>. Your variable cannot be global at some point and local later on or vice versa.</p>
<p>For that reason, if <code>x</code> is ever to be declared in a scope, Python will assume that you are refering to the local variable everywhere in that scope, unless you explicitly state otherwise.</p>
<p>This is why you first function, <code>greet</code>, works. The variable <code>name</code> is unambiguously coming from the closure. Although, in <code>func2</code> the variable <code>x</code> is used in the scope and thus you cannot reference the <code>x</code> from the closure unless explicitly stating otherwise with <a href="https://docs.python.org/3/reference/simple_stmts.html#the-nonlocal-statement" rel="nofollow noreferrer"><code>nonlocal</code></a>.</p>
<p>The following errors might enlighten us on this.</p>
<h2>A variable cannot become global after use</h2>
<pre><code>def func1():
    x = 20
    def func2():
        print("x is ", x)
        global x
        print("Changed the local x to ",x)
    func2()
</code></pre>
<p>This raises a <code>SyntaxError: name 'x' is used prior to global declaration</code>. This means that the closure's <code>x</code> cannot be used and then the global one.</p>
<h2>A global variable cannot become local</h2>
<p>Here is another case using <code>global</code> at the top of <code>func2</code>.</p>
<pre><code>def func1():
    x = 20
    def func2():
        global x
        print("x is ", x)
        x = 2
        print("Changed the local x to ",x)
    func2()
</code></pre>
<p>This code was exectued without error, but notice that the assignment to <code>x</code> updated the global variable, it did not make <code>x</code> become local again.</p>
</div>
