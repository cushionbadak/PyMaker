<div class="post-text" itemprop="text">
<p>So, having the unittest.mock and the code</p>
<pre><code>with pysftp.Connection(host, username, password, port) as sftp:
             sftp.get("filename")
</code></pre>
<p>... one can assert <code>Connection.assert_called_with(host, username, password, port)</code>.
But assertion <code>Connection.assert_called_with(host, username, password, port).get("filename")</code> fails. </p>
<p>How do I assert that?</p>
</div>
<div class="post-text" itemprop="text">
<p>I'm assuming that you would like to <a href="https://docs.python.org/3/library/unittest.mock.html#patch" rel="nofollow"><code>patch</code></a> <code>pysftp.Connection</code> reference.</p>
<p>Here is an example of how you can do your test:</p>
<pre><code>&gt;&gt;&gt; import pysftp
&gt;&gt;&gt; from mock import *

&gt;&gt;&gt; with patch("pysftp.Connection") as mock_connection:
...     with pysftp.Connection("1.2.3.4", "user", "pwd", 12345) as sftp:
...         sftp.get("filename")
...     mock_connection.assert_called_with("1.2.3.4", "user", "pwd", 12345)
...     sftp.get.assert_called_with("filename")
... 
&lt;MagicMock name='Connection().__enter__().get()' id='139907730030992'&gt;
</code></pre>
<p>Because <code>sftp</code> object is a <code>MagicMock</code> you can use it directly. As you can see in the log <code>sftp</code> is exactly the same of</p>
<pre><code>mock_connection.return_value.__enter__.return_value
</code></pre>
<ul>
<li><code>Connection</code> -&gt; <code>mock_connection</code></li>
<li><code>()</code> -&gt; <code>return_value</code></li>
</ul>
</div>
<span class="comment-copy">Please post a complete runable example where is clear what you <code>patch</code>/<code>mock</code> and how. Like it is the question have no sense.</span>
