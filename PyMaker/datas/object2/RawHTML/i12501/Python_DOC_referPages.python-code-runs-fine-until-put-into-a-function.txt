<div class="post-text" itemprop="text">
<p>So I developed python code that sends a quote in the form of a text message. It runs properly when ran in a simple script. However, once I put the code into a function and call the function then it fails to work. It sends a blank text message, instead of the quote.</p>
<p>Here's the code working:</p>
<pre><code>import smtplib
import urllib2

''' open webpage and grab randomly generated quote '''
response = urllib2.urlopen("http://inspirationalshit.com/quotes")
page = response.read()
split = page.split('&lt;blockquote&gt;')[1]
split = split.split('class="text-uppercase";&gt;')[1]
quote = split.split('&lt;/p&gt;')[0].strip()

'''email credentials (throwaway account) '''
username = "**********@gmail.com"
password = "*********"
phone = "********@vtext.com"
message = quote

''' format the email '''
msg = """From: %s
To: %s
Subject:
%s""" % (username, phone, message)

''' send the email '''
server = smtplib.SMTP("smtp.gmail.com", 587)
server.starttls()
server.login(username, password)
server.sendmail(username, phone, msg)
server.quit()
</code></pre>
<p>Here's the nonfunctional code</p>
<pre><code>import urllib2
import smtplib
import schedule
import time


def job():
    print "RAN"
    ''' open webpage and grab randomly generated quote '''
    response = urllib2.urlopen("http://inspirationalshit.com/quotes")
    page = response.read()
    split = page.split('&lt;blockquote&gt;')[1]
    split = split.split('class="text-uppercase";&gt;')[1]
    quote = split.split('&lt;/p&gt;')[0].strip()

    '''email credentials (throwaway account) '''
    username = "*********@gmail.com"
    password = "********"
    phone = "********@vtext.com"
    message = quote

    ''' format the email '''
    msg = """From: %s
    To: %s
    Subject:
    %s""" % (username, phone, message)
    print msg
    ''' send the email '''
    server = smtplib.SMTP("smtp.gmail.com", 587)
    server.starttls()
    server.login(username, password)
    server.sendmail(username, phone, msg)
    server.quit()


job()
</code></pre>
</div>
<div class="post-text" itemprop="text">
<pre><code>    ''' format the email '''
    msg = """From: %s
    To: %s
    Subject:
    %s""" % (username, phone, message)
    print msg
</code></pre>
<p>Maybe <code>sendmail</code> is sensitive to the whitespace at the beginning of each line of this string. Try de-indenting them.</p>
<pre><code>    ''' format the email '''
    msg = """From: %s
To: %s
Subject:
%s""" % (username, phone, message)
    print msg
</code></pre>
</div>
<span class="comment-copy">It looks like you're sending emails, not text messages.</span>
<span class="comment-copy">if you try to <code>print(quote)</code> in the function, does it print the expected text?</span>
<span class="comment-copy">@elsherbini yes, it prints the same thing in both cases.</span>
<span class="comment-copy">Good suggestion. If that works, the OP may want to use <a href="https://docs.python.org/3/library/textwrap.html#textwrap.dedent" rel="nofollow noreferrer"><code>textwrap.dedent</code></a> so the code can be formatted nicely and everything will still work.</span>
<span class="comment-copy">Nice that did it, thanks! I assumed it had to do something with the text format, but I didn't think it was the indent. Good catch!</span>
<span class="comment-copy">@Aweava, if this solved your problem please remember to <a href="https://meta.stackexchange.com/questions/5234/how-does-accepting-an-answer-work">accept it</a>. Later, when you've earned more reputation, you will also be able to vote answers up or down.</span>
