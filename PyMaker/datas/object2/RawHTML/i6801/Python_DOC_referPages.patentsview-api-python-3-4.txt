<div class="post-text" itemprop="text">
<p>I am beginner in python, currently working on a small project with Python. 
I want to build a dynamic script for patent research for patentsview.org.</p>
<p>Here is my code:</p>
<pre><code>import urllib.parse
import urllib.request


#http://www.patentsview.org/api/patents/query?q={"_and":
[{"inventor_last_name":author},{"_text_any":{"patent_title":[title]}}]}&amp;o=
{"matched_subentities_only": "true"}
author = "Jobs"
andreq = "_and"
invln = "inventor_last_name"
text = "_text_any"
patent = "patent_title"
match = "matched_subentities_only"
true = "true"
title = "computer"
urlbasic = "http://www.patentsview.org/api/patents/query"
patentall = {patent:title}
textall = {text:patentall}
invall = {invln:author}
andall = invall.copy()
andall.update(textall)
valuesq = {andreq:andall}
valuesqand = {andreq:andall}
valuesq = {andreq:valuesqand}
valueso = {match:true}

#########
url = "http://www.patentsview.org/api/patents/query"
values = {"q":valuesq,
          "o":valueso}
print(values)


data = urllib.parse.urlencode(values)
print(data)
############
data = data.encode("UTF-8")
print(data)
req = urllib.request.Request(url,data)
resp = urllib.request.urlopen(req)
respData = resp.read()
saveFile = open("patents.txt", "w")
saveFile.write(str(respData))
saveFile.close()
</code></pre>
<p>I think I got the right start for the dynamic URL - but the encoding seems to give me a HTTP Error 400: Bad request. 
If i dont encode, the url will be like www.somethingsomething.org/o:{....} which obviously produces an error.
Here is the error:</p>
<pre><code>Traceback (most recent call last):
  File "C:/Users/Max/PycharmProjects/KlayerValter/testen.py", line 38, in 
&lt;module&gt;
resp = urllib.request.urlopen(req)
File "C:\Python34\lib\urllib\request.py", line 161, in urlopen
return opener.open(url, data, timeout)
  File "C:\Python34\lib\urllib\request.py", line 469, in open
response = meth(req, response)
  File "C:\Python34\lib\urllib\request.py", line 579, in http_response
'http', request, response, code, msg, hdrs)
File "C:\Python34\lib\urllib\request.py", line 507, in error
return self._call_chain(*args)
  File "C:\Python34\lib\urllib\request.py", line 441, in _call_chain
result = func(*args)
File "C:\Python34\lib\urllib\request.py", line 587, in http_error_default
raise HTTPError(req.full_url, code, msg, hdrs, fp)
urllib.error.HTTPError: HTTP Error 400: Bad Request

Process finished with exit code 1
</code></pre>
<p>If I encode, i get the same error since all brackets get converted.
The API of patentsview works as follows:</p>
<pre><code>http://www.patentsview.org/api/patents/query?q={"_or":[{"_and":
[{"inventor_last_name":"Whitney"},{"_text_phrase":{"patent_title":"cotton 
gin"}}]},{"_and":[{"inventor_last_name":"Hopper"},{"_text_all":
{"patent_title":"COBOL"}}]}]}
</code></pre>
<p>For dynamic programming I had to come up with all the library names. If there is also a better solution, please help.</p>
<p>Best Regards.</p>
</div>
<div class="post-text" itemprop="text">
<p>The api accepts and returns json data, so you should use <a href="https://docs.python.org/3/library/json.html#json.dumps" rel="nofollow noreferrer"><code>json.dumps</code></a> to encode your post data. Then use <a href="https://docs.python.org/3/library/json.html#json.loads" rel="nofollow noreferrer"><code>json.loads</code></a> on the response if you want a dictionary, or just write to file.  </p>
<pre><code>from urllib.request import Request, urlopen
import json

url = "http://www.patentsview.org/api/patents/query"
author = "Jobs"
title = "computer"
data = {
    'q':{
        "_and":[
            {"inventor_last_name":author},
            {"_text_any":{"patent_title":title}}
        ]
    }, 
    'o':{"matched_subentities_only": "true"}
}
resp = urlopen(Request(url, json.dumps(data).encode()))
data = resp.read()
#data = json.loads(data)
</code></pre>
<p>As suggested by Christian, you could simply use <a href="http://docs.python-requests.org/en/master/" rel="nofollow noreferrer"><code>requests</code></a>, it's much better than <code>urllib</code>.</p>
<pre><code>data = requests.post(url, json=data).json()
</code></pre>
<hr/>
<p>As for all those variables in your code, they compose a dictionary like the one below:  </p>
<pre><code>values = {"q":{andreq:{andreq:{invln:author, text:{patent:title}}}}, "o":{match:true}}
</code></pre>
<p>I don't see why you would go through all that trouble to build a dictionary but i could be wrong. However you could wrap your code in a function with <code>author</code> and <code>title</code> as arguments.<br/>
<hr/>
With <code>requests</code> you don't have to use <code>json.dumps</code> on your data, just use the <code>json</code> parameter. If you want to save the response content to file you should use the <code>content</code> or <code>text</code> attribute.</p>
<pre><code>import requests

title = "computer" 
author = "Jobs" 
url = "http://www.patentsview.org/api/patents/query" 
data = { 
    "q":{ "_and":[ {"inventor_last_name":author}, {"_text_any":{"patent_title":title}}] }, 
    "o":{"matched_subentities_only":"true"} 
} 
resp = requests.post(url, json=data) 
with open("patents.txt", "w") as f:
    f.write(resp.text)
</code></pre>
</div>
<span class="comment-copy">Suggestion: use the <a href="http://docs.python-requests.org/en/master/" rel="nofollow noreferrer">requests</a> library instead of fighting with urllib -- it'll make your life a lot easier.</span>
<span class="comment-copy">" data = requests.post(url, json=data).json() "  This does not work.  resp = requests.post(url, json=data).json() saveFile = open("patents.txt", "w") saveFile.write(str(resp)) saveFile.close()  Gives me this:  ValueError: Expecting value: line 1 column 1 (char 0)</span>
<span class="comment-copy">The <code>ValueError</code> exception means that <code>.json()</code> failed to decode the response. Please make sure to pass valid data in the <code>json</code> parameter. If you update your post with your current code, i could take a look at it.</span>
<span class="comment-copy">import requests import json title = "computer" author = "Jobs" url = "<a href="http://www.patentsview.org/api/patents/query" rel="nofollow noreferrer">patentsview.org/api/patents/query</a>" data = {     "q":{         "and":[             {"inventor_last_name":author},             {"_text_any":{"patent_title":title}}]     },     "o":{"matched_subentities_only":"true"} } var = json.dumps(data) resp = requests.post(url,data=var)  saveFile = open("patents.txt", "w") saveFile.write(str(resp)) saveFile.close()   saveFile = open("patents.txt", "w") saveFile.write(str(resp)) saveFile.close()</span>
<span class="comment-copy">You've mistyped <code>"_and"</code>. That causes a 500 ERROR response which is obviously not a json response, so <code>.json()</code> fails.  I've updated my post give it a try.</span>
<span class="comment-copy">Thanks alot! - It was a long night. Case closed!</span>
