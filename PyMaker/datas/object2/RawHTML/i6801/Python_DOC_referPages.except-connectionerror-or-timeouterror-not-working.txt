<div class="post-text" itemprop="text">
<p>In case of a connection error, I want Python to wait and re-try. Here's the relevant code, where "link" is some link:</p>
<pre><code>import requests
import urllib.request
import urllib.parse

from random import randint

try:
    r=requests.get(link)

except ConnectionError or TimeoutError:
    print("Will retry again in a little bit")
    time.sleep(randint(2500,3000))
    r=requests.get(link)
</code></pre>
<p>Except I still periodically get a connection error. And I never see the text "Will retry again in a little bit" so I know the code is not re-trying. What am I doing wrong? I'm pasting parts of the error code below in case I'm misreading the error. TIA!</p>
<p>TimeoutError: [WinError 10060] A connection attempt failed because the connected party did not properly respond after a period of time, or established connection failed because connected host has failed to respond</p>
<p>During handling of the above exception, another exception occurred:</p>
<p>requests.packages.urllib3.exceptions.ProtocolError: ('Connection aborted.', TimeoutError(10060, 'A connection attempt failed because the connected party did not properly respond after a period of time, or established connection failed because connected host has failed to respond', None, 10060, None))</p>
<p>During handling of the above exception, another exception occurred:</p>
<p>requests.exceptions.ConnectionError: ('Connection aborted.', TimeoutError(10060, 'A connection attempt failed because the connected party did not properly respond after a period of time, or established connection failed because connected host has failed to respond', None, 10060, None))</p>
</div>
<div class="post-text" itemprop="text">
<p>The second request is not inside a try block so exceptions are not  caught.  Also in the try-except block you're not catching other exceptions that may occur.<br/>
You could use a loop to attempt a connection two times, and break if the request is successful. </p>
<pre><code>for _ in range(2):
    try:
        r = requests.get(link)
        break
    except (ConnectionError, TimeoutError):
        print("Will retry again in a little bit")
    except Exception as e:
        print(e)
    time.sleep(randint(2500,3000))
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>I think you should use</p>
<pre><code>except (ConnectionError, TimeoutError) as e:
    print("Will retry again in a little bit")
    time.sleep(randint(2500,3000))
    r=requests.get(link)
</code></pre>
<p>See <a href="https://stackoverflow.com/questions/6470428/catch-multiple-exceptions-in-one-line-except-block">this</a> similar question, or check the <a href="https://docs.python.org/3/tutorial/errors.html#handling-exceptions" rel="nofollow noreferrer">docs</a>.</p>
</div>
<span class="comment-copy">Thanks, will try this! Question: will this loop always sleep for 2500-3000 seconds or only if a connection error occurs? I want the latter, but it looks like this code is doing the former.</span>
<span class="comment-copy">Only on error. If the request is successful the <code>break</code> statement  breaks the loop before <code>time.sleep</code> is called.</span>
<span class="comment-copy">Thanks, this is working!</span>
<span class="comment-copy">Thanks! What will "pass" do in this case? Cause the code under "try" to re-run again? Also, I do want to make the script wait a non-trivial amount before re-trying, and your suggestion doesn't seem to do that.</span>
<span class="comment-copy">pass does nothing, you should replace it with your code. You should keep whatever code you have within the except block, i.e. your time.sleep call etc. I've edited my answer to use your code in the except block. Sorry for the confusion.</span>
<span class="comment-copy">That makes sense, thanks!  I updated my code and am re-running it just to make sure this fixed the issue.</span>
<span class="comment-copy">Is there really a reason to assign an alias <code>e</code> in this case? You never use it again. <code>except (ConnectionError, TimeoutError):</code> will suffice.</span>
<span class="comment-copy">I tried this version, and it didn't fix the issue. Still broke down on a Connection/TimeoutError without printing "Will retry again in a little bit" and re-trying.</span>
