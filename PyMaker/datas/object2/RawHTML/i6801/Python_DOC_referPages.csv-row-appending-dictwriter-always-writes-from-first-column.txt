<div class="post-text" itemprop="text">
<p><strong>Input file:</strong></p>
<pre><code>$ cat test.csv 
company,spread,cat1,cat2,cat3
A,XYZ,32,67,0
B,XYZ,43,0,432
C,XYZ,32,76,32
D,XYZ,454,87,43
E,XYZ,0,0,65
F,XYZ,0,0,7
</code></pre>
<p><strong>Expected CSV output</strong> (Sum columns <code>cat1</code>, <code>cat2</code> and <code>cat3</code> and append the sum.):</p>
<pre><code>$ cat test.csv 
company,spread,cat1,cat2,cat3
A,XYZ,32,67,0
B,XYZ,43,0,432
C,XYZ,32,76,32
D,XYZ,454,87,43
E,XYZ,0,0,65
F,XYZ,0,0,7
,,561,230,579
</code></pre>
<p><strong>Code:</strong></p>
<pre><code>import csv

all_keys = ['cat1', 'cat2', 'cat3']
default_values = {i: 0 for i in all_keys}

def read_csv():
    with open('test.csv', 'r') as f:
        reader = csv.DictReader(f)
        yield from reader

for row in read_csv():
    for i in all_keys:
        default_values[i] += int(row[i])

with open('test.csv', 'a') as w:
    writer = csv.DictWriter(w, fieldnames=all_keys)
    writer.writerow(default_values)
</code></pre>
<p><strong>Actual Output:</strong></p>
<pre><code>$ cat test.csv 
company,spread,cat1,cat2,cat3
A,XYZ,32,67,0
B,XYZ,43,0,432
C,XYZ,32,76,32
D,XYZ,454,87,43
E,XYZ,0,0,65
F,XYZ,0,0,7
561,230,579
</code></pre>
<p><strong>Question:</strong></p>
<p>The <code>csv.DictWriter</code> is not appending row with correct column alignment. I understand that I have 5 columns but I am providing values for only 3 columns. But I thought as this is <code>DictWriter</code>, it will append values to only a matching column header. If I open my <code>Actual Output</code> CSV, it is quite visual that columns are not aligned:</p>
<p><a href="https://i.stack.imgur.com/sBRnB.jpg" rel="nofollow noreferrer"><img alt="enter image description here" src="https://i.stack.imgur.com/sBRnB.jpg"/></a></p>
</div>
<div class="post-text" itemprop="text">
<p>You should include the column names for the first two in <code>fieldnames</code>:</p>
<pre><code>with open('test.csv', 'a') as w:
    writer = csv.DictWriter(w, fieldnames=['company', 'spread']+all_keys)
    writer.writerow(default_values)
</code></pre>
<p>Blank values will be written to the first two columns if the keys are not available in the dictionary.</p>
</div>
<div class="post-text" itemprop="text">
<p>You can declare you writter like that:</p>
<pre><code>with open('test.csv', 'a') as w:
    writer = csv.DictWriter(w, fieldnames=all_keys, restval=' ')
    writer.writerow(default_values)
</code></pre>
<p>So you don't have to specify all the missing keys : for all the missing keys, restval char will fill with the value you chose. <a href="https://docs.python.org/3/library/csv.html#csv.DictWriter" rel="nofollow noreferrer">https://docs.python.org/3/library/csv.html#csv.DictWriter</a></p>
</div>
<span class="comment-copy">The optional restval parameter specifies the value to be written if the dictionary is missing a key in fieldnames. From here <a href="https://docs.python.org/3/library/csv.html" rel="nofollow noreferrer">docs.python.org/3/library/csv.html</a>. So DictWriter(f, fieldnames, restval=‚Äù....) should work</span>
<span class="comment-copy">I tried that. But it isn't working. Same result as before. Is something wrong in my code? It as good as <code>restval</code> parameter is completely ignored.</span>
<span class="comment-copy">I have accepted the @moses answer. However, I am interested to know why the <code>restval</code> not working for me. +1 for your time.</span>
<span class="comment-copy">@slayedbylucifer <code>restval</code> only works for keys existing in the <code>fieldnames</code>. In fact my solution uses <code>restval</code> also, whose default value is <code>''</code>; I don't need to explicitly pass it.</span>
<span class="comment-copy">yes absolutely, i missed that part.</span>
