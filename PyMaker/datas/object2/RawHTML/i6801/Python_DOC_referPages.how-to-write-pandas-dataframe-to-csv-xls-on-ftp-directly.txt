<div class="post-text" itemprop="text">
<p>How to create a .csv or .xls file on ftp directly from Pandas dataframe as I do not want to create one on local machine and then push it on ftp. Many thanks in advance :)</p>
</div>
<div class="post-text" itemprop="text">
<p>As <a href="https://docs.python.org/3/library/ftplib.html#ftplib.FTP.storbinary" rel="noreferrer">the docs</a> say:</p>
<blockquote>
<p>Store a file in binary transfer mode. <em>cmd</em> should be an appropriate <code>STOR</code> command: <code>"STOR filename"</code>. <em>file</em> is a file object (opened in binary mode) which is read until EOF using its <code>read()</code> method in blocks of size <em>blocksize</em> to provide the data to be storedâ€¦</p>
</blockquote>
<p>So, you need to give it a file-like object with an appropriate <code>read</code> method.</p>
<p>A string is not a file-like object, but an <a href="https://docs.python.org/3/library/io.html#io.BytesIO" rel="noreferrer"><code>io.BytesIO</code></a> is. So:</p>
<pre><code>from ftplib import *
from StringIO import StringIO
import pandas
import io

ftp = FTP('ftp.mysite.com')
ftp.login('un', 'pw')
ftp.cwd('/')
buffer = StringIO.StringIO()
your_pandas_df.to_csv(buffer)
text = buffer.getvalue()
bio = io.BytesIO(str.encode(text))

ftp.storbinary('STOR filename.csv', bio)
</code></pre>
<p>for reference you can refer <a href="https://stackoverflow.com/questions/25735134/python-write-create-file-directly-in-ftp">Python write create file directly in FTP</a></p>
</div>
<span class="comment-copy">Hi Anurag, thanks for very quick answer.  I can create the file with this line:session.storbinary('STOR myfile', StringIO.StringIO(ResultsToFtp.to_csv('testfile'))) but don't know why the file is always empty. I have checked the dataframe ResultsToFtp has data inside but for some reason file is empty with None on cell A1</span>
<span class="comment-copy">first try to write file into local system (if possible). I think this will give clear picture is there some problem in <code>FTP</code> or producing file like object (i.e <code>StringIO</code> object)</span>
<span class="comment-copy">I did it locally from the same dataframe and works fine</span>
<span class="comment-copy">use <code>ftp.storbinary('STOR myfile', StringIO.StringIO(your_pandas_df))</code> because <a href="https://docs.python.org/2/library/stringio.html" rel="nofollow noreferrer">python stringIO documentation</a> as it need memory object not a file. and <code>dataframe.to_csv</code> does return anything</span>
<span class="comment-copy">Works Fine :) you are awesome...</span>
