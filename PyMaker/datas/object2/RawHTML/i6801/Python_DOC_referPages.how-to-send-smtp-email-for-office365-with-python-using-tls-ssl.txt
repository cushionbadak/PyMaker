<div class="post-text" itemprop="text">
<p>I am trying to send an email from my office365 corporate account using python. I am new to python. This code previously worked when using my hotmail account, however now that I have a need to send confidential information, I must use my corporate email.</p>
<p>I have tried a couple things. </p>
<ul>
<li>Verified that my username and password is correct.</li>
<li>Used both python2 and python3. Both give the same error: <code>535 5.7.3 Authentication unsuccessful</code></li>
<li>I previously was using <strong>mailserver.starttls()</strong> when I got the
above error, then after some research, I tried to pass a<br/>
certificate.<strong>mailserver.starttls(certfile='office365.cer')</strong> </li>
</ul>
<p>I am unclear on the certificate part, but my steps include, looking online to find out how to export a certificate. Using chrome browser, <a href="http://microdoftonline.com" rel="noreferrer">microsoftonline.com</a> has a chain certificate. I can export the root and the level just below the root but not the last level. I dont know how to pass both of these files, so I have simply passed the root certificate. At this point I get the error: <code>ssl.SSLError: [SSL] PEM lib (_ssl.c:3309)</code></p>
<p>i got stuck at this point. Any help is appreciated.
Code used below</p>
<pre><code>import smtplib

mailserver = smtplib.SMTP('smtp.office365.com',587)
mailserver.ehlo()
mailserver.starttls(certfile='office365.cer')
mailserver.ehlo()
mailserver.login('user@company.co', 'password')
mailserver.sendmail('user@company.co','user@company.co','python email')
mailserver.quit()
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>I found a library that it's working for me:</p>
<p><a href="https://github.com/Narcolapser/python-o365" rel="noreferrer">https://github.com/Narcolapser/python-o365</a></p>
<p><a href="https://pypi.python.org/pypi/O365" rel="noreferrer">https://pypi.python.org/pypi/O365</a></p>
<p>Install it using PIP and then:</p>
<pre><code>from O365 import Message
o365_auth = ('YourAccount@office365.com','YourPassword')
m = Message(auth=o365_auth)
m.setRecipients('reciving@office365.com')
m.setSubject('I made an email script.')
m.setBody('Talk to the computer, cause the human does not want to hear it any more.')
m.sendMessage()
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>Well, you are almost there. The following code will do the trick:</p>
<pre><code>import smtplib

mailserver = smtplib.SMTP('smtp.office365.com',587)
mailserver.ehlo()
mailserver.starttls()
mailserver.login('user@company.co', 'password')
mailserver.sendmail('user@company.co','user@company.co','python email')
mailserver.quit()
</code></pre>
<p>Use the following links for more information:</p>
<p><a href="http://www.aventistech.com/2016/03/07/python-send-email-via-office-365-tls/" rel="noreferrer">http://www.aventistech.com/2016/03/07/python-send-email-via-office-365-tls/</a></p>
<p><a href="https://docs.python.org/3/library/smtplib.html" rel="noreferrer">https://docs.python.org/3/library/smtplib.html</a></p>
<p><a href="https://gist.github.com/jasonjoh/3ec367594c3fa662ee983a617bdc7deb" rel="noreferrer">https://gist.github.com/jasonjoh/3ec367594c3fa662ee983a617bdc7deb</a></p>
</div>
<span class="comment-copy">I just want to point out for anyone seeing this in the future; while this library works, it does not use SMTP. It uses the Microsoft Outlook/Graph API in order to access your Office 365 account and send emails. See Gal's answer below if you want to use SMTP.</span>
<span class="comment-copy">NOTICE: the use of smtplib.SMTP() instead of smtplib.SMTP_SSL() !  With smtplib.SMTP_SSL() you will still get the "[SSL: WRONG_VERSION_NUMBER]" error.  replacing it with smtplib.SMTP() worked for me.</span>
<span class="comment-copy">how secure is this code? What happens if the server refuses to use TLS? will the connection go unencrypted or be aborted?</span>
