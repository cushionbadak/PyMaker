<div class="post-text" itemprop="text">
<p>I wrote a script for backing up my Neo4J DB.</p>
<p>At the end of the backup process and email is sent to the DB Administrator</p>
<p>The email received without the <code>message_body</code>.</p>
<p>This is the code:</p>
<pre><code>message = MIMEMultipart('alternative')
message['To'] = "Database Admin &lt;%s&gt;" % _receiver
message['From'] = "Pico.buzz Graph Database &lt;%s&gt;" % _sender
if not log.is_error():
    message['Subject'] = "Graph DB Backup Finished Successfully"
    message_body = 'Successfully backup email. Please see review log file'
else:
    message['Subject'] = "ATTENTION: ERROR! Graph DB Backup Failed"
    message_body = 'An error occur during backup. please review log'
instance_name = aws.get_instance_name()
instance_details = "Instance Id: %s\nPrivate IP Address: %s" % (aws.get_instance_id(), aws.get_instance_ip())
if instance_name is not None:
    instance_details = """Instance Name: %s\n%s""" % (instance_name, instance_details)
message_body = "%s\n\n%s" % (message_body, instance_details)
content = MIMEText(message_body, 'plain')
message.attach(content)
message.attach(_get_log_file())
smtp = smtplib.SMTP('localhost')
smtp.sendmail(_sender, _receiver, message.as_string())
log.info(__name__, "Successfully sent email to: %s" % _receiver)
</code></pre>
<p>Any idea why?</p>
</div>
<div class="post-text" itemprop="text">
<p><code>MIMEMultipart</code> takes as a parameter to the constructor a multipart subtype.</p>
<p>You were using the subtype <code>'alternative'</code>. The alternative subtype allows the email to be sent with HTML and text.</p>
<p>You wanted to submit an email with text and an attachment, so you need to construct <code>MIMEMultipart</code> with the subtype <code>'mixed'</code>.</p>
<p>For more details about these subtypes, you can look at the MIME Wikipedia entry on <a href="https://en.wikipedia.org/wiki/MIME#Multipart_messages" rel="nofollow">Multipart messages</a>.</p>
</div>
<span class="comment-copy">You've confirmed that <code>message_body</code> is what you expect before your <code>sendmail</code> call I presume?</span>
<span class="comment-copy">I printed it and was happy.. :)</span>
<span class="comment-copy">Unrelated, but <code>%s</code> formatting is typically avoided. You should look at <a href="https://docs.python.org/3/library/functions.html#format" rel="nofollow noreferrer">this</a>.</span>
<span class="comment-copy">Will do, thanks!</span>
<span class="comment-copy">Which version of python do you use? What <code>type(_get_log_file())</code> returns? What happens, if you first attach <code>_get_log_file()</code> to the message, and the <code>content</code> (order of attachment matters)?</span>
