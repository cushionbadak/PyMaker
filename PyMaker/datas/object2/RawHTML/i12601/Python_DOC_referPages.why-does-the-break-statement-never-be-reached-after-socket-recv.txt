<div class="post-text" itemprop="text">
<p>I write the following code to receive data, then write the data to a file.</p>
<p>My question is:
     I found the if branch (" if not data: break ") never be executed,
     1). Why does the if branch never be reached?
     2). How my code can exit the while loop?</p>
<pre><code>s = socket.socket(socket.AF_UNIX, socket.SOCK_STREAM)
s.connect("/var/run/output.socket")

while True:
    data = s.recv(1024)
    if not data:
        break
    else:
        f = open("/home/ematt/test.log",'a')
        f.write(data)
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>socket.recv always has data. It will wait until some data arrives.</p>
<p>See <a href="https://docs.python.org/2/library/socket.html" rel="nofollow">https://docs.python.org/2/library/socket.html</a></p>
</div>
<div class="post-text" itemprop="text">
<p><a href="https://docs.python.org/3/library/socket.html" rel="nofollow noreferrer">socket.recv</a> is a blocking call, it returns when data has been received (or the peer has closed the connection)</p>
<p>In case you want to avoid waiting on data to arrive, you can set the socket to <a href="https://docs.python.org/3/library/socket.html#socket.socket.setblocking" rel="nofollow noreferrer">non-blocking mode</a> using</p>
<pre><code>s.setblocking(False)
</code></pre>
<p>In such mode, <code>recv</code> throws an exception when no data is available.
Please see <a href="https://stackoverflow.com/questions/16745409/what-does-pythons-socket-recv-return-for-non-blocking-sockets-if-no-data-is-r">this SO QA</a> for more info and a code example on how to use it</p>
</div>
<span class="comment-copy">Except when the connection is closed by the remote party.</span>
