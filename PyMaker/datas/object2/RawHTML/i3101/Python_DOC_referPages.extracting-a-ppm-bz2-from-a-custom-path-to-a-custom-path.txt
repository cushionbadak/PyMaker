<div class="post-text" itemprop="text">
<p>as the title says, I have several folders, several .ppm.bz2 files and I want to extract them exactly where they are using python.</p>
<p><a href="https://i.stack.imgur.com/U3vpB.png" rel="nofollow noreferrer">Directory structure image</a></p>
<p>I am traversing in the folders as this:</p>
<pre><code> import tarfile
 import os
 path = '/Users/ankitkumar/Downloads/colorferet/dvd1/data/images/'
 folders = os.listdir(path)
 for folder in folders:  #the folders starting like 00001
     if not folder.startswith("0"):
         pass
     path2 = path + folder
     zips = os.listdir(path2)
     for zip in zips:
         if not zip.startswith("0"):
             pass
         path3 = path2+"/"+zip

         fh = tarfile.open(path3, 'r:bz2')
         outpath = path2+"/"
         fh.extractall(outpath)
         fh.close
</code></pre>
<p>`</p>
<p>then I get this error
`</p>
<pre><code>Traceback (most recent call last):
  File "ZIP.py", line 16, in &lt;module&gt;
    fh = tarfile.open(path3, 'r:bz2')
  File "/anaconda2/lib/python2.7/tarfile.py", line 1693, in open
    return func(name, filemode, fileobj, **kwargs)
  File "/anaconda2/lib/python2.7/tarfile.py", line 1778, in bz2open
    t = cls.taropen(name, mode, fileobj, **kwargs)
  File "/anaconda2/lib/python2.7/tarfile.py", line 1723, in taropen
    return cls(name, mode, fileobj, **kwargs)
  File "/anaconda2/lib/python2.7/tarfile.py", line 1587, in __init__
    self.firstmember = self.next()
  File "/anaconda2/lib/python2.7/tarfile.py", line 2370, in next
    raise ReadError(str(e))
tarfile.ReadError: invalid header
</code></pre>
<p>`</p>
</div>
<div class="post-text" itemprop="text">
<p>The tarfile module is for tar files, including <code>tar.bz2</code>. if your file is not <code>tar</code> you should use <code>bz2</code> module directly.</p>
<p>Also, try using <code>os.walk</code> instead of multiple <code>listdir</code> as it can traverse the tree</p>
<pre><code>import os
import bz2
import shutil

for path, dirs, files in os.walk(path):
    for filename in files:
        basename, ext = os.path.splitext(filename)
        if ext.lower() != '.bz2':
            continue
        fullname = os.path.join(path, filename)
        newname = os.path.join(path, basename)
        with bz2.open(fullname) as fh, open(newname, 'wb') as fw:
            shutil.copyfileobj(fh, fw)
</code></pre>
<p>This will uncompress all <code>.bz2</code> files in all subfolders, in the same place they are. All other files will stay the same. If the uncompressed file already exists it will be overwritten.</p>
<p><em>Please backup your data before running destructive code</em></p>
</div>
<span class="comment-copy">but problem is not getting the bz2 file, I want the exact path for getting the file as well as extracting the ppm at that place. moreover after doing this, I got the error ` /Users/ankitkumar/Downloads/colorferet/dvd1/data/images/00658/00658_941121_hr.ppm.bz2 Traceback (most recent call last):   File "File.py", line 12, in &lt;module&gt;     fh = tarfile.open(fullname)   File "/anaconda2/lib/python2.7/tarfile.py", line 1680, in open     raise ReadError("file could not be opened successfully") tarfile.ReadError: file could not be opened successfully `</span>
<span class="comment-copy">@ankiiiiiii That's what the code above will do - did you try it? The exact path is in the <code>path</code> variable.</span>
<span class="comment-copy">@ankiiiiiii you shouldn't use the tarfile module. I edited the answer.</span>
<span class="comment-copy">am I missing something?   with bz2.open(fullname) as fh, bz2.open(newname, 'wb') as fw: AttributeError: 'module' object has no attribute 'open'</span>
<span class="comment-copy">are you using python 3.3 or above? <a href="https://docs.python.org/3/library/bz2.html#bz2.open" rel="nofollow noreferrer">docs.python.org/3/library/bz2.html#bz2.open</a> @ankiiiiiii if python 2 use <code>bz2.BZ2File</code> instead of <code>bz2.open</code></span>
