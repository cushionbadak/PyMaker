<div class="post-text" itemprop="text">
<p>I am starting a process and storing it in a variable:</p>
<pre><code> self.wpa_sup=subprocess.Popen(["/usr/sbin/wpa_supplicant", "-Dnl80211,wext", "-i",self.linux_iface, "-c", "/etc/wpa_supplicant_%s.conf"%self.name, "-s"], 
                stdout=open('/dev/null','w'),  stderr=subprocess.STDOUT)
</code></pre>
<p>If I print the variable I can see that the value is stored.
I can see that <code>wpa_supplicant</code> is indeed started.</p>
<p>However when I check the <code>poll()</code> value I am getting <code>255</code> instead of <code>None</code></p>
<pre><code>print self.wpa_sup.poll()
</code></pre>
<p>When I am stopping the process I do it like so:</p>
<pre><code>self.wpa_sup.terminate()
self.wpa_sup.wait()
self.wpa_sup=None
</code></pre>
<p>Sometimes (a lot of the time) it works, I can stop and start the process, read the value from <code>poll()</code> successfully, however it appears to be unreliable. Any idea why this could be happening?</p>
</div>
<div class="post-text" itemprop="text">
<blockquote>
<p>I can see that <code>wpa_supplicant</code> is indeed started.</p>
</blockquote>
<p>if <code>.poll()</code> returns a non-<code>None</code> value; it means the process is <em>dead</em> and moreover it is <em>reaped</em> already (the status is read) i.e., you won't see anything in the process table. If you see something after <code>.poll() == 255</code>; it means that you are looking at a different process e.g., the child process started by <code>Popen()</code> might have started a grandchild process in turn and <code>wpa_supplicant</code> exited while the grandchild continues to run or you might see some unrelated to your script process. Compare <code>wpa_supplicant.pid</code> with what you see in the process table, to find out which scenario you are observing (if they are close then the former is more likely than the latter). </p>
<p>The meaning of the specific return code depends on a command e.g., <a href="http://man7.org/linux/man-pages/man1/ssh.1.html" rel="nofollow noreferrer"><code>ssh</code> returns <code>255</code> in case of an error</a> (otherwise it returns the exit status of the remote command that it runs -- <a href="http://wiki.bash-hackers.org/dict/terms/exit_status" rel="nofollow noreferrer"><code>255</code> indicates wrong argument to the <code>exit</code> builtin in bash</a> and therefore it is less likely that the remote program produces it). Remove <code>stdout=open('/dev/null', 'w')</code>, to see errors as <a href="https://stackoverflow.com/questions/35200176/subprocess-poll-returning-wrong-value/35203041#comment58119031_35200176">@Andrea Corbellini suggested</a>.</p>
</div>
<span class="comment-copy">If <code>poll()</code> is returning 255, it means your process exited with status 255. Try reading its stdout/err to figure out why (remove <code>stdout=open('/dev/null','w')</code>)</span>
<span class="comment-copy">Off topic: there exists <a href="https://docs.python.org/3/library/subprocess.html#subprocess.DEVNULL" rel="nofollow noreferrer"><code>subprocess.DEVNULL</code></a></span>
<span class="comment-copy">@AndreaCorbellini Thanks, didn't know that existed. I have found the problem, will reply to the answer Sebastian gave.</span>
<span class="comment-copy">But <code>os.devnull</code> already exists in 2.7.</span>
<span class="comment-copy">Thanks Sebastian, I have tracked it down. The code was running in a daemon and this had silently restarted which was causing issues. Fixing the problem with the daemon restarting solved the issue.</span>
