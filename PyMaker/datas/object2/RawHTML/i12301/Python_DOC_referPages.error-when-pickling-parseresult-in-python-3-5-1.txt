<div class="post-text" itemprop="text">
<p>I have test code that works in Python 2.7.11, but fails in Python 3.5.1:</p>
<pre><code>import pyparsing as pp
import pickle

class Greeting():
    def __init__(self, toks):
        self.salutation = toks[0]
        self.greetee = toks[1]

word = pp.Word(pp.alphas+"'.")
salutation = pp.OneOrMore(word)
comma = pp.Literal(",")
greetee = pp.OneOrMore(word)
endpunc = pp.oneOf("! ?")
greeting = salutation + pp.Suppress(comma) + greetee + pp.Suppress(endpunc)
greeting.setParseAction(Greeting)

string = 'Good morning, Miss Crabtree!'

g = greeting.parseString(string)

pkl = 'test .pkl'
pickle.dump(g, open(pkl, 'wb'))
pickle.load(open(pkl, 'rb'))
</code></pre>
<p>The error message is as follows:</p>
<pre><code>Traceback (most recent call last):
File "C:/Users/Arne/parser/test.py", line 23, in &lt;module&gt;
   pickle.load(open(pkl, 'rb'))
TypeError: __new__() missing 1 required positional argument: 'toklist'
</code></pre>
<p><code>__new__()</code> refers to <code>pyparsing.ParseResults.__new__(cls, toklist, name=None, asList=True, modal=True )</code>.</p>
<p>Is it still in general possible to pickle objects returned by <code>pyparsing</code> in Python 3.5.1 or has something changed?</p>
<p>Could somebody provide a brief code sample of their use of <code>pickle</code> and <code>pyparsing 2.0.7</code>?</p>
<p>My real grammar takes a few minutes to parse, so I really would appreciate being able to store the results before further processing.</p>
</div>
<div class="post-text" itemprop="text">
<p>This fails with <code>protocol=2</code> (optional 3rd arg to <code>pickle.dump</code>), but passes if you use pickle <code>protocol</code> = 0 or 1.  On Python 2.7.10, 0 is the default protocol. On Python 3.5, pickle has protocols 0-4, and again, pickling ParseResults only works with protocols 0 and 1. But in Py3.5, the default protocol has changed to 3.  You can work around this problem for now by specifying a protocol of 0 or 1.</p>
<p>More info on pickle protocols at <a href="https://docs.python.org/3/library/pickle.html?highlight=pickle#data-stream-format" rel="nofollow">https://docs.python.org/3/library/pickle.html?highlight=pickle#data-stream-format</a></p>
</div>
<span class="comment-copy">Please show (a) the full error message (including the full stack trace), and (b) a working example that produces this error.</span>
<span class="comment-copy">@poke - I changed my code sample as you suggested. The stack trace is only that short.</span>
<span class="comment-copy">The next release of pyparsing will support all pickle protocols 0-4.</span>
<span class="comment-copy">By the way, pyparsing is awesome!</span>
