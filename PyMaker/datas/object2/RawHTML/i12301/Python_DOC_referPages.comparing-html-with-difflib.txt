<div class="post-text" itemprop="text">
<p>I'm looking to get reliable diffs of <strong>content only</strong> (structural changes will be rare and therefore can be ignored) of <a href="https://secure.ssa.gov/apps10/reference.nsf/instructiontypecode!openview&amp;restricttocategory=POMT" rel="nofollow noreferrer">this</a> page. More specifically, the only change I need to pick up is a new Instruction ID added:</p>
<p><a href="https://i.stack.imgur.com/z5xJ9.png" rel="nofollow noreferrer"><img alt="enter image description here" src="https://i.stack.imgur.com/z5xJ9.png"/></a></p>
<p>To get a feel for what <strong>difflib</strong> will produce, I first diff two <em>identical</em> HTML contents, hoping to get nothing back:</p>
<pre><code>url = 'https://secure.ssa.gov/apps10/reference.nsf/instructiontypecode!openview&amp;restricttocategory=POMT'
response = urllib.urlopen(url
content = response.read()
import difflib
d = difflib.Differ()

diffed = d.compare(content, content)
</code></pre>
<p>Since <strong>difflib</strong> mimics the UNIX <code>diff</code> utility, I would expect <code>diffed</code> to contain nothing (or give some indication that the sequences were identical, yet yet if I <code>'\n'.join</code> <code>diffed</code>, I get <a href="http://pastebin.com/cPGeGQVR" rel="nofollow noreferrer">something resembling HTM</a>L, (although it doesn't render in a browser)</p>
<p>Indeed, if I take the simplest case possible of diffing two characters:</p>
<p><code>diffed</code> = d.compare('a', 'a')</p>
<p><code>diffed.next()</code> produces the following:</p>
<pre><code>'  a'
</code></pre>
<p>So I am either expecting something from <strong>difflib</strong> that it can't or won't provide (and I should change tack), or am I misusing it? What are viable alternatives for diffing HTML?</p>
</div>
<div class="post-text" itemprop="text">
<p>The arguments to <a href="https://docs.python.org/3/library/difflib.html#difflib.Differ.compare" rel="nofollow"><code>Differ.compare()</code></a> are supposed to be sequences of strings. If you use two strings they will be each treated as sequence and therefore compared character by character.</p>
<p>So your example should be rewritten as:</p>
<pre><code>url = 'https://secure.ssa.gov/apps10/reference.nsf/instructiontypecode!openview&amp;restricttocategory=POMT'
response = urllib.urlopen(url)
content = response.readlines()  # get response as list of lines
import difflib
d = difflib.Differ()

diffed = d.compare(content, content)
print('\n'.join(diffed))
</code></pre>
<p>If you only want to compare the content of a html file, you should probably use a parser to process it and get only text without tags, e.g. by using BeautifulSoup's <a href="http://www.crummy.com/software/BeautifulSoup/bs4/doc/#strings-and-stripped-strings" rel="nofollow">soup.stripped_strings</a>:</p>
<pre><code>...
soup = bs4.BeautifulSoup(html_content)
diff = d.compare(list(soup.stripped_strings), list_to_compare_to)
print('\n'.join(diff))
...
</code></pre>
</div>
<span class="comment-copy">Odd: (i) when I perform <code>d.compare(content, content)</code>, where <code>content</code> is now the output of <code>.readlines()</code> as opposed to <code>.read()</code>, the output is still the full HTML document, despite identical content, albeit with each line separated by a newline (ii) Likewise with your suggested bs4 approach - when I compare <code>list(soup.stripped_strings)</code> with <code>list(soup.stripped_strings)</code>, the output is still the full HTML doc (with tags removed). What am I misunderstanding here?</span>
<span class="comment-copy">That is how a <a href="https://docs.python.org/3/library/difflib.html#difflib.Differ" rel="nofollow noreferrer">Differ</a> works, it will return the whole document, if there are changes they will be prefixed with <code>-</code> or <code>+</code> to indicate lines removed from input a and added to input b. So if both inputs are equal, you'll just not get any lines with such prefixes.</span>
<span class="comment-copy">I see. Thanks. I've put this knowledge to use here. I welcome your thoughts on it:  <a href="http://stackoverflow.com/q/35375004/1389110">stackoverflow.com/q/35375004/1389110</a></span>
