<div class="post-text" itemprop="text">
<p>I am trying automate linux administration using Python Paramiko ssh module, everything working fine except sudo. I followed the paramiko documentation for sudo using <code>stdin.write()</code> and <code>stdin.flush()</code> but no luck so far.Please help me on this.</p>
<pre><code>ssh = paramiko.SSHClient()
ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy())
ssh.connect(host,username=uname,password=pwd)
print('Successfully authenticated on'+ " " +host)            
print "\n"
stdin,stdout,stderr = ssh.exec_command('sudo ls')
stdin.write(pwd+'\n')
stdin.flush()
print stdout.readlines()
ssh.close()
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>sudo behaves in very specific ways regarding the TTY you're on, in order to maintain its idea of security. There is a command line option to write the prompt to <code>stderr</code> and read from <code>stdin</code>, instead of sudo dealing with the TTY directly. </p>
<p>Try:</p>
<pre><code>stdin, stdout, stderr = ssh.exec_command('sudo -S ls')
</code></pre>
<p>If you're doing this for system administration tasks, a lot of the framework has already been done. You could have a look at <a href="http://www.fabfile.org/" rel="nofollow">Fabric</a>  if you're happy writing python for most things, or something like <a href="http://www.ansible.com/" rel="nofollow">Ansible</a> to still control things over <code>ssh</code> but write policy in a simpler <code>yaml</code> format.</p>
</div>
<div class="post-text" itemprop="text">
<p>You can also use the <a href="https://docs.python.org/3/library/atexit.html" rel="nofollow noreferrer">atexit</a> module. It cleans my functions on exit.
I use it like this: <code>atexit.register(client.close)</code></p>
</div>
<span class="comment-copy">you got any error, or no output?</span>
<span class="comment-copy">I dint get any erros, i see as below Successfully authenticated on 192.168.1.19   []</span>
<span class="comment-copy">please try to run same command on console, have you got any fine in that? This may happen if there is not file in current directory.</span>
<span class="comment-copy">wow .. stdin,stdout,stderr = ssh.exec_command('sudo -S ls') did work.  Thanks a lot for your help</span>
