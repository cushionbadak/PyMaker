<div class="post-text" itemprop="text">
<p>I am trying to run the Embedding Python in Another Application example found at <a href="https://docs.python.org/3/extending/embedding.html#very-high-level-embedding" rel="nofollow noreferrer">https://docs.python.org/3/extending/embedding.html#very-high-level-embedding</a> on my MacOS. While I can get the program to compile with my Anaconda distribution of Python3.7 and SCons, running it always throws the following error:</p>
<pre><code>Could not find platform independent libraries &lt;prefix&gt;
Could not find platform dependent libraries &lt;exec_prefix&gt;
Consider setting $PYTHONHOME to &lt;prefix&gt;[:&lt;exec_prefix&gt;]
Fatal Python error: initfsencoding: unable to load the file system codec
ModuleNotFoundError: No module named 'encodings'
</code></pre>
<p>I've tried the advice given at this StackOverflow post <a href="https://stackoverflow.com/questions/19292957/how-can-i-troubleshoot-python-could-not-find-platform-independent-libraries-pr">How can I troubleshoot Python "Could not find platform independent libraries &lt;prefix&gt;"</a>, by setting my PYTHONHOME variable to /usr/local, my Anaconda root directory, and the parent directory of the Python executable. I've also tried setting my PYTHONPATH variable to each of the folders. However, setting PYTHONHOME will cause my Anaconda installation of Python to crash with the message:</p>
<pre><code>Fatal Python error: initfsencoding: unable to load the file system codec
ModuleNotFoundError: No module named 'encodings'
</code></pre>
<p>I don't have any Python virtual environments set up and Python runs fine outside of this embedding example and setting the PYTHONHOME variable. Additionally the parent folder of the Anaconda Python binary is the first folder in my PATH variable, so I know Py_Initialize won't find the default MacOS installation of Python first. I've tried uninstalling and reinstalling Anaconda but the same error persists. The following code is my SConstruct file used to compile the example.</p>
<pre><code>env = Environment(
    CPPPATH=[
        "/Users/user/anaconda3/include",
        "/Users/user/anaconda3/include/python3.7m"
    ],
    LIBPATH=["/Users/user/anaconda3/lib/python3.7/config-3.7m-darwin"],
    LIBS=["dl", "python3.7m"]
)

env.Program("wrapper", "wrapper.c")
</code></pre>
<p>Any help or advice is appreciated. Thank you.</p>
</div>
<div class="post-text" itemprop="text">
<p>It will depend on how the python libraries are setup. I am assuming that they are using RPATH which in that case you can make your environment like this:</p>
<pre><code>env = Environment(
    CPPPATH=[
        "/Users/user/anaconda3/include",
        "/Users/user/anaconda3/include/python3.7m"
    ],
    LIBPATH=["/Users/user/anaconda3/lib/python3.7/config-3.7m-darwin"],
    LIBS=["dl", "python3.7m"],
    LINKFLAGS='-rpath /Users/user/anaconda3/lib/python3.7/config-3.7m-darwin'
)

env.Program("wrapper", "wrapper.c")
</code></pre>
<p>in that config folder there should be some dynamic libraries, which you can run the otool on:</p>
<pre><code>otool -L libpython3.7.dylib
</code></pre>
<p>Which should print how the library is being linked by the linker.</p>
<p>You can find more information here:</p>
<p><a href="https://stackoverflow.com/a/31824839/1644736">https://stackoverflow.com/a/31824839/1644736</a>
<a href="https://wincent.com/wiki/@executable_path,_@load_path_and_@rpath" rel="nofollow noreferrer">https://wincent.com/wiki/@executable_path,_@load_path_and_@rpath</a></p>
</div>
<span class="comment-copy">Did you read the section 1.6 from your python documentation link: <a href="https://docs.python.org/3/extending/embedding.html#compiling-and-linking-under-unix-like-systems" rel="nofollow noreferrer">docs.python.org/3/extending/â€¦</a>. It seems like you might need some more CFLAGS and LDFLAGS.</span>
<span class="comment-copy">So it turns out that setting LD_LIBRARY_PATH=~/anaconda3/lib/python3.7/config-3.7m-darwin solves the problem. Can you explain to me what argument I should pass to Environment to avoid having to alter LD_LIBRARY_PATH?</span>
