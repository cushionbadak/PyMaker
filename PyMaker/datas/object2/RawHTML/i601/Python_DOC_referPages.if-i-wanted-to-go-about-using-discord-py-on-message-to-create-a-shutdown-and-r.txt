<div class="post-text" itemprop="text">
<p>My Discord Bot runs off discord.py, using the on_message function. If I wanted to use this, to create a command which would shutdown, and another to restart my Discord Bot, how would I do it?</p>
<p>I run the bot off a server host on repl.it.
I will link some code below so you can see what I mean by on_message:</p>
<pre><code>  if message.content.upper().startswith("!SHUTDOWN"):
    if "534116283487223809" in [role.id for role in message.author.roles]:
      await client.send_message(message.channel, "*Shutting Down...*")
      time.sleep(0.5)
      #SCRIPT TO SHUTDOWN HERE
</code></pre>
<p>Ideally the commands should work as <code>!shutdown</code> and <code>!restart</code>, and should only be able to be used by me.</p>
<p>Thanks in advance,
H</p>
</div>
<div class="post-text" itemprop="text">
<p>To exit the script, you would call <a href="https://docs.python.org/3/library/sys.html#sys.exit" rel="nofollow noreferrer"><code>sys.exit([arg])</code></a>. To <em>restart</em> the script, take a look at <a href="https://docs.python.org/3/library/os.html#os.execl" rel="nofollow noreferrer"><code>os.exec*()</code></a>.</p>
<p>For example:</p>
<pre><code>if message.content.upper().startswith("!SHUTDOWN"):
  if "534116283487223809" in [role.id for role in message.author.roles]:
    await client.send_message(message.channel, "*Shutting Down...*")
    time.sleep(0.5)
    os.exit(0) # the exit code, 0, means it exited successfully
if message.content.upper().startswith("!RESTART"):
  if "534116283487223809" in [role.id for role in message.author.roles]:
    await client.send_message(message.channel, "*Restarting...*")
    time.sleep(0.5)
    python = sys.executable
    os.execl(python, python, *sys.argv)
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>You can place your code in a <code>while</code> loop and use <a href="https://discordpy.readthedocs.io/en/latest/api.html#discord.Client.logout" rel="nofollow noreferrer"><code>client.logout()</code></a> to close the Discord connection. The <code>!restart</code> command will then only use <code>client.logout()</code> without interrupting the <code>while</code> loop, and <code>!shutdown</code> will also use <code>client.logout()</code> but will call <code>break</code> to cancel the <code>while</code> loop.</p>
<p>You can create commands to handle this instead of having everything in the <code>on_message</code> event, which will become cluttered.</p>
<pre><code>from discord.ext import commands

while True:
    client = commands.Bot(command_prefix='!')

    @client.command(pass_context=True)
    async def restart(ctx):
        if "534116283487223809" in [role.id for role in ctx.message.author.roles]:
            await client.logout()

    @client.command(pass_context=True)
    async def shutdown(ctx):
        if "534116283487223809" in [role.id for role in ctx.message.author.roles]:
            await client.logout()
            break

    @client.event
    async def on_message(message)
        # do previous on_message stuff here
        await client.process_commands(message) # add at bottom to allow commands to work

    client.run('token')
</code></pre>
</div>
<span class="comment-copy">How would I go about adding this to my code? @FlyingSixtySix</span>
<span class="comment-copy">I've added an example. I'm not entirely sure if these will work with repl.it, but it's worth a shot.</span>
