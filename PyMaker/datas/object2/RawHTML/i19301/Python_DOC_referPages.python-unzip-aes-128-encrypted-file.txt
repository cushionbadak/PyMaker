<div class="post-text" itemprop="text">
<p>Is there a way to decompress an AES-128 encrypte file directly with python, since ZipFile throws a Bad Password error. If i use 7zip it works, so the password is correct, but then again 7zip needs to be installed as a dependency.</p>
<p>What i tried:</p>
<pre><code>from ZipFile import ZipFile
zip = ZipFile('test.zip')
zip.extractall(pwd='password')
</code></pre>
<p>This throws the Bad Password exception.</p>
<p>Checking the file with 7zip</p>
<pre><code>7z l -slt test.zip
</code></pre>
<p>This returns:</p>
<pre><code>Encrypted = +
Method = pkAES-128 Deflate
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>The zipfile module from the Python standard library supports only CRC32 encrypted zip files (see here: <a href="http://hg.python.org/cpython/file/71adf21421d9/Lib/zipfile.py#l420" rel="nofollow">http://hg.python.org/cpython/file/71adf21421d9/Lib/zipfile.py#l420</a> ). So, there is no way around some 3rd party dependency. </p>
<p>The easiest way would be to just install 7zip and call the commandline utility <code>7z</code> using the <code>subprocess</code> module from the standard lib:</p>
<pre><code>import subprocess
subprocess.call(["7z", "x", "-ppassword", "test.zip"])
</code></pre>
<p>Another option would be the python module "PyLzma" which can also handle AES encrypted 7zip archives: <a href="https://github.com/fancycode/pylzma" rel="nofollow">https://github.com/fancycode/pylzma</a> . It doesn't directly support decrypting classic zip files but you could use its routines to write your own decompressor function.</p>
</div>
<div class="post-text" itemprop="text">
<p>You can use the library <em>pyzipper</em>: <a href="https://github.com/danifus/pyzipper" rel="nofollow noreferrer">https://github.com/danifus/pyzipper</a>. It works nearly the same as Python's <a href="https://docs.python.org/3/library/zipfile.html" rel="nofollow noreferrer">zipfile</a>:</p>
<pre class="lang-py prettyprint-override"><code>import pyzipper

with pyzipper.AESZipFile('my_archive.zip') as f:
    f.pwd = b'myPassword'
    print(f.infolist())
    file_content = f.read('testfile.txt')
</code></pre>
</div>
