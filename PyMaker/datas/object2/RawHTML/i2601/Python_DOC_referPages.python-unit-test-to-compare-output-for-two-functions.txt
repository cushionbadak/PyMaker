<div class="post-text" itemprop="text">
<p>I am trying to perform a unit test to check if the count of two queries are the same.</p>
<p>Given below is my code that I have in place. Could anyone assist on how I could perform a unit test in python to check if the counts in both these functions are the same.</p>
<p><strong>base.py</strong></p>
<pre><code>import psycopg2

def q1():
  dwh_connection = psycopg2.connect(connection_details)
  cur = dwh_connection.cursor()
  cur.execute("select count(*) from table_1 limit 4")
  dwh_connection.close()

def q2():
  dwh_connection = psycopg2.connect(connection_details)
  cur = dwh_connection.cursor()
  cur.execute("select count(*) from table_2 limit 4")
  dwh_connection.close()
</code></pre>
<p>Thanks.</p>
<p><strong>Edit:</strong></p>
<p><em>Error message:</em></p>
<pre><code>File "/Users/PycharmProjects/unit/test_calc.py", line 10, in test_queries self.assertEqual(q1(),q2()) 

NameError: name 'q1' is not defined
</code></pre>
<p>Given below is my unittest code</p>
<pre><code>import unittest
import base import q1, q2


class TestStringMethods(unittest.TestCase):

    def test_queries(self):
        self.assertEqual(q1(),q2())

if __name__ == '__main__':
    unittest.main()
</code></pre>
<p><strong><em>Code for base.py</em></strong></p>
<pre><code>import psycopg2

def q1():
   dwh_connection = psycopg2.connect(conn_details)
   cur = dwh_connection.cursor()
   query = "select count(*) from tble_1;"
   cur.execute(query)
   var = cur.fetchone()
   print (var[0])
   dwh_connection.close()

def q2():
   dwh_connection = psycopg2.connect(conn_details)
   cur = dwh_connection.cursor()
   query = "select count(*) from tble_2;"
   cur.execute(query)
   var = cur.fetchone()
   print (var[0])
   dwh_connection.close()

q1()
q2()

The above code works just fine, if executed separately.
</code></pre>
</div>
<div class="post-text" itemprop="text">
<p>You can unit test with something like</p>
<pre><code>import unittest

class TestExample(unittest.TestCase):

    def test_queries(self):
        self.assertEqual(q1(), q2())

if __name__ == '__main__':
    unittest.main()
</code></pre>
<p>However, your functions dont return anything right now. Change them to something like</p>
<pre><code>def q1():
   dwh_connection = psycopg2.connect(connection_details)
   cur = dwh_connection.cursor()
   result = cur.execute("""select count(*) from table_1 limit 4""").fetchone()
   dwh_connection.close()
   return result
</code></pre>
</div>
<span class="comment-copy">It's generally discouraged to be testing the database when writing unit tests. This is because you're basically testing the database and there are other state issues that could go wrong between runs. Unit tests should be stateless between runs, and this basically ties them to a state. I'd recommend looking into <code>mock</code> here: <a href="https://docs.python.org/3/library/unittest.mock.html" rel="nofollow noreferrer">docs.python.org/3/library/unittest.mock.html</a></span>
<span class="comment-copy">thanks for the reply. I get an error that says q1 is not defined (refers to line "self.assertEqual(q1(), q2())" ). Could you please assist on this. Thanks..</span>
<span class="comment-copy">@darkhorse: <code>q1</code> is the function in the second code example. have you added it to your code??</span>
<span class="comment-copy">yes I have two functions q1 and q2 part of my initial code (base.py). Which when executed separately run fine. When I call these functions in my UnitCase I get an error as below   File "/Users/user/unit/test_calc.py", line 10, in test_queries     self.assertEqual(q1(),q2()) NameError: name 'q1' is not defined</span>
<span class="comment-copy">I have edited my initial message with the updated unit test code..</span>
<span class="comment-copy">@darkhorse: if they are in another file, they need to be imported</span>
