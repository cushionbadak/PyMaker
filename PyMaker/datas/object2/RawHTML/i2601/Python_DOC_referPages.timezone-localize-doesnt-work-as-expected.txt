<div class="post-text" itemprop="text">
<p>Currently, I tried to understand how <code>timezone.localize</code> work.</p>
<h2>naive datetime (without timezone information)</h2>
<p>Now, I try to create a naive datetime (without timezone information). I assume everything will respect to UTC</p>
<pre><code>&gt;&gt;&gt; d = datetime.datetime.fromtimestamp(1535500800)
&gt;&gt;&gt; d
datetime.datetime(2018, 8, 29, 0, 0)
&gt;&gt;&gt; time.mktime(d.timetuple())
1535500800.0
&gt;&gt;&gt; d.hour
0
</code></pre>
<p>(Screenshot from <a href="https://www.epochconverter.com/" rel="nofollow noreferrer">https://www.epochconverter.com/</a> , by using 1535500800 as timestamp. Red rectangles are for UTC timezone)
<a href="https://i.stack.imgur.com/0blxo.png" rel="nofollow noreferrer"><img alt="enter image description here" src="https://i.stack.imgur.com/0blxo.png"/></a></p>
<hr/>
<p>Everything seems fine. Now, I would like to experiment with <code>timezone.localize</code></p>
<hr/>
<h2>datetime with timezone using timezone.localize</h2>
<pre><code>&gt;&gt;&gt; d = datetime.datetime.fromtimestamp(1535500800)
&gt;&gt;&gt; d
datetime.datetime(2018, 8, 29, 0, 0)
&gt;&gt;&gt; kl_timezone = timezone('Asia/Kuala_Lumpur')
&gt;&gt;&gt; d = kl_timezone.localize(d)
&gt;&gt;&gt; d
datetime.datetime(2018, 8, 29, 0, 0, tzinfo=&lt;DstTzInfo 'Asia/Kuala_Lumpur' +08+8:00:00 STD&gt;)
&gt;&gt;&gt; time.mktime(d.timetuple())
1535500800.0
&gt;&gt;&gt; d.hour
0
</code></pre>
<p>(Screenshot from <a href="https://www.epochconverter.com/" rel="nofollow noreferrer">https://www.epochconverter.com/</a> , by using 1535500800 as timestamp. Blue rectangles are for Kuala Lumpur timezone)</p>
<p><a href="https://i.stack.imgur.com/bRGGm.png" rel="nofollow noreferrer"><img alt="enter image description here" src="https://i.stack.imgur.com/bRGGm.png"/></a></p>
<p>The time information highlight in <strong>blue</strong> rectangle is Kuala Lumpur timezone. Hence, I'm expecting after running <code>d = kl_timezone.localize(d)</code>, <code>d.hour</code> will return 8.</p>
<p>This is because</p>
<ul>
<li>Given 1535500800 timestamp, UTC residents treat it as 12:00 am</li>
<li>Given 1535500800 timestamp, Kuala Lumpur residents treat it as 8:00 am</li>
</ul>
<p>But, <code>d.hour</code> is returning 0, even after I use <code>kl_timezone.localize(d)</code>. </p>
<p>Isn't <code>d.hour</code> should return 8, because at timestamp 1535500800, Kuala Lumpur is 8:00 am?</p>
<p>Am I having wrong expectation on <code>timezone.localize</code>?</p>
</div>
<div class="post-text" itemprop="text">
<p><code>datetime.fromtimestamp</code> actually converts the to a timestamp in your local timezone. To get the timestamp with respect to UTC, you would use <a href="https://docs.python.org/3/library/datetime.html#datetime.datetime.utcfromtimestamp" rel="nofollow noreferrer"><code>datetime.utcfromtimestamp</code></a>. From there, you would make it aware, with <code>localize</code> or <code>replace</code>. Then, to determine what the time would be in Kuala Lumpur, you would use <a href="https://docs.python.org/3/library/datetime.html#datetime.datetime.astimezone" rel="nofollow noreferrer"><code>astimezone</code></a></p>
<pre><code>&gt;&gt;&gt; from datetime import datetime
&gt;&gt;&gt; import pytz
&gt;&gt;&gt; from pytz import timezone
&gt;&gt;&gt; d = datetime.utcfromtimestamp(1535500800)  # naive
&gt;&gt;&gt; d
datetime.datetime(2018, 8, 29, 0, 0)
&gt;&gt;&gt; utc_tz = timezone('UTC')
&gt;&gt;&gt; utc_d = utc_tz.localize(d)  # or utc_d = d.replace(tzinfo=pytz.utc)
&gt;&gt;&gt; utc_d
datetime.datetime(2018, 8, 29, 0, 0, tzinfo=&lt;UTC&gt;)
&gt;&gt;&gt; kl_tz = timezone('Asia/Kuala_Lumpur')
&gt;&gt;&gt; kl_d = utc_d.astimezone(kl_tz)  # convert from UTC to Malaysia
&gt;&gt;&gt; kl_d
datetime.datetime(2018, 8, 29, 8, 0, tzinfo=&lt;DstTzInfo 'Asia/Kuala_Lumpur' +08+8:00:00 STD&gt;)
</code></pre>
<p>To get back to POSIX timestamp, you would use <a href="https://docs.python.org/3/library/datetime.html#datetime.datetime.timestamp" rel="nofollow noreferrer"><code>timestamp</code></a></p>
<pre><code>&gt;&gt;&gt; kl_d.timestamp()
&gt;&gt;&gt; 1535500800.0
</code></pre>
</div>
<span class="comment-copy">Ok. I can see using <code>astimezone</code> is returning correct hour value. However, I notice the timestamp value changed as well. I do expect timestamp stayed the time - <a href="https://gist.github.com/yccheok/673b14af3d8bde75d656a2e2d17dc164" rel="nofollow noreferrer">gist.github.com/yccheok/673b14af3d8bde75d656a2e2d17dc164</a> . Isn't the timestamp should stay the same? (Timestamp stays same across different timezone - <a href="https://stackoverflow.com/questions/23062515/do-unix-timestamps-change-across-timezones" title="do unix timestamps change across timezones">stackoverflow.com/questions/23062515/â€¦</a>)</span>
<span class="comment-copy">The timestamp value with respect to UTC timezone would not change, but <code>mktime</code> that you used in your example converts it with respect to your <i>local</i> time. If you want to convert it to seconds w.r.t to UTC, I would suggest using <a href="https://docs.python.org/3/library/datetime.html#datetime.datetime.timestamp" rel="nofollow noreferrer"><code>timestamp</code></a> (e.g. <code>kl_d.timestamp()</code>)</span>
<span class="comment-copy">Ok. Now I notice that I'm using the wrong way to get timestamp. <code>kl_d.timestamp()</code> is the correct way instead of <code>time.mktime(kl_d.timetuple())</code></span>
