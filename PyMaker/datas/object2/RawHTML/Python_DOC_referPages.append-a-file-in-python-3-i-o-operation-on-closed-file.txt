<div class="post-text" itemprop="text">
<p>I'm able to open and write some headers to a csv file at the start of my code:</p>
<pre><code>## Create the output file
with open(output_file, mode='w+') as csv_file:
                    fieldnames = ['Name', 'Instance ID', 'Type', 'State', 'Private IP', 'Public IP', 'Region', 'Availability Zone', 'Launch Time' ]
                    writer = csv.DictWriter(csv_file, fieldnames=fieldnames)
                    writer.writeheader()
</code></pre>
<p>But in the same program I build a list of EC2 instances, and try to print that list to the same file later on in the code, and I get this error:</p>
<pre><code>File "C:\Users\tdunphy\AppData\Local\Programs\Python\Python37-32\lib\csv.py", line 155, in writerow
    return self.writer.writerow(self._dict_to_list(rowdict))
ValueError: I/O operation on closed file.
</code></pre>
<p>The is the code where I try to append to the file, that produces the above error:</p>
<pre><code>with open(output_file, mode='a+') as csv_file:
    writer.writerow({'Name': name, 'Instance ID': instance_id, 'Type': instance_type, 'State': instance_state, 'Private IP': private_ips, 'Public IP': public_ips, 'Region': aws_region, 'Availability Zone': availability_zone, 'Launch Time': launch_time_friendly})
</code></pre>
<p>Why can't I write to this file? What can I do to correct that?</p>
</div>
<div class="post-text" itemprop="text">
<p>You might need to add back this line before trying to writerow, as the old writer may still be referring to a "closed" file in memory:</p>
<pre><code>writer = csv.DictWriter(csv_file, fieldnames=fieldnames)
</code></pre>
</div>
<div class="post-text" itemprop="text">
<pre><code>with open(path, 'w+') as f1:
     s = store(f1)
with open(path, 'a+') as f2:
     s.operate_on()
</code></pre>
<p>if the same as </p>
<pre><code>try:
    f1 = open(path, 'w+') as f:
    s = store(f1)
finally:
    f1.close()
try:
    f2 = open(path, 'a+')
    s.operate_on()
finally:
    f2.close()
</code></pre>
<p>Perhaps this is more obvious what you're problem is. You're storing an open file object, then closing it, then opening some other file object <code>f2</code> which you never use and trying to operate on the closed file.</p>
<p>Your solution is to either put <code>writer.writerow(...)</code> in the first <code>with</code> block or just do</p>
<pre><code>csv_file = open(output_file, mode='w+')
</code></pre>
<p>and be careful to close it later.</p>
<p>Alternatively, create a new <code>csv.DictWriter</code> with the new file object.</p>
</div>
<span class="comment-copy">The error is very much self explanatory!</span>
<span class="comment-copy">That was it. Thanks!</span>
