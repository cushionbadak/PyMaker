link:
library/contextvars.html#contextvars.ContextVar

docs:


class contextvars.ContextVar(name[, *, default])¶
This class is used to declare a new Context Variable, e.g.:
var: ContextVar[int] = ContextVar('var', default=42)


The required name parameter is used for introspection and debug
purposes.
The optional keyword-only default parameter is returned by
ContextVar.get() when no value for the variable is found
in the current context.
Important: Context Variables should be created at the top module
level and never in closures.  Context objects hold strong
references to context variables which prevents context variables
from being properly garbage collected.


name¶
The name of the variable.  This is a read-only property.

New in version 3.7.1.




get([default])¶
Return a value for the context variable for the current context.
If there is no value for the variable in the current context,
the method will:

return the value of the default argument of the method,
if provided; or
return the default value for the context variable,
if it was created with one; or
raise a LookupError.




set(value)¶
Call to set a new value for the context variable in the current
context.
The required value argument is the new value for the context
variable.
Returns a Token object that can be used
to restore the variable to its previous value via the
ContextVar.reset() method.



reset(token)¶
Reset the context variable to the value it had before the
ContextVar.set() that created the token was used.
For example:
var = ContextVar('var')

token = var.set('new value')
# code that uses 'var'; var.get() returns 'new value'.
var.reset(token)

# After the reset call the var has no value again, so
# var.get() would raise a LookupError.



