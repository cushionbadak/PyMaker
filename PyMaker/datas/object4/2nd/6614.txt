link:
library/urllib.request.html#module-urllib.request

docs:

 — Extensible library for opening URLs¶
Source code: Lib/urllib/request.py

The  module defines functions and classes which help in
opening URLs (mostly HTTP) in a complex world — basic and digest
authentication, redirections, cookies and more.

See also
The Requests package
is recommended for a higher-level HTTP client interface.

The  module defines the following functions:


(url, data=None, [timeout, ]*, cafile=None, capath=None, cadefault=False, context=None)¶
Open the URL url, which can be either a string or a
 object.
data must be an object specifying additional data to be sent to the
server, or  if no such data is needed.  See 
for details.
urllib.request module uses HTTP/1.1 and includes  header
in its HTTP requests.
The optional timeout parameter specifies a timeout in seconds for
blocking operations like the connection attempt (if not specified,
the global default timeout setting will be used).  This actually
only works for HTTP, HTTPS and FTP connections.
If context is specified, it must be a  instance
describing the various SSL options. See 
for more details.
The optional cafile and capath parameters specify a set of trusted
CA certificates for HTTPS requests.  cafile should point to a single
file containing a bundle of CA certificates, whereas capath should
point to a directory of hashed certificate files.  More information can
be found in .
The cadefault parameter is ignored.
This function always returns an object which can work as a
context manager and has methods such as

 — return the URL of the resource retrieved,
commonly used to determine if a redirect was followed
 — return the meta-information of the page, such as headers,
in the form of an  instance (see
Quick Reference to HTTP Headers)
 – return the HTTP status code of the response.

For HTTP and HTTPS URLs, this function returns a
 object slightly modified. In addition
to the three new methods above, the msg attribute contains the
same information as the 
attribute — the reason phrase returned by server — instead of
the response headers as it is specified in the documentation for
.
For FTP, file, and data URLs and requests explicitly handled by legacy
 and  classes, this function
returns a  object.
Raises  on protocol errors.
Note that  may be returned if no handler handles the request (though
the default installed global  uses
 to ensure this never happens).
In addition, if proxy settings are detected (for example, when a 
environment variable like  is set),
 is default installed and makes sure the requests are
handled through the proxy.
The legacy  function from Python 2.6 and earlier has been
discontinued;  corresponds to the old
.  Proxy handling, which was done by passing a dictionary
parameter to , can be obtained by using
 objects.

Changed in version 3.2: cafile and capath were added.


Changed in version 3.2: HTTPS virtual hosts are now supported if possible (that is, if
 is true).


New in version 3.2: data can be an iterable object.


Changed in version 3.3: cadefault was added.


Changed in version 3.4.3: context was added.


Deprecated since version 3.6: cafile, capath and cadefault are deprecated in favor of context.
Please use  instead, or let
 select the system’s trusted CA
certificates for you.




(opener)¶
Install an  instance as the default global opener.
Installing an opener is only necessary if you want urlopen to use that
opener; otherwise, simply call  instead of
.  The code does not check for a real
, and any class with the appropriate interface will
work.



([handler, ...])¶
Return an  instance, which chains the handlers in the
order given. handlers can be either instances of , or
subclasses of  (in which case it must be possible to call
the constructor without any parameters).  Instances of the following classes
will be in front of the handlers, unless the handlers contain them,
instances of them or subclasses of them:  (if proxy
settings are detected), , ,
, ,
, , .
If the Python installation has SSL support (i.e., if the  module
can be imported),  will also be added.
A  subclass may also change its 
attribute to modify its position in the handlers list.



(path)¶
Convert the pathname path from the local syntax for a path to the form used in
the path component of a URL.  This does not produce a complete URL.  The return
value will already be quoted using the  function.



(path)¶
Convert the path component path from a percent-encoded URL to the local syntax for a
path.  This does not accept a complete URL.  This function uses
 to decode path.



()¶
This helper function returns a dictionary of scheme to proxy server URL
mappings. It scans the environment for variables named ,
in a case insensitive approach, for all operating systems first, and when it
cannot find it, looks for proxy information from Mac OSX System
Configuration for Mac OS X and Windows Systems Registry for Windows.
If both lowercase and uppercase environment variables exist (and disagree),
lowercase is preferred.

Note
If the environment variable  is set, which usually
indicates your script is running in a CGI environment, the environment
variable  (uppercase ) will be ignored. This is
because that variable can be injected by a client using the “Proxy:” HTTP
header. If you need to use an HTTP proxy in a CGI environment, either use
 explicitly, or make sure the variable name is in
lowercase (or at least the  suffix).


The following classes are provided:


class (url, data=None, headers={}, origin_req_host=None, unverifiable=False, method=None)¶
This class is an abstraction of a URL request.
url should be a string containing a valid URL.
data must be an object specifying additional data to send to the
server, or  if no such data is needed.  Currently HTTP
requests are the only ones that use data.  The supported object
types include bytes, file-like objects, and iterables.  If no
 nor  header field
has been provided,  will set these headers according
to the type of data.   will be used to send
bytes objects, while  as specified in
RFC 7230, Section 3.3.1 will be used to send files and other iterables.
For an HTTP POST request method, data should be a buffer in the
standard application/x-www-form-urlencoded format.  The
 function takes a mapping or sequence
of 2-tuples and returns an ASCII string in this format. It should
be encoded to bytes before being used as the data parameter.
headers should be a dictionary, and will be treated as if
 was called with each key and value as arguments.
This is often used to “spoof” the  header value, which is
used by a browser to identify itself – some HTTP servers only
allow requests coming from common browsers as opposed to scripts.
For example, Mozilla Firefox may identify itself as , while
’s default user agent string is
 (on Python 2.6).
An appropriate  header should be included if the data
argument is present.  If this header has not been provided and data
is not None,  will
be added as a default.
The final two arguments are only of interest for correct handling
of third-party HTTP cookies:
origin_req_host should be the request-host of the origin
transaction, as defined by RFC 2965.  It defaults to
.  This is the host name or IP
address of the original request that was initiated by the user.
For example, if the request is for an image in an HTML document,
this should be the request-host of the request for the page
containing the image.
unverifiable should indicate whether the request is unverifiable,
as defined by RFC 2965.  It defaults to .  An unverifiable
request is one whose URL the user did not have the option to
approve.  For example, if the request is for an image in an HTML
document, and the user had no option to approve the automatic
fetching of the image, this should be true.
method should be a string that indicates the HTTP request method that
will be used (e.g. ).  If provided, its value is stored in the
 attribute and is used by .
The default is  if data is  or  otherwise.
Subclasses may indicate a different default method by setting the
 attribute in the class itself.

Note
The request will not work as expected if the data object is unable
to deliver its content more than once (e.g. a file or an iterable
that can produce the content only once) and the request is retried
for HTTP redirects or authentication.  The data is sent to the
HTTP server right away after the headers.  There is no support for
a 100-continue expectation in the library.


Changed in version 3.3:  argument is added to the Request class.


Changed in version 3.4: Default  may be indicated at the class level.


Changed in version 3.6: Do not raise an error if the  has not been
provided and data is neither  nor a bytes object.
Fall back to use chunked transfer encoding instead.




class ¶
The  class opens URLs via s chained
together. It manages the chaining of handlers, and recovery from errors.



class ¶
This is the base class for all registered handlers — and handles only the
simple mechanics of registration.



class ¶
A class which defines a default handler for HTTP error responses; all responses
are turned into  exceptions.



class ¶
A class to handle redirections.



class (cookiejar=None)¶
A class to handle HTTP Cookies.



class (proxies=None)¶
Cause requests to go through a proxy. If proxies is given, it must be a
dictionary mapping protocol names to URLs of proxies. The default is to read
the list of proxies from the environment variables
.  If no proxy environment variables are set, then
in a Windows environment proxy settings are obtained from the registry’s
Internet Settings section, and in a Mac OS X environment proxy information
is retrieved from the OS X System Configuration Framework.
To disable autodetected proxy pass an empty dictionary.
The  environment variable can be used to specify hosts
which shouldn’t be reached via proxy; if set, it should be a comma-separated
list of hostname suffixes, optionally with  appended, for example
.


Note
 will be ignored if a variable  is set;
see the documentation on .





class ¶
Keep a database of   mappings.



class ¶
Keep a database of   mappings. A realm of
 is considered a catch-all realm, which is searched if no other realm
fits.



class ¶
A variant of  that also has a
database of  mappings.  Can be used by a
BasicAuth handler to determine when to send authentication credentials
immediately instead of waiting for a  response first.

New in version 3.5.




class (password_mgr=None)¶
This is a mixin class that helps with HTTP authentication, both to the remote
host and to a proxy. password_mgr, if given, should be something that is
compatible with ; refer to section
HTTPPasswordMgr Objects for information on the interface that must be
supported.  If passwd_mgr also provides  and
 methods (see
HTTPPasswordMgrWithPriorAuth Objects), then the handler will use the
 result for a given URI to determine whether or not to
send authentication credentials with the request.  If 
returns  for the URI, credentials are sent.  If 
is , credentials are not sent, and then if a  response is
received the request is re-sent with the authentication credentials.  If
authentication succeeds,  is called to set
  for the URI, so that subsequent requests to
the URI or any of its super-URIs will automatically include the
authentication credentials.

New in version 3.5: Added  support.




class (password_mgr=None)¶
Handle authentication with the remote host. password_mgr, if given, should
be something that is compatible with ; refer to
section HTTPPasswordMgr Objects for information on the interface that must
be supported. HTTPBasicAuthHandler will raise a  when
presented with a wrong Authentication scheme.



class (password_mgr=None)¶
Handle authentication with the proxy. password_mgr, if given, should be
something that is compatible with ; refer to section
HTTPPasswordMgr Objects for information on the interface that must be
supported.



class (password_mgr=None)¶
This is a mixin class that helps with HTTP authentication, both to the remote
host and to a proxy. password_mgr, if given, should be something that is
compatible with ; refer to section
HTTPPasswordMgr Objects for information on the interface that must be
supported.



class (password_mgr=None)¶
Handle authentication with the remote host. password_mgr, if given, should
be something that is compatible with ; refer to
section HTTPPasswordMgr Objects for information on the interface that must
be supported. When both Digest Authentication Handler and Basic
Authentication Handler are both added, Digest Authentication is always tried
first. If the Digest Authentication returns a 40x response again, it is sent
to Basic Authentication handler to Handle.  This Handler method will raise a
 when presented with an authentication scheme other than
Digest or Basic.

Changed in version 3.3: Raise  on unsupported Authentication Scheme.




class (password_mgr=None)¶
Handle authentication with the proxy. password_mgr, if given, should be
something that is compatible with ; refer to section
HTTPPasswordMgr Objects for information on the interface that must be
supported.



class ¶
A class to handle opening of HTTP URLs.



class (debuglevel=0, context=None, check_hostname=None)¶
A class to handle opening of HTTPS URLs.  context and check_hostname
have the same meaning as in .

Changed in version 3.2: context and check_hostname were added.




class ¶
Open local files.



class ¶
Open data URLs.

New in version 3.4.




class ¶
Open FTP URLs.



class ¶
Open FTP URLs, keeping a cache of open FTP connections to minimize delays.



class ¶
A catch-all class to handle unknown URLs.



class ¶
Process HTTP error responses.


Request Objects¶
The following methods describe ’s public interface,
and so all may be overridden in subclasses.  It also defines several
public attributes that can be used by clients to inspect the parsed
request.


¶
The original URL passed to the constructor.

Changed in version 3.4.

Request.full_url is a property with setter, getter and a deleter. Getting
 returns the original request URL with the
fragment, if it was present.



¶
The URI scheme.



¶
The URI authority, typically a host, but may also contain a port
separated by a colon.



¶
The original host for the request, without port.



¶
The URI path.  If the  uses a proxy, then selector
will be the full URL that is passed to the proxy.



¶
The entity body for the request, or  if not specified.

Changed in version 3.4: Changing value of  now deletes “Content-Length”
header if it was previously set or calculated.




¶
boolean, indicates whether the request is unverifiable as defined
by RFC 2965.



¶
The HTTP request method to use.  By default its value is ,
which means that  will do its normal computation
of the method to be used.  Its value can be set (thus overriding the default
computation in ) either by providing a default
value by setting it at the class level in a  subclass, or by
passing a value in to the  constructor via the method
argument.

New in version 3.3.


Changed in version 3.4: A default value can now be set in subclasses; previously it could only
be set via the constructor argument.




()¶
Return a string indicating the HTTP request method.  If
 is not , return its value, otherwise return
 if  is , or  if it’s not.
This is only meaningful for HTTP requests.

Changed in version 3.3: get_method now looks at the value of .




(key, val)¶
Add another header to the request.  Headers are currently ignored by all
handlers except HTTP handlers, where they are added to the list of headers sent
to the server.  Note that there cannot be more than one header with the same
name, and later calls will overwrite previous calls in case the key collides.
Currently, this is no loss of HTTP functionality, since all headers which have
meaning when used more than once have a (header-specific) way of gaining the
same functionality using only one header.



(key, header)¶
Add a header that will not be added to a redirected request.



(header)¶
Return whether the instance has the named header (checks both regular and
unredirected).



(header)¶
Remove named header from the request instance (both from regular and
unredirected headers).

New in version 3.4.




()¶
Return the URL given in the constructor.

Changed in version 3.4.

Returns 



(host, type)¶
Prepare the request by connecting to a proxy server. The host and type will
replace those of the instance, and the instance’s selector will be the original
URL given in the constructor.



(header_name, default=None)¶
Return the value of the given header. If the header is not present, return
the default value.



()¶
Return a list of tuples (header_name, header_value) of the Request headers.


Changed in version 3.4: The request methods add_data, has_data, get_data, get_type, get_host,
get_selector, get_origin_req_host and is_unverifiable that were deprecated
since 3.3 have been removed.



OpenerDirector Objects¶
 instances have the following methods:


(handler)¶
handler should be an instance of .  The following methods
are searched, and added to the possible chains (note that HTTP errors are a
special case).  Note that, in the following, protocol should be replaced
with the actual protocol to handle, for example  would
be the HTTP protocol response handler.  Also type should be replaced with
the actual HTTP code, for example  would handle HTTP
404 errors.

 — signal that the handler knows how to open protocol
URLs.
See  for more information.

 — signal that the handler knows how to handle HTTP
errors with HTTP error code type.
See  for more information.

 — signal that the handler knows how to handle errors
from (non-) protocol.

 — signal that the handler knows how to pre-process
protocol requests.
See  for more information.

 — signal that the handler knows how to
post-process protocol responses.
See  for more information.





(url, data=None[, timeout])¶
Open the given url (which can be a request object or a string), optionally
passing the given data. Arguments, return values and exceptions raised are
the same as those of  (which simply calls the 
method on the currently installed global ).  The
optional timeout parameter specifies a timeout in seconds for blocking
operations like the connection attempt (if not specified, the global default
timeout setting will be used). The timeout feature actually works only for
HTTP, HTTPS and FTP connections).



(proto, *args)¶
Handle an error of the given protocol.  This will call the registered error
handlers for the given protocol with the given arguments (which are protocol
specific).  The HTTP protocol is a special case which uses the HTTP response
code to determine the specific error handler; refer to the 
methods of the handler classes.
Return values and exceptions raised are the same as those of .

OpenerDirector objects open URLs in three stages:
The order in which these methods are called within each stage is determined by
sorting the handler instances.

Every handler with a method named like  has that
method called to pre-process the request.

Handlers with a method named like  are called to handle
the request. This stage ends when a handler either returns a non-
value (ie. a response), or raises an exception (usually
).  Exceptions are allowed to propagate.
In fact, the above algorithm is first tried for methods named
.  If all such methods return , the algorithm
is repeated for methods named like .  If all such methods
return , the algorithm is repeated for methods named
.
Note that the implementation of these methods may involve calls of the parent
 instance’s  and
 methods.

Every handler with a method named like  has that
method called to post-process the response.




BaseHandler Objects¶
 objects provide a couple of methods that are directly
useful, and others that are meant to be used by derived classes.  These are
intended for direct use:


(director)¶
Add a director as parent.



()¶
Remove any parents.

The following attribute and methods should only be used by classes derived from
.

Note
The convention has been adopted that subclasses defining
 or  methods are named
; all others are named .



¶
A valid , which can be used to open using a different
protocol, or handle errors.



(req)¶
This method is not defined in , but subclasses should
define it if they want to catch all URLs.
This method, if implemented, will be called by the parent
.  It should return a file-like object as described in
the return value of the  of , or .
It should raise , unless a truly exceptional
thing happens (for example,  should not be mapped to
).
This method will be called before any protocol-specific open method.




This method is not defined in , but subclasses should
define it if they want to handle URLs with the given protocol.
This method, if defined, will be called by the parent .
Return values should be the same as for  .



(req)¶
This method is not defined in , but subclasses should
define it if they want to catch all URLs with no specific registered handler to
open it.
This method, if implemented, will be called by the 
.  Return values should be the same as for
.



(req, fp, code, msg, hdrs)¶
This method is not defined in , but subclasses should
override it if they intend to provide a catch-all for otherwise unhandled HTTP
errors.  It will be called automatically by the   getting
the error, and should not normally be called in other circumstances.
req will be a  object, fp will be a file-like object with
the HTTP error body, code will be the three-digit code of the error, msg
will be the user-visible explanation of the code and hdrs will be a mapping
object with the headers of the error.
Return values and exceptions raised should be the same as those of
.




nnn should be a three-digit HTTP error code.  This method is also not defined
in , but will be called, if it exists, on an instance of a
subclass, when an HTTP error with code nnn occurs.
Subclasses should override this method to handle specific HTTP errors.
Arguments, return values and exceptions raised should be the same as for
.




This method is not defined in , but subclasses should
define it if they want to pre-process requests of the given protocol.
This method, if defined, will be called by the parent .
req will be a  object. The return value should be a
 object.




This method is not defined in , but subclasses should
define it if they want to post-process responses of the given protocol.
This method, if defined, will be called by the parent .
req will be a  object. response will be an object
implementing the same interface as the return value of .  The
return value should implement the same interface as the return value of
.



HTTPRedirectHandler Objects¶

Note
Some HTTP redirections require action from this module’s client code.  If this
is the case,  is raised.  See RFC 2616 for
details of the precise meanings of the various redirection codes.
An  exception raised as a security consideration if the
HTTPRedirectHandler is presented with a redirected URL which is not an HTTP,
HTTPS or FTP URL.



(req, fp, code, msg, hdrs, newurl)¶
Return a  or  in response to a redirect. This is called
by the default implementations of the  methods when a
redirection is received from the server.  If a redirection should take place,
return a new  to allow  to perform the
redirect to newurl.  Otherwise, raise  if
no other handler should try to handle this URL, or return  if you
can’t but another handler might.

Note
The default implementation of this method does not strictly follow RFC 2616,
which says that 301 and 302 responses to  requests must not be
automatically redirected without confirmation by the user.  In reality, browsers
do allow automatic redirection of these responses, changing the POST to a
, and the default implementation reproduces this behavior.




(req, fp, code, msg, hdrs)¶
Redirect to the  or  URL.  This method is called by the
parent  when getting an HTTP ‘moved permanently’ response.



(req, fp, code, msg, hdrs)¶
The same as , but called for the ‘found’ response.



(req, fp, code, msg, hdrs)¶
The same as , but called for the ‘see other’ response.



(req, fp, code, msg, hdrs)¶
The same as , but called for the ‘temporary redirect’
response.



HTTPCookieProcessor Objects¶
 instances have one attribute:


¶
The  in which cookies are stored.



ProxyHandler Objects¶



The  will have a method  for every
protocol which has a proxy in the proxies dictionary given in the
constructor.  The method will modify requests to go through the proxy, by
calling , and call the next handler in the chain to
actually execute the protocol.



HTTPPasswordMgr Objects¶
These methods are available on  and
 objects.


(realm, uri, user, passwd)¶
uri can be either a single URI, or a sequence of URIs. realm, user and
passwd must be strings. This causes  to be used as
authentication tokens when authentication for realm and a super-URI of any of
the given URIs is given.



(realm, authuri)¶
Get user/password for given realm and URI, if any.  This method will return
 if there is no matching user/password.
For  objects, the realm  will be
searched if the given realm has no matching user/password.



HTTPPasswordMgrWithPriorAuth Objects¶
This password manager extends  to support
tracking URIs for which authentication credentials should always be sent.


(realm, uri, user, passwd, is_authenticated=False)¶
realm, uri, user, passwd are as for
.  is_authenticated sets the initial
value of the  flag for the given URI or list of URIs.
If is_authenticated is specified as , realm is ignored.



(realm, authuri)
Same as for  objects



(self, uri, is_authenticated=False)¶
Update the  flag for the given uri or list
of URIs.



(self, authuri)¶
Returns the current state of the  flag for
the given URI.



AbstractBasicAuthHandler Objects¶


(authreq, host, req, headers)¶
Handle an authentication request by getting a user/password pair, and re-trying
the request.  authreq should be the name of the header where the information
about the realm is included in the request, host specifies the URL and path to
authenticate for, req should be the (failed)  object, and
headers should be the error headers.
host is either an authority (e.g. ) or a URL containing an
authority component (e.g. ). In either case, the
authority must not contain a userinfo component (so,  and
 are fine,  is not).



HTTPBasicAuthHandler Objects¶


(req, fp, code, msg, hdrs)¶
Retry the request with authentication information, if available.



ProxyBasicAuthHandler Objects¶


(req, fp, code, msg, hdrs)¶
Retry the request with authentication information, if available.



AbstractDigestAuthHandler Objects¶


(authreq, host, req, headers)¶
authreq should be the name of the header where the information about the realm
is included in the request, host should be the host to authenticate to, req
should be the (failed)  object, and headers should be the
error headers.



HTTPDigestAuthHandler Objects¶


(req, fp, code, msg, hdrs)¶
Retry the request with authentication information, if available.



ProxyDigestAuthHandler Objects¶


(req, fp, code, msg, hdrs)¶
Retry the request with authentication information, if available.



HTTPHandler Objects¶


(req)¶
Send an HTTP request, which can be either GET or POST, depending on
.



HTTPSHandler Objects¶


(req)¶
Send an HTTPS request, which can be either GET or POST, depending on
.



FileHandler Objects¶


(req)¶
Open the file locally, if there is no host name, or the host name is
.

Changed in version 3.2: This method is applicable only for local hostnames.  When a remote
hostname is given, an  is raised.




DataHandler Objects¶


(req)¶
Read a data URL. This kind of URL contains the content encoded in the URL
itself. The data URL syntax is specified in RFC 2397. This implementation
ignores white spaces in base64 encoded data URLs so the URL may be wrapped
in whatever source file it comes from. But even though some browsers don’t
mind about a missing padding at the end of a base64 encoded data URL, this
implementation will raise an  in that case.



FTPHandler Objects¶


(req)¶
Open the FTP file indicated by req. The login is always done with empty
username and password.



CacheFTPHandler Objects¶
 objects are  objects with the
following additional methods:


(t)¶
Set timeout of connections to t seconds.



(m)¶
Set maximum number of cached connections to m.



UnknownHandler Objects¶


()¶
Raise a  exception.



HTTPErrorProcessor Objects¶


(request, response)¶
Process HTTP error responses.
For 200 error codes, the response object is returned immediately.
For non-200 error codes, this simply passes the job on to the
 handler methods, via .
Eventually,  will raise an
 if no other handler handles the error.



(request, response)¶
Process HTTPS error responses.
The behavior is same as .



Examples¶
In addition to the examples below, more examples are given in
HOWTO Fetch Internet Resources Using The urllib Package.
This example gets the python.org main page and displays the first 300 bytes of
it.


Note that urlopen returns a bytes object.  This is because there is no way
for urlopen to automatically determine the encoding of the byte stream
it receives from the HTTP server. In general, a program will decode
the returned bytes object to string once it determines or guesses
the appropriate encoding.
The following W3C document, https://www.w3.org/International/O-charset, lists
the various ways in which an (X)HTML or an XML document could have specified its
encoding information.
As the python.org website uses utf-8 encoding as specified in its meta tag, we
will use the same for decoding the bytes object.


It is also possible to achieve the same result without using the
context manager approach.


In the following example, we are sending a data-stream to the stdin of a CGI
and reading the data it returns to us. Note that this example will only work
when the Python installation supports SSL.


The code for the sample CGI used in the above example is:


Here is an example of doing a  request using :


Use of Basic HTTP Authentication:


 provides many handlers by default, including a
.  By default,  uses the environment
variables named , where  is the URL scheme
involved.  For example, the  environment variable is read to
obtain the HTTP proxy’s URL.
This example replaces the default  with one that uses
programmatically-supplied proxy URLs, and adds proxy authorization support with
.


Adding HTTP headers:
Use the headers argument to the  constructor, or:


 automatically adds a User-Agent header to
every .  To change this:


Also, remember that a few standard headers (Content-Length,
Content-Type and Host)
are added when the  is passed to  (or
).
Here is an example session that uses the  method to retrieve a URL
containing parameters:


The following example uses the  method instead. Note that params output
from urlencode is encoded to bytes before it is sent to urlopen as data:


The following example uses an explicitly specified HTTP proxy, overriding
environment settings:


The following example uses no proxies at all, overriding environment settings:




Legacy interface¶
The following functions and classes are ported from the Python 2 module
 (as opposed to ).  They might become deprecated at
some point in the future.


(url, filename=None, reporthook=None, data=None)¶
Copy a network object denoted by a URL to a local file. If the URL
points to a local file, the object will not be copied unless filename is supplied.
Return a tuple  where filename is the
local file name under which the object can be found, and headers is whatever
the  method of the object returned by  returned (for
a remote object). Exceptions are the same as for .
The second argument, if present, specifies the file location to copy to (if
absent, the location will be a tempfile with a generated name). The third
argument, if present, is a callable that will be called once on
establishment of the network connection and once after each block read
thereafter.  The callable will be passed three arguments; a count of blocks
transferred so far, a block size in bytes, and the total size of the file.  The
third argument may be  on older FTP servers which do not return a file
size in response to a retrieval request.
The following example illustrates the most common usage scenario:


If the url uses the  scheme identifier, the optional data
argument may be given to specify a  request (normally the request
type is ).  The data argument must be a bytes object in standard
application/x-www-form-urlencoded format; see the
 function.
 will raise  when it detects that
the amount of data available  was less than the expected amount (which is the
size reported by a  Content-Length header). This can occur, for example, when
the  download is interrupted.
The Content-Length is treated as a lower bound: if there’s more data  to read,
urlretrieve reads more data, but if less data is available,  it raises the
exception.
You can still retrieve the downloaded data in this case, it is stored  in the
 attribute of the exception instance.
If no Content-Length header was supplied, urlretrieve can not check the size
of the data it has downloaded, and just returns it.  In this case you just have
to assume that the download was successful.



()¶
Cleans up temporary files that may have been left behind by previous
calls to .



class (proxies=None, **x509)¶

Deprecated since version 3.3.

Base class for opening and reading URLs.  Unless you need to support opening
objects using schemes other than , , or ,
you probably want to use .
By default, the  class sends a User-Agent header
of , where VVV is the  version number.
Applications can define their own User-Agent header by subclassing
 or  and setting the class attribute
 to an appropriate string value in the subclass definition.
The optional proxies parameter should be a dictionary mapping scheme names to
proxy URLs, where an empty dictionary turns proxies off completely.  Its default
value is , in which case environmental proxy settings will be used if
present, as discussed in the definition of , above.
Additional keyword parameters, collected in x509, may be used for
authentication of the client when using the  scheme.  The keywords
key_file and cert_file are supported to provide an  SSL key and certificate;
both are needed to support client authentication.
 objects will raise an  exception if the server
returns an error code.


(fullurl, data=None)¶
Open fullurl using the appropriate protocol.  This method sets up cache and
proxy information, then calls the appropriate open method with its input
arguments.  If the scheme is not recognized,  is called.
The data argument has the same meaning as the data argument of
.
This method always quotes fullurl using .



(fullurl, data=None)¶
Overridable interface to open unknown URL types.



(url, filename=None, reporthook=None, data=None)¶
Retrieves the contents of url and places it in filename.  The return value
is a tuple consisting of a local filename and either an
 object containing the response headers (for remote
URLs) or  (for local URLs).  The caller must then open and read the
contents of filename.  If filename is not given and the URL refers to a
local file, the input filename is returned.  If the URL is non-local and
filename is not given, the filename is the output of 
with a suffix that matches the suffix of the last path component of the input
URL.  If reporthook is given, it must be a function accepting three numeric
parameters: A chunk number, the maximum size chunks are read in and the total size of the download
(-1 if unknown).  It will be called once at the start and after each chunk of data is read from the
network.  reporthook is ignored for local URLs.
If the url uses the  scheme identifier, the optional data
argument may be given to specify a  request (normally the request type
is ).  The data argument must in standard
application/x-www-form-urlencoded format; see the
 function.



¶
Variable that specifies the user agent of the opener object.  To get
 to tell servers that it is a particular user agent, set this in a
subclass as a class variable or in the constructor before calling the base
constructor.




class (...)¶

Deprecated since version 3.3.

 subclasses  providing default handling
for the following HTTP response codes: 301, 302, 303, 307 and 401.  For the 30x
response codes listed above, the Location header is used to fetch
the actual URL.  For 401 response codes (authentication required), basic HTTP
authentication is performed.  For the 30x response codes, recursion is bounded
by the value of the maxtries attribute, which defaults to 10.
For all other response codes, the method  is called
which you can override in subclasses to handle the error appropriately.

Note
According to the letter of RFC 2616, 301 and 302 responses to POST requests
must not be automatically redirected without confirmation by the user.  In
reality, browsers do allow automatic redirection of these responses, changing
the POST to a GET, and  reproduces this behaviour.

The parameters to the constructor are the same as those for .

Note
When performing basic authentication, a  instance calls
its  method.  The default implementation asks the
users for the required information on the controlling terminal.  A subclass may
override this method to support more appropriate behavior if needed.

The  class offers one additional method that should be
overloaded to provide the appropriate behavior:


(host, realm)¶
Return information needed to authenticate the user at the given host in the
specified security realm.  The return value should be a tuple, , which can be used for basic authentication.
The implementation prompts for this information on the terminal; an application
should override this method to use an appropriate interaction model in the local
environment.




 Restrictions¶



Currently, only the following protocols are supported: HTTP (versions 0.9 and
1.0), FTP, local files, and data URLs.

Changed in version 3.4: Added support for data URLs.


The caching feature of  has been disabled until someone
finds the time to hack proper processing of Expiration time headers.

There should be a function to query whether a particular URL is in the cache.

For backward compatibility, if a URL appears to point to a local file but the
file can’t be opened, the URL is re-interpreted using the FTP protocol.  This
can sometimes cause confusing error messages.

The  and  functions can cause arbitrarily
long delays while waiting for a network connection to be set up.  This means
that it is difficult to build an interactive Web client using these functions
without using threads.

The data returned by  or  is the raw data
returned by the server.  This may be binary data (such as an image), plain text
or (for example) HTML.  The HTTP protocol provides type information in the reply
header, which can be inspected by looking at the Content-Type
header.  If the returned data is HTML, you can use the module
 to parse it.

The code handling the FTP protocol cannot differentiate between a file and a
directory.  This can lead to unexpected behavior when attempting to read a URL
that points to a file that is not accessible.  If the URL ends in a , it is
assumed to refer to a directory and will be handled accordingly.  But if an
attempt to read a file leads to a 550 error (meaning the URL cannot be found or
is not accessible, often for permission reasons), then the path is treated as a
directory in order to handle the case when a directory is specified by a URL but
the trailing  has been left off.  This can cause misleading results when
you try to fetch a file whose read permissions make it inaccessible; the FTP
code will try to read it, fail with a 550 error, and then perform a directory
listing for the unreadable file. If fine-grained control is needed, consider
using the  module, subclassing , or changing
_urlopener to meet your needs.



